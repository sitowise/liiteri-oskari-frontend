function phi4z(e,t,i,n,s,r,a,o,l){var u,h,c,p,d,m,f,y,g;for(l=r,g=1;15>=g;g++)if(u=Math.sin(l),tanphi=Math.tan(l),o=tanphi*Math.sqrt(1-e*u*u),h=Math.sin(2*l),c=t*l-i*h+n*Math.sin(4*l)-s*Math.sin(6*l),p=t-2*i*Math.cos(2*l)+4*n*Math.cos(4*l)-6*s*Math.cos(6*l),d=2*c+o*(c*c+a)-2*r*(o*c+1),m=e*h*(c*c+a-2*r*c)/(2*o),f=2*(r-c)*(o*p-2/h)-2*p,y=d/(m+f),l+=y,Math.abs(y)<=1e-10)return l;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(e){var t,i;return t=1+e,i=1-e,Math.sqrt(Math.pow(t,t)*Math.pow(i,i))}Oskari.clazz.define("Oskari.mapframework.openlayers.theme.default.Bundle",function(){},{create:function(){return this},update:function(){},start:function(){var e=this.mediator.manager.bundleDefinitionStates["openlayers-default-theme"].bundlePath;OpenLayers.ImgPath=e+"/img/"},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/css",src:"../../../../resources/openlayers/theme/default/style.css"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"openlayers-default-theme","Bundle-Name":"mapframework.openlayers-default-theme.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:[{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}]}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("openlayers-default-theme","Oskari.mapframework.openlayers.theme.default.Bundle"),function(){Oskari.clazz.define("Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle",function(){},{create:function(){return this},update:function(){},start:function(){},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../libraries/proj4js-1.0.1/proj4js-compressed.js"},{type:"text/javascript",src:"../../../../libraries/OpenLayers/OpenLayers-2.12-c5bb52d-patched.js"}]},bundle:{manifest:{"Bundle-Identifier":"openlayers-map-full","Bundle-Name":"mapframework.openlayers.mapfull.Bundle","Bundle-Author":[{Name:"ah",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:[{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}]}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("openlayers-single-full","Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle")}(),Proj4js={defaultDatum:"WGS84",transform:function(e,t,i){if(!e.readyToUse||!t.readyToUse)return this.reportError("Proj4js initialization for "+e.srsCode+" not yet complete"),i;if("900913"==e.srsProjNumber&&"WGS84"!=t.datumCode||"900913"==t.srsProjNumber&&"WGS84"!=e.datumCode){var n=Proj4js.WGS84;this.transform(e,n,i),e=n}return"longlat"==e.projName?(i.x*=Proj4js.common.D2R,i.y*=Proj4js.common.D2R):(e.to_meter&&(i.x*=e.to_meter,i.y*=e.to_meter),e.inverse(i)),e.from_greenwich&&(i.x+=e.from_greenwich),i=this.datum_transform(e.datum,t.datum,i),t.from_greenwich&&(i.x-=t.from_greenwich),"longlat"==t.projName?(i.x*=Proj4js.common.R2D,i.y*=Proj4js.common.R2D):(t.forward(i),t.to_meter&&(i.x/=t.to_meter,i.y/=t.to_meter)),i},datum_transform:function(e,t,i){return e.compare_datums(t)?i:e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM?i:(e.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&(e.geodetic_to_geocentric(i),(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM)&&e.geocentric_to_wgs84(i),(t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&t.geocentric_from_wgs84(i),t.geocentric_to_geodetic(i)),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),i)},reportError:function(){},extend:function(e,t){if(e=e||{},t)for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},i={},n=0;n<arguments.length;++n)e="function"==typeof arguments[n]?arguments[n].prototype:arguments[n],Proj4js.extend(i,e);return t.prototype=i,t},bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,i=document.getElementsByTagName("script"),n=0;n<i.length;n++){var s=i[n].getAttribute("src");if(s){var r=s.lastIndexOf(e);if(r>-1&&r+t==s.length){this.libPath=s.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,i,n){var s=document.createElement("script");s.defer=!1,s.type="text/javascript",s.id=e,s.src=e,s.onload=t,s.onerror=i,s.loadCheck=n,/MSIE/.test(navigator.userAgent)&&(s.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(s)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(e){if(this.srsCodeInput=e,0==e.indexOf("urn:")){var t=e.split(":");"ogc"!=t[1]&&"x-ogc"!=t[1]||"def"!=t[2]||"crs"!=t[3]||(e=t[4]+":"+t[t.length-1])}else if(0==e.indexOf("http://")){var i=e.split("#");i[0].match(/epsg.org/)?e="EPSG:"+i[1]:i[0].match(/RIG.xml/)&&(e="IGNF:"+i[1])}this.srsCode=e.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return this.defsLoaded(),void 0;var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])return this.initTransforms(),void 0;var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return Proj4js.Proj[e]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var i=this.defData.split("+"),n=0;n<i.length;n++){var s=i[n].split("=");switch(e=s[0].toLowerCase(),t=s[1],e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":this.k0=parseFloat(t);break;case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t),this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];e&&(this.datum_params=e.towgs84?e.towgs84.split(","):null,this.ellps=e.ellipse,this.datumName=e.datumName?e.datumName:this.datumCode)}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}},Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,i){var n=e*t;return i/Math.sqrt(1-n*n)},tsfnz:function(e,t,i){var n=e*i,s=.5*e;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(this.HALF_PI-t))/n},phi2z:function(e,t){var n,s,r=.5*e,a=this.HALF_PI-2*Math.atan(t);for(i=0;15>=i;i++)if(n=e*Math.sin(a),s=this.HALF_PI-2*Math.atan(t*Math.pow((1-n)/(1+n),r))-a,a+=s,Math.abs(s)<=1e-10)return a;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t},asinz:function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,i,n,s){return e*s-t*Math.sin(2*s)+i*Math.sin(4*s)-n*Math.sin(6*s)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return 0>e?-1:1},adjust_lon:function(e){return e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI},adjust_lat:function(e){return e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI},latiso:function(e,t,i){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var n=e*i;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-n)/(1+n))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var i=this.fL(1,t),n=0,s=0;do n=i,s=e*Math.sin(n),i=this.fL(Math.exp(e*Math.log((1+s)/(1-s))/2),t);while(Math.abs(i-n)>1e-12);return i},sinh:function(e){var t=Math.exp(e);return t=(t-1/t)/2},cosh:function(e){var t=Math.exp(e);return t=(t+1/t)/2},tanh:function(e){var t=Math.exp(e);return t=(t-1/t)/(t+1/t)},asinh:function(e){var t=e>=0?1:-1;return t*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,i){var n=t*i;return e/Math.sqrt(1-n*n)}},Proj4js.datum=Proj4js.Class({initialize:function(e){if(this.datum_type=Proj4js.common.PJD_WGS84,e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),e&&e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);(0!=e.datum_params[0]||0!=e.datum_params[1]||0!=e.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM),e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])&&(this.datum_type=Proj4js.common.PJD_7PARAM,e.datum_params[3]*=Proj4js.common.SEC_TO_RAD,e.datum_params[4]*=Proj4js.common.SEC_TO_RAD,e.datum_params[5]*=Proj4js.common.SEC_TO_RAD,e.datum_params[6]=e.datum_params[6]/1e6+1)}e&&(this.a=e.a,this.b=e.b,this.es=e.es,this.ep2=e.ep2,this.datum_params=e.datum_params)},compare_datums:function(e){return this.datum_type!=e.datum_type?!1:this.a!=e.a||Math.abs(this.es-e.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?0==strcmp(pj_param(this.params,"snadgrids").s,pj_param(e.params,"snadgrids").s):!0},geodetic_to_geocentric:function(e){var t,i,n,s,r,a,o,l=e.x,u=e.y,h=e.z?e.z:0,c=0;if(u<-Proj4js.common.HALF_PI&&u>-1.001*Proj4js.common.HALF_PI)u=-Proj4js.common.HALF_PI;else if(u>Proj4js.common.HALF_PI&&u<1.001*Proj4js.common.HALF_PI)u=Proj4js.common.HALF_PI;else if(u<-Proj4js.common.HALF_PI||u>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+u),null;return l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI),r=Math.sin(u),o=Math.cos(u),a=r*r,s=this.a/Math.sqrt(1-this.es*a),t=(s+h)*o*Math.cos(l),i=(s+h)*o*Math.sin(l),n=(s*(1-this.es)+h)*r,e.x=t,e.y=i,e.z=n,c},geocentric_to_geodetic:function(e){var t,i,n,s,r,a,o,l,u,h,c,p,d,m,f,y,g,v=1e-12,b=v*v,L=30,O=e.x,w=e.y,_=e.z?e.z:0;if(d=!1,t=Math.sqrt(O*O+w*w),i=Math.sqrt(O*O+w*w+_*_),t/this.a<v){if(d=!0,f=0,i/this.a<v)return y=Proj4js.common.HALF_PI,g=-this.b,void 0}else f=Math.atan2(w,O);n=_/i,s=t/i,r=1/Math.sqrt(1-this.es*(2-this.es)*s*s),l=s*(1-this.es)*r,u=n*r,m=0;do m++,o=this.a/Math.sqrt(1-this.es*u*u),g=t*l+_*u-o*(1-this.es*u*u),a=this.es*o/(o+g),r=1/Math.sqrt(1-a*(2-a)*s*s),h=s*(1-a)*r,c=n*r,p=c*l-h*u,l=h,u=c;while(p*p>b&&L>m);return y=Math.atan(c/Math.abs(h)),e.x=f,e.y=y,e.z=g,e},geocentric_to_geodetic_noniter:function(e){var t,i,n,s,r,a,o,l,u,h,c,p,d,m,f,y,g,v=e.x,b=e.y,L=e.z?e.z:0;if(v=parseFloat(v),b=parseFloat(b),L=parseFloat(L),g=!1,0!=v)t=Math.atan2(b,v);else if(b>0)t=Proj4js.common.HALF_PI;else if(0>b)t=-Proj4js.common.HALF_PI;else if(g=!0,t=0,L>0)i=Proj4js.common.HALF_PI;else{if(!(0>L))return i=Proj4js.common.HALF_PI,n=-this.b,void 0;i=-Proj4js.common.HALF_PI}return r=v*v+b*b,s=Math.sqrt(r),a=L*Proj4js.common.AD_C,l=Math.sqrt(a*a+r),h=a/l,p=s/l,c=h*h*h,o=L+this.b*this.ep2*c,y=s-this.a*this.es*p*p*p,u=Math.sqrt(o*o+y*y),d=o/u,m=y/u,f=this.a/Math.sqrt(1-this.es*d*d),n=m>=Proj4js.common.COS_67P5?s/m-f:m<=-Proj4js.common.COS_67P5?s/-m-f:L/d+f*(this.es-1),0==g&&(i=Math.atan(d/m)),e.x=t,e.y=i,e.z=n,e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x+=this.datum_params[0],e.y+=this.datum_params[1],e.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],n=this.datum_params[2],s=this.datum_params[3],r=this.datum_params[4],a=this.datum_params[5],o=this.datum_params[6],l=o*(e.x-a*e.y+r*e.z)+t,u=o*(a*e.x+e.y-s*e.z)+i,h=o*(-r*e.x+s*e.y+e.z)+n;e.x=l,e.y=u,e.z=h}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x-=this.datum_params[0],e.y-=this.datum_params[1],e.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],n=this.datum_params[2],s=this.datum_params[3],r=this.datum_params[4],a=this.datum_params[5],o=this.datum_params[6],l=(e.x-t)/o,u=(e.y-i)/o,h=(e.z-n)/o;e.x=l+a*u-r*h,e.y=-a*l+u+s*h,e.z=r*l-s*u+h}}}),Proj4js.Point=Proj4js.Class({initialize:function(e,t,i){if("object"==typeof e)this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("string"==typeof e){var n=e.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=e,this.y=t,this.z=i||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.Proj.aea={init:function(){return Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN?(Proj4js.reportError("aeaInitEqualLatitudes"),void 0):(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0,void 0)},forward:function(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*Proj4js.common.adjust_lon(t-this.long0),a=s*Math.sin(r)+this.x0,o=this.rh-s*Math.cos(r)+this.y0;return e.x=a,e.y=o,e},inverse:function(e){var t,i,n,s,r,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),s=0,0!=t&&(s=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,i=(this.c-n*n)/this.ns0,this.e3>=1e-10?(n=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,a=Math.abs(Math.abs(n)-Math.abs(i))>1e-10?this.phi1z(this.e3,i):i>=0?.5*PI:-.5*PI):a=this.phi1z(e3,i),r=Proj4js.common.adjust_lon(s/this.ns0+this.long0),e.x=r,e.y=a,e},phi1z:function(e,t){var i,n,s,r=Proj4js.common.asinz(.5*t);if(e<Proj4js.common.EPSLN)return r;for(var a=e*e,o=1;25>=o;o++)if(sinphi=Math.sin(r),cosphi=Math.cos(r),i=e*sinphi,n=1-i*i,s=.5*n*n/cosphi*(t/(1-a)-sinphi/n+.5/e*Math.log((1-i)/(1+i))),r+=s,Math.abs(s)<=1e-7)return r;return Proj4js.reportError("aea:phi1z:Convergence error"),null}},Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){return Proj4js.Proj.gauss.init.apply(this),this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"),void 0):(Proj4js.reportError("sterea:init:E_ERROR_0"),void 0)},forward:function(e){return e.x=Proj4js.common.adjust_lon(e.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[e]),sinc=Math.sin(e.y),cosc=Math.cos(e.y),cosl=Math.cos(e.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),e.x=k*cosc*Math.sin(e.x),e.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,i;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(rho=Math.sqrt(e.x*e.x+e.y*e.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),i=Math.asin(cosc*this.sinc0+e.y*sinc*this.cosc0/rho),t=Math.atan2(e.x*sinc,rho*this.cosc0*cosc-e.y*this.sinc0*sinc)):(i=this.phic0,t=0),e.x=t,e.y=i,Proj4js.Proj.gauss.inverse.apply(this,[e]),e.x=Proj4js.common.adjust_lon(e.x+this.long0),e}},Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,n,s,r,a,o,l=e.x,u=e.y;return n=Proj4js.common.adjust_lon(l-this.long0),Math.abs(u)<=1e-7?(a=this.x0+this.a*n,o=this.y0-this.a*this.ml0):(t=Math.sin(u),i=Math.cos(u),s=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,u),r=Proj4js.common.msfnz(this.e,t,i),n=t,a=this.x0+this.a*r*Math.sin(n)/t,o=this.y0+this.a*(s-this.ml0+r*(1-Math.cos(n))/t)),e.x=a,e.y=o,e},inverse:function(e){var t,i,n,s,r,a;if(e.x-=this.x0,e.y-=this.y0,t=this.ml0+e.y/this.a,s=0,Math.abs(t)<=1e-7)r=e.x/this.a+this.long0,a=0;else{if(i=t*t+e.x/this.a*(e.x/this.a),s=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,i,n,a),1!=s)return s;r=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*n/this.a)/Math.sin(a)+this.long0)}return e.x=r,e.y=a,e}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),s=this.x0+this.a*n*Math.cos(this.lat0),r=this.y0+this.a*i;return this.t1=s,this.t2=Math.cos(this.lat0),e.x=s,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var i=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=i,e.y=t}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t=e.x,i=e.y;if(i*Proj4js.common.R2D>90&&i*Proj4js.common.R2D<-90&&t*Proj4js.common.R2D>180&&t*Proj4js.common.R2D<-180)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+t+" : "+i),null;var n,s;if(Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*i));else{var r=Math.sin(i),a=Proj4js.common.tsfnz(this.e,i,r);n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),s=this.y0-this.a*this.k0*Math.log(a)}return e.x=n,e.y=s,e},inverse:function(e){var t,i,n=e.x-this.x0,s=e.y-this.y0;if(this.sphere)i=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-s/this.a*this.k0));else{var r=Math.exp(-s/(this.a*this.k0));if(i=Proj4js.common.phi2z(this.e,r),-9999==i)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return t=Proj4js.common.adjust_lon(this.long0+n/(this.a*this.k0)),e.x=t,e.y=i,e}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){return this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,this.inverse=Proj4js.Proj.tmerc.inverse,void 0):(Proj4js.reportError("utm:init: zone must be specified for UTM"),void 0)}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),0!=this.mode?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,i),s=this.a*(this.g-n),r=this.ns*Proj4js.common.adjust_lon(t-this.long0),a=this.x0+s*Math.sin(r),o=this.y0+this.rh-s*Math.cos(r);return e.x=a,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i;if(this.ns>=0)var i=Math.sqrt(e.x*e.x+e.y*e.y),t=1;else i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1;var n=0;0!=i&&(n=Math.atan2(t*e.x,t*e.y)),this.g-i/this.a;var s=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3),r=Proj4js.common.adjust_lon(this.long0+n/this.ns);return e.x=r,e.y=s,e},phi3z:function(e,t,i,n,s){var r,a;r=e;for(var o=0;15>o;o++)if(a=(e+i*Math.sin(2*r)-n*Math.sin(4*r)+s*Math.sin(6*r))/t-r,r+=a,Math.abs(a)<=1e-10)return r;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,n,s=e.x,r=e.y,a=Proj4js.common.adjust_lon(s-this.long0),o=Math.sin(r),l=Math.cos(r);if(this.sphere){var u=l*Math.sin(a);if(Math.abs(Math.abs(u)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;
i=.5*this.a*this.k0*Math.log((1+u)/(1-u)),t=Math.acos(l*Math.cos(a)/Math.sqrt(1-u*u)),0>r&&(t=-t),n=this.a*this.k0*(t-this.lat0)}else{var h=l*a,c=Math.pow(h,2),p=this.ep2*Math.pow(l,2),d=Math.tan(r),m=Math.pow(d,2);t=1-this.es*Math.pow(o,2);var f=this.a/Math.sqrt(t),y=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,r);i=this.k0*f*h*(1+c/6*(1-m+p+c/20*(5-18*m+Math.pow(m,2)+72*p-58*this.ep2)))+this.x0,n=this.k0*(y-this.ml0+f*d*c*(.5+c/24*(5-m+9*p+4*Math.pow(p,2)+c/30*(61-58*m+Math.pow(m,2)+600*p-330*this.ep2))))+this.y0}return e.x=i,e.y=n,e},inverse:function(e){var t,i,n,s,r,a,o=6;if(this.sphere){var l=Math.exp(e.x/(this.a*this.k0)),u=.5*(l-1/l),h=this.lat0+e.y/(this.a*this.k0),c=Math.cos(h);t=Math.sqrt((1-c*c)/(1+u*u)),r=Proj4js.common.asinz(t),0>h&&(r=-r),a=0==u&&0==c?this.long0:Proj4js.common.adjust_lon(Math.atan2(u,c)+this.long0)}else{var p=e.x-this.x0,d=e.y-this.y0;for(t=(this.ml0+d/this.k0)/this.a,i=t,s=0;!0&&(n=(t+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=n,!(Math.abs(n)<=Proj4js.common.EPSLN));s++)if(s>=o)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(i)<Proj4js.common.HALF_PI){var m=Math.sin(i),f=Math.cos(i),y=Math.tan(i),g=this.ep2*Math.pow(f,2),v=Math.pow(g,2),b=Math.pow(y,2),L=Math.pow(b,2);t=1-this.es*Math.pow(m,2);var O=this.a/Math.sqrt(t),w=O*(1-this.es)/t,_=p/(O*this.k0),x=Math.pow(_,2);r=i-O*y*x/w*(.5-x/24*(5+3*b+10*g-4*v-9*this.ep2-x/30*(61+90*b+298*g+45*L-252*this.ep2-3*v))),a=Proj4js.common.adjust_lon(this.long0+_*(1-x/6*(1+2*b+g-x/20*(5-2*g+28*b-3*v+8*this.ep2+24*L)))/f)}else r=Proj4js.common.HALF_PI*Proj4js.common.sign(d),a=this.long0}return e.x=a,e.y=r,e}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e),this.lc=this.long0,this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),i=Math.asin(t/this.rs),n=Math.sin(i);this.cp=Proj4js.common.latiso(0,i,n)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t),this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t),this.xs=this.x0,this.ys=this.y0-this.n2*i,this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,i=e.y,n=this.rs*(t-this.lc),s=this.cp+this.rs*Proj4js.common.latiso(this.e,i,Math.sin(i)),r=Math.asin(Math.sin(n)/Proj4js.common.cosh(s)),a=Proj4js.common.latiso(0,r,Math.sin(r));return e.x=this.xs+this.n2*a,e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(s)/Math.cos(n)),e},inverse:function(e){var t=e.x,i=e.y,n=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((i-this.ys)/this.n2)),s=Math.asin(Math.sin((i-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),r=Proj4js.common.latiso(0,s,Math.sin(s));return e.x=this.lc+n/this.rs,e.y=Proj4js.common.invlatiso(this.e,(r-this.cp)/this.rs),e}},Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,i,n,s,r,a,o=e.x,l=e.y;if(n=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),s=Math.cos(n),a=this.sin_p14*t+this.cos_p14*i*s,r=1,a>0||Math.abs(a)<=Proj4js.common.EPSLN)var u=this.a*r*i*Math.sin(n),h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*s);else Proj4js.reportError("orthoFwdPointError");return e.x=u,e.y=h,e},inverse:function(e){var t,i,n,s,r,a,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),t>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),i=Proj4js.common.asinz(t/this.a),n=Math.sin(i),s=Math.cos(i),a=this.long0,Math.abs(t)<=Proj4js.common.EPSLN&&(o=this.lat0),o=Proj4js.common.asinz(s*this.sin_p14+e.y*n*this.cos_p14/t),r=Math.abs(lat0)-Proj4js.common.HALF_PI,Math.abs(r)<=Proj4js.common.EPSLN&&(a=this.lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y))),r=s-this.sin_p14*Math.sin(o),(Math.abs(r)>=Proj4js.common.EPSLN||Math.abs(x)>=Proj4js.common.EPSLN)&&(a=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*n*this.cos_p14,r*t))),e.x=a,e.y=o,e}},Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),a=this.e=Math.sqrt(r);this.R=i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha),this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*a/2*Math.log((1+a*t)/(1-a*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+i)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,i=e.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+a/this.alpha,l=0,u=r,h=-1e3,c=0;Math.abs(u-h)>1e-7;){if(++c>20)return Proj4js.reportError("omercFwdInfinity"),void 0;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),h=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=o,e.y=u,e}},Proj4js.Proj.stere={ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*i)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);if(this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(e=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e),e*=this.e,this.akm1/=Math.sqrt(1-e*e));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0),t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI,e*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e),this.sinX1=Math.sin(t),this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var i,n,s=e.y;if(this.sphere){var r,a,o,l;switch(r=Math.sin(s),a=Math.cos(s),o=Math.cos(t),l=Math.sin(t),this.mode){case this.EQUIT:n=1+a*o,n<=Proj4js.common.EPSLN,n=this.akm1/n,i=n*a*l,n*=r;break;case this.OBLIQ:n=1+this.sinph0*r+this.cosph0*a*o,n<=Proj4js.common.EPSLN,n=this.akm1/n,i=n*a*l,n*=this.cosph0*r-this.sinph0*a*o;break;case this.N_POLE:o=-o,s=-s;case this.S_POLE:Math.abs(s-Proj4js.common.HALF_PI)<this.TOL,n=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*s),i=l*n,n*=o}}else{switch(o=Math.cos(t),l=Math.sin(t),r=Math.sin(s),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(s,r,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X)),this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*o)),n=A*(this.cosX1*sinX-this.sinX1*cosX*o),i=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*o),n=A*sinX,i=A*cosX;break;case this.S_POLE:s=-s,o=-o,r=-r;case this.N_POLE:i=this.akm1*Proj4js.common.tsfnz(this.e,s,r),n=-i*o}i*=l}return e.x=i*this.a+this.x0,e.y=n*this.a+this.y0,e},inverse:function(e){var t,i,n,s,r,a,o=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,u=0,h=0,c=0,p=0;if(this.sphere){var d,m,f,y;switch(m=Math.sqrt(o*o+l*l),d=2*Math.atan(m/this.akm1),f=Math.sin(d),y=Math.cos(d),t=0,this.mode){case this.EQUIT:i=Math.abs(m)<=Proj4js.common.EPSLN?0:Math.asin(l*f/m),(0!=y||0!=o)&&(t=Math.atan2(o*f,y*m));break;case this.OBLIQ:i=Math.abs(m)<=Proj4js.common.EPSLN?this.phi0:Math.asin(y*sinph0+l*f*cosph0/m),d=y-sinph0*Math.sin(i),(0!=d||0!=o)&&(t=Math.atan2(o*f*cosph0,d*m));break;case this.N_POLE:l=-l;case this.S_POLE:i=Math.abs(m)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-y:y),t=0==o&&0==l?0:Math.atan2(o,l)}}else{switch(r=Math.sqrt(o*o+l*l),this.mode){case this.OBLIQ:case this.EQUIT:u=2*Math.atan2(r*this.cosX1,this.akm1),n=Math.cos(u),s=Math.sin(u),h=0==r?Math.asin(n*this.sinX1):Math.asin(n*this.sinX1+l*s*this.cosX1/r),u=Math.tan(.5*(Proj4js.common.HALF_PI+h)),o*=s,l=r*this.cosX1*n-l*this.sinX1*s,p=Proj4js.common.HALF_PI,c=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:u=-r/this.akm1,h=Proj4js.common.HALF_PI-2*Math.atan(u),p=-Proj4js.common.HALF_PI,c=-.5*this.e}for(a=this.NITER;a--;h=i)if(s=this.e*Math.sin(h),i=2*Math.atan(u*Math.pow((1+s)/(1-s),c))-p,Math.abs(h-i)<this.CONV)return this.mode==this.S_POLE&&(i=-i),t=0==o&&0==l?0:Math.atan2(o,l),e.x=Proj4js.common.adjust_lon(t+this.long0),e.y=i,e}}},Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array,this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=new Array,this.B_im=new Array,this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=new Array,this.C_im=new Array,this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=new Array,this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t=e.x,i=e.y,s=i-this.lat0,r=t-this.long0,a=1e-5*(s/Proj4js.common.SEC_TO_RAD),o=r,l=1,u=0;for(n=1;10>=n;n++)l*=a,u+=this.A[n]*l;var h,c,p=u,d=o,m=1,f=0,g=0,v=0;for(n=1;6>=n;n++)h=m*p-f*d,c=f*p+m*d,m=h,f=c,g=g+this.B_re[n]*m-this.B_im[n]*f,v=v+this.B_im[n]*m+this.B_re[n]*f;return x=v*this.a+this.x0,y=g*this.a+this.y0,e.x=x,e.y=y,e},inverse:function(e){var t,s,r=e.x,a=e.y,o=r-this.x0,l=a-this.y0,u=l/this.a,h=o/this.a,c=1,p=0,d=0,m=0;for(n=1;6>=n;n++)t=c*u-p*h,s=p*u+c*h,c=t,p=s,d=d+this.C_re[n]*c-this.C_im[n]*p,m=m+this.C_im[n]*c+this.C_re[n]*p;for(i=0;i<this.iterations;i++){var f,y,g=d,v=m,b=u,L=h;for(n=2;6>=n;n++)f=g*d-v*m,y=v*d+g*m,g=f,v=y,b+=(n-1)*(this.B_re[n]*g-this.B_im[n]*v),L+=(n-1)*(this.B_im[n]*g+this.B_re[n]*v);g=1,v=0;var O=this.B_re[1],w=this.B_im[1];for(n=2;6>=n;n++)f=g*d-v*m,y=v*d+g*m,g=f,v=y,O+=n*(this.B_re[n]*g-this.B_im[n]*v),w+=n*(this.B_im[n]*g+this.B_re[n]*v);var _=O*O+w*w;d=(b*O+L*w)/_,m=(L*O-b*w)/_}var x=d,S=m,C=1,k=0;for(n=1;9>=n;n++)C*=x,k+=this.D[n]*C;var M=this.lat0+1e5*k*Proj4js.common.SEC_TO_RAD,P=this.long0+S;return e.x=P,e.y=M,e}},Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),s=this.x0+this.a*n,r=this.y0+1.25*this.a*Math.log(Math.tan(Proj4js.common.PI/4+i/2.5));return e.x=s,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);return e.x=t,e.y=i,e}},Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a},forward:function(e){var t,i,n,s,r,a,o=e.x,l=e.y;return n=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),s=Math.cos(n),a=this.sin_p14*t+this.cos_p14*i*s,r=1,a>0||Math.abs(a)<=Proj4js.common.EPSLN?(x=this.x0+this.a*r*i*Math.sin(n)/a,y=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*s)/a):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*i*Math.sin(n),y=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*s)),e.x=x,e.y=y,e},inverse:function(e){var t,i,n,s,r,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(s=Math.atan2(t,this.rc),i=Math.sin(s),n=Math.cos(s),a=Proj4js.common.asinz(n*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*n-e.y*this.sin_p14*i),r=Proj4js.common.adjust_lon(this.long0+r)):(a=this.phic0,r=0),e.x=r,e.y=a,e}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(e){var t,i,n,s=e.x,r=e.y;return n=Proj4js.common.adjust_lon(s-this.long0),t=this.R*n*Math.cos(r)+this.x0,i=this.R*r+this.y0,e.x=t,e.y=i,e},inverse:function(e){var t,i,n;return e.x-=this.x0,e.y-=this.y0,t=e.y/this.R,Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),i=Math.abs(t)-Proj4js.common.HALF_PI,Math.abs(i)>Proj4js.common.EPSLN?(i=this.long0+e.x/(this.R*Math.cos(t)),n=Proj4js.common.adjust_lon(i)):n=this.long0,e.x=n,e.y=t,e}},Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,i,n=e.x,s=e.y,r=Proj4js.common.adjust_lon(n-this.long0);Math.abs(s)<=Proj4js.common.EPSLN&&(t=this.x0+this.R*r,i=this.y0);var a=Proj4js.common.asinz(2*Math.abs(s/Proj4js.common.PI));(Math.abs(r)<=Proj4js.common.EPSLN||Math.abs(Math.abs(s)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(t=this.x0,i=s>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*a):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Proj4js.common.PI/r-r/Proj4js.common.PI),l=o*o,u=Math.sin(a),h=Math.cos(a),c=h/(u+h-1),p=c*c,d=c*(2/u-1),m=d*d,f=Proj4js.common.PI*this.R*(o*(c-m)+Math.sqrt(l*(c-m)*(c-m)-(m+l)*(p-m)))/(m+l);return 0>r&&(f=-f),t=this.x0+f,f=Math.abs(f/(Proj4js.common.PI*this.R)),i=s>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-f*f-2*o*f):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-f*f-2*o*f),e.x=t,e.y=i,e},inverse:function(e){var t,i,n,s,r,a,o,l,u,h,c;return e.x-=this.x0,e.y-=this.y0,u=Proj4js.common.PI*this.R,t=e.x/u,i=e.y/u,n=t*t+i*i,s=-Math.abs(i)*(1+n),r=s-2*i*i+t*t,a=-2*s+1+2*i*i+n*n,c=i*i/a+(2*r*r*r/a/a/a-9*s*r/a/a)/27,o=(s-r*r/3/a)/a,l=2*Math.sqrt(-o/3),u=3*c/o/l,Math.abs(u)>1&&(u=u>=0?1:-1),h=Math.acos(u)/3,lat=e.y>=0?(-l*Math.cos(h+Proj4js.common.PI/3)-r/3/a)*Proj4js.common.PI:-(-l*Math.cos(h+PI/3)-r/3/a)*Proj4js.common.PI,Math.abs(t)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(n-1+Math.sqrt(1+2*(t*t-i*i)+n*n))/2/t),e.x=lon,e.y=lat,e}},Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,i=e.y;dlon=Proj4js.common.adjust_lon(t-this.long0);var n=this.x0+this.a*dlon*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);return e.x=n,e.y=s,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts));return e.x=t,e.y=i,e}},Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0),this.lat_ts||(this.lat_ts=0),this.title||(this.title="Equidistant Cylindrical (Plate Carre)"),this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),s=Proj4js.common.adjust_lat(i-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*s,e},inverse:function(e){var t=e.x,i=e.y;return e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Proj4js.common.adjust_lat(this.lat0+(i-this.y0)/this.a),e}},Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,i,n=e.x,s=e.y;return n=Proj4js.common.adjust_lon(n-this.long0),this.sphere?(t=Math.asin(Math.cos(s)*Math.sin(n)),i=Math.atan2(Math.tan(s),Math.cos(n))-this.phi0):(this.n=Math.sin(s),this.c=Math.cos(s),i=this.pj_mlfn(s,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(s),this.t=this.tn*this.tn,this.a1=n*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),i-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;return this.sphere?(this.dd=i+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(t)),lam=Math.atan2(Math.tan(t),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+i,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=t/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=phi,e},pj_enfn:function(e){en=new Array,en[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08))),en[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var t=e*e;return en[2]=t*(this.C44-e*(this.C46+e*this.C48)),t*=e,en[3]=t*(this.C66-e*this.C68),en[4]=t*e*this.C88,en},pj_mlfn:function(e,t,i,n){return i*=t,t*=t,n[0]*e-i*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},pj_inv_mlfn:function(e,n,r){for(k=1/(1-n),phi=e,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-n*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),r)-e)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(i),this.ratexp))-Proj4js.common.HALF_PI,e.x=this.C*t,e},inverse:function(e){var t=1e-14,i=e.x/this.C,n=e.y;num=Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI)/this.K,1/this.C);for(var s=Proj4js.common.MAX_ITER;s>0&&(n=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI,!(Math.abs(n-e.y)<t));--s)e.y=n;return s?(e.x=i,e.y=n,e):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t),this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-t),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl)),0!=this.mode?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(e){var t,i,n,s,r,a,o,l,u,h,c,p=e.x,d=e.y;t=Math.sin(d),h=Proj4js.common.adjust_lon(p-this.longc),a=Math.sin(this.bl*h),Math.abs(Math.abs(d)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(c=Proj4js.common.tsfnz(this.e,d,t),s=this.el/Math.pow(c,this.bl),u=.5*(s-1/s),i=.5*(s+1/s),o=(u*this.singam-a*this.cosgam)/i,n=Math.cos(this.bl*h),Math.abs(n)<1e-7?r=this.al*this.bl*h:(r=this.al*Math.atan((u*this.cosgam+a*this.singam)/n)/this.bl,0>n&&(r+=Proj4js.common.PI*this.al/this.bl))):(o=d>=0?this.singam:-this.singam,r=this.al*d/this.bl),Math.abs(Math.abs(o)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),l=.5*this.al*Math.log((1-o)/(1+o))/this.bl,r-=this.u;var m=this.x0+l*this.cosaz+r*this.sinaz,f=this.y0+r*this.cosaz-l*this.sinaz;return e.x=m,e.y=f,e},inverse:function(e){var t,i,n,s,r,a,o,l,u,h,c;return e.x-=this.x0,e.y-=this.y0,c=0,s=e.x*this.cosaz-e.y*this.sinaz,r=e.y*this.cosaz+e.x*this.sinaz,r+=this.u,a=Math.exp(-this.bl*s/this.al),o=.5*(a-1/a),i=.5*(a+1/a),u=Math.sin(this.bl*r/this.al),h=(u*this.cosgam+o*this.singam)/i,Math.abs(Math.abs(h)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=h>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(n=1/this.bl,l=Math.pow(this.el/Math.sqrt((1+h)/(1-h)),n),lat=Proj4js.common.phi2z(this.e,l),t=this.longc-Math.atan2(o*this.cosgam-u*this.singam,n)/this.bl,lon=Proj4js.common.adjust_lon(t)),e.x=lon,e.y=lat,e}},Proj4js.Proj.lcc={init:function(){if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)return Proj4js.reportError("lcc:init: Equal Latitudes"),void 0;var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),n=Proj4js.common.msfnz(this.e,t,i),s=Proj4js.common.tsfnz(this.e,this.lat1,t),r=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Proj4js.common.msfnz(this.e,r,a),l=Proj4js.common.tsfnz(this.e,this.lat2,r),u=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(n/o)/Math.log(s/l):t,this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(e){var t=e.x,i=e.y;if(!(90>=i&&i>=-90&&180>=t&&t>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+i),null;var n,s,r=Math.abs(Math.abs(i)-Proj4js.common.HALF_PI);if(r>Proj4js.common.EPSLN)n=Proj4js.common.tsfnz(this.e,i,Math.sin(i)),s=this.a*this.f0*Math.pow(n,this.ns);else{if(r=i*this.ns,0>=r)return Proj4js.reportError("lcc:forward: No Projection"),null;s=0}var a=this.ns*Proj4js.common.adjust_lon(t-this.long0);return e.x=this.k0*s*Math.sin(a)+this.x0,e.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,e},inverse:function(e){var t,i,n,s,r;x=(e.x-this.x0)/this.k0,y=this.rh-(e.y-this.y0)/this.k0,this.ns>0?(t=Math.sqrt(x*x+y*y),i=1):(t=-Math.sqrt(x*x+y*y),i=-1);var a=0;if(0!=t&&(a=Math.atan2(i*x,i*y)),0!=t||this.ns>0){if(i=1/this.ns,n=Math.pow(t/(this.a*this.f0),i),s=Proj4js.common.phi2z(this.e,n),-9999==s)return null}else s=-Proj4js.common.HALF_PI;return r=Proj4js.common.adjust_lon(a/this.ns+this.long0),e.x=r,e.y=s,e}},Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);if(this.mode=Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){var t;switch(this.qp=Proj4js.common.qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,i,n=e.x,s=e.y;if(n=Proj4js.common.adjust_lon(n-this.long0),this.sphere){var r,a,o;switch(o=Math.sin(s),a=Math.cos(s),r=Math.cos(n),this.mode){case this.EQUIT:if(i=this.mode==this.EQUIT?1+a*r:1+this.sinph0*o+this.cosph0*a*r,i<=Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:y less than eps"),null;i=Math.sqrt(2/i),t=i*a*Math.sin(n),i*=this.mode==this.EQUIT?o:this.cosph0*o-this.sinph0*a*r;break;case this.N_POLE:r=-r;case this.S_POLE:if(Math.abs(s+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;i=Proj4js.common.FORTPI-.5*s,i=2*(this.mode==this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(n),i*=r}}else{var r,l,o,u,h=0,c=0,p=0;switch(r=Math.cos(n),l=Math.sin(n),o=Math.sin(s),u=Proj4js.common.qsfnz(this.e,o),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(h=u/this.qp,c=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:p=1+this.sinb1*h+this.cosb1*c*r;break;case this.EQUIT:p=1+c*r;break;case this.N_POLE:p=Proj4js.common.HALF_PI+s,u=this.qp-u;break;case this.S_POLE:p=s-Proj4js.common.HALF_PI,u=this.qp+u}if(Math.abs(p)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),i=this.mode==this.OBLIQ?this.ymf*p*(this.cosb1*h-this.sinb1*c*r):(p=Math.sqrt(2/(1+c*r)))*h*this.ymf,t=this.xmf*p*c*l;break;case this.N_POLE:case this.S_POLE:u>=0?(t=(p=Math.sqrt(u))*l,i=r*(this.mode==this.S_POLE?p:-p)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;if(this.sphere){var n,s=0,r=0;n=Math.sqrt(t*t+i*i);var a=.5*n;if(a>1)return Proj4js.reportError("laea:Inv:DataError"),null;switch(a=2*Math.asin(a),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(r=Math.sin(a),s=Math.cos(a)),this.mode){case this.EQUIT:a=Math.abs(n)<=Proj4js.common.EPSLN?0:Math.asin(i*r/n),t*=r,i=s*n;break;case this.OBLIQ:a=Math.abs(n)<=Proj4js.common.EPSLN?this.phi0:Math.asin(s*sinph0+i*r*cosph0/n),t*=r*cosph0,i=(s-Math.sin(a)*sinph0)*n;break;case this.N_POLE:i=-i,a=Proj4js.common.HALF_PI-a;break;case this.S_POLE:a-=Proj4js.common.HALF_PI}lam=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(t,i):0}else{var o,l,u,h,c=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(t/=this.dd,i*=this.dd,h=Math.sqrt(t*t+i*i),h<Proj4js.common.EPSLN)return e.x=0,e.y=this.phi0,e;l=2*Math.asin(.5*h/this.rq),o=Math.cos(l),t*=l=Math.sin(l),this.mode==this.OBLIQ?(c=o*this.sinb1+i*l*this.cosb1/h,u=this.qp*c,i=h*this.cosb1*o-i*this.sinb1*l):(c=i*l/h,u=this.qp*c,i=h*o);break;case this.N_POLE:i=-i;case this.S_POLE:if(u=t*t+i*i,!u)return e.x=0,e.y=this.phi0,e;c=1-u/this.qp,this.mode==this.S_POLE&&(c=-c)}lam=Math.atan2(t,i),a=this.authlat(Math.asin(c),this.apa)}return e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=a,e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,i=new Array;return i[0]=e*this.P00,t=e*e,i[0]+=t*this.P01,i[1]=t*this.P10,t*=e,i[0]+=t*this.P02,i[1]+=t*this.P11,i[2]=t*this.P20,i},authlat:function(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t=e.x;e.y;var i,n=Math.sin(e.y),s=Math.cos(e.y),r=Proj4js.common.adjust_lon(t-this.long0),a=Math.cos(r),o=this.sin_p12*n+this.cos_p12*s*a;if(Math.abs(Math.abs(o)-1)<Proj4js.common.EPSLN){if(i=1,0>o)return Proj4js.reportError("aeqd:Fwd:PointError"),void 0}else{var l=Math.acos(o);i=l/Math.sin(l)}return e.x=this.x0+this.a*i*s*Math.sin(r),e.y=this.y0+this.a*i*(this.cos_p12*n-this.sin_p12*s*a),e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(t>2*Proj4js.common.HALF_PI*this.a)return Proj4js.reportError("aeqdInvDataError"),void 0;var i,n=t/this.a,s=Math.sin(n),r=Math.cos(n),a=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)i=this.lat0;else{i=Proj4js.common.asinz(r*this.sin_p12+e.y*s*this.cos_p12/t);var o=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(o)<=Proj4js.common.EPSLN?a=lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y)):(o=r-this.sin_p12*Math.sin(i),Math.abs(o)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN||(Math.atan2(e.x*s*this.cos_p12,o*t),a=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*s*this.cos_p12,o*t))))}return e.x=a,e.y=i,e}},Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,i=e.y,n=Proj4js.common.adjust_lon(t-this.long0),s=i,r=Proj4js.common.PI*Math.sin(i),a=0;!0;a++){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<Proj4js.common.EPSLN)break;a>=50&&Proj4js.reportError("moll:Fwd:IterationError")}s/=2,Proj4js.common.PI/2-Math.abs(i)<Proj4js.common.EPSLN&&(n=0);var l=.900316316158*this.a*n*Math.cos(s)+this.x0,u=1.4142135623731*this.a*Math.sin(s)+this.y0;return e.x=l,e.y=u,e},inverse:function(e){var t,i;e.x-=this.x0;var i=e.y/(1.4142135623731*this.a);Math.abs(i)>.999999999999&&(i=.999999999999);var t=Math.asin(i),n=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));
n<-Proj4js.common.PI&&(n=-Proj4js.common.PI),n>Proj4js.common.PI&&(n=Proj4js.common.PI),i=(2*t+Math.sin(2*t))/Proj4js.common.PI,Math.abs(i)>1&&(i=1);var s=Math.asin(i);return e.x=n,e.y=s,e}};var OpenLayers={VERSION_NUMBER:"Release 2.13 dev",singleFile:!0,_getScriptLocation:function(){for(var e,t,i=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),n=document.getElementsByTagName("script"),s="",r=0,a=n.length;a>r;r++)if(e=n[r].getAttribute("src"),e&&(t=e.match(i))){s=t[1];break}return function(){return s}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var s=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,s)}else n.prototype=i;return n},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,s,r;for(n=2,s=arguments.length;s>n;n++)r=arguments[n],"function"==typeof r&&(r=r.prototype),OpenLayers.Util.extend(e.prototype,r)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}var s="function"==typeof window.Event&&t instanceof window.Event;!s&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],n=1,s=t.length;s>n;n++){var r=t[n];i+=r.charAt(0).toUpperCase()+r.substring(1)}return i},format:function(e,t,i){t||(t=window);var n=function(e,n){for(var s,r=n.split(/\.+/),a=0;a<r.length;a++)0==a&&(s=t),s=s[r[a]];return"function"==typeof s&&(s=i?s.apply(null,i):s()),"undefined"==typeof s?"undefined":s};return e.replace(OpenLayers.String.tokenRegEx,n)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return t===!0&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):i}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var s=e.toString().split(".");1==s.length&&null==t&&(t=0);var r=s[0];if(i)for(var a=/(-?[0-9]+)([0-9]{3})/;a.test(r);)r=r.replace(a,"$1"+i+"$2");var o;if(0==t)o=r;else{var l=s.length>1?s[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),o=r+n+l}return o}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var s=e.length;if("function"!=typeof t)throw new TypeError;for(var r=0;s>r;r++)if(r in e){var a=e[r];t.call(i,a,r,e)&&n.push(a)}}return n}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){OpenLayers.Util.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,s=Math.round(this.bottom*i)/i,r=Math.round(this.right*i)/i,a=Math.round(this.top*i)/i;return t===!0?s+","+n+","+a+","+r:n+","+s+","+r+","+a},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y);var s=(this.left-i)*e+i,r=(this.bottom-n)*e+n,a=(this.right-i)*e+i,o=(this.top-n)*e+n;return new OpenLayers.Bounds(s,r,a,o)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){var t=null;if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":t=new OpenLayers.Bounds(e.lon,e.lat,e.lon,e.lat);break;case"OpenLayers.Geometry.Point":t=new OpenLayers.Bounds(e.x,e.y,e.x,e.y);break;case"OpenLayers.Bounds":t=e}t&&(this.centerLonLat=null,(null==this.left||t.left<this.left)&&(this.left=t.left),(null==this.bottom||t.bottom<this.bottom)&&(this.bottom=t.bottom),(null==this.right||t.right>this.right)&&(this.right=t.right),(null==this.top||t.top>this.top)&&(this.top=t.top))}},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;if(n&&!i){var s=n.getWidth(),r=(n.left+n.right)/2,a=Math.round((e.lon-r)/s);i=this.containsLonLat({lon:e.lon-a*s,lat:e.lat},{inclusive:t.inclusive})}return i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var n=!1;return n=i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,s=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!s){var r=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top,a=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,o=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,l=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;n=(r||a)&&(o||l)}if(t.worldBounds&&!n){var u=t.worldBounds,h=u.getWidth(),c=!u.containsBounds(i),p=!u.containsBounds(e);c&&!p?(e=e.add(-h,0),n=i.intersectsBounds(e,{inclusive:t.inclusive})):p&&!c&&(i=i.add(-h,0),n=e.intersectsBounds(i,{inclusive:t.inclusive}))}return n},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),s=this.contains(e.right,e.bottom,i),r=this.contains(e.left,e.top,i),a=this.contains(e.right,e.top,i);return t?n||s||r||a:n&&s&&r&&a},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),s=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,s.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,r.x),this.top=Math.max(s.y,r.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,n=t.rightTolerance||0,s=this.clone();if(e){for(var r=e.getWidth();s.left<e.left&&s.right-n<=e.left;)s=s.add(r,0);for(;s.left+i>=e.right&&s.right>e.right;)s=s.add(-r,0);var a=s.left+i;a<e.right&&a>e.left&&s.right-n>e.right&&(s=s.add(-r,0))}return s},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"==e.charAt(0)?"b":"t",t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"none":"";i.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(e,null);i=n?n.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var s=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(s,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],n=t&&e[1];return new OpenLayers.LonLat(i,n)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;i>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var n=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],n=i&&i[e];return n||(n=e),t&&(n=OpenLayers.String.format(n,t)),n}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,i,n,s,r,a,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),s&&(e.style.position=s),r&&(e.style.border=r),a&&(e.style.overflow=a),parseFloat(o)>=0&&parseFloat(o)<1?(e.style.filter="alpha(opacity="+100*o+")",e.style.opacity=o):1==parseFloat(o)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,s,r,a,o){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),s||(s="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,s,r,a,o),l},OpenLayers.Util.createImage=function(e,t,i,n,s,r,a,o){function l(){u.style.display="",OpenLayers.Event.stopObservingElement(u)}var u=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),s||(s="relative"),OpenLayers.Util.modifyDOMElement(u,e,t,i,s,r,null,a),o&&(u.style.display="none",OpenLayers.Event.observe(u,"load",l),OpenLayers.Event.observe(u,"error",l)),u.style.alt=e,u.galleryImg="no",n&&(u.src=n),u},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(n){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&7>t}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,s,r,a,o,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,r,null,null,l);var u=e.childNodes[0];s&&(u.src=s),OpenLayers.Util.modifyDOMElement(u,e.id+"_innerImage",null,n,"relative",a),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==o&&(o="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.src+"', "+"sizingMethod='"+o+"')",parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),u.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,s,r,a,o,l){var u=OpenLayers.Util.createDiv(),h=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);return h.className="olAlphaImg",u.appendChild(h),OpenLayers.Util.modifyAlphaImageDiv(u,e,t,i,n,s,r,a,o),u},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var n in t)(void 0===e[n]||!i&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var n=e[i];if(null!=n&&"function"!=typeof n){var s;if("object"==typeof n&&n.constructor==Array){for(var r,a=[],o=0,l=n.length;l>o;o++)r=n[o],a.push(encodeURIComponent(null===r||void 0===r?"":r));s=a.join(",")}else s=encodeURIComponent(n);t.push(encodeURIComponent(i)+"="+s)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var n=(e+" ").split(/[?&]/);i+=" "===n.pop()?t:n.length?"&"+t:"?"+t}return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;i>t;t++){var n=arguments[t];try{e=n();break}catch(s){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,s=i.b,r=i.f,a=OpenLayers.Util.rad(t.lon-e.lon),o=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(t.lat))),u=Math.sin(o),h=Math.cos(o),c=Math.sin(l),p=Math.cos(l),d=a,m=2*Math.PI,f=20;Math.abs(d-m)>1e-12&&--f>0;){var y=Math.sin(d),g=Math.cos(d),v=Math.sqrt(p*y*p*y+(h*c-u*p*g)*(h*c-u*p*g));if(0==v)return 0;var b=u*c+h*p*g,L=Math.atan2(v,b),O=Math.asin(h*p*y/v),w=Math.cos(O)*Math.cos(O),_=b-2*u*c/w,x=r/16*w*(4+r*(4-3*w));m=d,d=a+(1-x)*r*Math.sin(O)*(L+x*v*(_+x*b*(-1+2*_*_)))}if(0==f)return 0/0;var S=w*(n*n-s*s)/(s*s),C=1+S/16384*(4096+S*(-768+S*(320-175*S))),k=S/1024*(256+S*(-128+S*(74-47*S))),M=k*v*(_+k/4*(b*(-1+2*_*_)-k/6*_*(-3+4*v*v)*(-3+4*_*_))),P=s*C*(L-M),E=P.toFixed(3)/1e3;return E},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var n=OpenLayers.Util,s=n.VincentyConstants,r=s.a,a=s.b,o=s.f,l=e.lon,u=e.lat,h=i,c=n.rad(t),p=Math.sin(c),d=Math.cos(c),m=(1-o)*Math.tan(n.rad(u)),f=1/Math.sqrt(1+m*m),y=m*f,g=Math.atan2(m,d),v=f*p,b=1-v*v,L=b*(r*r-a*a)/(a*a),O=1+L/16384*(4096+L*(-768+L*(320-175*L))),w=L/1024*(256+L*(-128+L*(74-47*L))),_=h/(a*O),x=2*Math.PI;Math.abs(_-x)>1e-12;){var S=Math.cos(2*g+_),C=Math.sin(_),k=Math.cos(_),M=w*C*(S+w/4*(k*(-1+2*S*S)-w/6*S*(-3+4*C*C)*(-3+4*S*S)));x=_,_=h/(a*O)+M}var P=y*C-f*k*d,E=Math.atan2(y*k+f*C*d,(1-o)*Math.sqrt(v*v+P*P)),N=Math.atan2(C*p,f*k-y*C*d),T=o/16*b*(4+o*(4-3*b)),z=N-(1-T)*o*v*(_+T*C*(S+T*k*(-1+2*S*S)));return Math.atan2(v,-P),new OpenLayers.LonLat(l+n.deg(z),n.deg(E))},OpenLayers.Util.getParameters=function(e){e=null===e||void 0===e?window.location.href:e;var t="";if(OpenLayers.String.contains(e,"?")){var i=e.indexOf("?")+1,n=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;t=e.substring(i,n)}for(var s={},r=t.split(/[&;]/),a=0,o=r.length;o>a;++a){var l=r[a].split("=");if(l[0]){var u=l[0];try{u=decodeURIComponent(u)}catch(h){u=unescape(u)}var c=(l[1]||"").replace(/\+/g," ");try{c=decodeURIComponent(c)}catch(h){c=unescape(c)}c=c.split(","),1==c.length&&(c=c[0]),s[u]=c}}return s},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var n=OpenLayers.Util.normalizeScale(e);i=1/(n*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n,s=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),r=null;if(e.getBoundingClientRect){n=e.getBoundingClientRect();var a=i.scrollTop,o=i.scrollLeft;t[0]=n.left+o,t[1]=n.top+a}else if(document.getBoxObjectFor&&!s){n=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=n.screenX-l.screenX,t[1]=n.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,r=e.offsetParent,r!=e)for(;r;)t[0]+=r.offsetLeft,t[1]+=r.offsetTop,r=r.offsetParent;var u=OpenLayers.BROWSER_NAME;for(("opera"==u||"safari"==u&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),r=e.offsetParent;r&&r!=document.body;)t[0]-=r.scrollLeft,("opera"!=u||"TR"!=r.tagName)&&(t[1]-=r.scrollTop),r=r.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});var n=OpenLayers.Util.createUrlObject(e,i),s=OpenLayers.Util.createUrlObject(t,i);for(var r in n)if("args"!==r&&n[r]!=s[r])return!1;for(var r in n.args){if(n.args[r]!=s.args[r])return!1;delete s.args[r]}for(var r in s.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",s=i.protocol+"//"+i.host.split(":").shift()+n;if(0===e.indexOf("/"))e=s+e;else{var r=i.pathname.split("/");r.pop(),e=s+r.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var a=document.createElement("a");a.href=e;var o={};o.host=a.host.split(":").shift(),o.protocol=a.protocol,o.port=t.ignorePort80?"80"==a.port||"0"==a.port?"":a.port:""==a.port||"0"==a.port?"80":a.port,o.hash=t.ignoreHash||"#"===a.hash?"":a.hash;var l=a.search;if(!l){var u=e.indexOf("?");l=-1!=u?e.substr(u):""}return o.args=OpenLayers.Util.getParameters(l),o.pathname="/"==a.pathname.charAt(0)?a.pathname:"/"+a.pathname,o},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),n=e.indexOf("#");return t=-1==i?-1!=n?e.substr(0,n):e:-1!=n?e.substr(0,Math.min(i,n)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,s,r=document.createElement("div");r.style.visibility="hidden";for(var a=i&&i.containerElement?i.containerElement:document.body,o=!1,l=null,u=a;u&&"body"!=u.tagName.toLowerCase();){var h=OpenLayers.Element.getStyle(u,"position");if("absolute"==h){o=!0;break}if(h&&"static"!=h)break;u=u.parentNode}!o||0!==a.clientHeight&&0!==a.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(r)),r.style.position="absolute",t&&(t.w?(n=t.w,r.style.width=n+"px"):t.h&&(s=t.h,r.style.height=s+"px")),i&&i.displayClass&&(r.className=i.displayClass);var c=document.createElement("div");if(c.innerHTML=e,c.style.overflow="visible",c.childNodes)for(var p=0,d=c.childNodes.length;d>p;p++)c.childNodes[p].style&&(c.childNodes[p].style.overflow="visible");return r.appendChild(c),l?a.appendChild(l):a.appendChild(r),n||(n=parseInt(c.scrollWidth),r.style.width=n+"px"),s||(s=parseInt(c.scrollHeight)),r.removeChild(c),l?(l.removeChild(r),a.removeChild(l)):a.removeChild(r),new OpenLayers.Size(n,s)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,n=0,s=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),n=i.offsetWidth,t.style.overflow="scroll",s=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=n-s,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;var n=Math.abs(e),s=Math.floor(n),r=(n-s)/(1/60),a=r;r=Math.floor(r);var o=(a-r)/(1/60);o=Math.round(10*o),o/=10,o>=60&&(o-=60,r+=1,r>=60&&(r-=60,s+=1)),10>s&&(s="0"+s);var l=s+"°";return i.indexOf("dm")>=0&&(10>r&&(r="0"+r),l+=r+"'",i.indexOf("dms")>=0&&(10>o&&(o="0"+o),l+=o+'"')),l+="lon"==t?0>e?OpenLayers.i18n("W"):OpenLayers.i18n("E"):0>e?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};
for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return this.keepData&&(this.data=i),i},write:function(e){var t;if(this.xmldom)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var n=document.implementation.createDocument("","",null);n.importNode&&(e=n.importNode(e,!0)),n.appendChild(e),t=i.serializeToString(n)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){var i;return i=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createTextNode:function(e){var t;return"string"!=typeof e&&(e=String(e)),t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,i);else for(var s,r,a=e.getElementsByTagName("*"),o=0,l=a.length;l>o;++o)s=a[o],r=s.prefix?s.prefix+":"+i:i,("*"==i||r==s.nodeName)&&("*"==t||t==s.namespaceURI)&&n.push(s);return n},getAttributeNodeNS:function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var s,r,a=e.attributes,o=0,l=a.length;l>o;++o)if(s=a[o],s.namespaceURI==t&&(r=s.prefix?s.prefix+":"+i:i,r==s.nodeName)){n=s;break}return n},getAttributeNS:function(e,t,i){var n="";if(e.getAttributeNS)n=e.getAttributeNS(t,i)||"";else{var s=this.getAttributeNodeNS(e,t,i);s&&(n=s.nodeValue)}return n},getChildValue:function(e,t){var i=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:i+=n.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,n=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,s=e.firstChild;s;s=s.nextSibling){switch(s.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)n=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return n},hasAttributeNS:function(e,t,i){var n=!1;return n=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,n){if(e.setAttributeNS)e.setAttributeNS(t,i,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var s=e.ownerDocument.createNode(2,i,t);s.nodeValue=n,e.setAttributeNode(s)}else e.setAttribute(i,n)}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var n=e.indexOf(":");i=this.namespaces[e.substring(0,n)]}i||(i=this.namespaces[this.defaultPrefix]);var s=this.createElementNS(i,e);t.attributes&&this.setAttributes(s,t.attributes);var r=t.value;return null!=r&&s.appendChild(this.createTextNode(r)),s},setAttributes:function(e,t){var i,n;for(var s in t)null!=t[s]&&t[s].toString&&(i=t[s].toString(),n=this.namespaces[s.substring(0,s.indexOf(":"))]||null,this.setAttributeNS(e,n,s,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var n=e.localName||e.nodeName.split(":").pop(),s=i[n]||i["*"];s&&s.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,n=e.childNodes,s=0,r=n.length;r>s;++s)i=n[s],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var n,s,r=e.indexOf(":");r>0?(n=e.substring(0,r),s=e.substring(r+1)):(n=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,s=e);var a=this.writers[n][s].apply(this,[t]);return i&&i.appendChild(a),a},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var n=e;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(t&&t!==(n.localName||n.nodeName.split(":").pop())||i&&i!==n.namespaceURI))break e;n=null;break e;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break e}return n||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var n=e.attributes.length;if(n)for(var s,r=0;n>r;++r){if(s=e.attributes[r],"xmlns"===s.prefix&&s.name==="xmlns:"+t){i=s.value||null;break e}if("xmlns"===s.name&&null===t){i=s.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){function e(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(t){var i;return i=isNaN(t.getTime())?"Invalid Date":t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1,2)+"-"+e(t.getUTCDate(),2)+"T"+e(t.getUTCHours(),2)+":"+e(t.getUTCMinutes(),2)+":"+e(t.getUTCSeconds(),2)+"."+e(t.getUTCMilliseconds(),3)+"Z"}}(),parse:function(e){var t,i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var n=parseInt(i[1],10)||0,s=parseInt(i[2],10)-1||0,r=parseInt(i[3],10)||1;t=new Date(Date.UTC(n,s,r));var a=i[7];if(a){var o=parseInt(i[4],10),l=parseInt(i[5],10),u=parseFloat(i[6]),h=0|u,c=Math.round(1e3*(u-h));if(t.setUTCHours(o,l,h,c),"Z"!==a){var p=parseInt(a,10),d=parseInt(i[8],10)||0,m=-1e3*(60*60*p+60*d);t=new Date(t.getTime()+m)}}}else t=new Date("invalid");return t}},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var n=this.geometry.getBounds();t=i.intersectsBounds(n)}else{var s=i.toGeometry();t=s.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move)return void 0;var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();return this.geometry.move(n*(t.x-i.x),n*(i.y-t.y)),this.layer.drawFeature(this),i},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(e,t,i){var n=!1,s=this.getBounds();if(null!=s&&null!=e){var r=null!=t?t:0,a=null!=i?i:0,o=new OpenLayers.Bounds(this.bounds.left-r,this.bounds.bottom-a,this.bounds.right+r,this.bounds.top+a);n=o.containsLonLat(e)}return n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i);var n=i.read(e);if(n instanceof OpenLayers.Feature.Vector)t=n.geometry;else if(OpenLayers.Util.isArray(n)){for(var s=n.length,r=new Array(s),a=0;s>a;++a)r[a]=n[a].geometry;t=new OpenLayers.Geometry.Collection(r)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point,s=i&&i.tolerance,r=!1,a=e.x1-t.x1,o=e.y1-t.y1,l=e.x2-e.x1,u=e.y2-e.y1,h=t.y2-t.y1,c=t.x2-t.x1,p=h*l-c*u,d=c*o-h*a,m=l*o-u*a;if(0==p)0==d&&0==m&&(r=!0);else{var f=d/p,y=m/p;if(f>=0&&1>=f&&y>=0&&1>=y)if(n){var g=e.x1+f*l,v=e.y1+f*u;r=new OpenLayers.Geometry.Point(g,v)}else r=!0}if(s){var b;if(r){if(n){var L,g,v,O=[e,t];e:for(var w=0;2>w;++w){L=O[w];for(var _=1;3>_;++_)if(g=L["x"+_],v=L["y"+_],b=Math.sqrt(Math.pow(g-r.x,2)+Math.pow(v-r.y,2)),s>b){r.x=g,r.y=v;break e}}}}else{var x,S,g,v,C,k,O=[e,t];e:for(var w=0;2>w;++w){x=O[w],S=O[(w+1)%2];for(var _=1;3>_;++_)if(C={x:x["x"+_],y:x["y"+_]},k=OpenLayers.Geometry.distanceToSegment(C,S),k.distance<s){r=n?new OpenLayers.Geometry.Point(C.x,C.y):!0;break e}}}}return r},OpenLayers.Geometry.distanceToSegment=function(e,t){var i,n,s=e.x,r=e.y,a=t.x1,o=t.y1,l=t.x2,u=t.y2,h=l-a,c=u-o,p=(h*(s-a)+c*(r-o))/(Math.pow(h,2)+Math.pow(c,2));return 0>=p?(i=a,n=o):p>=1?(i=l,n=u):(i=a+p*h,n=o+p*c),{distance:Math.sqrt(Math.pow(i-s,2)+Math.pow(n-r,2)),x:i,y:n}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,s,r,a,o,l=!(t&&t.edge===!1),u=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,s=this.y,r=e.x,a=e.y,i=Math.sqrt(Math.pow(n-r,2)+Math.pow(s-a,2)),o=u?{x0:n,y0:s,x1:r,y1:a,distance:i}:i):(o=e.distanceTo(this,t),u&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance})),o},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;i>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;n>i;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),s=this.components.slice(t,this.components.length);n.push(e),this.components=n.concat(s)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,n=[],s=[],r=0,a=Number.MAX_VALUE,o=0;t>o;++o){i=this.components[o];var l=i.getArea(),u=i.getCentroid(!0);isNaN(l)||isNaN(u.x)||isNaN(u.y)||(n.push(l),r+=l,a=a>l&&l>0?l:a,s.push(u))}if(t=n.length,0===r){for(var o=0;t>o;++o)n[o]=1;r=n.length}else{for(var o=0;t>o;++o)n[o]/=a;r/=a}for(var u,l,h=0,c=0,o=0;t>o;++o)u=s[o],l=n[o],h+=u.x*l,c+=u.y*l;return new OpenLayers.Geometry.Point(h/r,c/r)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;n>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,s,r=!(t&&t.edge===!1),a=r&&t&&t.details,o=Number.POSITIVE_INFINITY,l=0,u=this.components.length;u>l&&(i=this.components[l].distanceTo(e,t),s=a?i.distance:i,!(o>s&&(o=s,n=i,0==o)));++l);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;n>i;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n>i;i++){var s=this.components[i];s.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;n>i&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;n>i;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;i>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0;if(t.components&&t.components.length>1)for(var s,r,a=1,o=t.components.length;o>a;a++)s=t.components[a-1],r=t.components[a],n+=OpenLayers.Util.distVincenty({lon:s.x,lat:s.y},{lon:r.x,lat:r.y});return 1e3*n},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,s=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var r,a,o,l,u,h,c,p;e:for(var d=0,m=s.length;m>d;++d){r=s[d],a=r.x1,o=r.x2,l=r.y1,u=r.y2;for(var f=0,y=n.length;y>f&&(h=n[f],!(h.x1>o));++f)if(!(h.x2<a||(c=h.y1,p=h.y2,Math.min(c,p)>Math.max(l,u)||Math.max(c,p)<Math.min(l,u)||!OpenLayers.Geometry.segmentsIntersect(r,h)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,s=new Array(n),r=0;n>r;++r)t=this.components[r],i=this.components[r+1],s[r]=t.x<i.x?{x1:t.x,y1:t.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:t.x,y2:t.y};return s.sort(e)},splitWithSegment:function(e,t){for(var i,n,s,r,a,o=!(t&&t.edge===!1),l=t&&t.tolerance,u=[],h=this.getVertices(),c=[],p=[],d=!1,m={point:!0,tolerance:l},f=null,y=0,g=h.length-2;g>=y;++y)if(i=h[y],c.push(i.clone()),n=h[y+1],a={x1:i.x,y1:i.y,x2:n.x,y2:n.y},s=OpenLayers.Geometry.segmentsIntersect(e,a,m),s instanceof OpenLayers.Geometry.Point&&(r=s.x===e.x1&&s.y===e.y1||s.x===e.x2&&s.y===e.y2||s.equals(i)||s.equals(n)?!0:!1,r||o)){if(s.equals(p[p.length-1])||p.push(s.clone()),0===y&&s.equals(i))continue;if(s.equals(n))continue;d=!0,s.equals(i)||c.push(s),u.push(new OpenLayers.Geometry.LineString(c)),c=[s.clone()]}if(d&&(c.push(n.clone()),u.push(new OpenLayers.Geometry.LineString(c))),p.length>0){var v=e.x1<e.x2?1:-1,b=e.y1<e.y2?1:-1;f={lines:u,points:p.sort(function(e,t){return v*e.x-v*t.x||b*e.y-b*t.y})}}return f},split:function(e,t){var i,n,s,r,a=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,u,h,c,p,d,m=this.getVertices(),f=[];s=[];for(var y=0,g=m.length-2;g>=y;++y){l=m[y],u=m[y+1],h={x1:l.x,y1:l.y,x2:u.x,y2:u.y},r=r||[e],o&&f.push(l.clone());for(var v=0;v<r.length;++v)if(c=r[v].splitWithSegment(h,t),c&&(p=c.lines,p.length>0&&(p.unshift(v,1),Array.prototype.splice.apply(r,p),v+=p.length-2),o))for(var b=0,L=c.points.length;L>b;++b)d=c.points[b],d.equals(l)||(f.push(d),s.push(new OpenLayers.Geometry.LineString(f)),f=d.equals(u)?[]:[d.clone()])}o&&s.length>0&&f.length>0&&(f.push(u.clone()),s.push(new OpenLayers.Geometry.LineString(f)))}else a=e.splitWith(this,t);return r&&r.length>1?n=!0:r=[],s&&s.length>1?i=!0:s=[],(n||i)&&(a=o?[s,r]:r),a},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1),s=n&&t&&t.details,r={},a=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,l=this.getSortedSegments(),u=e.x,h=e.y,c=0,p=l.length;p>c;++c)if(o=l[c],i=OpenLayers.Geometry.distanceToSegment(e,o),i.distance<a){if(a=i.distance,r=i,0===a)break}else if(o.x2>u&&(h>o.y1&&h<o.y2||h<o.y1&&h>o.y2))break;r=s?{distance:r.distance,x0:r.x,y0:r.y,x1:u,y1:h}:r.distance}else if(e instanceof OpenLayers.Geometry.LineString){var d,m,f,y,g,v=this.getSortedSegments(),b=e.getSortedSegments(),L=b.length,O={point:!0};e:for(var c=0,p=v.length;p>c;++c){d=v[c],y=d.x1,g=d.y1;for(var w=0;L>w;++w){if(m=b[w],f=OpenLayers.Geometry.segmentsIntersect(d,m,O)){a=0,r={distance:0,x0:f.x,y0:f.y,x1:f.x,y1:f.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:y,y:g},m),i.distance<a&&(a=i.distance,r={distance:a,x0:y,y0:g,x1:i.x,y1:i.y})}}if(s||(r=r.distance),0!==a&&d){i=e.distanceTo(new OpenLayers.Geometry.Point(d.x2,d.y2),t);var _=s?i.distance:i;a>_&&(r=s?{distance:a,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:_)}}else r=e.distanceTo(this,t),s&&(r={distance:r.distance,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0});return r},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t){return e-t},n=function(e,t,i,r){for(var a,l=0,u=0,h=t;i>h;h++)a=s(e[t],e[i],e[h]),a>l&&(l=a,u=h);l>r&&u!=t&&(o.push(u),n(e,t,u,r),n(e,u,i,r))},s=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=2*(n/s);return r},r=0,a=t.length-1,o=[];for(o.push(r),o.push(a);t[r].equals(t[a]);)a--,o.push(a);n(t,r,a,e);var l=[];o.sort(i);for(var u=0;u<o.length;u++)l.push(t[o[u]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,n=this.components.pop();null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var s=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[s]),i},removeComponent:function(){var e=this.components&&this.components.length>3;if(e){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var t=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[t])}return e},move:function(e,t){for(var i=0,n=this.components.length;n-1>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n-1>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,s=this.components.length;s-1>n;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n-1>i;i++){var s=this.components[i];s.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&2>=e)return this.components[0].clone();if(e>2){var t=0,i=0,n=this.components[0].x,s=this.components[0].y,r=-1*this.getArea();if(0!=r){for(var a=0;e-1>a;a++){var o=this.components[a],l=this.components[a+1];t+=(o.x+l.x-2*n)*((o.x-n)*(l.y-s)-(l.x-n)*(o.y-s)),i+=(o.y+l.y-2*s)*((o.x-n)*(l.y-s)-(l.x-n)*(o.y-s))}var u=n+t/(6*r),h=s+i/(6*r)}else{for(var a=0;e-1>a;a++)t+=this.components[a].x,i+=this.components[a].y;var u=t/(e-1),h=i/(e-1)}return new OpenLayers.Geometry.Point(u,h)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,n=this.components.length;n-1>i;i++){var s=this.components[i],r=this.components[i+1];t+=(s.x+r.x)*(r.y-s.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0,s=t.components&&t.components.length;if(s>2){for(var r,a,o=0;s-1>o;o++)r=t.components[o],a=t.components[o+1],n+=OpenLayers.Util.rad(a.x-r.x)*(2+Math.sin(OpenLayers.Util.rad(r.y))+Math.sin(OpenLayers.Util.rad(a.y)));n=6378137*6378137*n/2}return n},containsPoint:function(e){function t(e,t,i,n,s){return(e-s)*((n-t)/(s-i))+n}for(var i,n,s,r,a,o,l,u=OpenLayers.Number.limitSigDigs,h=14,c=u(e.x,h),p=u(e.y,h),d=this.components.length-1,m=0,f=0;d>f;++f)if(i=this.components[f],s=u(i.x,h),r=u(i.y,h),n=this.components[f+1],a=u(n.x,h),o=u(n.y,h),r!=o){if(l=u(t(p,s,r,a,o),h),l==c&&(o>r&&p>=r&&o>=p||r>o&&r>=p&&p>=o)){m=-1;break}c>=l||s!=a&&(l<Math.min(s,a)||l>Math.max(s,a))||(o>r&&p>=r&&o>p||r>o&&r>p&&p>=o)&&++m}else if(p==r&&(a>=s&&c>=s&&a>=c||s>=a&&s>=c&&c>=a)){m=-1;break}var y=-1==m?1:!!(1&m);return y},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;n>i&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;i>t;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,n=this.components.length;n>i;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var n,s=1;t>s;++s)if(n=this.components[s].containsPoint(e)){i=1===n?1:!1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;i>t&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;i>t&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;i>t&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var s=this.components[0];for(t=0,i=s.components.length;i>t&&!(n=e.containsPoint(s.components[t]));++t);}return n},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1);return i=!n&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var s=Math.PI*(1/i-.5);n&&(s+=n/180*Math.PI);for(var r,a,o,l=[],u=0;i>u;++u)r=s+2*u*Math.PI/i,a=e.x+t*Math.cos(r),o=e.y+t*Math.sin(r),l.push(new OpenLayers.Geometry.Point(a,o));var h=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([h])},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1
},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){var s=OpenLayers.Util.getElement(e);if(n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!s._eventCacheID){var r="eventCacheID_";s.id&&(r=s.id+"_"+r),s._eventCacheID=OpenLayers.Util.createUniqueID(r)}var a=s._eventCacheID;this.observers[a]||(this.observers[a]=[]),this.observers[a].push({element:s,name:t,observer:i,useCapture:n}),s.addEventListener?s.addEventListener(t,i,n):s.attachEvent&&s.attachEvent("on"+t,i)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,n){n=n||!1;var s=OpenLayers.Util.getElement(e),r=s._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.detachEvent)&&(t="keydown");var a=!1,o=OpenLayers.Event.observers[r];if(o)for(var l=0;!a&&l<o.length;){var u=o[l];if(u.name==t&&u.observer==i&&u.useCapture==n){o.splice(l,1),0==o.length&&delete OpenLayers.Event.observers[r],a=!0;break}l++}return a&&(s.removeEventListener?s.removeEventListener(t,i,n):s&&s.detachEvent&&s.detachEvent("on"+t,i)),a},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,n,s){OpenLayers.Util.extend(this,s),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t=0,i=this.BROWSER_EVENTS.length;i>t;t++)OpenLayers.Event.observe(e,this.BROWSER_EVENTS[t],this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,n){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var s=this.listeners[e];s||(s=[],this.listeners[e]=s,this.extensionCount[e]=0);var r={obj:t,func:i};n?(s.splice(this.extensionCount[e],0,r),"object"==typeof n&&n.extension&&this.extensionCount[e]++):s.push(r)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var n=this.listeners[e];if(null!=n)for(var s=0,r=n.length;r>s;s++)if(n[s].obj==t&&n[s].func==i){n.splice(s,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(!i||0==i.length)return void 0;null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var n,s=0,r=i.length;r>s;s++){var a=i[s];if(n=a.func.apply(a.obj,[t]),void 0!=n&&0==n)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),n},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){var n=e.touches;if(n&&n[0]){for(var s,r=0,a=0,o=n.length,l=0;o>l;++l)s=n[l],r+=s.clientX,a+=s.clientY;e.clientX=r/o,e.clientY=a/o}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var e=document.body;e&&(0==e.scrollTop&&0==e.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[t.scrollLeft,t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),n=!i&&e.match(this.URL_SPLIT_REGEX);if(n){var s=window.location;i=n[1]==s.protocol&&n[3]==s.hostname;var r=n[4],a=s.port;(80!=r&&""!=r||"80"!=a&&""!=a)&&(i=i&&r==a)}return i||(t?e="function"==typeof t?t(e):t+encodeURIComponent(e):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:e})),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=OpenLayers.Util.applyDefaults(e,t);var i,n=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(n=!0);n===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var s=new OpenLayers.Request.XMLHttpRequest,r=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));r=OpenLayers.Request.makeSameOrigin(r,e.proxy),s.open(e.method,r,e.async,e.user,e.password);for(var a in e.headers)s.setRequestHeader(a,e.headers[a]);var o=this.events,l=this;return s.onreadystatechange=function(){if(s.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=o.triggerEvent("complete",{request:s,config:e,requestUrl:r});t!==!1&&l.runCallbacks({request:s,config:e,requestUrl:r})}},e.async===!1?s.send(e.data):window.setTimeout(function(){0!==s.readyState&&s.send(e.data)},0),s},runCallbacks:function(e){var t,i=e.request,n=e.config,s=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var r;n.failure&&(r=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure),"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&i.responseText&&(i.status=200),s(i),(!i.status||i.status>=200&&i.status<300)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(i.status<200||i.status>=300)&&(this.events.triggerEvent("failure",e),r&&r(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=o&&!h?new o:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){if(e._object.send(e._data),l&&!e._async)for(e.readyState=t.OPENED,r(e);e.readyState<t.DONE;)if(e.readyState++,n(e),e._aborted)return}function n(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function s(e){var t=e.responseXML,i=e.responseText;return u&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&(u&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function r(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=s(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function a(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,l=!!window.controllers,u=window.document.all&&!window.opera,h=u&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,l&&o.wrapped&&(t.wrapped=o.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,i,s,o,h){delete this._headers,arguments.length<3&&(s=!0),this._async=s;var c,p=this,d=this.readyState;u&&s&&(c=function(){d!=t.DONE&&(a(p),p.abort())},window.attachEvent("onunload",c)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,i,s,o,h):arguments.length>3?this._object.open(e,i,s,o):this._object.open(e,i,s),this.readyState=t.OPENED,n(this),this._object.onreadystatechange=function(){if(!l||s){if(p.readyState=p._object.readyState,r(p),p._aborted)return p.readyState=t.UNSENT,void 0;p.readyState==t.DONE&&(delete p._data,a(p),u&&s&&window.detachEvent("onunload",c)),d!=p.readyState&&n(p),d=p.readyState}}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,i(this)},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),a(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var n,s=0;n=this._listeners[s];s++)if(n[0]==e&&n[1]==t&&n[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var n,s=0;(n=this._listeners[s])&&(n[0]!=e||n[1]!=t||n[2]!=i);s++);n&&this._listeners.splice(s,1)},t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,n=0;i=this._listeners[n];n++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),"object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var n=this.getCode(),s=t.getCode();i=n==s||!!OpenLayers.Projection.transforms[n]&&OpenLayers.Projection.transforms[n][s]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var n=t.getCode(),s=i.getCode(),r=OpenLayers.Projection.transforms;r[n]&&r[n][s]&&r[n][s](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/s,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/s*Math.PI))-Math.PI/2),e}function t(e){return e.x=e.x*s/180,e.y=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*s,e}function i(i,n){var s,r,a,o,l,u=OpenLayers.Projection.addTransform,h=OpenLayers.Projection.nullTransform;for(s=0,r=n.length;r>s;++s)for(a=n[s],u(i,a,t),u(a,i,e),l=s+1;r>l;++l)o=n[l],u(a,o,h),u(o,a,h)}var n,s=20037508.34,r=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],a=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(n=r.length-1;n>=0;--n)i(r[n],a);for(n=a.length-1;n>=0;--n)i(a[n],r)}(),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[],this.styles={},this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],n=0,s=i.length;s>n;++n){var r=i[n],a=this.getElementsByTagNameNS(e,"*",r);if(0!=a.length)switch(r.toLowerCase()){case"link":case"networklink":this.parseLinks(a,t);break;case"style":this.extractStyles&&this.parseStyles(a,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(a,t);break;case"placemark":this.parseFeatures(a,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=OpenLayers.Util.extend({},t);i.depth++;for(var n=0,s=e.length;s>n;n++){var r=this.parseProperty(e[n],"*","href");if(r&&!this.fetched[r]){this.fetched[r]=!0;var a=this.fetchLink(r);a&&this.parseData(a,i)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});return t?t.responseText:void 0},parseStyles:function(e,t){for(var i=0,n=e.length;n>i;i++){var s=this.parseStyle(e[i]);if(s){var r=(t.styleBaseUrl||"")+"#"+s.id;this.styles[r]=s}}},parseKmlColor:function(e){var t=null;if(e){var i=e.match(this.regExes.kmlColor);i&&(t={color:"#"+i[4]+i[3]+i[2],opacity:parseInt(i[1],16)/255})}return t},parseStyle:function(e){for(var t,i,n={},s=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],r=0,a=s.length;a>r;++r)if(t=s[r],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(n.strokeColor=l.color,n.strokeOpacity=l.opacity);var u=this.parseProperty(i,"*","width");u&&(n.strokeWidth=u);break;case"polystyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(n.fillOpacity=l.opacity,n.fillColor=l.color);var h=this.parseProperty(i,"*","fill");"0"==h&&(n.fillColor="none");var c=this.parseProperty(i,"*","outline");"0"==c&&(n.strokeWidth="0");break;case"iconstyle":var p=parseFloat(this.parseProperty(i,"*","scale")||1),u=32*p,d=32*p,m=this.getElementsByTagNameNS(i,"*","Icon")[0];if(m){var f=this.parseProperty(m,"*","href");if(f){var y=this.parseProperty(m,"*","w"),g=this.parseProperty(m,"*","h"),v="http://maps.google.com/mapfiles/kml";!OpenLayers.String.startsWith(f,v)||y||g||(y=64,g=64,p/=2),y=y||g,g=g||y,y&&(u=parseInt(y)*p),g&&(d=parseInt(g)*p);var b=f.match(this.regExes.kmlIconPalette);if(b){var L=b[1],O=b[2],w=this.parseProperty(m,"*","x"),_=this.parseProperty(m,"*","y"),x=w?w/32:0,S=_?7-_/32:7,C=8*S+x;f="http://maps.google.com/mapfiles/kml/pal"+L+"/icon"+C+O}n.graphicOpacity=1,n.externalGraphic=f}}var k=this.getElementsByTagNameNS(i,"*","hotSpot")[0];if(k){var w=parseFloat(k.getAttribute("x")),_=parseFloat(k.getAttribute("y")),M=k.getAttribute("xunits");"pixels"==M?n.graphicXOffset=-w*p:"insetPixels"==M?n.graphicXOffset=-u+w*p:"fraction"==M&&(n.graphicXOffset=-u*w);var P=k.getAttribute("yunits");"pixels"==P?n.graphicYOffset=-d+_*p+1:"insetPixels"==P?n.graphicYOffset=-(_*p)+1:"fraction"==P&&(n.graphicYOffset=-d*(1-_)+1)}n.graphicWidth=u,n.graphicHeight=d;break;case"balloonstyle":var E=OpenLayers.Util.getXmlNodeValue(i);E&&(n.balloonStyle=E.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(n.fontColor=l.color,n.fontOpacity=l.opacity)}!n.strokeColor&&n.fillColor&&(n.strokeColor=n.fillColor);var N=e.getAttribute("id");return N&&n&&(n.id=N),n},parseStyleMaps:function(e,t){for(var i=0,n=e.length;n>i;i++)for(var s=e[i],r=this.getElementsByTagNameNS(s,"*","Pair"),a=s.getAttribute("id"),o=0,l=r.length;l>o;o++){var u=r[o],h=this.parseProperty(u,"*","key"),c=this.parseProperty(u,"*","styleUrl");c&&"normal"==h&&(this.styles[(t.styleBaseUrl||"")+"#"+a]=this.styles[(t.styleBaseUrl||"")+c])}},parseFeatures:function(e,t){for(var i=[],n=0,s=e.length;s>n;n++){var r=e[n],a=this.parseFeature.apply(this,[r]);if(!a)throw"Bad Placemark: "+n;if(this.extractStyles&&a.attributes&&a.attributes.styleUrl&&(a.style=this.getStyle(a.attributes.styleUrl,t)),this.extractStyles){var o=this.getElementsByTagNameNS(r,"*","Style")[0];if(o){var l=this.parseStyle(o);l&&(a.style=OpenLayers.Util.extend(a.style,l))}}if(this.extractTracks){var u=this.getElementsByTagNameNS(r,this.namespaces.gx,"Track");if(u&&u.length>0){var h=u[0],c={features:[],feature:a};this.readNode(h,c),c.features.length>0&&i.push.apply(i,c.features)}}else i.push(a)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){var n;i.attributes={};for(var s=0,r=this.trackAttributes.length;r>s;++s)n=this.trackAttributes[s],i.attributes[n]=[],n in this.readers.kml||(this.readers.kml[n]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var a=i.angles.length>0;if(a&&i.whens.length!==i.angles.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(var o,l,u,s=0,r=i.whens.length;r>s;++s){if(o=t.feature.clone(),o.fid=t.feature.fid||t.feature.id,l=i.points[s],o.geometry=l,"z"in l&&(o.attributes.altitude=l.z),this.internalProjection&&this.externalProjection&&o.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var h=0,c=this.trackAttributes.length;c>h;++h)o.attributes[n]=i.attributes[this.trackAttributes[h]][s];o.attributes.when=i.whens[s],o.attributes.trackId=t.feature.id,a&&(u=i.angles[s],o.attributes.heading=parseFloat(u[0]),o.attributes.tilt=parseFloat(u[1]),o.attributes.roll=parseFloat(u[2])),t.features.push(o)}},coord:function(e,t){var i=this.getChildValue(e),n=i.replace(this.regExes.trimSpace,"").split(/\s+/),s=new OpenLayers.Geometry.Point(n[0],n[1]);n.length>2&&(s.z=parseFloat(n[2])),t.points.push(s)},angles:function(e,t){var i=this.getChildValue(e),n=i.replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(n)}}},parseFeature:function(e){for(var t,i,n,s,r=["MultiGeometry","Polygon","LineString","Point"],a=0,o=r.length;o>a;++a)if(t=r[a],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,i=this.getElementsByTagNameNS(e,this.internalns,t),i.length>0){var s=this.parseGeometry[t.toLowerCase()];if(!s)throw new TypeError("Unsupported geometry type: "+t);n=s.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var l;this.extractAttributes&&(l=this.parseAttributes(e));var u=new OpenLayers.Feature.Vector(n,l),h=e.getAttribute("id")||e.getAttribute("name");return null!=h&&(u.fid=h),u},getStyle:function(e,t){var i=OpenLayers.Util.removeTail(e),n=OpenLayers.Util.extend({},t);if(n.depth++,n.styleBaseUrl=i,!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&n.depth<=this.maxDepth&&!this.fetched[i]){var s=this.fetchLink(i);s&&this.parseData(s,n)}var r=OpenLayers.Util.extend({},this.styles[e]);return r},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),i=[];if(t.length>0){var n=t[0].firstChild.nodeValue;n=n.replace(this.regExes.removeSpace,""),i=n.split(",")}var s=null;if(!(i.length>1))throw"Bad coordinate string: "+n;return 2==i.length&&(i[2]=null),s=new OpenLayers.Geometry.Point(i[0],i[1],i[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=null;if(i.length>0){var s=this.getChildValue(i[0]);s=s.replace(this.regExes.trimSpace,""),s=s.replace(this.regExes.trimComma,",");for(var r,a,o=s.split(this.regExes.splitSpace),l=o.length,u=new Array(l),h=0;l>h;++h){if(r=o[h].split(","),a=r.length,!(a>1))throw"Bad LineString point coordinates: "+o[h];2==r.length&&(r[2]=null),u[h]=new OpenLayers.Geometry.Point(r[0],r[1],r[2])}if(!l)throw"Bad LineString coordinates: "+s;n=t?new OpenLayers.Geometry.LinearRing(u):new OpenLayers.Geometry.LineString(u)}return n},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),i=t.length,n=new Array(i);if(i>0)for(var s,r=0,a=t.length;a>r;++r){if(s=this.parseGeometry.linestring.apply(this,[t[r],!0]),!s)throw"Bad LinearRing geometry: "+r;n[r]=s}return new OpenLayers.Geometry.Polygon(n)},multigeometry:function(e){for(var t,i,n=[],s=e.childNodes,r=0,a=s.length;a>r;++r)if(t=s[r],1==t.nodeType){var o=t.prefix?t.nodeName.split(":")[1]:t.nodeName,i=this.parseGeometry[o.toLowerCase()];i&&n.push(i.apply(this,[t]))}return new OpenLayers.Geometry.Collection(n)}},parseAttributes:function(e){var t={},i=e.getElementsByTagName("ExtendedData");i.length&&(t=this.parseExtendedData(i[0]));for(var n,s,r,a=e.childNodes,o=0,l=a.length;l>o;++o)if(n=a[o],1==n.nodeType&&(s=n.childNodes,s.length>=1&&s.length<=3)){var r;switch(s.length){case 1:r=s[0];break;case 2:var u=s[0],h=s[1];r=3==u.nodeType||4==u.nodeType?u:h;break;case 3:default:r=s[1]}if(3==r.nodeType||4==r.nodeType){var c=n.prefix?n.nodeName.split(":")[1]:n.nodeName,p=OpenLayers.Util.getXmlNodeValue(r);p&&(p=p.replace(this.regExes.trimSpace,""),t[c]=p)}}return t},parseExtendedData:function(e){var t,i,n,s,r={},a=e.getElementsByTagName("Data");for(t=0,i=a.length;i>t;t++){n=a[t],s=n.getAttribute("name");var o={},l=n.getElementsByTagName("value");if(l.length&&(o.value=this.getChildValue(l[0])),this.kvpAttributes)r[s]=o.value;else{var u=n.getElementsByTagName("displayName");u.length&&(o.displayName=this.getChildValue(u[0])),r[s]=o}}var h=e.getElementsByTagName("SimpleData");for(t=0,i=h.length;i>t;t++){var o={};n=h[t],s=n.getAttribute("name"),o.value=this.getChildValue(n),this.kvpAttributes?r[s]=o.value:(o.displayName=s,r[s]=o)}return r},parseProperty:function(e,t,i){var n,s=this.getElementsByTagNameNS(e,t,i);try{n=OpenLayers.Util.getXmlNodeValue(s[0])}catch(r){n=null}return n},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),n=0,s=e.length;s>n;++n)i.appendChild(this.createPlacemarkXML(e[n]));return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}if(this.foldersDesc){var n=this.createElementNS(this.kmlns,"description"),s=this.createTextNode(this.foldersDesc);n.appendChild(s),e.appendChild(n)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),i=e.style&&e.style.label?e.style.label:e.id,n=e.attributes.name||i;t.appendChild(this.createTextNode(n));var s=this.createElementNS(this.kmlns,"description"),r=e.attributes.description||this.placemarksDesc;s.appendChild(this.createTextNode(r));var a=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&a.setAttribute("id",e.fid),a.appendChild(t),a.appendChild(s);var o=this.buildGeometryNode(e.geometry);if(a.appendChild(o),e.attributes){var l=this.buildExtendedData(e.attributes);l&&a.appendChild(l)}return a},buildGeometryNode:function(e){var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[i.toLowerCase()],s=null;return n&&(s=n.apply(this,[e])),s},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n,s=this.createElementNS(this.kmlns,"Polygon"),r=e.components,a=0,o=r.length;o>a;++a)n=0==a?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,n),i=this.buildGeometry.linearring.apply(this,[r[a]]),t.appendChild(i),s.appendChild(t);return s},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),n=0,s=e.components.length;s>n;++n)t=this.buildGeometryNode.apply(this,[e.components[n]]),t&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates"),n=e.components;if(n){for(var s,r=n.length,a=new Array(r),o=0;r>o;++o)s=n[o],a[o]=this.buildCoordinates(s);t=a.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);return i.appendChild(l),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection)),e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var i in e)if(e[i]&&"name"!=i&&"description"!=i&&"styleUrl"!=i){var n=this.createElementNS(this.kmlns,"Data");n.setAttribute("name",i);var s=this.createElementNS(this.kmlns,"value");if("object"==typeof e[i]){if(e[i].value&&s.appendChild(this.createTextNode(e[i].value)),e[i].displayName){var r=this.createElementNS(this.kmlns,"displayName");r.appendChild(this.getXMLDoc().createCDATASection(e[i].displayName)),n.appendChild(r)}}else s.appendChild(this.createTextNode(e[i]));n.appendChild(s),t.appendChild(n)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,n,s,r,a,o=null,l=t&&t.mutual,u=[],h=[e],c=0,p=this.components.length;p>c;++c){n=this.components[c],r=!1;for(var d=0;d<h.length;++d)if(i=n.split(h[d],t)){if(l){s=i[0];for(var m=0,f=s.length;f>m;++m)0===m&&u.length?u[u.length-1].addComponent(s[m]):u.push(new OpenLayers.Geometry.MultiLineString([s[m]]));r=!0,i=i[1]}if(i.length){i.unshift(d,1),Array.prototype.splice.apply(h,i);break}}r||(u.length?u[u.length-1].addComponent(n.clone()):u=[new OpenLayers.Geometry.MultiLineString(n.clone())])}return u&&u.length>1?r=!0:u=[],h&&h.length>1?a=!0:h=[],(r||a)&&(o=l?[u,h]:h),o},splitWith:function(e,t){var i,n,s,r,a,o,l,u=null,h=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[],o=[e];for(var c=0,p=this.components.length;p>c;++c){a=!1,n=this.components[c];for(var d=0;d<o.length;++d)if(i=o[d].split(n,t)){h&&(s=i[0],s.length&&(s.unshift(d,1),Array.prototype.splice.apply(o,s),d+=s.length-2),i=i[1],0===i.length&&(i=[n.clone()]));for(var m=0,f=i.length;f>m;++m)0===m&&l.length?l[l.length-1].addComponent(i[m]):l.push(new OpenLayers.Geometry.MultiLineString([i[m]]));a=!0}a||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString([n.clone()])])
}}else u=e.split(this);return o&&o.length>1?r=!0:o=[],l&&l.length>1?a=!0:l=[],(r||a)&&(u=h?[o,l]:l),u},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],n=0;n<t.length;n++){var s=this.parseFeature(t[n]);s&&i.push(s)}return i},parseFeature:function(e){for(var t,i,n,s,r=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],a=0;a<r.length;++a)if(t=r[a],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){if(s=this.parseGeometry[t.toLowerCase()],!s)throw new TypeError("Unsupported geometry type: "+t);n=s.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var o,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(a=0;a<l.length;++a){var u=l[a],h=this.parseGeometry.box.apply(this,[u]),c=u.parentNode,p=c.localName||c.nodeName.split(":").pop();"boundedBy"===p?o=h:n=h.toGeometry()}var d;this.extractAttributes&&(d=this.parseAttributes(e));var m=new OpenLayers.Feature.Vector(n,d);m.bounds=o,m.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var f,y=e.firstChild;y&&(1!=y.nodeType||!(f=y.getAttribute("fid")||y.getAttribute("id")));)y=y.nextSibling;return m.fid=f,m},parseGeometry:{point:function(e){var t,i,n=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),n=i.split(this.regExes.splitSpace)),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),n=i.split(","))),0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0)){var s=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),r=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");s.length>0&&r.length>0&&(n=[s[0].firstChild.nodeValue,r[0].firstChild.nodeValue])}return 2==n.length&&(n[2]=null),this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var n,s=0;s<t.length;++s)n=this.parseGeometry.point.apply(this,[t[s]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(e,t){var i,n,s=[],r=[];if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),s=n.split(this.regExes.splitSpace);for(var a,o,l,u,h=parseInt(i[0].getAttribute("dimension")),c=0;c<s.length/h;++c)a=c*h,o=s[a],l=s[a+1],u=2==h?null:s[a+2],this.xy?r.push(new OpenLayers.Geometry.Point(o,l,u)):r.push(new OpenLayers.Geometry.Point(l,o,u))}if(0==s.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0)){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,",");for(var p=n.split(this.regExes.splitSpace),c=0;c<p.length;++c)s=p[c].split(","),2==s.length&&(s[2]=null),this.xy?r.push(new OpenLayers.Geometry.Point(s[0],s[1],s[2])):r.push(new OpenLayers.Geometry.Point(s[1],s[0],s[2]))}var d=null;return 0!=r.length&&(d=t?new OpenLayers.Geometry.LinearRing(r):new OpenLayers.Geometry.LineString(r)),d},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var n,s=0;s<t.length;++s)n=this.parseGeometry.linestring.apply(this,[t[s]]),n&&i.push(n);return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var n,s=0;s<t.length;++s)n=this.parseGeometry.linestring.apply(this,[t[s],!0]),n&&i.push(n);return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var n,s=0;s<t.length;++s)n=this.parseGeometry.polygon.apply(this,[t[s]]),n&&i.push(n);return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t,i,n=[],s=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(s.length>0){var r=[];if(s.length>0&&(t=s[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var a=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var a=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var r=[];if(o.length>0&&(t=o[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var l=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var l=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}if(a&&l){n.push(new OpenLayers.Geometry.Point(a.x,a.y)),n.push(new OpenLayers.Geometry.Point(l.x,a.y)),n.push(new OpenLayers.Geometry.Point(l.x,l.y)),n.push(new OpenLayers.Geometry.Point(a.x,l.y)),n.push(new OpenLayers.Geometry.Point(a.x,a.y));var u=new OpenLayers.Geometry.LinearRing(n);i=new OpenLayers.Geometry.Polygon([u])}return i},box:function(e){var t,i,n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),s=null,r=null;return n.length>0&&(t=n[0].firstChild.nodeValue,i=t.split(" "),2==i.length&&(s=i[0].split(","),r=i[1].split(","))),null!==s&&null!==r?new OpenLayers.Bounds(parseFloat(s[0]),parseFloat(s[1]),parseFloat(r[0]),parseFloat(r[1])):void 0}},parseAttributes:function(e){for(var t,i,n,s,r,a,o,l={},u=e.firstChild;u;){if(1==u.nodeType){for(t=u.childNodes,i=0;i<t.length;++i)n=t[i],1==n.nodeType&&(s=n.childNodes,1==s.length?(r=s[0],(3==r.nodeType||4==r.nodeType)&&(a=n.prefix?n.nodeName.split(":")[1]:n.nodeName,o=r.nodeValue.replace(this.regExes.trimSpace,""),l[a]=o)):l[n.nodeName.split(":").pop()]=null);break}u=u.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);n.appendChild(i);var s=this.createElementNS(this.gmlns,"gml:"+this.featureName),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),a=e.fid||e.id;r.setAttribute("fid",a),r.appendChild(n);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]),u=o.substring(o.lastIndexOf(":")+1),h=this.createElementNS(this.featureNS,this.featurePrefix+":"+u);h.appendChild(l),r.appendChild(h)}return s.appendChild(r),s},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[i.toLowerCase()];return n.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPoint"),s=e.components,r=0;r<s.length;r++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[s[r]]),t.appendChild(i),n.appendChild(t);return n},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiLineString"),s=e.components,r=0;r<s.length;++r)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[s[r]]),t.appendChild(i),n.appendChild(t);return n},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n,s=this.createElementNS(this.gmlns,"gml:Polygon"),r=e.components,a=0;a<r.length;++a)n=0==a?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+n),i=this.buildGeometry.linearring.apply(this,[r[a]]),t.appendChild(i),s.appendChild(t);return s},multipolygon:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPolygon"),s=e.components,r=0;r<s.length;++r)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[s[r]]),t.appendChild(i),n.appendChild(t);return n},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var n=e.components?e.components:[e],s=0;s<n.length;s++)i.push(n[s].x+","+n[s].y);var r=this.createTextNode(i.join(" "));return t.appendChild(r),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0==t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var n=0,s=i.length;s>n;++n)this.readNode(i[n],{features:t},!0);else{var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");i.length&&this.readNode(i[0],{features:t},!0)}}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var n,s=i.split(this.regExes.splitSpace),r=s.length,a=new Array(r),o=0;r>o;++o)n=s[o].split(","),a[o]=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2]);t.points=a},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,n=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,n)?n===this.featureType&&(i="_typeName"):i="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var n=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(n.type=e.nodeName.split(":").pop(),n.namespace=e.namespaceURI);var s=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");s&&(n.fid=s),this.internalProjection&&this.externalProjection&&n.geometry&&n.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(n.bounds=i.bounds),t.features.push(n)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),n=this.getChildValue(e);t.attributes[i]=n}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],n=0,s=i.length;s>n;++n)this.writeNode("pointMember",i[n],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],n=0,s=i.length;s>n;++n)this.writeNode("lineStringMember",i[n],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],n=0,s=i.length;s>n;++n)this.writeNode("polygonMember",i[n],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,n=e.components.length;n>i;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes){var n=e.attributes[i];null!=n&&this.writeNode("feature:_attribute",{name:i,value:n},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],n=this.writeNode("gml:"+i,e,t);return this.srsName&&n.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,n=e.length;n>i;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],s=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,s.x,s.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,n=new Array(i),s=0;i>s;++s)t=e[s],n[s]=this.xy?t.x+","+t.y:t.y+","+t.x,void 0!=t.z&&(n[s]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?n[0]:n.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,s=[],r=!1,a=0,o=n.length;o>a;a++){t=n[a];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?s.push(t):(r=!0,this.applySymbolizer(t,i,e)))}if(0==r&&s.length>0){r=!0;for(var a=0,o=s.length;o>a;a++)this.applySymbolizer(s[a],i,e)}return n.length>0&&0==r&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],s=e.symbolizer[n]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var r=this.defaultStyle;OpenLayers.Util.applyDefaults(s,{pointRadius:r.pointRadius}),(s.stroke===!0||s.graphic===!0)&&OpenLayers.Util.applyDefaults(s,{strokeWidth:r.strokeWidth,strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,strokeDashstyle:r.strokeDashstyle,strokeLinecap:r.strokeLinecap}),(s.fill===!0||s.graphic===!0)&&OpenLayers.Util.applyDefaults(s,{fillColor:r.fillColor,fillOpacity:r.fillOpacity}),s.graphic===!0&&OpenLayers.Util.applyDefaults(s,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,s),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,n,s=this.rules,r=0,a=s.length;a>r;r++){i=s[r].symbolizer;for(var o in i){if(n=i[o],"object"!=typeof n){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var i;for(var n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;n>i;i++)if(-1!=e.CLASS_NAME.indexOf(t[i]))return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var n=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(n,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={},OpenLayers.Util.extend(this,e),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer)this.symbolizer[e]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(e){var t=this.getContext(e),i=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var n=e.layer.map.getScale();return this.minScaleDenominator&&(i=n>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)),i&&this.maxScaleDenominator&&(i=n<OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)),i&&this.filter&&(i="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(e):this.filter.evaluate(t)),i},getContext:function(e){var t=this.context;return t||(t=e.attributes||e.data),"function"==typeof this.context&&(t=this.context(e)),t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=new Array(t);for(var i=0;t>i;++i)e.symbolizers[i]=this.symbolizers[i].clone()}else{e.symbolizer={};var n,s;for(var r in this.symbolizer)n=this.symbolizer[r],s=typeof n,"object"===s?e.symbolizer[r]=OpenLayers.Util.extend({},n):"string"===s&&(e.symbolizer[r]=n)}return e.filter=this.filter&&this.filter.clone(),e.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement,i={exceptionReport:null};return t&&(this.readChildNodes(e,i),null===i.exceptionReport&&(i=(new OpenLayers.Format.OWSCommon).read(e))),i},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var n=this.parser.write(e,t);return this.stringifyOutput===!1?n:OpenLayers.Format.XML.prototype.write.apply(this,[n])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,n=this.getVersion(i);this.parser=this.getParser(n);var s=this.parser.read(e,t);if(null!==this.errorProperty&&void 0===s[this.errorProperty]){var r=new OpenLayers.Format.OGCExceptionReport;s.error=r.read(e)}return s.version=n,s},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;i>t;t++){var n=e.fid||e.id;if(n==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;i>t;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;i>t;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return void 0},clone:function(){for(var e=[],t=0,i=this.filters.length;i>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,i=!1,n=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof n||"string"!=typeof t?n==t:n.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof n||"string"!=typeof t?n!=t:n.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:i=n<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:i=n>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=n<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=n>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:i=n>=this.lowerBoundary&&n<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var s=new RegExp(this.value,"gi");i=s.test(n)}return i},value2regex:function(e,t,i){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return e=e?e:"*",t=t?t:".",i=i?i:"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value
},regex2value:function(){var e=this.value;return e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 1:t=this.readNode(n),t.property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=n.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(){}}},readSpatial:function(e,t,i){var n=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,n),n.value=n.components[0],delete n.components,t.filters.push(n)},writeOgcExpression:function(e,t){if(e instanceof OpenLayers.Filter.Function){var i=this.writeNode("Function",e,t);t.appendChild(i)}else this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writeFeatureIdNodes:function(e,t){for(var i=0,n=e.fids.length;n>i;++i)this.writeNode("FeatureId",e.fids[i],t)},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return"FID"===e.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,e,t):this.writeNode(this.getFilterType(e),e,t),t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),n=0,s=e.filters.length;s>n;++n)t=e.filters[n],"FID"===t.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,t,i):this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),n=0,s=e.filters.length;s>n;++n)t=e.filters[n],"FID"===t.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,t,i):this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return"FID"===i.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,i,t):this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){return this.createElementNSPlus("ogc:Literal",{value:e})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,n=0,s=i.length;s>n;n++)this.writeOgcExpression(i[n],t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),s=e.getAttribute("singleChar"),r=e.getAttribute("escape");i.value2regex(n,s,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(e){OpenLayers.Util.extend(this,e)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={namedLayers:t.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(e,i),i},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.description=this.getChildValue(e)},NamedLayer:function(e,t){var i={userStyles:[],namedStyles:[]};this.readChildNodes(e,i);for(var n=0,s=i.userStyles.length;s>n;++n)i.userStyles[n].layerName=i.name;OpenLayers.Util.isArray(t.namedLayers)?t.namedLayers.push(i):t.namedLayers[i.name]=i},NamedStyle:function(e,t){t.namedStyles.push(this.getChildName(e.firstChild))},UserStyle:function(e,t){var i={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(e,i);var n;this.multipleSymbolizers?(delete i.defaultsPerSymbolizer,n=new OpenLayers.Style2(i)):n=new OpenLayers.Style(this.defaultSymbolizer,i),t.userStyles.push(n)},IsDefault:function(e,t){"1"==this.getChildValue(e)&&(t.isDefault=!0)},FeatureTypeStyle:function(e,t){++this.featureTypeCounter;var i={rules:this.multipleSymbolizers?t.rules:[]};this.readChildNodes(e,i),this.multipleSymbolizers||(t.rules=i.rules)},Rule:function(e,t){var i;this.multipleSymbolizers&&(i={symbolizers:[]});var n=new OpenLayers.Rule(i);this.readChildNodes(e,n),t.rules.push(n)},ElseFilter:function(e,t){t.elseFilter=!0},MinScaleDenominator:function(e,t){t.minScaleDenominator=parseFloat(this.getChildValue(e))},MaxScaleDenominator:function(e,t){t.maxScaleDenominator=parseFloat(this.getChildValue(e))},TextSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Text(i))):t.symbolizer.Text=OpenLayers.Util.applyDefaults(i,t.symbolizer.Text)},LabelPlacement:function(e,t){this.readChildNodes(e,t)},PointPlacement:function(e,t){var i={};this.readChildNodes(e,i),i.labelRotation=i.rotation,delete i.rotation;var n,s=t.labelAnchorPointX,r=t.labelAnchorPointY;1/3>=s?n="l":s>1/3&&2/3>s?n="c":s>=2/3&&(n="r"),1/3>=r?n+="b":r>1/3&&2/3>r?n+="m":r>=2/3&&(n+="t"),i.labelAlign=n,OpenLayers.Util.applyDefaults(t,i)},AnchorPoint:function(e,t){this.readChildNodes(e,t)},AnchorPointX:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelAnchorPointX=i)},AnchorPointY:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelAnchorPointY=i)},Displacement:function(e,t){this.readChildNodes(e,t)},DisplacementX:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelXOffset=i)},DisplacementY:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelYOffset=i)},LinePlacement:function(e,t){this.readChildNodes(e,t)},PerpendicularOffset:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.labelPerpendicularOffset=i)},Label:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.label=i)},Font:function(e,t){this.readChildNodes(e,t)},Halo:function(e,t){var i={};this.readChildNodes(e,i),t.haloRadius=i.haloRadius,t.haloColor=i.fillColor,t.haloOpacity=i.fillOpacity},Radius:function(e,t){var i=this.readers.ogc._expression.call(this,e);null!=i&&(t.haloRadius=i)},RasterSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Raster(i))):t.symbolizer.Raster=OpenLayers.Util.applyDefaults(i,t.symbolizer.Raster)},Geometry:function(e,t){t.geometry={},this.readChildNodes(e,t.geometry)},ColorMap:function(e,t){t.colorMap=[],this.readChildNodes(e,t.colorMap)},ColorMapEntry:function(e,t){var i=e.getAttribute("quantity"),n=e.getAttribute("opacity");t.push({color:e.getAttribute("color"),quantity:null!==i?parseFloat(i):void 0,label:e.getAttribute("label")||void 0,opacity:null!==n?parseFloat(n):void 0})},LineSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Line(i))):t.symbolizer.Line=OpenLayers.Util.applyDefaults(i,t.symbolizer.Line)},PolygonSymbolizer:function(e,t){var i={fill:!1,stroke:!1};this.multipleSymbolizers||(i=t.symbolizer.Polygon||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Polygon(i))):t.symbolizer.Polygon=i},PointSymbolizer:function(e,t){var i={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(i=t.symbolizer.Point||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Point(i))):t.symbolizer.Point=i},Stroke:function(e,t){t.stroke=!0,this.readChildNodes(e,t)},Fill:function(e,t){t.fill=!0,this.readChildNodes(e,t)},CssParameter:function(e,t){var i=e.getAttribute("name"),n=this.cssMap[i];if(t.label&&("fill"===i?n="fontColor":"fill-opacity"===i&&(n="fontOpacity")),n){var s=this.readers.ogc._expression.call(this,e);s&&(t[n]=s)}},GraphicFill:function(e,t){t.pointRadius=null,this.readChildNodes(e,t)},Graphic:function(e,t){t.graphic=!0;var i={};this.readChildNodes(e,i);for(var n,s,r=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],a=0,o=r.length;o>a;++a)n=r[a],s=i[n],void 0!=s&&(t[n]=s);if(void 0!=i.opacity&&(t.graphicOpacity=i.opacity),void 0!=i.size){var l=i.size/2;isNaN(l)?t.graphicWidth=i.size:t.pointRadius=i.size/2}void 0!=i.href&&(t.externalGraphic=i.href),void 0!=i.rotation&&(t.rotation=i.rotation)},ExternalGraphic:function(e,t){this.readChildNodes(e,t)},Mark:function(e,t){this.readChildNodes(e,t)},WellKnownName:function(e,t){t.graphicName=this.getChildValue(e)},Opacity:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.opacity=i)},Size:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.size=i)},Rotation:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.rotation=i)},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},Format:function(e,t){t.graphicFormat=this.getChildValue(e)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var t=null;for(var i in this.cssMap)if(this.cssMap[i]==e){t=i;break}return t},getGraphicFormat:function(e){var t;for(var i in this.graphicFormats)if(this.graphicFormats[i].test(e)){t=i;break}return t||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(e){return this.writers.sld.StyledLayerDescriptor.apply(this,[e])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(e,t){var i=this.createElementNSPlus(e),n="string"==typeof t?t.split("${"):[t];i.appendChild(this.createTextNode(n[0]));for(var s,r,a=1,o=n.length;o>a;a++)s=n[a],r=s.indexOf("}"),r>0?(this.writeNode("ogc:PropertyName",{property:s.substring(0,r)},i),i.appendChild(this.createTextNode(s.substring(++r)))):i.appendChild(this.createTextNode("${"+s));return i},StyledLayerDescriptor:function(e){var t=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(t.setAttribute("xmlns:ogc",this.namespaces.ogc),t.setAttribute("xmlns:gml",this.namespaces.gml),e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),OpenLayers.Util.isArray(e.namedLayers))for(var i=0,n=e.namedLayers.length;n>i;++i)this.writeNode("NamedLayer",e.namedLayers[i],t);else for(var s in e.namedLayers)this.writeNode("NamedLayer",e.namedLayers[s],t);return t},Name:function(e){return this.createElementNSPlus("sld:Name",{value:e})},Title:function(e){return this.createElementNSPlus("sld:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("sld:Abstract",{value:e})},NamedLayer:function(e){var t=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",e.name,t),e.namedStyles)for(var i=0,n=e.namedStyles.length;n>i;++i)this.writeNode("NamedStyle",e.namedStyles[i],t);if(e.userStyles)for(var i=0,n=e.userStyles.length;n>i;++i)this.writeNode("UserStyle",e.userStyles[i],t);return t},NamedStyle:function(e){var t=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",e,t),t},UserStyle:function(e){var t=this.createElementNSPlus("sld:UserStyle");if(e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.isDefault&&this.writeNode("IsDefault",e.isDefault,t),this.multipleSymbolizers&&e.rules){for(var i,n,s,r,a,o={0:[]},l=[0],u=0,h=e.rules.length;h>u;++u)if(i=e.rules[u],i.symbolizers){n={};for(var c=0,p=i.symbolizers.length;p>c;++c)s=i.symbolizers[c],r=s.zIndex,r in n||(a=i.clone(),a.symbolizers=[],n[r]=a),n[r].symbolizers.push(s.clone());for(r in n)r in o||(l.push(r),o[r]=[]),o[r].push(n[r])}else o[0].push(i.clone());l.sort();for(var d,u=0,h=l.length;h>u;++u)d=o[l[u]],d.length>0&&(a=e.clone(),a.rules=o[l[u]],this.writeNode("FeatureTypeStyle",a,t))}else this.writeNode("FeatureTypeStyle",e,t);return t},IsDefault:function(e){return this.createElementNSPlus("sld:IsDefault",{value:e?"1":"0"})},FeatureTypeStyle:function(e){for(var t=this.createElementNSPlus("sld:FeatureTypeStyle"),i=0,n=e.rules.length;n>i;++i)this.writeNode("Rule",e.rules[i],t);return t},Rule:function(e){var t=this.createElementNSPlus("sld:Rule");e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.elseFilter?this.writeNode("ElseFilter",null,t):e.filter&&this.writeNode("ogc:Filter",e.filter,t),void 0!=e.minScaleDenominator&&this.writeNode("MinScaleDenominator",e.minScaleDenominator,t),void 0!=e.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",e.maxScaleDenominator,t);var i,n;if(this.multipleSymbolizers&&e.symbolizers)for(var n,s=0,r=e.symbolizers.length;r>s;++s)n=e.symbolizers[s],i=n.CLASS_NAME.split(".").pop(),this.writeNode(i+"Symbolizer",n,t);else for(var a=OpenLayers.Style.SYMBOLIZER_PREFIXES,s=0,o=a.length;o>s;++s)i=a[s],n=e.symbolizer[i],n&&this.writeNode(i+"Symbolizer",n,t);return t},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(e){return this.createElementNSPlus("sld:MinScaleDenominator",{value:e})},MaxScaleDenominator:function(e){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:e})},LineSymbolizer:function(e){var t=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",e,t),t},Stroke:function(e){var t=this.createElementNSPlus("sld:Stroke");return void 0!=e.strokeColor&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeColor"},t),void 0!=e.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeOpacity"},t),void 0!=e.strokeWidth&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeWidth"},t),void 0!=e.strokeDashstyle&&"solid"!==e.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeDashstyle"},t),void 0!=e.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeLinecap"},t),t},CssParameter:function(e){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(e.key)},value:e.symbolizer[e.key]})},TextSymbolizer:function(e){var t=this.createElementNSPlus("sld:TextSymbolizer");return null!=e.label&&this.writeNode("Label",e.label,t),(null!=e.fontFamily||null!=e.fontSize||null!=e.fontWeight||null!=e.fontStyle)&&this.writeNode("Font",e,t),(null!=e.labelAnchorPointX||null!=e.labelAnchorPointY||null!=e.labelAlign||null!=e.labelXOffset||null!=e.labelYOffset||null!=e.labelRotation||null!=e.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",e,t),(null!=e.haloRadius||null!=e.haloColor||null!=e.haloOpacity)&&this.writeNode("Halo",e,t),(null!=e.fontColor||null!=e.fontOpacity)&&this.writeNode("Fill",{fillColor:e.fontColor,fillOpacity:e.fontOpacity},t),t},LabelPlacement:function(e){var t=this.createElementNSPlus("sld:LabelPlacement");return null==e.labelAnchorPointX&&null==e.labelAnchorPointY&&null==e.labelAlign&&null==e.labelXOffset&&null==e.labelYOffset&&null==e.labelRotation||null!=e.labelPerpendicularOffset||this.writeNode("PointPlacement",e,t),null!=e.labelPerpendicularOffset&&this.writeNode("LinePlacement",e,t),t},LinePlacement:function(e){var t=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",e.labelPerpendicularOffset,t),t},PerpendicularOffset:function(e){return this.createElementNSPlus("sld:PerpendicularOffset",{value:e})},PointPlacement:function(e){var t=this.createElementNSPlus("sld:PointPlacement");return(null!=e.labelAnchorPointX||null!=e.labelAnchorPointY||null!=e.labelAlign)&&this.writeNode("AnchorPoint",e,t),(null!=e.labelXOffset||null!=e.labelYOffset)&&this.writeNode("Displacement",e,t),null!=e.labelRotation&&this.writeNode("Rotation",e.labelRotation,t),t},AnchorPoint:function(e){var t=this.createElementNSPlus("sld:AnchorPoint"),i=e.labelAnchorPointX,n=e.labelAnchorPointY;if(null!=i&&this.writeNode("AnchorPointX",i,t),null!=n&&this.writeNode("AnchorPointY",n,t),null==i&&null==n){var s=e.labelAlign.substr(0,1),r=e.labelAlign.substr(1,1);"l"===s?i=0:"c"===s?i=.5:"r"===s&&(i=1),"b"===r?n=0:"m"===r?n=.5:"t"===r&&(n=1),this.writeNode("AnchorPointX",i,t),this.writeNode("AnchorPointY",n,t)}return t},AnchorPointX:function(e){return this.createElementNSPlus("sld:AnchorPointX",{value:e})},AnchorPointY:function(e){return this.createElementNSPlus("sld:AnchorPointY",{value:e})},Displacement:function(e){var t=this.createElementNSPlus("sld:Displacement");return null!=e.labelXOffset&&this.writeNode("DisplacementX",e.labelXOffset,t),null!=e.labelYOffset&&this.writeNode("DisplacementY",e.labelYOffset,t),t},DisplacementX:function(e){return this.createElementNSPlus("sld:DisplacementX",{value:e})},DisplacementY:function(e){return this.createElementNSPlus("sld:DisplacementY",{value:e})},Font:function(e){var t=this.createElementNSPlus("sld:Font");return e.fontFamily&&this.writeNode("CssParameter",{symbolizer:e,key:"fontFamily"},t),e.fontSize&&this.writeNode("CssParameter",{symbolizer:e,key:"fontSize"},t),e.fontWeight&&this.writeNode("CssParameter",{symbolizer:e,key:"fontWeight"},t),e.fontStyle&&this.writeNode("CssParameter",{symbolizer:e,key:"fontStyle"},t),t},Label:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Label",e)},Halo:function(e){var t=this.createElementNSPlus("sld:Halo");return e.haloRadius&&this.writeNode("Radius",e.haloRadius,t),(e.haloColor||e.haloOpacity)&&this.writeNode("Fill",{fillColor:e.haloColor,fillOpacity:e.haloOpacity},t),t},Radius:function(e){return this.createElementNSPlus("sld:Radius",{value:e})},RasterSymbolizer:function(e){var t=this.createElementNSPlus("sld:RasterSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),e.opacity&&this.writeNode("Opacity",e.opacity,t),e.colorMap&&this.writeNode("ColorMap",e.colorMap,t),t},Geometry:function(e){var t=this.createElementNSPlus("sld:Geometry");return e.property&&this.writeNode("ogc:PropertyName",e,t),t},ColorMap:function(e){for(var t=this.createElementNSPlus("sld:ColorMap"),i=0,n=e.length;n>i;++i)this.writeNode("ColorMapEntry",e[i],t);return t},ColorMapEntry:function(e){var t=this.createElementNSPlus("sld:ColorMapEntry"),i=e;return t.setAttribute("color",i.color),void 0!==i.opacity&&t.setAttribute("opacity",parseFloat(i.opacity)),void 0!==i.quantity&&t.setAttribute("quantity",parseFloat(i.quantity)),void 0!==i.label&&t.setAttribute("label",i.label),t},PolygonSymbolizer:function(e){var t=this.createElementNSPlus("sld:PolygonSymbolizer");return e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},Fill:function(e){var t=this.createElementNSPlus("sld:Fill");return e.externalGraphic?this.writeNode("GraphicFill",e,t):(e.fillColor&&this.writeNode("CssParameter",{symbolizer:e,key:"fillColor"},t),null!=e.fillOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"fillOpacity"},t)),t},PointSymbolizer:function(e){var t=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",e,t),t},GraphicFill:function(e){var t=this.createElementNSPlus("sld:GraphicFill");return this.writeNode("Graphic",e,t),t},Graphic:function(e){var t=this.createElementNSPlus("sld:Graphic");return void 0!=e.externalGraphic?this.writeNode("ExternalGraphic",e,t):this.writeNode("Mark",e,t),void 0!=e.graphicOpacity&&this.writeNode("Opacity",e.graphicOpacity,t),void 0!=e.pointRadius?this.writeNode("Size",2*e.pointRadius,t):void 0!=e.graphicWidth&&this.writeNode("Size",e.graphicWidth,t),void 0!=e.rotation&&this.writeNode("Rotation",e.rotation,t),t},ExternalGraphic:function(e){var t=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",e.externalGraphic,t);var i=e.graphicFormat||this.getGraphicFormat(e.externalGraphic);return this.writeNode("Format",i,t),t},Mark:function(e){var t=this.createElementNSPlus("sld:Mark");return e.graphicName&&this.writeNode("WellKnownName",e.graphicName,t),e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},WellKnownName:function(e){return this.createElementNSPlus("sld:WellKnownName",{value:e})},Opacity:function(e){return this.createElementNSPlus("sld:Opacity",{value:e})},Size:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Size",e)},Rotation:function(e){return this.createElementNSPlus("sld:Rotation",{value:e})},OnlineResource:function(e){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":e}})},Format:function(e){return this.createElementNSPlus("sld:Format",{value:e})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(e,t){var i,n=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);
if(t&&t.map)if(this.context=n,t.map instanceof OpenLayers.Map)i=this.mergeContextToMap(n,t.map);else{var s=t.map;(OpenLayers.Util.isElement(s)||"string"==typeof s)&&(s={div:s}),i=this.contextToMap(n,s)}else i=n;return i},getLayerFromContext:function(e){var t,i,n={queryable:e.queryable,visibility:e.visibility,maxExtent:e.maxExtent,metadata:OpenLayers.Util.applyDefaults(e.metadata,{styles:e.styles,formats:e.formats,"abstract":e["abstract"],dataURL:e.dataURL}),numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.tileSize?new OpenLayers.Size(e.tileSize.width,e.tileSize.height):void 0,minScale:e.minScale||e.maxScaleDenominator,maxScale:e.maxScale||e.minScaleDenominator,srs:e.srs,dimensions:e.dimensions,metadataURL:e.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(n,this.layerOptions);var s={layers:e.name,transparent:e.transparent,version:e.version};if(e.formats&&e.formats.length>0)for(s.format=e.formats[0].value,t=0,i=e.formats.length;i>t;t++){var r=e.formats[t];if(1==r.current){s.format=r.value;break}}if(e.styles&&e.styles.length>0)for(t=0,i=e.styles.length;i>t;t++){var a=e.styles[t];if(1==a.current){a.href?s.sld=a.href:a.body?s.sld_body=a.body:s.styles=a.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(s,this.layerParams);var o=null,l=e.service;return l==OpenLayers.Format.Context.serviceTypes.WFS?(n.strategies=[new OpenLayers.Strategy.BBOX],n.protocol=new OpenLayers.Protocol.WFS({url:e.url,featurePrefix:e.name.split(":")[0],featureType:e.name.split(":").pop()}),o=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.KML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.KML}),o=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.GML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.GML}),o=new OpenLayers.Layer.Vector(e.title||e.name,n)):e.features?(o=new OpenLayers.Layer.Vector(e.title||e.name,n),o.addFeatures(e.features)):e.categoryLayer!==!0&&(o=new OpenLayers.Layer.WMS(e.title||e.name,e.url,s,n)),o},getLayersFromContext:function(e){for(var t=[],i=0,n=e.length;n>i;i++){var s=this.getLayerFromContext(e[i]);null!==s&&t.push(s)}return t},contextToMap:function(e,t){t=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},t),t.maxExtent&&(t.maxResolution=t.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var i={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};t.metadata=i;var n=new OpenLayers.Map(t);return n.addLayers(this.getLayersFromContext(e.layersContext)),n.setCenter(e.bounds.getCenterLonLat(),n.getZoomForExtent(e.bounds,!0)),n},mergeContextToMap:function(e,t){return t.addLayers(this.getLayersFromContext(e.layersContext)),t},write:function(e){return e=this.toContext(e),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(){var e=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===e&&(e=this.defaultVersion),e},toContext:function(e){var t={};return"OpenLayers.Map"==e.CLASS_NAME&&(t.bounds=e.getExtent(),t.maxExtent=e.maxExtent,t.projection=e.projection,t.size=e.getSize(),t.layers=e.layers),t},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e){var t=this.version;if(!t){var i=e.getAttribute("xmlns:ows");i&&"1.1"===i.substring(i.lastIndexOf("/")+1)&&(t="1.1.0"),t||(t=this.defaultVersion)}return t},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.left=n[0],t.bottom=n[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var n=i.split(this.regExes.splitSpace);t.right=n[0],t.top=n[1],t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(e){if(e.layersContext)for(var t=0,i=e.layersContext.length;i>t;t++){var n=e.layersContext[t],s=[],r=e.title||"";e.metadata&&e.metadata.nestingPath&&(s=e.metadata.nestingPath.slice()),""!=r&&s.push(r),n.metadata.nestingPath=s,n.layersContext&&this.setNestingPath(n)}},decomposeNestingPath:function(e){var t=[];if(OpenLayers.Util.isArray(e)){for(var i=e.slice();i.length>0;)t.push(i.slice()),i.pop();t.reverse()}return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t),this.setNestingPath({layersContext:t.layersContext});var i=[];return this.processLayer(i,t),delete t.layersContext,t.layersContext=i,t},processLayer:function(e,t){if(t.layersContext)for(var i=0,n=t.layersContext.length;n>i;i++){var s=t.layersContext[i];e.push(s),s.layersContext&&this.processLayer(e,s)}},write:function(e,t){var i="OWSContext";this.nestingLayerLookup={},t=t||{},OpenLayers.Util.applyDefaults(t,e);var n=this.writeNode(i,t);return this.nestingLayerLookup=null,this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[n])},readers:{kml:{Document:function(e,t){t.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(e)}},owc:{OWSContext:function(e,t){this.readChildNodes(e,t)},General:function(e,t){this.readChildNodes(e,t)},ResourceList:function(e,t){this.readChildNodes(e,t)},Layer:function(e,t){var i={metadata:{},visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),opacity:null!=e.getAttribute("opacity")?parseFloat(e.getAttribute("opacity")):null,name:e.getAttribute("name"),categoryLayer:null==e.getAttribute("name"),formats:[],styles:[]};t.layersContext||(t.layersContext=[]),t.layersContext.push(i),this.readChildNodes(e,i)},InlineGeometry:function(e,t){t.features=[];var i,n=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(n.length>=1&&(i=n[0]),i&&i.firstChild){var s=i.firstChild.nextSibling?i.firstChild.nextSibling:i.firstChild;this.setNamespace("feature",s.namespaceURI),this.featureType=s.localName||s.nodeName.split(":").pop(),this.readChildNodes(e,t)}},Server:function(e,t){(!t.service&&!t.version||t.service!=OpenLayers.Format.Context.serviceTypes.WMS)&&(t.service=e.getAttribute("service"),t.version=e.getAttribute("version"),this.readChildNodes(e,t))},Name:function(e,t){t.name=this.getChildValue(e),this.readChildNodes(e,t)},Title:function(e,t){t.title=this.getChildValue(e),this.readChildNodes(e,t)},StyleList:function(e,t){this.readChildNodes(e,t.styles)},Style:function(e,t){var i={};t.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={};t.legend=i,this.readChildNodes(e,i)},OnlineResource:function(e,t){t.url=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(e){var t=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:e.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",e,t),this.writeNode("ResourceList",e,t),t},General:function(e){var t=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",e,t),this.writeNode("ows:Title",e.title||"OpenLayers OWSContext",t),t},ResourceList:function(e){for(var t=this.createElementNSPlus("ResourceList"),i=0,n=e.layers.length;n>i;i++){var s=e.layers[i],r=this.decomposeNestingPath(s.metadata.nestingPath);this.writeNode("_Layer",{layer:s,subPaths:r},t)}return t},Server:function(e){var t=this.createElementNSPlus("Server",{attributes:{version:e.version,service:e.service}});return this.writeNode("OnlineResource",e,t),t},OnlineResource:function(e){var t=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":e.url}});return t},InlineGeometry:function(e){var t=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",e.getDataExtent(),t);for(var i=0,n=e.features.length;n>i;i++)this.writeNode("gml:featureMember",e.features[i],t);return t},StyleList:function(e){for(var t=this.createElementNSPlus("StyleList"),i=0,n=e.length;n>i;i++)this.writeNode("Style",e[i],t);return t},Style:function(e){var t=this.createElementNSPlus("Style");return this.writeNode("Name",e,t),this.writeNode("Title",e,t),e.legend&&this.writeNode("LegendURL",e,t),t},Name:function(e){var t=this.createElementNSPlus("Name",{value:e.name});return t},Title:function(e){var t=this.createElementNSPlus("Title",{value:e.title});return t},LegendURL:function(e){var t=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",e.legend,t),t},_WMS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.params.LAYERS,queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1",opacity:e.hasOwnProperty("opacity")?e.opacity:null}});return this.writeNode("ows:Title",e.name,t),this.writeNode("ows:OutputFormat",e.params.FORMAT,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:e.params.VERSION,url:e.url},t),e.metadata.styles&&e.metadata.styles.length>0&&this.writeNode("StyleList",e.metadata.styles,t),t},_Layer:function(e){var t,i,n,s;if(t=e.layer,i=e.subPaths,n=null,s=null,i.length>0){var r=i[0].join("/"),a=r.lastIndexOf("/");return n=this.nestingLayerLookup[r],s=a>0?r.substring(a+1,r.length):r,n||(n=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",s,n),this.nestingLayerLookup[r]=n),e.subPaths.shift(),this.writeNode("_Layer",e,n),n}return t instanceof OpenLayers.Layer.WMS?n=this.writeNode("_WMS",t):t instanceof OpenLayers.Layer.Vector&&(t.protocol instanceof OpenLayers.Protocol.WFS.v1?n=this.writeNode("_WFS",t):t.protocol instanceof OpenLayers.Protocol.HTTP?t.protocol.format instanceof OpenLayers.Format.GML?(t.protocol.format.version="2.1.2",n=this.writeNode("_GML",t)):t.protocol.format instanceof OpenLayers.Format.KML&&(t.protocol.format.version="2.2",n=this.writeNode("_KML",t)):(this.setNamespace("feature",this.featureNS),n=this.writeNode("_InlineGeometry",t))),t.options.maxScale&&this.writeNode("sld:MinScaleDenominator",t.options.maxScale,n),t.options.minScale&&this.writeNode("sld:MaxScaleDenominator",t.options.minScale,n),this.nestingLayerLookup[t.name]=n,n},_WFS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.protocol.featurePrefix+":"+e.protocol.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:e.protocol.version,url:e.protocol.url},t),t},_InlineGeometry:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("InlineGeometry",e,t),t},_GML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:e.protocol.url,version:e.protocol.format.version},t),t},_KML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:e.protocol.format.version,url:e.protocol.url},t),t}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(e){var t=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",e,t),t}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Format.CSWGetRecords=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetRecords.DEFAULTS);var t=OpenLayers.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetRecords version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--i>0&&e);return t},ignore:function(e){var t=3,i=!1;do{if("a"===e.nodeName.toLowerCase()){i=!0;break}e=e.parentNode}while(--t>0&&e);return i},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var n=this.getPressedButton(i);if(n){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:n}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var s=OpenLayers.Util.pagePosition(n);this.target.triggerEvent("buttonclick",{buttonElement:n,buttonXY:{x:this.startEvt.clientX-s[0],y:this.startEvt.clientY-s[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt}return t}}),OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===a[t]){var i=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),s=n(i);a[t]=e(s)}return a[t]}function i(e,t){if(void 0===o[t]){var i,n,r=0,a=s.length,l="undefined"!=typeof e.cssText;for(o[t]=null;a>r;r++)if(n=s[r],n?(l||(n=n.toLowerCase()),i=n+t.charAt(0).toUpperCase()+t.slice(1)):i=t,void 0!==e[i]){o[t]=i;break}}return o[t]}function n(e){return i(r,e)}var s=["","O","ms","Moz","Webkit"],r=document.createElement("div").style,a={},o={};return{css:t,js:i,style:n,cssCache:a,jsCache:o}}(),OpenLayers.Animation=function(e){function t(e,t,i){t=t>0?t:Number.POSITIVE_INFINITY;var n=++a,s=+new Date;return o[n]=function(){o[n]&&+new Date-s<=t?(e(),o[n]&&r(o[n],i)):delete o[n]},r(o[n],i),n}function i(e){delete o[e]}var n=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),s=!!n,r=function(){var t=e[n]||function(t){e.setTimeout(t,16)};return function(i,n){t.apply(e,[i,n])}}(),a=0,o={};return{isNative:s,requestFrame:r,start:t,stop:i}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.time=0,OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],n=this.finish[t];if(null==i||null==n||isNaN(i)||isNaN(n))throw new TypeError("invalid value for Tween");var s=n-i;e[t]=this.easing.apply(this,[this.time,i,s,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,autoUpdateSize:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t);var i=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[i]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var n=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(n,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),n=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(n),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var s=!0,r=document.getElementsByTagName("link"),a=0,o=r.length;o>a;++a)if(OpenLayers.Util.isEquivalentUrl(r.item(a).href,this.theme)){s=!1;break}if(s){var l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var a=0,o=this.controls.length;o>a;a++)this.addControlToMap(this.controls[a]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test,s=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])});return s},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)
},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;n>i;i++){var s=this.layers[i];if(s.id==e){t=s;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;i>t;t++)if(this.layers[t]==e)return!1;return this.events.triggerEvent("preaddlayer",{layer:e})===!1?!1:(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;i>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;n>i;i++){var s=this.layers[i];if(s.isBaseLayer||this.allOverlays){this.setBaseLayer(s);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var n=0,s=this.layers.length;s>n;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=t){var n=this.getZoomForResolution(i||this.resolution,!0);this.setCenter(t,n,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,s=e.length;s>n;n++){var r=e[n],a=i[n]?i[n]:null;this.addControl(r,a)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;n>i;i++){var s=this.controls[i];if(s.id==e){t=s;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var n=e.draw();n&&(n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(n))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,n=this.layers.length;n>i;i++)this.layers[i].onMapResize();var s=this.getCachedCenter();if(null!=this.baseLayer&&null!=s){var r=this.getZoom();this.zoom=null,this.setCenter(s,r)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var n=this.size.w*t/2,s=this.size.h*t/2;i=new OpenLayers.Bounds(e.lon-n,e.lat-s,e.lon+n,e.lat+s)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),s=n.add(e,t);if(this.dragging||!s.equals(n)){var r=this.getLonLatFromViewPortPx(s);i.animate?this.panTo(r):(this.moveTo(r),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var t=this.getCachedCenter();if(e.equals(t))return;var i=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),s={x:n.x-i.x,y:n.y-i.y},r={x:0,y:0};this.panTween.start({x:0,y:0},s,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-r.x,i=e.y-r.y;this.moveByPx(t,i),r.x=Math.round(e.x),r.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,s=i+e,r=n+t,a=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent&&(o=i,l=n,a=!1),e=a||s<=this.maxPx.x-o&&s>=this.minPx.x+o?Math.round(e):0,t=r<=this.maxPx.y-l&&r>=this.minPx.y+l?Math.round(t):0,e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerDiv.style.left=(this.layerContainerOriginPx.x-=e)+"px",this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerDiv.style.top=(this.layerContainerOriginPx.y-=t)+"px",this.minPx.y-=t,this.maxPx.y-=t);var u,h,c;for(h=0,c=this.layers.length;c>h;++h)u=this.layers[h],u.visibility&&(u===this.baseLayer||u.inRange)&&(u.moveByPx(e,t),u.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)if(this.fractionalZoom)e=this.getZoomForResolution(i);else for(var n=0|e,s=t.length;s>n;++n)if(t[n]<=i){e=n;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var n=t;t=this.adjustZoom(t),t!==n&&(e=this.getCenter());var s=i.dragging||this.dragging,r=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var a=this.getResolutionForZoom(t),o=this.calculateBounds(e,a);if(!this.restrictedExtent.containsBounds(o)){var l=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):o.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-o.right,0)),o.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):o.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-o.top))}}var u=r||this.isValidZoomLevel(t)&&t!=this.getZoom(),h=this.isValidLonLat(e)&&!e.equals(this.center);if(u||h||s){s||this.events.triggerEvent("movestart"),h&&(!u&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var c=u?this.getResolutionForZoom(t):this.getResolution();if(u||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();var p=this.layerContainerDiv.style;p.left="0px",p.top="0px",this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0;var d=this.getMaxExtent({restricted:!0}),m=d.getCenterLonLat(),f=this.center.lon-m.lon,y=m.lat-this.center.lat,g=Math.round(d.getWidth()/c),v=Math.round(d.getHeight()/c);this.minPx={x:(this.size.w-g)/2-f/c,y:(this.size.h-v)/2-y/c},this.maxPx={x:this.minPx.x+Math.round(d.getWidth()/c),y:this.minPx.y+Math.round(d.getHeight()/c)}}u&&(this.zoom=t,this.resolution=c);var b=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(b,u,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:u})),b=this.baseLayer.getExtent();for(var L=this.layers.length-1;L>=0;--L){var O=this.layers[L];if(O!==this.baseLayer&&!O.isBaseLayer){var w=O.calculateInRange();O.inRange!=w&&(O.inRange=w,w||O.display(!1)),w&&O.visibility&&(O.moveTo(b,u,i.dragging),i.dragging||O.events.triggerEvent("moveend",{zoomChanged:u}))}}if(this.events.triggerEvent("move"),s||this.events.triggerEvent("moveend"),u){for(var L=0,_=this.popups.length;_>L;L++)this.popups[L].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=this.layerContainerOriginPx.x,s=this.layerContainerOriginPx.y,r=Math.round(t.x-i.x),a=Math.round(t.y-i.y);this.layerContainerDiv.style.left=(this.layerContainerOriginPx.x=r)+"px",this.layerContainerDiv.style.top=(this.layerContainerOriginPx.y=a)+"px";var o=n-r,l=s-a;this.minPx.x-=o,this.maxPx.x-=o,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var i=this.getMaxExtent(),n=this.baseLayer.wrapDateLine&&i;t=i.containsLonLat(e,{worldBounds:n})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e){this.isValidZoomLevel(e)&&this.setCenter(null,e)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=n.getWidth();i=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:!0,i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*i/2,s=this.size.h*i/2,r=this.getCachedCenter(),a=new OpenLayers.Bounds(r.lon-n,r.lat-s,r.lon+n,r.lat+s);this.zoomToExtent(a,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),n=t.add(-i/2,0),s=t.add(i/2,0),r=t.add(0,-i/2),a=t.add(0,i/2),o=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||o;return l.equals(o)||(n.transform(l,o),s.transform(l,o),r.transform(l,o),a.transform(l,o)),new OpenLayers.Size(OpenLayers.Util.distVincenty(n,s),OpenLayers.Util.distVincenty(r,a))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=this.layerContainerOriginPx.x,n=this.layerContainerOriginPx.y;t=e.add(i,n)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-this.layerContainerOriginPx.x,n=-this.layerContainerOriginPx.y;t=e.add(i,n),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t;var n=this.map||e.map;n&&this.setMap(n),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.active=!1,!0},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.touch||(this.unregisterMouseListeners(),this.touch=!0),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this["double"]&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy),t&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,n=this.down.touches.length;n>i;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(){var e=!0;return this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=new Array(i);for(var n,s=0;i>s;s++)n=e.touches[s],t[s]={clientX:n.clientX,clientY:n.clientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,this.touch=!1,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var e=this;this._docMove=function(t){e.mousemove({xy:{x:t.clientX,y:t.clientY},element:document})},this._docUp=function(t){e.mouseup({xy:{x:t.clientX,y:t.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.start=e.xy,this.last=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(this.started=!1,this.start=null,this.last=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.touch=!1,this.started=!1,this.dragging=!1,this.start=null,this.last=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,i=this.handlers.drag.last.y-e.y;if(0!=t||0!=i){var n=this.rectPxBounds.top,s=this.rectPxBounds.left,r=Math.abs(this.rectPxBounds.getHeight()),a=this.rectPxBounds.getWidth(),o=Math.max(0,n-i);o=Math.min(o,this.ovmap.size.h-this.hComp-r);var l=Math.max(0,s-t);l=Math.min(l,this.ovmap.size.w-this.wComp-a),this.setRectPxBounds(new OpenLayers.Bounds(l,o+r,l+a,o))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),i=e.xy.x-t.x,n=e.xy.y-t.y,s=this.rectPxBounds.top,r=this.rectPxBounds.left,a=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),l=Math.max(0,s+n);l=Math.min(l,this.ovmap.size.h-a);var u=Math.max(0,r+i);u=Math.min(u,this.ovmap.size.w-o),this.setRectPxBounds(new OpenLayers.Bounds(u,l+a,u+o,l)),this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="",this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.maxExtent,i=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(i=i.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var n=this.ovmap.getResolution()/this.map.getResolution();return n>this.minRatio&&n<=this.maxRatio&&this.ovmap.getExtent().containsBounds(i)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),i=t/e;i>this.maxRatio?t=this.minRatio*e:i<=this.minRatio&&(t=this.maxRatio*e);var n;this.ovmap.getProjection()!=this.map.getProjection()?(n=this.map.center.clone(),n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):n=this.map.center,this.ovmap.setCenter(n,this.ovmap.getZoomForResolution(t*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,e),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,i=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&i?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[i]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(e.getCenterLonLat())
},setRectPxBounds:function(e){var t=Math.max(e.top,0),i=Math.max(e.left,0),n=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),s=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),r=Math.max(s-i,0),a=Math.max(n-t,0);if(r<this.minRectSize||a<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var o=i+r/2-this.minRectSize/2,l=t+a/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px",this.extentRectangle.style.left=Math.round(o)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(t)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(a)+"px",this.extentRectangle.style.width=Math.round(r)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(n),Math.round(s),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),i=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),n=null;return t&&i&&(n=new OpenLayers.Bounds(t.x,t.y,i.x,i.y)),n},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),i=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,i=this.ovmap.getResolution(),n=this.ovmap.getExtent().getCenterLonLat(),s=e.x-t.w/2,r=e.y-t.h/2;return{lon:n.lon+s*i,lat:n.lat-r*i}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),i=this.ovmap.getExtent();return i?{x:Math.round(1/t*(e.lon-i.left)),y:Math.round(1/t*(i.top-e.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),n=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var s in e)if(e.hasOwnProperty(s)&&OpenLayers.Util.indexOf(n,s)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(){var e=this.visibility;this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none",this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}))},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},s=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],s&&this.options[i]&&(s=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=s),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var r;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(r=this.options.maxResolution),this.options.minScale&&(r=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var a;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(a=this.options.minResolution),this.options.maxScale&&(a=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),r||(r=n.resolutions[0]),!a)){var o=n.resolutions.length-1;a=n.resolutions[o]}if(this.resolutions=n.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=new Array(t),e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=a,a&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(a,this.units)),this.maxResolution=r,r&&(this.minScale=OpenLayers.Util.getScaleFromResolution(r,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=new Array(n),i=0;n>i;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n,s=e.maxResolution;null!=e.minScale?s=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==s&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,n=this.maxExtent.getHeight()/t.h,s=Math.max(i,n));var r=e.minResolution;if(null!=e.maxScale?r=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,n=this.minExtent.getHeight()/t.h,r=Math.max(i,n)),"number"!=typeof s&&"number"!=typeof r&&null!=this.maxExtent){var a=this.map.getTileSize();s=Math.max(this.maxExtent.getWidth()/a.w,this.maxExtent.getHeight()/a.h)}var o=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof r&&"number"==typeof s&&void 0===l){var u=s/r;l=Math.floor(Math.log(u)/Math.log(2))+1}else void 0===l&&null!=o&&(l=o+1);if(!("number"!=typeof l||0>=l||"number"!=typeof s&&"number"!=typeof r)){var h=new Array(l),c=2;"number"==typeof r&&"number"==typeof s&&(c=Math.pow(s/r,1/(l-1)));var p;if("number"==typeof s)for(p=0;l>p;p++)h[p]=s/Math.pow(c,p);else for(p=0;l>p;p++)h[l-1-p]=r*Math.pow(c,p);return h}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),n=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),n=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[n])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,n,s;if(this.map.fractionalZoom){var r,a=0,o=this.resolutions.length-1,l=this.resolutions[a],u=this.resolutions[o];for(n=0,s=this.resolutions.length;s>n;++n)if(r=this.resolutions[n],r>=e&&(l=r,a=n),e>=r){u=r,o=n;break}var h=l-u;i=h>0?a+(l-e)/h:a}else{var c,p=Number.POSITIVE_INFINITY;for(n=0,s=this.resolutions.length;s>n;n++)if(t){if(c=Math.abs(this.resolutions[n]-e),c>p)break;p=c}else if(this.resolutions[n]<e)break;i=Math.max(0,n-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var n=i.getResolution(),s=i.getMaxExtent({restricted:!0}),r=(e.x-i.minPx.x)*n+s.left,a=(i.minPx.y-e.y)*n+s.top;t=new OpenLayers.LonLat(r,a),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;if(null!=e){t=t||this.map.getResolution();var n=this.map.calculateBounds(null,t);i=new OpenLayers.Pixel(1/t*(e.lon-n.left),1/t*(n.top-e.lat))}return i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,n=t.length;n>i;++i){var s=t[i].firstChild||t[i],r=t[i].lastChild;r&&"iframe"===r.nodeName.toLowerCase()&&(s=r.parentNode),OpenLayers.Util.modifyDOMElement(s,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var e=null;return e=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var e=156543.03390625,t=0;t<=this.MAX_ZOOM_LEVEL;++t)this.RESOLUTIONS[t]=e/Math.pow(2,t);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var e=new OpenLayers.Projection("EPSG:4326"),t=new OpenLayers.Projection("EPSG:900913");return function(i,n){var s=OpenLayers.Projection.transform({x:i,y:n},e,t);return new OpenLayers.LonLat(s.x,s.y)}}(),inverseMercator:function(){var e=new OpenLayers.Projection("EPSG:4326"),t=new OpenLayers.Projection("EPSG:900913");return function(i,n){var s=OpenLayers.Projection.transform({x:i,y:n},t,e);return new OpenLayers.LonLat(s.x,s.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize(),t=Math.min(e.w,300),i=Math.min(e.h,200),n=new OpenLayers.Size(t,i),s=new OpenLayers.Pixel(e.w/2,e.h/2),r=s.add(-n.w/2,-n.h/2),a=OpenLayers.Util.createDiv(this.name+"_warning",r,n,null,null,null,"auto");a.style.padding="7px",a.style.backgroundColor="yellow",a.innerHTML=this.getWarningHTML(),this.div.appendChild(a)},getWarningHTML:function(){return""},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(e,t){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(e,-t):this.moveTo(this.map.getCachedCenter())},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var n=this.map.getCenter(),s=this.map.getZoom();if(null!=n){var r=this.getMapObjectCenter(),a=this.getOLLonLatFromMapObjectLonLat(r),o=this.getMapObjectZoom(),l=this.getOLZoomFromMapObjectZoom(o);if(!n.equals(a)||s!=l)if(!t&&a&&this.dragPanMapObject&&this.smoothDragPan){var u=this.map.getViewPortPxFromLonLat(a),h=this.map.getViewPortPxFromLonLat(n);this.dragPanMapObject(h.x-u.x,u.y-h.y)}else{var c=this.getMapObjectLonLatFromOLLonLat(n),p=this.getMapObjectZoomFromOLZoom(s);this.setMapObjectCenter(c,p,i)}}}},getLonLatFromViewPortPx:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectPixelFromOLPixel(e),n=this.getMapObjectLonLatFromMapObjectPixel(i);t=this.getOLLonLatFromMapObjectLonLat(n)}return t},getViewPortPxFromLonLat:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectLonLatFromOLLonLat(e),n=this.getMapObjectPixelFromMapObjectLonLat(i);t=this.getOLPixelFromMapObjectPixel(n)}return t},getOLLonLatFromMapObjectLonLat:function(e){var t=null;if(null!=e){var i=this.getLongitudeFromMapObjectLonLat(e),n=this.getLatitudeFromMapObjectLonLat(e);t=new OpenLayers.LonLat(i,n)}return t},getMapObjectLonLatFromOLLonLat:function(e){var t=null;return null!=e&&(t=this.getMapObjectLonLatFromLonLat(e.lon,e.lat)),t},getOLPixelFromMapObjectPixel:function(e){var t=null;if(null!=e){var i=this.getXFromMapObjectPixel(e),n=this.getYFromMapObjectPixel(e);t=new OpenLayers.Pixel(i,n)}return t},getMapObjectPixelFromOLPixel:function(e){var t=null;return null!=e&&(t=this.getMapObjectPixelFromXY(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var e=["minZoomLevel","maxZoomLevel","numZoomLevels"],t=0,i=e.length;i>t;t++){var n=e[t];this[n]=null!=this.options[n]?this.options[n]:this.map[n]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var s,r=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(s=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=null!=s?Math.min(s,r):r,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var a=0;this.resolutions=[];for(var t=this.minZoomLevel;t<=this.maxZoomLevel;t++)this.resolutions[a++]=this.RESOLUTIONS[t];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var e=null,t=this.map.getSize(),i=this.getExtent();return null!=t&&null!=i&&(e=Math.max(i.getWidth()/t.w,i.getHeight()/t.h)),e},getExtent:function(){var e=this.map.getSize(),t=this.getLonLatFromViewPortPx({x:0,y:0}),i=this.getLonLatFromViewPortPx({x:e.w,y:e.h});return null!=t&&null!=i?new OpenLayers.Bounds(t.lon,i.lat,i.lon,t.lat):null},getZoomForResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var e=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(e)},getOLZoomFromMapObjectZoom:function(e){var t=null;return null!=e&&(t=e-this.minZoomLevel,this.map.baseLayer!==this&&(t=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(t)))),t},getMapObjectZoomFromOLZoom:function(e){var t=null;return null!=e&&(t=e+this.minZoomLevel,this.map.baseLayer!==this&&(t=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(t)))),t},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(e,t){t=t||{},t.version||(t.version="function"==typeof GMap2?"2":"3");var i=OpenLayers.Layer.Google["v"+t.version.replace(/\./g,"_")];if(!i)throw"Unsupported Google Maps API version: "+t.version;OpenLayers.Util.applyDefaults(t,i),OpenLayers.Util.applyDefaults(t,i.DEFAULTS),t.maxExtent&&(t.maxExtent=t.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,t]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,t]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(){var e=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(e)},display:function(e){this._dragging||this.setGMapVisibility(e),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,t,i){this._dragging=i,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(e){if(e!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=e),this.getVisibility()){var t=this.getMapContainer();OpenLayers.Util.modifyDOMElement(t,null,null,null,null,null,null,e)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var e=OpenLayers.Layer.Google.cache[this.map.id];e&&e.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var e=OpenLayers.Layer.Google.cache[this.map.id];if(e){var t=this.mapObject&&this.getMapContainer();t&&t.parentNode&&t.parentNode.removeChild(t);var i=e.termsOfUse;i&&i.parentNode&&i.parentNode.removeChild(i);var n=e.poweredBy;n&&n.parentNode&&n.parentNode.removeChild(n)}},removeMap:function(e){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var t=OpenLayers.Layer.Google.cache[e.id];t&&(t.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[e.id]):--t.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(e){var t=null;if(null!=e){var i=e.getSouthWest(),n=e.getNorthEast();this.sphericalMercator?(i=this.forwardMercator(i.lng(),i.lat()),n=this.forwardMercator(n.lng(),n.lat())):(i=new OpenLayers.LonLat(i.lng(),i.lat()),n=new OpenLayers.LonLat(n.lng(),n.lat())),t=new OpenLayers.Bounds(i.lon,i.lat,n.lon,n.lat)}return t},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lon:e.lng()},getLatitudeFromMapObjectLonLat:function(e){var t=this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lat:e.lat();return t},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var e,t,i,n=OpenLayers.Layer.Google.cache[this.map.id];if(n)e=n.mapObject,t=n.termsOfUse,i=n.poweredBy,++n.count;else{var s=this.map.viewPortDiv,r=document.createElement("div");r.id=this.map.id+"_GMap2Container",r.style.position="absolute",r.style.width="100%",r.style.height="100%",s.appendChild(r);try{e=new GMap2(r),t=r.lastChild,s.appendChild(t),t.style.zIndex="1100",t.style.right="",t.style.bottom="",t.className="olLayerGoogleCopyright",i=r.lastChild,s.appendChild(i),i.style.zIndex="1100",i.style.right="",i.style.bottom="",i.className="olLayerGooglePoweredBy gmnoprint"}catch(a){throw a}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:e,termsOfUse:t,poweredBy:i,count:1}}this.mapObject=e,this.termsOfUse=t,this.poweredBy=i,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof e.getDragObject?this.dragObject=e.getDragObject():this.dragPanMapObject=null,this.isBaseLayer===!1&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var e=this,t=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(t),delete e._resized,e.mapObject.checkResize(),e.moveTo(e.map.getCenter(),e.map.getZoom())});this._resized=!0}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){var i=this.mapObject.getContainer();e===!0?(this.mapObject.setMapType(this.type),i.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",t.displayed=this.id):(t.displayed===this.id&&delete t.displayed,t.displayed||(i.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),n=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new GLatLngBounds(new GLatLng(i.lat,i.lon),new GLatLng(n.lat,n.lon))}return t},setMapObjectCenter:function(e,t){this.mapObject.setCenter(e,t)},dragPanMapObject:function(e,t){this.dragObject.moveBy(new GSize(-e,t))},getMapObjectLonLatFromMapObjectPixel:function(e){return this.mapObject.fromContainerPixelToLatLng(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.fromLatLngToContainerPixel(e)},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var n=this.inverseMercator(e,t);i=new GLatLng(n.lat,n.lon)}else i=new GLatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new GPoint(e,t)}},OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),n=this.schemaLocationAttr();return n&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",n),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,n=this.featureType.length;n>i;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){e=e||{};var t,i,n=e.options||{},s=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:n.handle}}),r=e.features;if(r){n.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var a,o;for(t=0,i=r.length;i>t;++t)o=r[t],a=this.stateName[o.state],a&&this.writeNode(a,{feature:o,options:n},s);n.multi===!0&&this.setGeometryTypes()}if(n.nativeElements)for(t=0,i=n.nativeElements.length;i>t;++t)this.writeNode("wfs:Native",n.nativeElements[t],s);return s},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,n),n},Update:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var s=t.modified;null===this.geometryName||s&&void 0===s.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},n));for(var r in t.attributes)void 0===t.attributes[r]||s&&s.attributes&&(!s.attributes||void 0===s.attributes[r])||this.writeNode("Property",{name:r,value:t.attributes[r]},n);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,n=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n),n}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,n=[];for(var s in t)i=this.namespaces[s],i&&n.push(i+" "+t[s]);var r=n.join(" ")||void 0;return r},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;i>t;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,i){var n=parseInt(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;n&&(t.srsDimension=n)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,n=this.getChildValue(e).replace(this.regExes.trimSpace,""),s=n.split(this.regExes.splitSpace);
i=this.xy?new OpenLayers.Geometry.Point(s[0],s[1],s[2]):new OpenLayers.Geometry.Point(s[1],s[0],s[2]),t.points=[i]},posList:function(e,t){for(var i,n,s,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),a=r.split(this.regExes.splitSpace),o=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=a.length/o,u=new Array(l),h=0,c=a.length;c>h;h+=o)i=a[h],n=a[h+1],s=2==o?void 0:a[h+2],u[h/o]=this.xy?new OpenLayers.Geometry.Point(i,n,s):new OpenLayers.Geometry.Point(n,i,s);t.points=u},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],s=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,s.x,s.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,n=e.length;n>i;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,n=new Array(i),s=0;i>s;++s)t=e[s],n[s]=this.xy?t.x+" "+t.y:t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:n.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;n>i;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,n=e.components.length;n>i;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],n=0,s=i.length;s>n;++n)this.writeNode("curveMember",i[n],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],n=0,s=i.length;s>n;++n)this.writeNode("surfaceMember",i[n],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,n),t.filters.push(n)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),s=e.getAttribute("singleChar"),r=e.getAttribute("escapeChar");i.value2regex(n,s,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,n=e.length;n>i;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,s=e.propertyNames.length;s>n;n++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wfs:{WFS_Capabilities:function(e,t){this.readChildNodes(e,t)},FeatureTypeList:function(e,t){t.featureTypeList={featureTypes:[]},this.readChildNodes(e,t.featureTypeList)},FeatureType:function(e,t){var i={};this.readChildNodes(e,i),t.featureTypes.push(i)},Name:function(e,t){var i=this.getChildValue(e);if(i){var n=i.split(":");t.name=n.pop(),n.length>0&&(t.featureNS=this.lookupNamespaceURI(e,n[0]))}},Title:function(e,t){var i=this.getChildValue(e);i&&(t.title=i)},Abstract:function(e,t){var i=this.getChildValue(e);i&&(t["abstract"]=i)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--)e=this.controls[t],e.events&&e.events.un({activate:this.iconOn,deactivate:this.iconOff}),e.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],this.activeState[e.id]=e.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var e=this.div.childNodes.length,t=e-1;t>=0;t--)this.div.removeChild(this.div.childNodes[t]);if(this.div.innerHTML="",this.active)for(var t=0,i=this.controls.length;i>t;t++)this.div.appendChild(this.controls[t].panel_div)},activateControl:function(e){if(!this.active)return!1;if(e.type==OpenLayers.Control.TYPE_BUTTON)return e.trigger(),void 0;if(e.type==OpenLayers.Control.TYPE_TOGGLE)return e.active?e.deactivate():e.activate(),void 0;if(this.allowDepress&&e.active)e.deactivate();else{for(var t,i=0,n=this.controls.length;n>i;i++)t=this.controls[i],t==e||t.type!==OpenLayers.Control.TYPE_TOOL&&null!=t.type||t.deactivate();e.activate()}},addControls:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.controls=this.controls.concat(e);for(var t=0,i=e.length;i>t;t++){var n=e[t],s=this.createControlMarkup(n);OpenLayers.Element.addClass(s,n.displayClass+"ItemInactive"),OpenLayers.Element.addClass(s,"olButton"),""==n.title||s.title||(s.title=n.title),n.panel_div=s}this.map&&(this.addControlsToMap(e),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(e){for(var t,i=0,n=e.length;n>i;i++)t=e[i],t.autoActivate===!0?(t.autoActivate=!1,this.map.addControl(t),t.autoActivate=!0):(this.map.addControl(t),t.deactivate()),t.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");e.className=e.className.replace(t,"$1Active")},iconOff:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Active\\b");e.className=e.className.replace(t,"$1Inactive")},onButtonClick:function(e){for(var t=this.controls,i=e.buttonElement,n=t.length-1;n>=0;--n)if(t[n].panel_div===i){this.activateControl(t[n]);break}},getControlsBy:function(e,t){var i="function"==typeof t.test,n=OpenLayers.Array.filter(this.controls,function(n){return n[e]==t||i&&t.test(n[e])});return n},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,s=e.length;s>n;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var s=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(s,i));var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var a in n)a.toUpperCase()in r&&delete n[a];return s=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,s)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,s,r){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=n,s&&(this.size=s.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,r),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&(t=this.events.triggerEvent("beforedraw")!==!1),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,n=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:n})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,n){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=n,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload(),e},renderTile:function(){if(this.layer.div.appendChild(this.getTile()),this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=(0|this.position.x)+"px",e.top=(0|this.position.y)+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){OpenLayers.Event.stopObservingElement(e);var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),this.layerAlphaHack===!0&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img"),this.imgDiv.className="olTileImage",this.imgDiv.galleryImg="no";var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=100*(this.layer.gutter/this.layer.tileSize.w),i=100*(this.layer.gutter/this.layer.tileSize.h)),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var e=this.getImage();if(this.url&&e.getAttribute("src")==this.url)this.onImageLoad();else{var t=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(e),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url)},this);e.getAttribute("src")==this.blankImageUrl?t():(OpenLayers.Event.stopObservingElement(e),OpenLayers.Event.observe(e,"load",t),OpenLayers.Event.observe(e,"error",t),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),e.src=this.blankImageUrl)}},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;OpenLayers.Event.stopObservingElement(e),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this.tileQueue=[],null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"),OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(!0),this.moveTimerId=null},this))},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null),this.clearTileQueue(),null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.clearTileQueue(),this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],n=0,s=i.length;s>n;n++){var r=i[n];this.destroyTile(r)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.tileQueue=[],e.tileQueueId=null,e.loading=!1,e.moveTimerId=null,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var n=!this.grid.length||t,s=this.getTilesBounds(),r=this.map.getResolution();this.getServerResolution(r),this.singleTile?(n||!i&&!s.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(r),this.initSingleTile(e)):(n=n||!s.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),n?(t&&"resize"===this.transitionEffect&&this.applyBackBuffer(r),this.initGriddedTiles(e)):this.moveGriddedTiles())}},getTileData:function(e){var t=null,i=e.lon,n=e.lat,s=this.grid.length;if(this.map&&s){var r=this.map.getResolution(),a=this.tileSize.w,o=this.tileSize.h,l=this.grid[0][0].bounds,u=l.left,h=l.top;if(u>i&&this.map.baseLayer.wrapDateLine){var c=this.map.getMaxExtent().getWidth(),p=Math.ceil((u-i)/c);i+=c*p}var d=(i-u)/(r*a),m=(h-n)/(r*o),f=Math.floor(d),y=Math.floor(m);if(y>=0&&s>y){var g=this.grid[y][f];g&&(t={tile:g,i:Math.floor((d-f)*a),j:Math.floor((m-y)*o)})}}return t},queueTileDraw:function(e){var t=e.object;return~OpenLayers.Util.indexOf(this.tileQueue,t)||this.tileQueue.push(t),this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div)),!1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId),this.tileQueueId=null,this.tileQueue=[]},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var i,n,s,r;for(i=this.serverResolutions.length-1;i>=0&&(s=this.serverResolutions[i],n=Math.abs(s-e),!(n>t));i--)t=n,r=s;e=r}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;this.div.insertBefore(t,this.div.firstChild),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}for(var n,s=this.backBufferResolution/e,r=t.childNodes,a=r.length-1;a>=0;--a)n=r[a],n.style.top=(0|s*n._i*n._h)+"px",n.style.left=(0|s*n._j*n._w)+"px",n.style.width=Math.round(s*n._w)+"px",n.style.height=Math.round(s*n._h)+"px";var o=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,u=this.map.layerContainerOriginPx.y;t.style.left=Math.round(o.x-l)+"px",t.style.top=Math.round(o.y-u)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";for(var t=0,i=this.grid.length;i>t;t++)for(var n=0,s=this.grid[t].length;s>n;n++){var r=this.grid[t][n],a=this.grid[t][n].createBackBuffer();a&&(a._i=t,a._j=n,a._w=r.size.w,a._h=r.size.h,e.appendChild(a))}}return e},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio),e.w=parseInt(e.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])
},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var i=this.grid[t-1][0].bounds,n=this.grid[0].length*i.getWidth(),s=this.grid.length*i.getHeight();e=new OpenLayers.Bounds(i.left,i.bottom,i.left+n,i.bottom+s)}return e},initSingleTile:function(e){this.clearTileQueue();var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio,s=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2),r=this.map.getLayerPxFromLonLat({lon:s.left,lat:s.top});this.grid.length||(this.grid[0]=[]);var a=this.grid[0][0];a?a.moveTo(s,r):(a=this.addTile(s,r),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,s=i*this.tileSize.h,r=i/this.map.getResolution(),a={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)},o=e.left-t.lon,l=Math.floor(o/n)-this.buffer,u=o/n-l,h=-u*a.w,c="t"===this.tileOriginCorner.substr(0,1)?1:-1,p=c*(t.lat-e.top+s),d=Math[~c?"floor":"ceil"](p/s)-this.buffer*c,m=d-p/s,f=c*m*a.h;return{tilelon:n,tilelat:s,tileoffsetx:h,tileoffsety:f,startcol:l,startrow:d}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin(),n=this.gridLayout,s=n.tilelon,r=n.tilelat,a="t"===this.tileOriginCorner.substr(0,1)?1:-1,o=i.lon+(n.startcol+t)*s,l=i.lat-(n.startrow+e*a)*r*a;return new OpenLayers.Bounds(o,l,o+s,l+r)},initGriddedTiles:function(e){this.clearTileQueue();var t=this.map.getSize(),i=this.getTileOrigin(),n=this.map.getResolution(),s=this.getServerResolution(),r=n/s,a={w:this.tileSize.w/r,h:this.tileSize.h/r},o=Math.ceil(t.h/a.h)+2*this.buffer+1,l=Math.ceil(t.w/a.w)+2*this.buffer+1,u=this.calculateGridLayout(e,i,s);this.gridLayout=u;var h=Math.round(u.tileoffsetx),c=Math.round(u.tileoffsety),p=u.tilelon,d=u.tilelat,m=this.map.layerContainerOriginPx.x,f=this.map.layerContainerOriginPx.y,y=[],g=this.map.getCenter(),v=0;do{var b=this.grid[v];b||(b=[],this.grid.push(b));var L=0;do{var O=this.getTileBoundsForGridIndex(v,L),w=h+L*a.w-m,_=c+v*a.h-f,x=new OpenLayers.Pixel(w,_),S=b[L];S?S.moveTo(O,x,!1):(S=this.addTile(O,x),this.addTileMonitoringHooks(S),b.push(S));var C=O.getCenterLonLat();y.push({tile:S,distance:Math.pow(C.lon-g.lon,2)+Math.pow(C.lat-g.lat,2)}),L+=1}while(O.right<=e.right+p*this.buffer||l>L);v+=1}while(O.bottom>=e.bottom-d*this.buffer||o>v);this.removeExcessTiles(v,L);var n=this.getServerResolution(),k=n===this.gridResolution;this.gridResolution=n,y.sort(function(e,t){return e.distance-t.distance});for(var M=0,P=y.length;P>M;++M)y[M].tile.draw(k)},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return i.events.register("beforedraw",this,this.queueTileDraw),i},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++},e.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded",{tile:e}),0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(e){if(!e&&!OpenLayers.Animation.isNative)return null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay),void 0;for(var t=this.buffer+1;;){var i=this.grid[0][0],n={x:i.position.x+this.map.layerContainerOriginPx.x,y:i.position.y+this.map.layerContainerOriginPx.y},s=this.getServerResolution()/this.map.getResolution(),r={w:Math.round(this.tileSize.w*s),h:Math.round(this.tileSize.h*s)};if(n.x>-r.w*(t-1))this.shiftColumn(!0,r);else if(n.x<-r.w*t)this.shiftColumn(!1,r);else if(n.y>-r.h*(t-1))this.shiftRow(!0,r);else{if(!(n.y<-r.h*t))break;this.shiftRow(!1,r)}}},shiftRow:function(e){var t=this.grid,i=e?0:t.length-1,n=e?-1:1,s="t"===this.tileOriginCorner.substr(0,1)?1:-1,r=this.gridLayout;r.startrow+=n*s;for(var a=this.getTileBoundsForGridIndex(i,0),o=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(a.left,a.top)),l=Math.round(o.y-this.map.layerContainerOriginPx.y),u=t[e?"pop":"shift"](),h=0,c=u.length;c>h;h++){var p=u[h],o=p.position.clone();o.y=l,p.moveTo(this.getTileBoundsForGridIndex(i,h),o)}t[e?"unshift":"push"](u)},shiftColumn:function(e){var t=this.grid,i=e?0:t[0].length-1,n=e?-1:1,s=this.gridLayout;s.startcol+=n;for(var r=this.getTileBoundsForGridIndex(0,i),a=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(r.left,r.top)),o=Math.round(a.x-this.map.layerContainerOriginPx.x),l=0,u=t.length;u>l;l++){var h=t[l],c=h[e?"pop":"shift"](),a=c.position.clone();a.x=o,c.moveTo(this.getTileBoundsForGridIndex(l,i),a),h[e?"unshift":"push"](c)}},removeExcessTiles:function(e,t){for(var i,n;this.grid.length>e;){var s=this.grid.pop();for(i=0,n=s.length;n>i;i++){var r=s[i];this.destroyTile(r)}}for(i=0,n=this.grid.length;n>i;i++)for(;this.grid[i].length>t;){var s=this.grid[i],r=s.pop();this.destroyTile(r)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,s=i*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),a=t.left+n*Math.floor((r.lon-t.left)/n),o=t.bottom+s*Math.floor((r.lat-t.bottom)/s);return new OpenLayers.Bounds(a,o,a+n,o+s)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(e){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,e)if("feature"==e.requesttype){this.request.get_image=null;var t=this.request.get_feature.query;this.addCoordSys(t.featurecoordsys,e.featureCoordSys),this.addCoordSys(t.filtercoordsys,e.filterCoordSys),e.polygon?(t.isspatial=!0,t.spatialfilter.polygon=e.polygon):e.envelope&&(t.isspatial=!0,t.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(t.spatialfilter.envelope,e.envelope))}else if("image"==e.requesttype){this.request.get_feature=null;var i=this.request.get_image.properties;this.parseEnvelope(i.envelope,e.envelope),this.addLayers(i.layerlist,e.layers),this.addImageSize(i.imagesize,e.tileSize),this.addCoordSys(i.featurecoordsys,e.featureCoordSys),this.addCoordSys(i.filtercoordsys,e.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},parseEnvelope:function(e,t){t&&4==t.length&&(e.minx=t[0],e.miny=t[1],e.maxx=t[2],e.maxy=t[3])},addLayers:function(e,t){for(var i=0,n=t.length;n>i;i++)e.push(t[i])},addImageSize:function(e,t){null!==t&&(e.width=t.w,e.height=t.h,e.printwidth=t.w,e.printheight=t.h)},addCoordSys:function(e,t){"string"==typeof t?(e.id=parseInt(t),e.string=t):"object"==typeof t&&null!==t.proj?(e.id=t.proj.srsProjNumber,e.string=t.proj.srsCode):e=t},iserror:function(e){var t=null;if(e){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);var i=e.documentElement.getElementsByTagName("ERROR");t=null!==i&&i.length>0}else t=""!==this.response.error;return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;if(e&&e.documentElement&&(t="ARCXML"==e.documentElement.nodeName?e.documentElement:e.documentElement.getElementsByTagName("ARCXML")[0]),!t||"parsererror"===t.firstChild.nodeName){var i,n;try{i=e.firstChild.nodeValue,n=e.firstChild.childNodes[1].firstChild.nodeValue}catch(s){}throw{message:"Error parsing the ArcXML request",error:i,source:n}}var r=this.parseResponse(t);return r},write:function(e){e||(e=this.request);var t=this.createElementNS("","ARCXML");t.setAttribute("version","1.1");var i=this.createElementNS("","REQUEST");if(null!=e.get_image){var n=this.createElementNS("","GET_IMAGE");i.appendChild(n);var s=this.createElementNS("","PROPERTIES");n.appendChild(s);var r=e.get_image.properties;if(null!=r.featurecoordsys){var a=this.createElementNS("","FEATURECOORDSYS");s.appendChild(a),0===r.featurecoordsys.id?a.setAttribute("string",r.featurecoordsys.string):a.setAttribute("id",r.featurecoordsys.id)}if(null!=r.filtercoordsys){var o=this.createElementNS("","FILTERCOORDSYS");s.appendChild(o),0===r.filtercoordsys.id?o.setAttribute("string",r.filtercoordsys.string):o.setAttribute("id",r.filtercoordsys.id)}if(null!=r.envelope){var l=this.createElementNS("","ENVELOPE");s.appendChild(l),l.setAttribute("minx",r.envelope.minx),l.setAttribute("miny",r.envelope.miny),l.setAttribute("maxx",r.envelope.maxx),l.setAttribute("maxy",r.envelope.maxy)}var u=this.createElementNS("","IMAGESIZE");if(s.appendChild(u),u.setAttribute("height",r.imagesize.height),u.setAttribute("width",r.imagesize.width),(r.imagesize.height!=r.imagesize.printheight||r.imagesize.width!=r.imagesize.printwidth)&&(u.setAttribute("printheight",r.imagesize.printheight),u.setArrtibute("printwidth",r.imagesize.printwidth)),null!=r.background){var h=this.createElementNS("","BACKGROUND");s.appendChild(h),h.setAttribute("color",r.background.color.r+","+r.background.color.g+","+r.background.color.b),null!==r.background.transcolor&&h.setAttribute("transcolor",r.background.transcolor.r+","+r.background.transcolor.g+","+r.background.transcolor.b)}if(null!=r.layerlist&&r.layerlist.length>0){var c=this.createElementNS("","LAYERLIST");s.appendChild(c);for(var p=0;p<r.layerlist.length;p++){var d=this.createElementNS("","LAYERDEF");if(c.appendChild(d),d.setAttribute("id",r.layerlist[p].id),d.setAttribute("visible",r.layerlist[p].visible),"object"==typeof r.layerlist[p].query){var m=r.layerlist[p].query;if(m.where.length<0)continue;var f=null;f="boolean"==typeof m.spatialfilter&&m.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),f.setAttribute("where",m.where),"number"==typeof m.accuracy&&m.accuracy>0&&f.setAttribute("accuracy",m.accuracy),"number"==typeof m.featurelimit&&m.featurelimit<2e3&&f.setAttribute("featurelimit",m.featurelimit),"string"==typeof m.subfields&&"#ALL#"!=m.subfields&&f.setAttribute("subfields",m.subfields),"string"==typeof m.joinexpression&&m.joinexpression.length>0&&f.setAttribute("joinexpression",m.joinexpression),"string"==typeof m.jointables&&m.jointables.length>0&&f.setAttribute("jointables",m.jointables),d.appendChild(f)}"object"==typeof r.layerlist[p].renderer&&this.addRenderer(d,r.layerlist[p].renderer)}}}else if(null!=e.get_feature){var n=this.createElementNS("","GET_FEATURES");if(n.setAttribute("outputmode","newxml"),n.setAttribute("checkesc","true"),e.get_feature.geometry?n.setAttribute("geometry",e.get_feature.geometry):n.setAttribute("geometry","false"),e.get_feature.compact&&n.setAttribute("compact",e.get_feature.compact),"number"==e.get_feature.featurelimit&&n.setAttribute("featurelimit",e.get_feature.featurelimit),n.setAttribute("globalenvelope","true"),i.appendChild(n),null!=e.get_feature.layer&&e.get_feature.layer.length>0){var y=this.createElementNS("","LAYER");y.setAttribute("id",e.get_feature.layer),n.appendChild(y)}var g=e.get_feature.query;if(null!=g){var v=null;if(v=g.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),n.appendChild(v),"number"==typeof g.accuracy&&v.setAttribute("accuracy",g.accuracy),null!=g.featurecoordsys){var b=this.createElementNS("","FEATURECOORDSYS");0==g.featurecoordsys.id?b.setAttribute("string",g.featurecoordsys.string):b.setAttribute("id",g.featurecoordsys.id),v.appendChild(b)}if(null!=g.filtercoordsys){var L=this.createElementNS("","FILTERCOORDSYS");0===g.filtercoordsys.id?L.setAttribute("string",g.filtercoordsys.string):L.setAttribute("id",g.filtercoordsys.id),v.appendChild(L)}if(g.buffer>0){var O=this.createElementNS("","BUFFER");O.setAttribute("distance",g.buffer),v.appendChild(O)}if(g.isspatial){var w=this.createElementNS("","SPATIALFILTER");if(w.setAttribute("relation",g.spatialfilter.relation),v.appendChild(w),g.spatialfilter.envelope){var _=this.createElementNS("","ENVELOPE");_.setAttribute("minx",g.spatialfilter.envelope.minx),_.setAttribute("miny",g.spatialfilter.envelope.miny),_.setAttribute("maxx",g.spatialfilter.envelope.maxx),_.setAttribute("maxy",g.spatialfilter.envelope.maxy),w.appendChild(_)}else"object"==typeof g.spatialfilter.polygon&&w.appendChild(this.writePolygonGeometry(g.spatialfilter.polygon))}null!=g.where&&g.where.length>0&&v.setAttribute("where",g.where)}}return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},addGroupRenderer:function(e,t){var i=this.createElementNS("","GROUPRENDERER");e.appendChild(i);for(var n=0;n<t.length;n++){var s=t[n];this.addRenderer(i,s)}},addRenderer:function(e,t){if(OpenLayers.Util.isArray(t))this.addGroupRenderer(e,t);else{var i=this.createElementNS("",t.type.toUpperCase()+"RENDERER");e.appendChild(i),"VALUEMAPRENDERER"==i.tagName?this.addValueMapRenderer(i,t):"VALUEMAPLABELRENDERER"==i.tagName?this.addValueMapLabelRenderer(i,t):"SIMPLELABELRENDERER"==i.tagName?this.addSimpleLabelRenderer(i,t):"SCALEDEPENDENTRENDERER"==i.tagName&&this.addScaleDependentRenderer(i,t)}},addScaleDependentRenderer:function(e,t){("string"==typeof t.lower||"number"==typeof t.lower)&&e.setAttribute("lower",t.lower),("string"==typeof t.upper||"number"==typeof t.upper)&&e.setAttribute("upper",t.upper),this.addRenderer(e,t.renderer)},addValueMapLabelRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),e.setAttribute("labelfield",t.labelfield),"object"==typeof t.exacts)for(var i=0,n=t.exacts.length;n>i;i++){var s=t.exacts[i],r=this.createElementNS("","EXACT");if("string"==typeof s.value&&r.setAttribute("value",s.value),"string"==typeof s.label&&r.setAttribute("label",s.label),"string"==typeof s.method&&r.setAttribute("method",s.method),e.appendChild(r),"object"==typeof s.symbol){var a=null;if("text"==s.symbol.type&&(a=this.createElementNS("","TEXTSYMBOL")),null!=a){for(var o=this.fontStyleKeys,l=0,u=o.length;u>l;l++){var h=o[l];s.symbol[h]&&a.setAttribute(h,s.symbol[h])}r.appendChild(a)}}}},addValueMapRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),"object"==typeof t.ranges)for(var i=0,n=t.ranges.length;n>i;i++){var s=t.ranges[i],r=this.createElementNS("","RANGE");if(r.setAttribute("lower",s.lower),r.setAttribute("upper",s.upper),e.appendChild(r),"object"==typeof s.symbol){var a=null;"simplepolygon"==s.symbol.type&&(a=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=a&&("string"==typeof s.symbol.boundarycolor&&a.setAttribute("boundarycolor",s.symbol.boundarycolor),"string"==typeof s.symbol.fillcolor&&a.setAttribute("fillcolor",s.symbol.fillcolor),"number"==typeof s.symbol.filltransparency&&a.setAttribute("filltransparency",s.symbol.filltransparency),r.appendChild(a))}}else if("object"==typeof t.exacts)for(var o=0,l=t.exacts.length;l>o;o++){var u=t.exacts[o],h=this.createElementNS("","EXACT");if("string"==typeof u.value&&h.setAttribute("value",u.value),"string"==typeof u.label&&h.setAttribute("label",u.label),"string"==typeof u.method&&h.setAttribute("method",u.method),e.appendChild(h),"object"==typeof u.symbol){var a=null;"simplemarker"==u.symbol.type&&(a=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=a&&("string"==typeof u.symbol.antialiasing&&a.setAttribute("antialiasing",u.symbol.antialiasing),"string"==typeof u.symbol.color&&a.setAttribute("color",u.symbol.color),"string"==typeof u.symbol.outline&&a.setAttribute("outline",u.symbol.outline),"string"==typeof u.symbol.overlap&&a.setAttribute("overlap",u.symbol.overlap),"string"==typeof u.symbol.shadow&&a.setAttribute("shadow",u.symbol.shadow),"number"==typeof u.symbol.transparency&&a.setAttribute("transparency",u.symbol.transparency),"string"==typeof u.symbol.usecentroid&&a.setAttribute("usecentroid",u.symbol.usecentroid),"number"==typeof u.symbol.width&&a.setAttribute("width",u.symbol.width),h.appendChild(a))}}},addSimpleLabelRenderer:function(e,t){e.setAttribute("field",t.field);for(var i=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],n=0,s=i.length;s>n;n++){var r=i[n];t[r]&&e.setAttribute(r,t[r])}if("text"==t.symbol.type){var a=t.symbol,o=this.createElementNS("","TEXTSYMBOL");e.appendChild(o);for(var i=this.fontStyleKeys,n=0,s=i.length;s>n;n++){var r=i[n];a[r]&&o.setAttribute(r,t[r])}}},writePolygonGeometry:function(e){if(!(e instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+e.CLASS_NAME+" object.",geometry:e};for(var t=this.createElementNS("","POLYGON"),i=0,n=e.components.length;n>i;i++){for(var s=e.components[i],r=this.createElementNS("","RING"),a=0,o=s.components.length;o>a;a++){var l=s.components[a],u=this.createElementNS("","POINT");u.setAttribute("x",l.x),u.setAttribute("y",l.y),r.appendChild(u)}t.appendChild(r)}return t},parseResponse:function(e){if("string"==typeof e){var t=new OpenLayers.Format.XML;e=t.read(e)}var i=new OpenLayers.Format.ArcXML.Response,n=e.getElementsByTagName("ERROR");if(null!=n&&n.length>0)i.error=this.getChildValue(n,"Unknown error.");else{var s=e.getElementsByTagName("RESPONSE");if(null==s||0==s.length)return i.error="No RESPONSE tag found in ArcXML response.",i;var r=s[0].firstChild.nodeName;if("#text"==r&&(r=s[0].firstChild.nextSibling.nodeName),"IMAGE"==r){var a=e.getElementsByTagName("ENVELOPE"),o=e.getElementsByTagName("OUTPUT");if(null==a||0==a.length)i.error="No ENVELOPE tag found in ArcXML response.";else if(null==o||0==o.length)i.error="No OUTPUT tag found in ArcXML response.";else{var l=this.parseAttributes(a[0]),u=this.parseAttributes(o[0]);i.image="string"==typeof u.type?{envelope:l,output:{type:u.type,data:this.getChildValue(o[0])}}:{envelope:l,output:u}}}else if("FEATURES"==r){var h=s[0].getElementsByTagName("FEATURES"),c=h[0].getElementsByTagName("FEATURECOUNT");if(i.features.featurecount=c[0].getAttribute("count"),i.features.featurecount>0){var p=h[0].getElementsByTagName("ENVELOPE");i.features.envelope=this.parseAttributes(p[0],"number");for(var d=h[0].getElementsByTagName("FEATURE"),m=0;m<d.length;m++){for(var f=new OpenLayers.Feature.Vector,y=d[m].getElementsByTagName("FIELD"),g=0;g<y.length;g++){var v=y[g].getAttribute("name"),b=y[g].getAttribute("value");f.attributes[v]=b}var L=d[m].getElementsByTagName("POLYGON");if(L.length>0){for(var O=L[0].getElementsByTagName("RING"),w=[],_=0;_<O.length;_++){var x=[];x.push(this.parsePointGeometry(O[_]));for(var S=O[_].getElementsByTagName("HOLE"),C=0;C<S.length;C++)x.push(this.parsePointGeometry(S[C]));S=null,w.push(new OpenLayers.Geometry.Polygon(x)),x=null}O=null,f.geometry=1==w.length?w[0]:new OpenLayers.Geometry.MultiPolygon(w)}i.features.feature.push(f)}}}else i.error="Unidentified response type."}return i},parseAttributes:function(e,t){for(var i={},n=0;n<e.attributes.length;n++)i[e.attributes[n].nodeName]="number"==t?parseFloat(e.attributes[n].nodeValue):e.attributes[n].nodeValue;return i},parsePointGeometry:function(e){var t=[],i=e.getElementsByTagName("COORDS");if(i.length>0){var n=this.getChildValue(i[0]);n=n.split(/;/);for(var s=0;s<n.length;s++){var r=n[s].split(/ /);t.push(new OpenLayers.Geometry.Point(r[0],r[1]))}i=null}else{var a=e.getElementsByTagName("POINT");if(a.length>0)for(var o=0;o<a.length;o++)t.push(new OpenLayers.Geometry.Point(parseFloat(a[o].getAttribute("x")),parseFloat(a[o].getAttribute("y"))));a=null}return new OpenLayers.Geometry.LinearRing(t)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){var e={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){var e={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(e,t,i){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:i.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(i,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,this.params,i]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])},getURL:function(e){var t="";e=this.adjustBounds(e);var i=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize})),n=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:i.write(),async:!1});if(null!=n){var s=n.responseXML;s&&s.documentElement||(s=n.responseText);var r=new OpenLayers.Format.ArcXML,a=r.read(s);t=this.getUrlOrImage(a.image.output)}return t},getURLasync:function(e,t,i){e=this.adjustBounds(e);var n=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:n.write(),callback:function(e){var n=e.responseXML;n&&n.documentElement||(n=e.responseText);var s=new OpenLayers.Format.ArcXML,r=s.read(n);t.call(i,this.getUrlOrImage(r.image.output))},scope:this})},getUrlOrImage:function(e){var t="";return e.url?t=e.url:e.data&&(t="data:image/"+e.type+";base64,"+e.data),t},setLayerQuery:function(e,t){for(var i=0;i<this.options.layers.length;i++)if(e==this.options.layers[i].id)return this.options.layers[i].query=t,void 0;this.options.layers.push({id:e,visible:!0,query:t})},getFeatureInfo:function(e,t,i){var n=i.buffer||1,s=i.callback||function(){},r=i.scope||window,a={};OpenLayers.Util.extend(a,this.options),a.requesttype="feature",e instanceof OpenLayers.LonLat?(a.polygon=null,a.envelope=[e.lon-n,e.lat-n,e.lon+n,e.lat+n]):e instanceof OpenLayers.Geometry.Polygon&&(a.envelope=null,a.polygon=e);var o=new OpenLayers.Format.ArcXML(a);if(OpenLayers.Util.extend(o.request.get_feature,i),o.request.get_feature.layer=t.id,"number"==typeof t.query.accuracy)o.request.get_feature.query.accuracy=t.query.accuracy;else{var l=this.map.getCenter(),u=this.map.getViewPortPxFromLonLat(l);u.x++;var h=this.map.getLonLatFromPixel(u);o.request.get_feature.query.accuracy=h.lon-l.lon}o.request.get_feature.query.where=t.query.where,o.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:o.write(),callback:function(e){var t=o.parseResponse(e.responseText);o.iserror()?s.call(r,null):s.call(r,t.features)}})},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,n=e.timePeriods.length;n>i;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){var t=this.createElementNSPlus("wcs:BeginPosition",{value:e});return t},EndPosition:function(e){var t=this.createElementNSPlus("wcs:EndPosition",{value:e});return t},TimeResolution:function(e){var t=this.createElementNSPlus("wcs:TimeResolution",{value:e});return t},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){return void 0},write:function(e){var t;window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs)for(var i=0,n=e.outputs.length;n>i;i++)this.writeNode("wps:Output",e.outputs[i],t);return t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference,mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e["abstract"],t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,n=e.length;n>i;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),e.boundingBoxData&&this.writeNode("wps:BoundingBoxData",e.boundingBoxData,t),t
},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData?this.writeNode("wps:ComplexData",e.complexData,t):e.boundingBoxData&&this.writeNode("ows:BoundingBox",e.boundingBoxData,t),t},LiteralData:function(e){var t=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value});return t},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),i=e.value;return"string"==typeof i?t.appendChild(this.getXMLDoc().createCDATASection(e.value)):t.appendChild(i),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},BoundingBoxData:function(e,t){this.writers.ows.BoundingBox.apply(this,[e,t,"wps:BoundingBoxData"])},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(e,t){t.executeResponse={lang:e.getAttribute("lang"),statusLocation:e.getAttribute("statusLocation"),serviceInstance:e.getAttribute("serviceInstance"),service:e.getAttribute("service")},this.readChildNodes(e,t.executeResponse)},Process:function(e,t){t.process={},this.readChildNodes(e,t.process)},Status:function(e,t){t.status={creationTime:e.getAttribute("creationTime")},this.readChildNodes(e,t.status)},ProcessSucceeded:function(e,t){t.processSucceeded=!0},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Reference:function(e,t){t.reference={href:e.getAttribute("href"),mimeType:e.getAttribute("mimeType"),encoding:e.getAttribute("encoding"),schema:e.getAttribute("schema")}},Data:function(e,t){t.data={},this.readChildNodes(e,t)},LiteralData:function(e,t){t.literalData={dataType:e.getAttribute("dataType"),uom:e.getAttribute("uom"),value:this.getChildValue(e)}},ComplexData:function(e,t){if(t.complexData={mimeType:e.getAttribute("mimeType"),schema:e.getAttribute("schema"),encoding:e.getAttribute("encoding"),value:""},this.isSimpleContent(e)){var i;for(i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 3:case 4:t.complexData.value+=i.nodeValue}}else for(i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&(t.complexData.value=i)},BoundingBox:function(e,t){t.boundingBoxData={dimensions:e.getAttribute("dimensions"),crs:e.getAttribute("crs")},this.readChildNodes(e,t.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position,this.buttons=[];var t={w:18,h:18},i=new OpenLayers.Pixel(e.x+t.w/2,e.y);return this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this._addButton("panright","east-mini.png",e.add(t.w,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),this._addButton("zoomworld","zoom-world-mini.png",i.add(0,4*t.h+5),t),this._addButton("zoomout","zoom-minus-mini.png",i.add(0,5*t.h+5),t),this.div},_addButton:function(e,t,i,n){var s=OpenLayers.Util.getImageLocation(t),r=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,i,n,s,"absolute");return r.style.cursor="pointer",this.div.appendChild(r),r.action=e,r.className="olButton",this.buttons.push(r),r},_removeButton:function(e){this.div.removeChild(e),OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position.clone(),this.buttons=[];var t={w:18,h:18};if(this.panIcons){var i=new OpenLayers.Pixel(e.x+t.w/2,e.y),n=t.w;this.zoomWorldIcon&&(i=new OpenLayers.Pixel(e.x+t.w,e.y)),this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t),n*=2),this._addButton("panright","east-mini.png",e.add(n,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),i=this._addZoomBar(i.add(0,4*t.h+5)),this._addButton("zoomout","zoom-minus-mini.png",i,t)}else this._addButton("zoomin","zoom-plus-mini.png",e,t),i=this._addZoomBar(e.add(0,t.h)),this._addButton("zoomout","zoom-minus-mini.png",i,t),this.zoomWorldIcon&&(i=i.add(0,t.h+3),this._addButton("zoomworld","zoom-world-mini.png",i,t));return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),i=this.id+"_"+this.map.id,n=this.map.getMinZoom(),s=this.map.getNumZoomLevels()-1-this.map.getZoom(),r=OpenLayers.Util.createAlphaImageDiv(i,e.add(-1,s*this.zoomStopHeight),{w:20,h:9},t,"absolute");r.style.cursor="move",this.slider=r,this.sliderEvents=new OpenLayers.Events(this,r,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var a={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-n)},t=OpenLayers.Util.getImageLocation("zoombar.png"),o=null;if(OpenLayers.Util.alphaHack()){var i=this.id+"_"+this.map.id;o=OpenLayers.Util.createAlphaImageDiv(i,e,{w:a.w,h:this.zoomStopHeight},t,"absolute",null,"crop"),o.style.height=a.h+"px"}else o=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,a,t);return o.style.cursor="pointer",o.className="olButton",this.zoombarDiv=o,this.div.appendChild(o),this.startTop=parseInt(o.style.top),this.div.appendChild(r),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-n))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(t=Math.floor(t));var i=this.map.getNumZoomLevels()-1-t;i=Math.min(Math.max(i,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(i)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},zoomBarDown:function(e){(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=e.xy.clone(),this.zoomStart=e.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(e))},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,i=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-i[1]>0&&e.clientY-i[1]<parseInt(this.zoombarDiv.style.height)-2){var n=parseInt(this.slider.style.top)-t;this.slider.style.top=n+"px",this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y,OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var t=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(t+=this.deltaY/this.zoomStopHeight,t=Math.min(Math.max(t,0),this.map.getNumZoomLevels()-1)):(t+=this.deltaY/this.zoomStopHeight,t=Math.max(Math.round(t),0)),this.map.zoomTo(t),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(e,t,i,n,s){this.url=t,this.extent=i,this.maxExtent=i,this.size=n,OpenLayers.Layer.prototype.initialize.apply(this,[e,s]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,t){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var i=null==this.tile;if(t||i){this.setTileSize();var n=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});i?(this.tile=new OpenLayers.Tile.Image(this,n,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=n.clone()),this.tile.draw()}},setTileSize:function(){var e=this.extent.getWidth()/this.map.getResolution(),t=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(e,t)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.events.triggerEvent("loadstart")},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},setUrl:function(e){this.url=e,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(e){OpenLayers.Strategy.prototype.initialize.apply(this,[e]),this.events=new OpenLayers.Events(this)},activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},triggerSave:function(e){var t=e.feature;(t.state===OpenLayers.State.INSERT||t.state===OpenLayers.State.UPDATE||t.state===OpenLayers.State.DELETE)&&this.save([e.feature])},save:function(e){e||(e=this.layer.features),this.events.triggerEvent("start",{features:e});var t=this.layer.projection,i=this.layer.map.getProjectionObject();if(!i.equals(t)){for(var n,s,r=e.length,a=new Array(r),o=0;r>o;++o)n=e[o],s=n.clone(),s.fid=n.fid,s.state=n.state,n.url&&(s.url=n.url),s._original=n,s.geometry.transform(i,t),a[o]=s;e=a}this.layer.protocol.commit(e,{callback:this.onCommit,scope:this})},onCommit:function(e){var t={response:e};if(e.success()){for(var i,n,s=e.reqFeatures,r=[],a=e.insertIds||[],o=0,l=0,u=s.length;u>l;++l)n=s[l],n=n._original||n,i=n.state,i&&(i==OpenLayers.State.DELETE?r.push(n):i==OpenLayers.State.INSERT&&(n.fid=a[o],++o),n.state=null);r.length>0&&this.layer.destroyFeatures(r),this.events.triggerEvent("success",t)}else this.events.triggerEvent("fail",t)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(e){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=[];if(this.extractTracks)for(var i=e.getElementsByTagName("trk"),n=0,s=i.length;s>n;n++){var r={};this.extractAttributes&&(r=this.parseAttributes(i[n]));for(var a=this.getElementsByTagNameNS(i[n],i[n].namespaceURI,"trkseg"),o=0,l=a.length;l>o;o++){var u=this.extractSegment(a[o],"trkpt");t.push(new OpenLayers.Feature.Vector(u,r))}}if(this.extractRoutes)for(var h=e.getElementsByTagName("rte"),c=0,p=h.length;p>c;c++){var r={};this.extractAttributes&&(r=this.parseAttributes(h[c]));var d=this.extractSegment(h[c],"rtept");t.push(new OpenLayers.Feature.Vector(d,r))}if(this.extractWaypoints)for(var m=e.getElementsByTagName("wpt"),f=0,s=m.length;s>f;f++){var r={};this.extractAttributes&&(r=this.parseAttributes(m[f]));var y=new OpenLayers.Geometry.Point(m[f].getAttribute("lon"),m[f].getAttribute("lat"));t.push(new OpenLayers.Feature.Vector(y,r))}if(this.internalProjection&&this.externalProjection)for(var g=0,v=t.length;v>g;g++)t[g].geometry.transform(this.externalProjection,this.internalProjection);return t},extractSegment:function(e,t){for(var i=this.getElementsByTagNameNS(e,e.namespaceURI,t),n=[],s=0,r=i.length;r>s;s++)n.push(new OpenLayers.Geometry.Point(i[s].getAttribute("lon"),i[s].getAttribute("lat")));return new OpenLayers.Geometry.LineString(n)},parseAttributes:function(e){for(var t,i,n={},s=e.firstChild;s;)1==s.nodeType&&s.firstChild&&(t=s.firstChild,(3==t.nodeType||4==t.nodeType)&&(i=s.prefix?s.nodeName.split(":")[1]:s.nodeName,"trkseg"!=i&&"rtept"!=i&&(n[i]=t.nodeValue))),s=s.nextSibling;return n},write:function(e,t){e=OpenLayers.Util.isArray(e)?e:[e];var i=this.createElementNS(this.namespaces.gpx,"gpx");i.setAttribute("version","1.1"),i.setAttribute("creator",this.creator),this.setAttributes(i,{"xsi:schemaLocation":this.schemaLocation}),t&&"object"==typeof t&&i.appendChild(this.buildMetadataNode(t));for(var n=0,s=e.length;s>n;n++)i.appendChild(this.buildFeatureNode(e[n]));return OpenLayers.Format.XML.prototype.write.apply(this,[i])},buildMetadataNode:function(e){for(var t=["name","desc","author"],i=this.createElementNSPlus("gpx:metadata"),n=0;n<t.length;n++){var s=t[n];if(e[s]){var r=this.createElementNSPlus("gpx:"+s);r.appendChild(this.createTextNode(e[s])),i.appendChild(r)}}return i},buildFeatureNode:function(e){var t=e.geometry;if(t=t.clone(),this.internalProjection&&this.externalProjection&&t.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==t.CLASS_NAME){var i=this.buildWptNode(t);return this.appendAttributesNode(i,e),i}var n=this.createElementNSPlus("gpx:trk");this.appendAttributesNode(n,e);var s=this.buildTrkSegNode(t);s=OpenLayers.Util.isArray(s)?s:[s];for(var r=0,a=s.length;a>r;r++)n.appendChild(s[r]);return n},buildTrkSegNode:function(e){var t,i,n,s,r;if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=this.createElementNSPlus("gpx:trkseg"),i=0,n=e.components.length;n>i;i++)s=e.components[i],t.appendChild(this.buildTrkPtNode(s));return t}for(r=[],i=0,n=e.components.length;n>i;i++)r.push(this.buildTrkSegNode(e.components[i]));return r},buildTrkPtNode:function(e){var t=this.createElementNSPlus("gpx:trkpt");return t.setAttribute("lon",e.x),t.setAttribute("lat",e.y),t},buildWptNode:function(e){var t=this.createElementNSPlus("gpx:wpt");return t.setAttribute("lon",e.x),t.setAttribute("lat",e.y),t},appendAttributesNode:function(e,t){var i=this.createElementNSPlus("gpx:name");i.appendChild(this.createTextNode(t.attributes.name||t.id)),e.appendChild(i);var n=this.createElementNSPlus("gpx:desc");n.appendChild(this.createTextNode(t.attributes.description||this.defaultDesc)),e.appendChild(n)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i=[],n={},s={complexTypes:i,customTypes:n};this.readChildNodes(e,s);for(var r,a,o=e.attributes,l=0,u=o.length;u>l;++l)r=o[l],a=r.name,0==a.indexOf("xmlns")?this.setNamespace(a.split(":")[1]||"",r.value):t[a]=r.value;t.featureTypes=i,t.targetPrefix=this.namespaceAlias[t.targetNamespace];for(var h,c,l=0,u=i.length;u>l;++l)h=i[l],c=n[h.typeName],n[h.typeName]&&(h.typeName=c.name)},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i),t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i),t.properties=i.elements},element:function(e,t){if(t.elements){for(var i,n={},s=e.attributes,r=0,a=s.length;a>r;++r)i=s[r],n[i.name]=i.value;var o=n.type;o||(o={},this.readChildNodes(e,o),n.restriction=o,n.type=o.base);var l=o.base||o;n.localType=l.split(":").pop(),t.elements.push(n)}if(t.complexTypes){var o=e.getAttribute("type"),u=o.split(":").pop();t.customTypes[u]={name:e.getAttribute("name"),type:o}}},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base"),this.readRestriction(e,t)}}},readRestriction:function(e,t){for(var i,n,s,r=e.childNodes,a=0,o=r.length;o>a;++a)i=r[a],1==i.nodeType&&(n=i.nodeName.split(":").pop(),s=i.getAttribute("value"),t[n]?("string"==typeof t[n]&&(t[n]=[t[n]]),t[n].push(s)):t[n]=s)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};if("ExceptionReport"===e.nodeName.split(":").pop()){var i=new OpenLayers.Format.OGCExceptionReport;t.error=i.read(e)}else this.readNode(e,t);return t},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(i,n):t={display:"none"};var s=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&s!==!1){var r=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var a=isNaN(t.labelXOffset)?0:t.labelXOffset,o=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();r.move(a*l,o*l)}this.drawText(e.id,t,r)}else this.removeText(e.id);return s}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth(),n=(this.extent.left+this.extent.right)/2,s=(e.left+e.right)/2,r=Math.round((s-n)/i);this.featureDx=r*i}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var n,s=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());var r=s&&s.intersectsBounds(this.extent,{worldBounds:n});i="none"!==t.display&&!!s&&r,i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=n&&"OpenLayers.Geometry.MultiPoint"!=n&&"OpenLayers.Geometry.MultiLineString"!=n&&"OpenLayers.Geometry.MultiPolygon"!=n)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}else for(var s=0;s<e.components.length;s++)this.drawGeometry(e.components[s],t,i)},drawExternalGraphic:function(e,t,i){var n=new Image,s=t.title||t.graphicTitle;s&&(n.title=s);var r=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth;r=r?r:2*t.pointRadius,a=a?a:2*t.pointRadius;var o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*a),u=t.graphicOpacity||t.fillOpacity,h=function(){if(this.features[i]){var t=this.getLocalXY(e),s=t[0],h=t[1];if(!isNaN(s)&&!isNaN(h)){var c=0|s+o,p=0|h+l,d=this.canvas;d.globalAlpha=u;var m=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(n,c*m,p*m,r*m,a*m),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(c,p,r,a))}}};n.onload=OpenLayers.Function.bind(h,this),n.src=t.externalGraphic},drawNamedSymbol:function(e,t,i){var n,s,r,a,o,l,u,h,c,p=Math.PI/180,d=OpenLayers.Renderer.symbol[t.graphicName];if(!d)throw new Error(t.graphicName+" is not a valid symbol name");if(d.length&&!(d.length<2)){var m=this.getLocalXY(e),f=m[0],y=m[1];if(!isNaN(f)&&!isNaN(y)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{for(l=new OpenLayers.Bounds,o=0;o<d.length;o+=2)l.extend(new OpenLayers.LonLat(d[o],d[o+1]));this.cachedSymbolBounds[t.graphicName]=l}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(f,y),this.hitDetection&&this.hitContext.translate(f,y),h=p*t.rotation,isNaN(h)||(this.canvas.rotate(h),this.hitDetection&&this.hitContext.rotate(h)),u=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight()),this.canvas.scale(u,u),this.hitDetection&&this.hitContext.scale(u,u),r=l.getCenterLonLat().lon,a=l.getCenterLonLat().lat,this.canvas.translate(-r,-a),this.hitDetection&&this.hitContext.translate(-r,-a),c=t.strokeWidth,t.strokeWidth=c/u,t.fill!==!1){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),o=0;o<d.length;o+=2)n=d[o],s=d[o+1],0==o&&this.canvas.moveTo(n,s),this.canvas.lineTo(n,s);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),o=0;o<d.length;o+=2)n=d[o],s=d[o+1],0==o&&this.canvas.moveTo(n,s),this.hitContext.lineTo(n,s);this.hitContext.closePath(),this.hitContext.fill()}}if(t.stroke!==!1){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),o=0;o<d.length;o+=2)n=d[o],s=d[o+1],0==o&&this.canvas.moveTo(n,s),this.canvas.lineTo(n,s);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,u),this.hitContext.beginPath(),o=0;o<d.length;o+=2)n=d[o],s=d[o+1],0==o&&this.hitContext.moveTo(n,s),this.hitContext.lineTo(n,s);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=c,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),n=i.length;return i="#"+i.substring(n-6,n)},setHitContextStyle:function(e,t,i,n){var s=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=s):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=s,"undefined"==typeof n?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=i.strokeWidth+2/n)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var n=this.getLocalXY(e),s=n[0],r=n[1];if(!isNaN(s)&&!isNaN(r)){var a=2*Math.PI,o=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(s,r,o,0,a,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(s,r,o,0,a,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(s,r,o,0,a,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(s,r,o,0,a,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")
},renderPath:function(e,t,i,n,s){var r=t.components,a=r.length;e.beginPath();var o=this.getLocalXY(r[0]),l=o[0],u=o[1];if(!isNaN(l)&&!isNaN(u)){e.moveTo(o[0],o[1]);for(var h=1;a>h;++h){var c=this.getLocalXY(r[h]);e.lineTo(c[0],c[1])}"fill"===s?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var n=e.components,s=n.length;this.drawLinearRing(n[0],t,i);for(var r=1;s>r;++r)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(n[r],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(n[r],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),s=t.label.split("\n"),r=s.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==a&&(a=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=o*a*(r-1);for(var l=0;r>l;l++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(s[l],i[0],i[1]+o*l+1),this.canvas.restore()),this.canvas.fillText(s[l],i[0],i[1]+o*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var u=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==u&&(u=-.5);var a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==a&&(a=-.5);var o=this.canvas.mozMeasureText("xx");i[1]+=o*(1+a*r);for(var l=0;r>l;l++){var h=i[0]+u*this.canvas.mozMeasureText(s[l]),c=i[1]+l*o;this.canvas.translate(h,c),this.canvas.mozDrawText(s[l]),this.canvas.translate(-h,-c)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,n=(e.x-this.featureDx)/t+-i.left/t,s=i.top/t-e.y/t;return[n,s]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,i;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var n=e.xy,s=0|n.x,r=0|n.y,a=this.hitContext.getImageData(s,r,1,1).data;if(255===a[3]){var o=a[2]+256*(a[1]+256*a[0]);if(o){t="OpenLayers_Feature_Vector_"+(o-1+this.hitOverflow);try{i=this.features[t][0]}catch(l){}}}}return i},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,n,s,r=[],a=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features)this.features.hasOwnProperty(o)&&(i=this.features[o][0],n=i.geometry,this.calculateFeatureDx(n.getBounds(),a),s=this.features[o][1],this.drawGeometry(n,s,i.id),s.label&&r.push([i,s]));for(var l,u=0,h=r.length;h>u;++u)l=r[u],this.drawText(l[0].geometry.getCentroid(),l[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(e){var t={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};t=OpenLayers.Util.extend(t,e);for(var i={},n=0;n<t.interestingTagsExclude.length;n++)i[t.interestingTagsExclude[n]]=!0;t.interestingTagsExclude=i;for(var s={},n=0;n<t.areaTags.length;n++)s[t.areaTags[n]]=!0;t.areaTags=s,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[t])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getNodes(e),i=this.getWays(e),n=new Array(i.length),s=0;s<i.length;s++){for(var r=new Array(i[s].nodes.length),a=this.isWayArea(i[s])?1:0,o=0;o<i[s].nodes.length;o++){var l=t[i[s].nodes[o]],u=new OpenLayers.Geometry.Point(l.lon,l.lat);u.osm_id=parseInt(i[s].nodes[o]),r[o]=u,l.used=!0}var h=null;h=a?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(r)):new OpenLayers.Geometry.LineString(r),this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection);var c=new OpenLayers.Feature.Vector(h,i[s].tags);c.osm_id=parseInt(i[s].id),c.fid="way."+c.osm_id,n[s]=c}for(var p in t){var l=t[p];if(!l.used||this.checkTags){var d=null;if(this.checkTags){var m=this.getTags(l.node,!0);if(l.used&&!m[1])continue;d=m[0]}else d=this.getTags(l.node);var c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(l.lon,l.lat),d);this.internalProjection&&this.externalProjection&&c.geometry.transform(this.externalProjection,this.internalProjection),c.osm_id=parseInt(p),c.fid="node."+c.osm_id,n.push(c)}l.node=null}return n},getNodes:function(e){for(var t=e.getElementsByTagName("node"),i={},n=0;n<t.length;n++){var s=t[n],r=s.getAttribute("id");i[r]={lat:s.getAttribute("lat"),lon:s.getAttribute("lon"),node:s}}return i},getWays:function(e){for(var t=e.getElementsByTagName("way"),i=[],n=0;n<t.length;n++){var s=t[n],r={id:s.getAttribute("id")};r.tags=this.getTags(s);var a=s.getElementsByTagName("nd");r.nodes=new Array(a.length);for(var o=0;o<a.length;o++)r.nodes[o]=a[o].getAttribute("ref");i.push(r)}return i},getTags:function(e,t){for(var i=e.getElementsByTagName("tag"),n={},s=!1,r=0;r<i.length;r++){var a=i[r].getAttribute("k");n[a]=i[r].getAttribute("v"),t&&(this.interestingTagsExclude[a]||(s=!0))}return t?[n,s]:n},isWayArea:function(e){var t=!1,i=!1;if(e.nodes[0]==e.nodes[e.nodes.length-1]&&(t=!0),this.checkTags)for(var n in e.tags)if(this.areaTags[n]){i=!0;break}return t&&(this.checkTags?i:!0)},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.osm_id=1,this.created_nodes={};var t=this.createElementNS(null,"osm");t.setAttribute("version","0.5"),t.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var i=e.length-1;i>=0;i--)for(var n=this.createFeatureNodes(e[i]),s=0;s<n.length;s++)t.appendChild(n[s]);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureNodes:function(e){var t=[],i=e.geometry.CLASS_NAME,n=i.substring(i.lastIndexOf(".")+1);n=n.toLowerCase();var s=this.createXML[n];return s&&(t=s.apply(this,[e])),t},createXML:{point:function(e){var t=null,i=e.geometry?e.geometry:e;this.internalProjection&&this.externalProjection&&(i=i.clone(),i.transform(this.internalProjection,this.externalProjection));var n=!1;if(e.osm_id?(t=e.osm_id,this.created_nodes[t]&&(n=!0)):(t=-this.osm_id,this.osm_id++),n)s=this.created_nodes[t];else var s=this.createElementNS(null,"node");return this.created_nodes[t]=s,s.setAttribute("id",t),s.setAttribute("lon",i.x),s.setAttribute("lat",i.y),e.attributes&&this.serializeTags(e,s),this.setState(e,s),n?[]:[s]},linestring:function(e){var t,i=[],n=e.geometry;e.osm_id?t=e.osm_id:(t=-this.osm_id,this.osm_id++);var s=this.createElementNS(null,"way");s.setAttribute("id",t);for(var r=0;r<n.components.length;r++){var a=this.createXML.point.apply(this,[n.components[r]]);if(a.length){a=a[0];var o=a.getAttribute("id");i.push(a)}else o=n.components[r].osm_id,a=this.created_nodes[o];this.setState(e,a);var l=this.createElementNS(null,"nd");l.setAttribute("ref",o),s.appendChild(l)}return this.serializeTags(e,s),i.push(s),i},polygon:function(e){var t=OpenLayers.Util.extend({area:"yes"},e.attributes),i=new OpenLayers.Feature.Vector(e.geometry.components[0],t);return i.osm_id=e.osm_id,this.createXML.linestring.apply(this,[i])}},serializeTags:function(e,t){for(var i in e.attributes){var n=this.createElementNS(null,"tag");n.setAttribute("k",i),n.setAttribute("v",e.attributes[i]),t.appendChild(n)}},setState:function(e,t){if(e.state){var i=null;switch(e.state){case OpenLayers.State.UPDATE:i="modify";case OpenLayers.State.DELETE:i="delete"}i&&t.setAttribute("action",i)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.stop(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),this.handle(e)?!this.stopDown:!0},mouseup:function(e){return this.up=e.xy,this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){return this.callbacks.over||this.callbacks.out?(this.handle(e),!0):!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature,s="click"==t||"dblclick"==t||"touchstart"==t;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===t&&OpenLayers.Event.stop(e);var r=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(n&&r?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):(!n||s)&&this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(n&&r||s)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(n||s)&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var n=this.EVENTMAP[e][t];if(n)if("click"==e&&this.up&&this.down){var s=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));s<=this.clickTolerance&&this.callback(n,i)}else this.callback(n,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.over=this.feature.id==e.id?!0:!1:(this.feature=e,this.handlers.drag.activate(),t=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id==e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var s=[];for(var r in i)s.push(new OpenLayers.Rule({symbolizer:i[r],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:r})}));this.styles[e].addRules(s)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var e=0,t=this.strategies.length;t>e;e++)this.strategies[e].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,n=new Array(i),s=0;i>s;++s)n[s]=t[s].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var i=this.renderers[e],n="function"==typeof i?i:OpenLayers.Renderer[i];if(n&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!i){this.renderer.root.style.visibility="hidden";var s=this.map.getSize(),r=s.w,a=s.h,o=r/2*this.ratio-r/2,l=a/2*this.ratio-a/2;o+=this.map.layerContainerOriginPx.x,o=-Math.round(o),l+=this.map.layerContainerOriginPx.y,l=-Math.round(l),this.div.style.left=o+"px",this.div.style.top=l+"px";var u=this.map.getExtent().scale(this.ratio);if(n=this.renderer.setExtent(u,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&n)for(var h in this.unrenderedFeatures){var c=this.unrenderedFeatures[h];this.drawFeature(c)}}if(!this.drawn||t||!n){this.drawn=!0;for(var c,h=0,p=this.features.length;p>h;h++)this.renderer.locked=h!==p-1,c=this.features[h],this.drawFeature(c)}},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var e=this.div.style.display;e!=this.renderer.root.style.display&&(this.renderer.root.style.display=e)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e},s=this.events.triggerEvent("beforefeaturesadded",n);if(s===!1)return;e=n.features}for(var r=[],a=0,o=e.length;o>a;a++){this.renderer.locked=a!=e.length-1?!0:!1;var l=e[a];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}r.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:r})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){this.renderer.locked=0!=n&&e[n-1].geometry?!0:!1;var s=e[n];delete this.unrenderedFeatures[s.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:s}),this.features=OpenLayers.Util.removeItem(this.features,s),s.layer=null,s.geometry&&this.renderer.eraseFeatures(s),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,s)&&OpenLayers.Util.removeItem(this.selectedFeatures,s),i&&this.events.triggerEvent("featureremoved",{feature:s})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var n,s=i.length-1;s>=0;s--)n=i[s],t&&this.events.triggerEvent("beforefeatureremoved",{feature:n}),n.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:n});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var n=this.renderer.drawFeature(e,t);n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,i=this.renderer.getFeatureIdFromEvent(e);return i&&(t="string"==typeof i?this.getFeatureById(i):i),t},getFeatureBy:function(e,t){for(var i=null,n=0,s=this.features.length;s>n;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,s=this.features.length,r=[];for(i=0;s>i;i++)n=this.features[i],n&&n.attributes&&n.attributes[e]===t&&r.push(n);return r},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,n=0,s=t.length;s>n;n++)i=t[n].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,n=0;n<i.length;n++)if(t=i[n].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,n,s,r=this.layers||[this.layer];for(n=0;n<r.length;++n)for(t=r[n],s=0;t.selectedFeatures.length>s;)i=t.selectedFeatures[s],e&&e.except==i?++s:this.unselect(i)},clickFeature:function(e){if(!this.hover){var t=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;t?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var n=this.selectStyle||this.renderIntent;t.drawFeature(e,n),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter==this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;t!==!1&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),t!==!1&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),i=this.map.getLonLatFromPixel({x:e.right,y:e.top}),n=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var s=this.multiple;this.multiple=!0;var r=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:r});for(var a,o=0;o<r.length;++o){a=r[o];for(var l=0,u=a.features.length;u>l;++l){var h=a.features[l];h.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME)>-1)&&n.toGeometry().intersects(h.geometry)&&-1==OpenLayers.Util.indexOf(a.selectedFeatures,h)&&this.select(h)}}this.multiple=s,this.events.triggerEvent("boxselectionend",{layers:r})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;t>e;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;i>t;t++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[t],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);
var i=this,n={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.standalone===!1&&(this.selectControl=new OpenLayers.Control.SelectFeature(e,n));var s={documentDrag:this.documentDrag,geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(e,t){i.dragStart.apply(i,[e,t])},onDrag:function(e,t){i.dragVertex.apply(i,[e,t])},onComplete:function(e){i.dragComplete.apply(i,[e])},featureCallbacks:{over:function(e){(i.standalone!==!0||e._sketch||i.feature===e)&&i.dragControl.overFeature.apply(i.dragControl,[e])}}};this.dragControl=new OpenLayers.Control.DragFeature(e,s);var r={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,r)}},destroy:function(){this.layer=null,this.standalone||this.selectControl.destroy(),this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.dragControl.deactivate();var t=this.feature,i=t&&t.geometry&&t.layer;this.standalone===!1?(i&&this.selectControl.unselect.apply(this.selectControl,[t]),this.selectControl.deactivate()):i&&this.unselectFeature(t),this.handlers.keyboard.deactivate(),e=!0}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){this.standalone&&this.beforeSelectFeature(e)===!1||(this.feature=e,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature));var t=e.modified;!e.geometry||t&&t.geometry||(this._originalGeometry=e.geometry.clone())},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.feature=null,this.dragControl.deactivate(),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e,t){e==this.feature||e.geometry.parent||e==this.dragHandle||e==this.radiusHandle||(this.standalone===!1&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),(null==this.geometryTypes||-1!=OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME))&&(this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[e]),this.dragControl.overFeature.apply(this.dragControl,[e]),this.dragControl.lastPixel=t,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=t,this.dragControl.handlers.drag.last=t))},dragVertex:function(e,t){this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=e&&(this.feature=e),this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t})):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent)),this.layer.drawFeature(e)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,t)){var i=this.dragControl.feature;i&&-1!=OpenLayers.Util.indexOf(this.vertices,i)&&!this.dragControl.handlers.drag.dragging&&i.geometry.parent&&(i.geometry.parent.removeComponent(i.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function e(i){var n,s,r,a;if("OpenLayers.Geometry.Point"==i.CLASS_NAME)s=new OpenLayers.Feature.Vector(i),s._sketch=!0,s.renderIntent=t.vertexRenderIntent,t.vertices.push(s);else{var o=i.components.length;for("OpenLayers.Geometry.LinearRing"==i.CLASS_NAME&&(o-=1),n=0;o>n;++n)r=i.components[n],"OpenLayers.Geometry.Point"==r.CLASS_NAME?(s=new OpenLayers.Feature.Vector(r),s._sketch=!0,s.renderIntent=t.vertexRenderIntent,t.vertices.push(s)):e(r);if(t.createVertices&&"OpenLayers.Geometry.MultiPoint"!=i.CLASS_NAME)for(n=0,a=i.components.length;a-1>n;++n){var l=i.components[n],u=i.components[n+1];if("OpenLayers.Geometry.Point"==l.CLASS_NAME&&"OpenLayers.Geometry.Point"==u.CLASS_NAME){var h=(l.x+u.x)/2,c=(l.y+u.y)/2,p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(h,c),null,t.virtualStyle);p.geometry.parent=i,p._index=n+1,p._sketch=!0,t.virtualVertices.push(p)}}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),n=new OpenLayers.Feature.Vector(i);i.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},n._sketch=!0,this.dragHandle=n,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),s=new OpenLayers.Geometry.Point(t.right,t.bottom),r=new OpenLayers.Feature.Vector(s),a=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,o=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,l=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;s.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var s=this.x-n.x,r=this.y-n.y,u=s-t,h=r-i;if(l){var c=Math.atan2(h,u),p=Math.atan2(r,s),d=p-c;d*=180/Math.PI,e.rotate(d,n)}if(a){var m,f;if(o)m=r/h,f=s/u/m;else{var y=Math.sqrt(u*u+h*h),g=Math.sqrt(s*s+r*r);m=g/y}e.resize(m,n,f)}},r._sketch=!0,this.radiusHandle=r,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.standalone||this.selectControl.setMap(e),this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},i)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var n=""+t.x+t.y+t.z;i=this.selectUrl(n,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),n=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),s=this.getServerZoom();if(this.wrapDateLine){var r=Math.pow(2,s);i=(i%r+r)%r}return{x:i,y:n,z:s}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e);var t=e.name||"Bing "+(e.type||this.type),i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),t="//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e),i=document.createElement("script");i.type="text/javascript",i.src=t,i.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(i)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],t=e.imageUrl.replace("{quadkey}","${quadkey}");t=t.replace("{culture}",this.culture),this.url=[];for(var i=0;i<e.imageUrlSubdomains.length;++i)this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0),this.updateAttribution()},drawTileFromQueue:function(){this.url&&OpenLayers.Layer.XYZ.prototype.drawTileFromQueue.apply(this,arguments)},getURL:function(e){for(var t=this.getXYZ(e),i=t.x,n=t.y,s=t.z,r=[],a=s;a>0;--a){var o="0",l=1<<a-1;0!=(i&l)&&o++,0!=(n&l)&&(o++,o++),r.push(o)}var u=r.join(""),h=this.selectUrl(""+i+n+s,this.url);return OpenLayers.String.format(h,{quadkey:u})},updateAttribution:function(){var e=this.metadata;if(e.resourceSets&&this.map&&this.map.center){var t,i,n,s,r,a,o,l=e.resourceSets[0].resources[0],u=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),h=l.imageryProviders,c=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),p="";for(i=0,n=h.length;n>i;++i)for(t=h[i],s=0,r=t.coverageAreas.length;r>s;++s)o=t.coverageAreas[s],a=OpenLayers.Bounds.fromArray(o.bbox,!0),u.intersectsBounds(a)&&c<=o.zoomMax&&c>=o.zoomMin&&(p+=t.attribution+" ");this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:e.brandLogoUri,copyrights:p}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Bing(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e,this.initLayer();var t=document.getElementById(this._callbackId);t.parentNode.removeChild(t),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={features:[]};this.readNode(e,t);for(var i=[],n=0,s=t.features.length;s>n;n++){var r=t.features[n];this.internalProjection&&this.externalProjection&&r.components[0]&&r.components[0].transform(this.externalProjection,this.internalProjection);var a=new OpenLayers.Feature.Vector(r.components[0],r.attributes);i.push(a)}return i},readers:{sa:{SamplingPoint:function(e,t){if(!t.attributes){var i={attributes:{}};t.features.push(i),t=i}t.attributes.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},position:function(e,t){this.readChildNodes(e,t)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){this.readChildNodes(e,t)},featureMember:function(e,t){var i={attributes:{}};t.features.push(i),this.readChildNodes(e,i)},name:function(e,t){t.attributes.name=this.getChildValue(e)},pos:function(e,t){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(e.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[e,t])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(e){for(var t=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),i=0,n=e.fois.length;n>i;i++)this.writeNode("FeatureOfInterestId",{foi:e.fois[i]},t);return t},FeatureOfInterestId:function(e){var t=this.createElementNSPlus("FeatureOfInterestId",{value:e.foi});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={measurements:[],observations:[]};return this.readNode(e,t),t},write:function(e){var t=this.writeNode("sos:GetObservation",e);return t.setAttribute("xmlns:om",this.namespaces.om),t.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},readers:{om:{ObservationCollection:function(e,t){t.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},member:function(e,t){this.readChildNodes(e,t)},Measurement:function(e,t){var i={};t.measurements.push(i),this.readChildNodes(e,i)},Observation:function(e,t){var i={};t.observations.push(i),this.readChildNodes(e,i)},samplingTime:function(e,t){var i={};t.samplingTime=i,this.readChildNodes(e,i)},observedProperty:function(e,t){t.observedProperty=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},procedure:function(e,t){t.procedure=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},featureOfInterest:function(e,t){var i={features:[]};t.fois=[],t.fois.push(i),this.readChildNodes(e,i);for(var n=[],s=0,r=i.features.length;r>s;s++){var a=i.features[s];n.push(new OpenLayers.Feature.Vector(a.components[0],a.attributes))}i.features=n},result:function(e,t){var i={};t.result=i,""!==this.getChildValue(e)?(i.value=this.getChildValue(e),i.uom=e.getAttribute("uom")):this.readChildNodes(e,i)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(e,t){var i={};t.timeInstant=i,this.readChildNodes(e,i)},timePosition:function(e,t){t.timePosition=this.getChildValue(e)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(e){var t=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",e,t),e.eventTime&&this.writeNode("eventTime",e,t);for(var i in e.procedures)this.writeNode("procedure",e.procedures[i],t);for(var n in e.observedProperties)this.writeNode("observedProperty",e.observedProperties[n],t);return e.foi&&this.writeNode("featureOfInterest",e.foi,t),this.writeNode("responseFormat",e,t),e.resultModel&&this.writeNode("resultModel",e,t),e.responseMode&&this.writeNode("responseMode",e,t),t},featureOfInterest:function(e){var t=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",e.objectId,t),t},ObjectID:function(e){return this.createElementNSPlus("ObjectID",{value:e})},responseFormat:function(e){return this.createElementNSPlus("responseFormat",{value:e.responseFormat})},procedure:function(e){return this.createElementNSPlus("procedure",{value:e})},offering:function(e){return this.createElementNSPlus("offering",{value:e.offering})},observedProperty:function(e){return this.createElementNSPlus("observedProperty",{value:e})},eventTime:function(e){var t=this.createElementNSPlus("eventTime");return"latest"===e.eventTime&&this.writeNode("ogc:TM_Equals",e,t),t},resultModel:function(e){return this.createElementNSPlus("resultModel",{value:e.resultModel})},responseMode:function(e){return this.createElementNSPlus("responseMode",{value:e.responseMode})}},ogc:{TM_Equals:function(e){var t=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},t),"latest"===e.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})}},gml:{TimeInstant:function(e){var t=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",e,t),t},timePosition:function(e){var t=this.createElementNSPlus("gml:timePosition",{value:e.value});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,i=!1,n=!1,s=OpenLayers.Event.element(e);null!=s&&!n&&!t;){if(!t)try{var r;if(s.currentStyle)r=s.currentStyle.overflow;else{var a=document.defaultView.getComputedStyle(s,null);r=a.getPropertyValue("overflow")}t=r&&"auto"==r||"scroll"==r}catch(o){}if(!i&&(i=OpenLayers.Element.hasClass(s,"olScrollable"),!i))for(var l=0,u=this.map.layers.length;u>l;l++){var h=this.map.layers[l];if(s==h.div||s==h.pane){i=!0;break}}n=s==this.map.div,s=s.parentNode}if(!t&&n){if(i){var c=0;e||(e=window.event),e.wheelDelta?(c=e.wheelDelta,0===c%160&&(c=.75*c),c/=120):e.detail&&(c=-(e.detail/Math.abs(e.detail))),this.delta=this.delta+c,this.interval?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(e)},this),this.interval)):this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),0>t?this.callback("down",[e,this.cumulative?t:-1]):this.callback("up",[e,this.cumulative?t:1]))},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",e),OpenLayers.Event.observe(window,"mousewheel",e),OpenLayers.Event.observe(document,"mousewheel",e),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",e),OpenLayers.Event.stopObserving(window,"mousewheel",e),OpenLayers.Event.stopObserving(document,"mousewheel",e),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var n=0,s=e.propertyNames.length;s>n;n++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[n]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,s=this.order.length;s-n>1;){i=parseInt((n+s)/2);var r=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));r>0?n=i:s=i}return this.order.splice(s,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(s)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var n=e.getZIndex(t),s=0;if(i){var r=e.getZIndex(i);s=n-r}return s},Z_ORDER_DRAWING_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===n){var s=i._boundsBottom-t._boundsBottom;n=0===s?1:s}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var s,r=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/r),a=this.map.getMaxExtent();a.right>e.left&&a.right<e.right?s=!0:a.left>e.left&&a.left<e.right&&(s=!1),(s!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=s===!0?a.getWidth()/n:0),this.rightOfDateLine=s}return i},getNodeType:function(){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,s=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var r=0,a=e.components.length;a>r;r++)s=this.drawGeometry(e.components[r],t,i)&&s;return s}s=!1;var o=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):o=!0,s=this.redrawNode(e.id,e,t,i)),0==s){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(o=!0),l.parentNode.removeChild(l))}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return s},redrawNode:function(e,t,i,n){i=this.applyDefaultSymbolizer(i);var s=this.nodeFactory(e,this.getNodeType(t,i));s._featureId=n,s._boundsBottom=t.getBounds().bottom,s._geometryClass=t.CLASS_NAME,s._style=i;var r=this.drawGeometryNode(s,t,i);if(r===!1)return!1;if(s=r.node,this.indexer){var a=this.indexer.insert(s);a?this.vectorRoot.insertBefore(s,a):this.vectorRoot.appendChild(s)}else s.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(s);return this.postDraw(s),r.complete},redrawBackgroundNode:function(e,t,i){var n=OpenLayers.Util.extend({},i);return n.externalGraphic=n.backgroundGraphic,n.graphicXOffset=n.backgroundXOffset,n.graphicYOffset=n.backgroundYOffset,n.graphicZIndex=n.backgroundGraphicZIndex,n.graphicWidth=n.backgroundWidth||n.graphicWidth,n.graphicHeight=n.backgroundHeight||n.graphicHeight,n.backgroundGraphic=null,n.backgroundXOffset=null,n.backgroundYOffset=null,n.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,n,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,s={isFilled:void 0===i.fill?!0:i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(s.isFilled=!1,s.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":s.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=s,0!=n?{node:this.setStyle(e,i,s,t),complete:n}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);i&&this.textRoot.removeChild(i)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,n=i?i:t||e.srcElement;return n._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;n>i;i++)this.eraseGeometry(e.components[i],t);else{var s=OpenLayers.Util.getElement(e.id);if(s&&s.parentNode&&(s.geometry&&(s.geometry.destroy(),s.geometry=null),s.parentNode.removeChild(s),this.indexer&&this.indexer.remove(s),s._style.backgroundGraphic)){var r=e.id+this.BACKGROUND_ID_SUFFIX,a=OpenLayers.Util.getElement(r);a&&a.parentNode&&a.parentNode.removeChild(a)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(e){var t=this.root;
e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){e=e||window.location.href;var t=OpenLayers.Util.getParameters(e),i=e.indexOf("#");return i>0&&(e="?"+e.substring(i+1,e.length),OpenLayers.Util.extend(t,OpenLayers.Util.getParameters(e))),t},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,t=this.map.controls.length;t>e;e++){var i=this.map.controls[e];if(i!=this&&"OpenLayers.Control.ArgParser"==i.CLASS_NAME){i.displayProjection!=this.displayProjection&&(this.displayProjection=i.displayProjection);break}}if(e==this.map.controls.length){var n=this.getParameters();n.layers&&(this.layers=n.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),n.lat&&n.lon&&(this.center=new OpenLayers.LonLat(parseFloat(n.lon),parseFloat(n.lat)),n.zoom&&(this.zoom=parseFloat(n.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var e=0,t=this.layers.length;t>e;e++){var i=this.map.layers[e],n=this.layers.charAt(e);"B"==n?this.map.setBaseLayer(i):("T"==n||"F"==n)&&i.setVisibility("T"==n)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(e,t,i){null===e||"object"!=typeof e||OpenLayers.Util.isElement(e)?(OpenLayers.Control.prototype.initialize.apply(this,[i]),this.element=OpenLayers.Util.getElement(e),this.base=t||document.location.href):(i=e,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[i]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,t=this.map.controls.length;t>e;e++){var i=this.map.controls[e];if(i.CLASS_NAME==this.argParserClass.CLASS_NAME){i.displayProjection!=this.displayProjection&&(this.displayProjection=i.displayProjection);break}}e==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var e=this.anchor?"#":"?",t=this.base,i=null;-1!=t.indexOf("#")&&0==this.anchor&&(i=t.substring(t.indexOf("#"),t.length)),-1!=t.indexOf(e)&&(t=t.substring(0,t.indexOf(e)));var n=t.split("#");t=n[0]+e+OpenLayers.Util.getParameterString(this.createParams()),i&&(t+=i),this.anchor&&!this.element?window.location.href=t:this.element.href=t},createParams:function(e,t,i){e=e||this.map.getCenter();var n=OpenLayers.Util.getParameters(this.base);if(e){n.zoom=t||this.map.getZoom();var s=e.lat,r=e.lon;if(this.displayProjection){var a=OpenLayers.Projection.transform({x:r,y:s},this.map.getProjectionObject(),this.displayProjection);r=a.x,s=a.y}n.lat=Math.round(1e5*s)/1e5,n.lon=Math.round(1e5*r)/1e5,i=i||this.map.layers,n.layers="";for(var o=0,l=i.length;l>o;o++){var u=i[o];n.layers+=u.isBaseLayer?u==this.map.baseLayer?"B":"0":u.getVisibility()?"T":"F"}}return n},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var n=[];n.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,n)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),s=this.getServerZoom(),r=this.serviceVersion+"/"+this.layername+"/"+s+"/"+i+"/"+n+"."+this.type,a=this.url;return OpenLayers.Util.isArray(a)&&(a=this.selectUrl(r,a)),a+r},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){return OpenLayers.Strategy.prototype.activate.apply(this,arguments)?(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this}),!0):!1},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart"),t.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,t.map.getProjectionObject()),filter:t.filter},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e,t){var i=this.layer;i.destroyFeatures();var n=t.features;if(n&&n.length>0){if(!e.equals(i.projection))for(var s,r=0,a=n.length;a>r;++r)s=n[r].geometry,s&&s.transform(i.projection,e);i.addFeatures(n)}i.events.triggerEvent("loadend",{response:t})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),i=t.zoomIn,n=t.zoomOut,s=this.map.events;return n.parentNode!==e&&(s=this.events,s.attachToElement(n.parentNode)),s.register("buttonclick",this,this.onZoomClick),this.zoomInLink=i,this.zoomOutLink=n,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),i=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),i||(i=document.createElement("a"),i.href="#zoomOut",i.appendChild(document.createTextNode(this.zoomOutText)),i.className="olControlZoomOut",e.appendChild(i)),OpenLayers.Element.addClass(i,"olButton"),{zoomIn:t,zoomOut:i}},onZoomClick:function(e){var t=e.buttonElement;t===this.zoomInLink?this.map.zoomIn():t===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(e,t){if(e.length<2)throw new Error("At least two point features have to be added to create a line from");for(var i,n,s,r=new Array(e.length-1),a=0,o=e.length;o>a;a++){if(i=e[a],s=i.geometry){if("OpenLayers.Geometry.Point"!=s.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else{var l=i.lonlat;s=new OpenLayers.Geometry.Point(l.lon,l.lat)}if(a>0){var u=null!=this.dataFrom?e[a+this.dataFrom].data||e[a+this.dataFrom].attributes:null,h=null!=this.styleFrom?e[a+this.styleFrom].style:null,c=new OpenLayers.Geometry.LineString([n,s]);r[a-1]=new OpenLayers.Feature.Vector(c,u,h)}n=s}this.addFeatures(r,t)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){var t;return t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,n,s=e.params.LAYERS,r=(OpenLayers.Util.isArray(s)?s[0]:s).split(":");r.length>1&&(n=r[0]),i=r.pop();var a={url:e.url,featureType:i,featurePrefix:n,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,a))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.markers.length;i>t;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var i=0,n=this.markers.length;n>i;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),this.opacity<1&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var i=e.draw(t);this.div.appendChild(i)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;i>t;t++){var n=this.markers[t];e.extend(n.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(e,t){this.direction=e,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[t])},trigger:function(){if(this.map){var e=OpenLayers.Function.bind(function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-e("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,e("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-e("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(e("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetDomain.DEFAULTS);var t=OpenLayers.Format.CSWGetDomain["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetDomain version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetDomainResponse:function(e,t){this.readChildNodes(e,t)},DomainValues:function(e,t){OpenLayers.Util.isArray(t.DomainValues)||(t.DomainValues=[]);for(var i=e.attributes,n={},s=0,r=i.length;r>s;++s)n[i[s].name]=i[s].nodeValue;this.readChildNodes(e,n),t.DomainValues.push(n)},PropertyName:function(e,t){t.PropertyName=this.getChildValue(e)},ParameterName:function(e,t){t.ParameterName=this.getChildValue(e)},ListOfValues:function(e,t){OpenLayers.Util.isArray(t.ListOfValues)||(t.ListOfValues=[]),this.readChildNodes(e,t.ListOfValues)},Value:function(e,t){for(var i=e.attributes,n={},s=0,r=i.length;r>s;++s)n[i[s].name]=i[s].nodeValue;n.value=this.getChildValue(e),t.push({Value:n})},ConceptualScheme:function(e,t){t.ConceptualScheme={},this.readChildNodes(e,t.ConceptualScheme)},Name:function(e,t){t.Name=this.getChildValue(e)},Document:function(e,t){t.Document=this.getChildValue(e)},Authority:function(e,t){t.Authority=this.getChildValue(e)},RangeOfValues:function(e,t){t.RangeOfValues={},this.readChildNodes(e,t.RangeOfValues)},MinValue:function(e,t){for(var i=e.attributes,n={},s=0,r=i.length;r>s;++s)n[i[s].name]=i[s].nodeValue;n.value=this.getChildValue(e),t.MinValue=n},MaxValue:function(e,t){for(var i=e.attributes,n={},s=0,r=i.length;r>s;++s)n[i[s].name]=i[s].nodeValue;n.value=this.getChildValue(e),t.MaxValue=n}}},write:function(e){var t=this.writeNode("csw:GetDomain",e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetDomain:function(e){var t=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return e.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",e.PropertyName||this.PropertyName,t):(e.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",e.ParameterName||this.ParameterName,t),this.readChildNodes(t,e),t},PropertyName:function(e){var t=this.createElementNSPlus("csw:PropertyName",{value:e});return t},ParameterName:function(e){var t=this.createElementNSPlus("csw:ParameterName",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(e){var t=new OpenLayers.Format.ArcXML,i=t.read(e);return i.features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.layer&&this.setLayer(this.options.layer);var t=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(t,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(e){this.active?(this.deactivate(),this.layer=e,this.activate()):this.layer=e},setTargets:function(e){if(this.targets=[],e&&e.length)for(var t,i=0,n=e.length;n>i;++i)t=e[i],t instanceof OpenLayers.Layer.Vector?this.addTargetLayer(t):this.addTarget(t)},addTargetLayer:function(e){this.addTarget({layer:e})},addTarget:function(e){e=OpenLayers.Util.applyDefaults(e,this.defaults),e.nodeTolerance=e.nodeTolerance||e.tolerance,e.vertexTolerance=e.vertexTolerance||e.tolerance,e.edgeTolerance=e.edgeTolerance||e.tolerance,this.targets.push(e)},removeTargetLayer:function(e){for(var t,i=this.targets.length-1;i>=0;--i)t=this.targets[i],t.layer===e&&this.removeTarget(t)},removeTarget:function(e){return OpenLayers.Util.removeItem(this.targets,e)},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,e},onSketchModified:function(e){this.feature=e.feature,this.considerSnapping(e.vertex,e.vertex)},onVertexModified:function(e){this.feature=e.feature;var t=this.layer.map.getLonLatFromViewPortPx(e.pixel);this.considerSnapping(e.vertex,new OpenLayers.Geometry.Point(t.lon,t.lat))},considerSnapping:function(e,t){for(var i,n,s={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},r=!1,a=0,o=this.targets.length;o>a;++a)if(n=this.targets[a],i=this.testTarget(n,t)){if(this.greedy){s=i,s.target=n,r=!0;break}(i.rank<s.rank||i.rank===s.rank&&i.dist<s.dist)&&(s=i,s.target=n,r=!0)}if(r){var l=this.events.triggerEvent("beforesnap",{point:e,x:s.x,y:s.y,distance:s.dist,layer:s.target.layer,snapType:this.precedence[s.rank]});l!==!1?(e.x=s.x,e.y=s.y,this.point=e,this.events.triggerEvent("snap",{point:e,snapType:this.precedence[s.rank],layer:s.target.layer,distance:s.dist})):r=!1}this.point&&!r&&(e.x=t.x,e.y=t.y,this.point=null,this.events.triggerEvent("unsnap",{point:e}))},testTarget:function(e,t){var i=this.layer.map.getResolution();if("minResolution"in e&&i<e.minResolution)return null;if("maxResolution"in e&&i>=e.maxResolution)return null;for(var n,s,r,a,o,l,u,h={node:this.getGeoTolerance(e.nodeTolerance,i),vertex:this.getGeoTolerance(e.vertexTolerance,i),edge:this.getGeoTolerance(e.edgeTolerance,i)},c=Math.max(h.node,h.vertex,h.edge),p={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},d=!1,m=e.layer.features,f=this.precedence.length,y=new OpenLayers.LonLat(t.x,t.y),g=0,v=m.length;v>g;++g)if(n=m[g],n!==this.feature&&!n._sketch&&n.state!==OpenLayers.State.DELETE&&(!e.filter||e.filter.evaluate(n))&&n.atPoint(y,c,c))for(var b=0,L=Math.min(p.rank+1,f);L>b;++b)if(s=this.precedence[b],e[s])if("edge"===s){if(o=n.geometry.distanceTo(t,{details:!0}),l=o.distance,l<=h[s]&&l<p.dist){p={rank:b,dist:l,x:o.x0,y:o.y0},d=!0;break}}else{r=n.geometry.getVertices("node"===s),u=!1;for(var O=0,w=r.length;w>O;++O)a=r[O],l=a.distanceTo(t),l<=h[s]&&(b<p.rank||b===p.rank&&l<p.dist)&&(p={rank:b,dist:l,x:a.x,y:a.y},d=!0,u=!0);if(u)break}return d?p:null},getGeoTolerance:function(e,t){t!==this.resolution&&(this.resolution=t,this.geoToleranceCache={});var i=this.geoToleranceCache[e];return void 0===i&&(i=e*t,this.geoToleranceCache[e]=i),i},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var i={};if(this.readNode(e,i),void 0===i.service){var n=new OpenLayers.Format.OGCExceptionReport;i.error=n.read(t)}return i},readers:{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e){var t={};t.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var i={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};return isNaN(i.x)&&isNaN(i.y)||(t.res=i),t},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var i,n;t.capability?(n=t.capability,i=t):n=t;var s=e.getAttributeNode("queryable"),r=s&&s.specified?e.getAttribute("queryable"):null;s=e.getAttributeNode("cascaded");var a=s&&s.specified?e.getAttribute("cascaded"):null;s=e.getAttributeNode("opaque");var o=s&&s.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),u=e.getAttribute("fixedWidth"),h=e.getAttribute("fixedHeight"),c=i||{},p=OpenLayers.Util.extend,d={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?p({},c.srs):{},metadataURLs:[],bbox:i?p({},c.bbox):{},llbbox:c.llbbox,dimensions:i?p({},c.dimensions):{},authorityURLs:i?p({},c.authorityURLs):{},identifiers:{},keywords:[],queryable:r&&""!==r?"1"===r||"true"===r:c.queryable||!1,cascaded:null!==a?parseInt(a):c.cascaded||0,opaque:o?"1"===o||"true"===o:c.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:c.noSubsets||!1,fixedWidth:null!=u?parseInt(u):c.fixedWidth||0,fixedHeight:null!=h?parseInt(h):c.fixedHeight||0,minScale:c.minScale,maxScale:c.maxScale,attribution:c.attribution};if(t.nestedLayers.push(d),d.capability=n,this.readChildNodes(e,d),delete d.capability,d.name){var m=d.name.split(":"),f=n.request,y=f.getfeatureinfo;m.length>0&&(d.prefix=m[0]),n.layers.push(d),void 0===d.formats&&(d.formats=f.getmap.formats),void 0===d.infoFormats&&y&&(d.infoFormats=y.formats)}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i,this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i),this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name"),n={};this.readChildNodes(e,n),t.authorityURLs[i]=n.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS"),t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min"),n=e.getAttribute("max"),s=Math.pow(2,.5),r=OpenLayers.INCHES_PER_UNIT.m;t.maxScale=parseFloat((i/s*r*OpenLayers.DOTS_PER_INCH).toPrecision(13)),t.minScale=parseFloat((n/s*r*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),n={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[n.name]=n},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t.dimensions){var n=t.dimensions[i];n.nearestVal="1"===e.getAttribute("nearestValue"),n.multipleVal="1"===e.getAttribute("multipleValues"),n.current="1"===e.getAttribute("current"),n["default"]=e.getAttribute("default")||"";var s=this.getChildValue(e);n.values=s.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var i=this.getChildValue(e),n=i.split(/ +/),s=0,r=n.length;r>s;s++)t.srs[n[s]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(i.status>=200&&i.status<300){var n=this.parseResponse(i,t.readOptions);n&&n.success!==!1?(t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,n):e.features=n,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=n)}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||i.length<=0)return null;var n=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t);if(!this.featureNS){var s=this.readFormat||this.format;this.featureNS=s.featureNS,s.autoConfig=!1,this.geometryName||this.setGeometryName(s.geometryName)}return n},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,n=i.responseXML;n&&n.documentElement||(n=i.responseText);var s=this.format.read(n)||{};e.insertIds=s.insertIds||[],s.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=s),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),new OpenLayers.Protocol.Response({requestType:"commit"});var i=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),n=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});
t.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var s=this.format.writeNode("ogc:Filter",e);n.appendChild(s),i.appendChild(n);var r=OpenLayers.Format.XML.prototype.write.apply(this.format,[i]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:r})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0):!1},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(e)?this.lastUp&&this.lastUp.equals(e.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var n=!0;if(null!=i&&e&&t){var s=e.distanceTo(t);s>i&&(n=!1)}return n},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,n=this.line.geometry.components[i];!n||isNaN(n.x)||isNaN(n.y)||this.insertXY(n.x+e,n.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e),n=t*Math.sin(e);this.insertDeltaXY(i,n)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var n=this.line.geometry.components[i],s=this.line.geometry.components[i-1],r=Math.atan2(n.y-s.y,n.x-s.x);this.insertDirectionLength(180*r/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,n=t[i],s=e.removeComponent(n);return s&&(this.redoStack||(this.redoStack=[]),this.redoStack.push(n),this.drawFeature()),s},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(e,t,i){var n=i||OpenLayers.Spherical.DEFAULT_RADIUS,s=Math.sin(Math.PI*(t.lon-e.lon)/360),r=Math.sin(Math.PI*(t.lat-e.lat)/360),a=r*r+s*s*Math.cos(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180);return 2*n*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},OpenLayers.Spherical.computeHeading=function(e,t){var i=Math.sin(Math.PI*(e.lon-t.lon)/180)*Math.cos(Math.PI*t.lat/180),n=Math.cos(Math.PI*e.lat/180)*Math.sin(Math.PI*t.lat/180)-Math.sin(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180)*Math.cos(Math.PI*(e.lon-t.lon)/180);return 180*Math.atan2(i,n)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var t,i=this.layers||e.layers;for(t=i.length-1;t>=0;--t)this.addLayer({layer:i[t]});this.layers||e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(e){e.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(e){e.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(e){if(this.active){var t=e.tile;if(t instanceof OpenLayers.Tile.Image&&!t.crossOriginKeyword&&"data:"!==t.url.substr(0,5)){var i=OpenLayers.Request.makeSameOrigin(t.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[i]=t.url,t.url=i}}},cache:function(e){if(this.active&&window.localStorage){var t=e.tile;if(t instanceof OpenLayers.Tile.Image&&"data:"!==t.url.substr(0,5))try{var i=t.getCanvasContext();if(i){var n=OpenLayers.Control.CacheWrite.urlMap,s=n[t.url]||t.url;window.localStorage.setItem("olCache_"+s,i.canvas.toDataURL(this.imageFormat)),delete n[t.url]}}catch(r){var a=r.name||r.message;a&&this.quotaRegEx.test(a)?this.events.triggerEvent("cachefull",{tile:t}):OpenLayers.Console.error(r.toString())}}},destroy:function(){if(this.layers||this.map){var e,t=this.layers||this.map.layers;for(e=t.length-1;e>=0;--e)this.removeLayer({layer:t[e]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var e,t;for(e=window.localStorage.length-1;e>=0;--e)t=window.localStorage.key(e),"olCache_"===t.substr(0,8)&&window.localStorage.removeItem(t)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);var e={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,e)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var t=0,i=this.map.layers.length;i>t;t++){var n=this.map.layers[t];n.attribution&&n.getVisibility()&&-1===OpenLayers.Util.indexOf(e,n.attribution)&&e.push(n.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:e.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,n=(new Date).getTime(),s=0,r=this.points.length;r>s&&(i=this.points[s],!(n-i.tick>this.delay));s++)t=i;if(t){var a=(new Date).getTime()-t.tick,o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=o/a;if(!(0==l||l<this.threshold)){var u=Math.asin((e.y-t.xy.y)/o);return t.xy.x<=e.x&&(u=Math.PI-u),{speed:l,theta:u}}}},move:function(e,t){var i=e.speed,n=Math.cos(e.theta),s=-Math.sin(e.theta),r=(new Date).getTime(),a=0,o=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-r,l=-this.deceleration*Math.pow(e,2)/2+i*e,u=l*n,h=l*s,c={};c.end=!1;var p=-this.deceleration*e+i;0>=p&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,c.end=!0),c.x=u-a,c.y=h-o,a=u,o=h,t(c.x,c.y,c.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,t,i){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,i]),this.location=t,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(e){var t=e.responseXML;if(t&&t.documentElement||(t=OpenLayers.Format.XML.prototype.read(e.responseText)),this.useFeedTitle){var i=null;try{i=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(n){i=t.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}var s={};OpenLayers.Util.extend(s,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(s.externalProjection=this.projection,s.internalProjection=this.map.getProjectionObject());for(var r=new OpenLayers.Format.GeoRSS(s),a=r.read(t),o=0,l=a.length;l>o;o++){var u={},h=a[o];if(h.geometry){var c=h.attributes.title?h.attributes.title:"Untitled",p=h.attributes.description?h.attributes.description:"No description.",d=h.attributes.link?h.attributes.link:"",m=h.geometry.getBounds().getCenterLonLat();if(u.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),u.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),c||p){u.title=c,u.description=p;var f='<div class="olLayerGeoRSSClose">[x]</div>';f+='<div class="olLayerGeoRSSTitle">',d&&(f+='<a class="link" href="'+d+'" target="_blank">'),f+=c,d&&(f+="</a>"),f+="</div>",f+='<div style="" class="olLayerGeoRSSDescription">',f+=p,f+="</div>",u.popupContentHTML=f}var h=new OpenLayers.Feature(this,m,u);this.features.push(h);var y=h.createMarker();y.events.register("click",h,this.markerClick),this.addMarker(y)}}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;n>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!t){var s=this.createPopup();OpenLayers.Event.observe(s.div,"click",OpenLayers.Function.bind(function(){for(var e=0,t=this.layer.map.popups.length;t>e;e++)this.layer.map.removePopup(this.layer.map.popups[e])},this)),this.layer.map.addPopup(s)}OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS"),t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),n={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[n.name]=n},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(i)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]),t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature")),t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,i,n){var s=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),s.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!(!this.yx[e]&&!OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),i={},n=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,n):e.toArray(n),i.WIDTH=t.w,i.HEIGHT=t.h;var s=this.getFullRequestString(i);return s},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e){var t=this.map.getProjectionObject(),i=this.projection&&this.projection.equals(t)?this.projection.getCode():t.getCode(),n="none"==i?null:i;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=n:this.params.SRS=n,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),s=-Math.round(e.top/t);return this.getFullRequestString({t:s,l:n,s:i})},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,s=i*this.tileSize.h,r=e.left,a=Math.floor(r/n)-this.buffer,o=r/n-a,l=-o*this.tileSize.w,u=a*n,h=e.top,c=Math.ceil(h/s)+this.buffer,p=c-h/s,d=-(p+1)*this.tileSize.h,m=c*s;return{tilelon:n,tilelat:s,tileoffsetlon:u,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d,startcol:a,startrow:c}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,n=t*this.tileSize.h,s=this.getLonLatFromViewPortPx(e),r=i*Math.floor(s.lon/i),a=n*Math.floor(s.lat/n);return new OpenLayers.Bounds(r,a,r+i,a+n)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(e){var t=this.getParser(),i={queryable:e.queryable,visibility:e.visibility,name:e.params.LAYERS,title:e.name,"abstract":e.metadata["abstract"],dataURL:e.metadata.dataURL,metadataURL:e.metadataURL,server:{version:e.params.VERSION,url:e.url},maxExtent:e.maxExtent,transparent:e.params.TRANSPARENT,numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:1==e.opacity?void 0:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.singleTile||!e.tileSize?void 0:{width:e.tileSize.w,height:e.tileSize.h},minScale:e.options.resolutions||e.options.scales||e.options.maxResolution||e.options.minScale?e.minScale:void 0,maxScale:e.options.resolutions||e.options.scales||e.options.minResolution||e.options.maxScale?e.maxScale:void 0,formats:[],styles:[],srs:e.srs,dimensions:e.dimensions};if(e.metadata.servertitle&&(i.server.title=e.metadata.servertitle),e.metadata.formats&&e.metadata.formats.length>0)for(var n=0,s=e.metadata.formats.length;s>n;n++){var r=e.metadata.formats[n];i.formats.push({value:r.value,current:r.value==e.params.FORMAT})}else i.formats.push({value:e.params.FORMAT,current:!0});if(e.metadata.styles&&e.metadata.styles.length>0)for(var n=0,s=e.metadata.styles.length;s>n;n++){var a=e.metadata.styles[n];a.current=a.href==e.params.SLD||a.body==e.params.SLD_BODY||a.name==e.params.STYLES?!0:!1,i.styles.push(a)}else i.styles.push({href:e.params.SLD,body:e.params.SLD_BODY,name:e.params.STYLES||t.defaultStyleName,title:t.defaultStyleTitle,current:!0});return i},toContext:function(e){var t={},i=e.layers;if("OpenLayers.Map"==e.CLASS_NAME){var n=e.metadata||{};t.size=e.getSize(),t.bounds=e.getExtent(),t.projection=e.projection,t.title=e.title,t.keywords=n.keywords,t["abstract"]=n["abstract"],t.logo=n.logo,t.descriptionURL=n.descriptionURL,t.contactInformation=n.contactInformation,t.maxExtent=e.maxExtent}else OpenLayers.Util.applyDefaults(t,e),void 0!=t.layers&&delete t.layers;if(void 0==t.layersContext&&(t.layersContext=[]),void 0!=i&&OpenLayers.Util.isArray(i))for(var s=0,r=i.length;r>s;s++){var a=i[s];a instanceof OpenLayers.Layer.WMS&&t.layersContext.push(this.layerToContext(a))}return t},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(e){var t=null;if(null==e)t=this.namespaces[this.defaultPrefix];else for(t in this.namespaces)if(this.namespaces[t]==e)break;return t},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;this.rootPrefix=t.prefix;var i={version:t.getAttribute("version")};return this.runChildNodes(i,t),i},runChildNodes:function(e,t){for(var i,n,s,r,a=t.childNodes,o=0,l=a.length;l>o;++o)i=a[o],1==i.nodeType&&(s=this.getNamespacePrefix(i.namespaceURI),r=i.nodeName.split(":").pop(),n=this["read_"+s+"_"+r],n&&n.apply(this,[e,i]))},read_wmc_General:function(e,t){this.runChildNodes(e,t)},read_wmc_BoundingBox:function(e,t){e.projection=t.getAttribute("SRS"),e.bounds=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"))},read_wmc_LayerList:function(e,t){e.layersContext=[],this.runChildNodes(e,t)},read_wmc_Layer:function(e,t){var i={visibility:"1"!=t.getAttribute("hidden"),queryable:"1"==t.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(i,t),e.layersContext.push(i)},read_wmc_Extension:function(e,t){this.runChildNodes(e,t)},read_ol_units:function(e,t){e.units=this.getChildValue(t)},read_ol_maxExtent:function(e,t){var i=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"));e.maxExtent=i},read_ol_transparent:function(e,t){e.transparent=this.getChildValue(t)},read_ol_numZoomLevels:function(e,t){e.numZoomLevels=parseInt(this.getChildValue(t))},read_ol_opacity:function(e,t){e.opacity=parseFloat(this.getChildValue(t))},read_ol_singleTile:function(e,t){e.singleTile="true"==this.getChildValue(t)},read_ol_tileSize:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height")};e.tileSize=i},read_ol_isBaseLayer:function(e,t){e.isBaseLayer="true"==this.getChildValue(t)},read_ol_displayInLayerSwitcher:function(e,t){e.displayInLayerSwitcher="true"==this.getChildValue(t)},read_wmc_Server:function(e,t){e.version=t.getAttribute("version"),e.url=this.getOnlineResource_href(t),e.metadata.servertitle=t.getAttribute("title")},read_wmc_FormatList:function(e,t){this.runChildNodes(e,t)},read_wmc_Format:function(e,t){var i={value:this.getChildValue(t)};"1"==t.getAttribute("current")&&(i.current=!0),e.formats.push(i)},read_wmc_StyleList:function(e,t){this.runChildNodes(e,t)},read_wmc_Style:function(e,t){var i={};this.runChildNodes(i,t),"1"==t.getAttribute("current")&&(i.current=!0),e.styles.push(i)},read_wmc_SLD:function(e,t){this.runChildNodes(e,t)},read_sld_StyledLayerDescriptor:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_sld_FeatureTypeStyle:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_wmc_OnlineResource:function(e,t){e.href=this.getAttributeNS(t,this.namespaces.xlink,"href")},read_wmc_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_wmc_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_wmc_MetadataURL:function(e,t){e.metadataURL=this.getOnlineResource_href(t)},read_wmc_KeywordList:function(e,t){e.keywords=[],this.runChildNodes(e.keywords,t)},read_wmc_Keyword:function(e,t){e.push(this.getChildValue(t))},read_wmc_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e["abstract"]=i)},read_wmc_LogoURL:function(e,t){e.logo={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)}},read_wmc_DescriptionURL:function(e,t){e.descriptionURL=this.getOnlineResource_href(t)},read_wmc_ContactInformation:function(e,t){var i={};this.runChildNodes(i,t),e.contactInformation=i},read_wmc_ContactPersonPrimary:function(e,t){var i={};this.runChildNodes(i,t),e.personPrimary=i},read_wmc_ContactPerson:function(e,t){var i=this.getChildValue(t);i&&(e.person=i)},read_wmc_ContactOrganization:function(e,t){var i=this.getChildValue(t);i&&(e.organization=i)},read_wmc_ContactPosition:function(e,t){var i=this.getChildValue(t);i&&(e.position=i)},read_wmc_ContactAddress:function(e,t){var i={};this.runChildNodes(i,t),e.contactAddress=i},read_wmc_AddressType:function(e,t){var i=this.getChildValue(t);i&&(e.type=i)},read_wmc_Address:function(e,t){var i=this.getChildValue(t);i&&(e.address=i)},read_wmc_City:function(e,t){var i=this.getChildValue(t);i&&(e.city=i)},read_wmc_StateOrProvince:function(e,t){var i=this.getChildValue(t);i&&(e.stateOrProvince=i)},read_wmc_PostCode:function(e,t){var i=this.getChildValue(t);i&&(e.postcode=i)},read_wmc_Country:function(e,t){var i=this.getChildValue(t);i&&(e.country=i)},read_wmc_ContactVoiceTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.phone=i)},read_wmc_ContactFacsimileTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.fax=i)},read_wmc_ContactElectronicMailAddress:function(e,t){var i=this.getChildValue(t);i&&(e.email=i)},read_wmc_DataURL:function(e,t){e.dataURL=this.getOnlineResource_href(t)},read_wmc_LegendURL:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)};e.legend=i},read_wmc_DimensionList:function(e,t){e.dimensions={},this.runChildNodes(e.dimensions,t)},read_wmc_Dimension:function(e,t){var i=t.getAttribute("name").toLowerCase(),n={name:i,units:t.getAttribute("units")||"",unitSymbol:t.getAttribute("unitSymbol")||"",userValue:t.getAttribute("userValue")||"",nearestValue:"1"===t.getAttribute("nearestValue"),multipleValues:"1"===t.getAttribute("multipleValues"),current:"1"===t.getAttribute("current"),"default":t.getAttribute("default")||""},s=this.getChildValue(t);n.values=s.split(","),e[n.name]=n},write:function(e,t){var i=this.createElementDefaultNS("ViewContext");return this.setAttributes(i,{version:this.VERSION,id:t&&"string"==typeof t.id?t.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),i.appendChild(this.write_wmc_General(e)),i.appendChild(this.write_wmc_LayerList(e)),OpenLayers.Format.XML.prototype.write.apply(this,[i])
},createElementDefaultNS:function(e,t,i){var n=this.createElementNS(this.namespaces[this.defaultPrefix],e);return t&&n.appendChild(this.createTextNode(t)),i&&this.setAttributes(n,i),n},setAttributes:function(e,t){var i;for(var n in t)i=t[n].toString(),i.match(/[A-Z]/)?this.setAttributeNS(e,null,n,i):e.setAttribute(n,i)},write_wmc_General:function(e){var t=this.createElementDefaultNS("General");e.size&&t.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var i=e.bounds;return t.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18),SRS:e.projection})),t.appendChild(this.createElementDefaultNS("Title",e.title)),e.keywords&&t.appendChild(this.write_wmc_KeywordList(e.keywords)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.logo&&t.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo)),e.descriptionURL&&t.appendChild(this.write_wmc_URLType("DescriptionURL",e.descriptionURL)),e.contactInformation&&t.appendChild(this.write_wmc_ContactInformation(e.contactInformation)),t.appendChild(this.write_ol_MapExtension(e)),t},write_wmc_KeywordList:function(e){for(var t=this.createElementDefaultNS("KeywordList"),i=0,n=e.length;n>i;i++)t.appendChild(this.createElementDefaultNS("Keyword",e[i]));return t},write_wmc_ContactInformation:function(e){var t=this.createElementDefaultNS("ContactInformation");return e.personPrimary&&t.appendChild(this.write_wmc_ContactPersonPrimary(e.personPrimary)),e.position&&t.appendChild(this.createElementDefaultNS("ContactPosition",e.position)),e.contactAddress&&t.appendChild(this.write_wmc_ContactAddress(e.contactAddress)),e.phone&&t.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",e.phone)),e.fax&&t.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",e.fax)),e.email&&t.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",e.email)),t},write_wmc_ContactPersonPrimary:function(e){var t=this.createElementDefaultNS("ContactPersonPrimary");return e.person&&t.appendChild(this.createElementDefaultNS("ContactPerson",e.person)),e.organization&&t.appendChild(this.createElementDefaultNS("ContactOrganization",e.organization)),t},write_wmc_ContactAddress:function(e){var t=this.createElementDefaultNS("ContactAddress");return e.type&&t.appendChild(this.createElementDefaultNS("AddressType",e.type)),e.address&&t.appendChild(this.createElementDefaultNS("Address",e.address)),e.city&&t.appendChild(this.createElementDefaultNS("City",e.city)),e.stateOrProvince&&t.appendChild(this.createElementDefaultNS("StateOrProvince",e.stateOrProvince)),e.postcode&&t.appendChild(this.createElementDefaultNS("PostCode",e.postcode)),e.country&&t.appendChild(this.createElementDefaultNS("Country",e.country)),t},write_ol_MapExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent;if(i){var n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n)}return t},write_wmc_LayerList:function(e){for(var t=this.createElementDefaultNS("LayerList"),i=0,n=e.layersContext.length;n>i;++i)t.appendChild(this.write_wmc_Layer(e.layersContext[i]));return t},write_wmc_Layer:function(e){var t=this.createElementDefaultNS("Layer",null,{queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1"});return t.appendChild(this.write_wmc_Server(e)),t.appendChild(this.createElementDefaultNS("Name",e.name)),t.appendChild(this.createElementDefaultNS("Title",e.title)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.dataURL&&t.appendChild(this.write_wmc_URLType("DataURL",e.dataURL)),e.metadataURL&&t.appendChild(this.write_wmc_URLType("MetadataURL",e.metadataURL)),t},write_wmc_LayerExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent,n=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(n,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(n),e.tileSize&&!e.singleTile){var s=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(s,e.tileSize),t.appendChild(s)}for(var r,a=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],o=0,l=a.length;l>o;++o)r=this.createOLPropertyNode(e,a[o]),r&&t.appendChild(r);return t},createOLPropertyNode:function(e,t){var i=null;return null!=e[t]&&(i=this.createElementNS(this.namespaces.ol,"ol:"+t),i.appendChild(this.createTextNode(e[t].toString()))),i},write_wmc_Server:function(e){var t=e.server,i=this.createElementDefaultNS("Server"),n={service:"OGC:WMS",version:t.version};return t.title&&(n.title=t.title),this.setAttributes(i,n),i.appendChild(this.write_wmc_OnlineResource(t.url)),i},write_wmc_URLType:function(e,t,i){var n=this.createElementDefaultNS(e);if(n.appendChild(this.write_wmc_OnlineResource(t)),i)for(var s=["width","height","format"],r=0;r<s.length;r++)s[r]in i&&n.setAttribute(s[r],i[s[r]]);return n},write_wmc_DimensionList:function(e){var t=this.createElementDefaultNS("DimensionList");for(var i in e.dimensions){var n={},s=e.dimensions[i];for(var r in s)n[r]="boolean"==typeof s[r]?Number(s[r]):s[r];var a="";n.values&&(a=n.values.join(","),delete n.values),t.appendChild(this.createElementDefaultNS("Dimension",a,n))}return t},write_wmc_FormatList:function(e){for(var t=this.createElementDefaultNS("FormatList"),i=0,n=e.formats.length;n>i;i++){var s=e.formats[i];t.appendChild(this.createElementDefaultNS("Format",s.value,s.current&&1==s.current?{current:"1"}:null))}return t},write_wmc_StyleList:function(e){var t=this.createElementDefaultNS("StyleList"),i=e.styles;if(i&&OpenLayers.Util.isArray(i))for(var n,s=0,r=i.length;r>s;s++){var a=i[s],o=this.createElementDefaultNS("Style",null,a.current&&1==a.current?{current:"1"}:null);if(a.href){n=this.createElementDefaultNS("SLD"),a.name&&n.appendChild(this.createElementDefaultNS("Name",a.name)),a.title&&n.appendChild(this.createElementDefaultNS("Title",a.title)),a.legend&&n.appendChild(this.write_wmc_URLType("LegendURL",a.legend.href,a.legend));var l=this.write_wmc_OnlineResource(a.href);n.appendChild(l),o.appendChild(n)}else if(a.body){n=this.createElementDefaultNS("SLD"),a.name&&n.appendChild(this.createElementDefaultNS("Name",a.name)),a.title&&n.appendChild(this.createElementDefaultNS("Title",a.title)),a.legend&&n.appendChild(this.write_wmc_URLType("LegendURL",a.legend.href,a.legend));var u=OpenLayers.Format.XML.prototype.read.apply(this,[a.body]),h=u.documentElement;n.ownerDocument&&n.ownerDocument.importNode&&(h=n.ownerDocument.importNode(h,!0)),n.appendChild(h),o.appendChild(n)}else o.appendChild(this.createElementDefaultNS("Name",a.name)),o.appendChild(this.createElementDefaultNS("Title",a.title)),a["abstract"]&&o.appendChild(this.createElementDefaultNS("Abstract",a["abstract"])),a.legend&&o.appendChild(this.write_wmc_URLType("LegendURL",a.legend.href,a.legend));t.appendChild(o)}return t},write_wmc_OnlineResource:function(e){var t=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(t,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(t,this.namespaces.xlink,"xlink:href",e),t},getOnlineResource_href:function(e){var t={},i=e.getElementsByTagName("OnlineResource");return i.length>0&&this.read_wmc_OnlineResource(t,i[0]),t.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])},read_sld_MinScaleDenominator:function(e,t){var i=parseFloat(this.getChildValue(t));i>0&&(e.maxScale=i)},read_sld_MaxScaleDenominator:function(e,t){e.minScale=parseFloat(this.getChildValue(t))},read_wmc_SRS:function(e,t){"srs"in e||(e.srs={}),e.srs[this.getChildValue(t)]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.maxScale){var i=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");i.appendChild(this.createTextNode(e.maxScale.toPrecision(16))),t.appendChild(i)}if(e.minScale){var n=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");n.appendChild(this.createTextNode(e.minScale.toPrecision(16))),t.appendChild(n)}if(e.srs)for(var s in e.srs)t.appendChild(this.createElementDefaultNS("SRS",s));return t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e)),t},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{xls:{XLS:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Response:function(e,t){this.readChildNodes(e,t)},GeocodeResponse:function(e,t){t.responseLists=[],this.readChildNodes(e,t)},GeocodeResponseList:function(e,t){var i={features:[],numberOfGeocodedAddresses:parseInt(e.getAttribute("numberOfGeocodedAddresses"))};t.responseLists.push(i),this.readChildNodes(e,i)},GeocodedAddress:function(e,t){var i=new OpenLayers.Feature.Vector;t.features.push(i),this.readChildNodes(e,i),i.geometry=i.components[0]},GeocodeMatchCode:function(e,t){t.attributes.matchCode={accuracy:parseFloat(e.getAttribute("accuracy")),matchType:e.getAttribute("matchType")}},Address:function(e,t){var i={countryCode:e.getAttribute("countryCode"),addressee:e.getAttribute("addressee"),street:[],place:[]};t.attributes.address=i,this.readChildNodes(e,i)},freeFormAddress:function(e,t){t.freeFormAddress=this.getChildValue(e)},StreetAddress:function(e,t){this.readChildNodes(e,t)},Building:function(e,t){t.building={number:e.getAttribute("number"),subdivision:e.getAttribute("subdivision"),buildingName:e.getAttribute("buildingName")}},Street:function(e,t){t.street.push(this.getChildValue(e))},Place:function(e,t){t.place[e.getAttribute("type")]=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(e){return this.writers.xls.XLS.apply(this,[e])},writers:{xls:{XLS:function(e){var t=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",e.header,t),this.writeNode("Request",e,t),t},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(e){var t=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:e.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",e.addresses,t),t},GeocodeRequest:function(e){for(var t=this.createElementNSPlus("xls:GeocodeRequest"),i=0,n=e.length;n>i;i++)this.writeNode("Address",e[i],t);return t},Address:function(e){var t=this.createElementNSPlus("xls:Address",{attributes:{countryCode:e.countryCode}});return e.freeFormAddress?this.writeNode("freeFormAddress",e.freeFormAddress,t):(e.street&&this.writeNode("StreetAddress",e,t),e.municipality&&this.writeNode("Municipality",e.municipality,t),e.countrySubdivision&&this.writeNode("CountrySubdivision",e.countrySubdivision,t),e.postalCode&&this.writeNode("PostalCode",e.postalCode,t)),t},freeFormAddress:function(e){return this.createElementNSPlus("freeFormAddress",{value:e})},StreetAddress:function(e){var t=this.createElementNSPlus("xls:StreetAddress");e.building&&this.writeNode(t,"Building",e.building);var i=e.street;OpenLayers.Util.isArray(i)||(i=[i]);for(var n=0,s=i.length;s>n;n++)this.writeNode("Street",i[n],t);return t},Building:function(e){return this.createElementNSPlus("xls:Building",{attributes:{number:e.number,subdivision:e.subdivision,buildingName:e.buildingName}})},Street:function(e){return this.createElementNSPlus("xls:Street",{value:e})},Municipality:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:e})},CountrySubdivision:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:e})},PostalCode:function(e){return this.createElementNSPlus("xls:PostalCode",{value:e})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var n=e+(i?0:this.translationParameters.x),s=t+(i?0:this.translationParameters.y);return n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL&&s>=-this.MAX_PIXEL&&s<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),s=-e.left/n,r=e.top/n;if(t){this.left=s,this.top=r;var a="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",a),this.translate(this.xOffset,0),!0}var o=this.translate(s-this.left+this.xOffset,r-this.top);return o||this.setExtent(e,!0),i&&o},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path"}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var n=t.title||t.graphicTitle;if(n){e.setAttributeNS(null,"title",n);var s=e.getElementsByTagName("title");if(s.length>0)s[0].firstChild.textContent=n;else{var r=this.nodeFactory(null,"title");r.textContent=n,e.appendChild(r)}}var a,o=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&o){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){a=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var u=t.graphicWidth||t.graphicHeight,h=t.graphicHeight||t.graphicWidth;u=u?u:2*t.pointRadius,h=h?h:2*t.pointRadius;var c=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*u),p=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*h),d=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(a.x+c).toFixed()),e.setAttributeNS(null,"y",(a.y+p).toFixed()),e.setAttributeNS(null,"width",u),e.setAttributeNS(null,"height",h),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+d),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var m=3*t.pointRadius,f=2*m,y=this.importSymbol(t.graphicName);a=this.getPosition(e),l=3*this.symbolMetrics[y.id][0]/f;var g=e.parentNode,v=e.nextSibling;g&&g.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(y.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",y.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",f),e.setAttributeNS(null,"height",f),e.setAttributeNS(null,"x",a.x-m),e.setAttributeNS(null,"y",a.y-m),v?g.insertBefore(e,v):g&&g.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var b=t.rotation;if((void 0!==b||void 0!==e._rotation)&&a)if(e._rotation=b,b|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+b+" "+a.x+" "+a.y+")");else{var L=this.symbolMetrics[y.id];e.firstChild.setAttributeNS(null,"transform","rotate("+b+" "+L[1]+" "+L[2]+")")}}if(i.isFilled)if(t.externalGraphic){var O=this.createImagePattern(t);e.setAttributeNS(null,"fill","url(#"+O+")"),e.setAttributeNS(null,"fill-opacity",1)}else t.graphicName&&"OpenLayers.Geometry.Point"!==e._geometryClass?OpenLayers.Console.error("WellKnownName is not yet supported as GraphicFill by the SVG renderer!"):(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity));else e.setAttributeNS(null,"fill","none");return i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*l),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},createImagePattern:function(e){var t=this.container.id+"-"+e.externalGraphic+(e.pointRadius?"-"+e.pointRadius:""),i=OpenLayers.Util.getElement(t);if(!i){var n=new Image;n.onload=OpenLayers.Function.bind(function(){this.defs||(this.defs=this.createDefs());var s=72*n.height/96,r=72*n.width/96;if(e.pointRadius){var a=r/s;s=72*2*e.pointRadius/96,r=s*a}s+="pt",r+="pt",i=this.nodeFactory(t,"pattern"),i.setAttributeNS(null,"x","0"),i.setAttributeNS(null,"y","0"),i.setAttributeNS(null,"height",s),i.setAttributeNS(null,"width",r),i.setAttributeNS(null,"patternUnits","userSpaceOnUse");var o=this.nodeFactory(null,"image");if(i.appendChild(o),o.setAttributeNS(this.xlinkns,"href",e.externalGraphic),o.setAttributeNS(null,"height",s),o.setAttributeNS(null,"width",r),o.setAttributeNS(null,"style","opacity: "+(e.graphicOpacity||e.fillOpacity||1)),"undefined"!=typeof e.rotation){var l=OpenLayers.String.format("rotate(${0})",[e.rotation]);o.setAttributeNS(null,"transform",l)}this.defs.appendChild(i)},this),n.src=e.externalGraphic}return t},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),s=(t.x-this.featureDx)/n+this.left,r=this.top-t.y/n;return this.inValidRange(s,r)?(e.setAttributeNS(null,"cx",s),e.setAttributeNS(null,"cy",r),e.setAttributeNS(null,"r",i),e):!1},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawPolygon:function(e,t){for(var i,n,s="",r=!0,a=!0,o=0,l=t.components.length;l>o;o++)s+=" M",i=this.getComponentsString(t.components[o].components," "),n=i.path,n?(s+=" "+n,a=i.complete&&a):r=!1;return s+=" z",r?(e.setAttributeNS(null,"d",s),e.setAttributeNS(null,"fill-rule","evenodd"),a?e:null):!1},drawRectangle:function(e,t){var i=this.getResolution(),n=(t.x-this.featureDx)/i+this.left,s=this.top-t.y/i;return this.inValidRange(n,s)?(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",s),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e):!1},drawText:function(e,t,i){var n=!!t.labelOutlineWidth;if(n){var s=OpenLayers.Util.extend({},t);s.fontColor=s.labelOutlineColor,s.fontStrokeColor=s.labelOutlineColor,s.fontStrokeWidth=t.labelOutlineWidth,delete s.labelOutlineWidth,this.drawText(e,s,i)}var r=this.getResolution(),a=(i.x-this.featureDx)/r+this.left,o=i.y/r-this.top,l=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+l,"text");u.setAttributeNS(null,"x",a),u.setAttributeNS(null,"y",-o),t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(u.setAttributeNS(null,"pointer-events","visible"),u._featureId=e):u.setAttributeNS(null,"pointer-events","none");var h=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[0]]||"middle"),OpenLayers.IS_GECKO===!0&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[1]]||"central");for(var c=t.label.split("\n"),p=c.length;u.childNodes.length>p;)u.removeChild(u.lastChild);for(var d=0;p>d;d++){var m=this.nodeFactory(e+l+"_tspan_"+d,"tspan");if(t.labelSelect===!0&&(m._featureId=e,m._geometry=i,m._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[h[1]]||"-35%"),m.setAttribute("x",a),0==d){var f=OpenLayers.Renderer.SVG.LABEL_VFACTOR[h[1]];null==f&&(f=-.5),m.setAttribute("dy",f*(p-1)+"em")}else m.setAttribute("dy","1em");m.textContent=""===c[d]?" ":c[d],m.parentNode||u.appendChild(m)}u.parentNode||this.textRoot.appendChild(u)},getComponentsString:function(e,t){for(var i,n,s=[],r=!0,a=e.length,o=[],l=0;a>l;l++)n=e[l],s.push(n),i=this.getShortString(n),i?o.push(i):(l>0&&this.getShortString(e[l-1])&&o.push(this.clipLine(e[l],e[l-1])),a-1>l&&this.getShortString(e[l+1])&&o.push(this.clipLine(e[l],e[l+1])),r=!1);return{path:o.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),s=this.MAX_PIXEL-this.translationParameters.x,r=this.MAX_PIXEL-this.translationParameters.y,a=(t.x-this.featureDx)/n+this.left,o=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,u=this.top-e.y/n;return(-s>l||l>s)&&(i=(u-o)/(l-a),l=0>l?-s:s,u=o+(l-a)*i),(-r>u||u>r)&&(i=(l-a)/(u-o),u=0>u?-r:r,l=a+(u-o)*i),l+","+u},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left,n=this.top-e.y/t;return this.inValidRange(i,n)?i+","+n:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");var s=this.nodeFactory(t,"symbol"),r=this.nodeFactory(null,"polygon");s.appendChild(r);for(var a,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),u=[],h=0;h<n.length;h+=2)a=n[h],o=n[h+1],l.left=Math.min(l.left,a),l.bottom=Math.min(l.bottom,o),l.right=Math.max(l.right,a),l.top=Math.max(l.top,o),u.push(a,",",o);r.setAttributeNS(null,"points",u.join(" "));var c=l.getWidth(),p=l.getHeight(),d=[l.left-c,l.bottom-p,3*c,3*p];return s.setAttributeNS(null,"viewBox",d.join(" ")),this.symbolMetrics[t]=[Math.max(c,p),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(s),s},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot?i.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(e){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t,i,n=e.documentElement,s=n.childNodes,r={layerDescriptions:[]},a=0;a<s.length;++a)if(t=s[a],i=t.nodeName,"LayerDescription"==i){var o=t.getAttribute("name"),l="",u="",h="";t.getAttribute("owsType")?(l=t.getAttribute("owsType"),u=t.getAttribute("owsURL")):""!=t.getAttribute("wfs")?(l="WFS",u=t.getAttribute("wfs")):""!=t.getAttribute("wcs")&&(l="WCS",u=t.getAttribute("wcs"));var c=t.getElementsByTagName("Query");c.length>0&&(h=c[0].getAttribute("typeName"),h||(h=c[0].getAttribute("typename")));var p={layerName:o,owsType:l,owsURL:u,typeName:h};r.layerDescriptions.push(p),r.length=r.layerDescriptions.length,r[r.length-1]=p}else if("ServiceException"==i){var d=new OpenLayers.Format.OGCExceptionReport;return{error:d.read(e)}}return r},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,n,s,r){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=n&&(this.contentHTML=n),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),s&&this.addCloseBox(r),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,n=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv){var s=parseInt(this.closeDiv.style.width);i+=s+t.right}this.size.w+=i,this.size.h+=n,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),n=this.getSafeContentSize(i),s=null;if(n.equals(i))s=i;else{var r={w:n.w<i.w?n.w:null,h:n.h<i.h?n.h:null};if(r.w&&r.h)s=n;else{var a=OpenLayers.Util.getRenderedDimensions(e,r,{displayClass:this.contentDisplayClass,containerElement:t}),o=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=o&&a.equals(n)){var l=OpenLayers.Util.getScrollbarWidth();r.w?a.h+=l:a.w+=l}s=this.getSafeContentSize(a)}}this.setSize(s)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)
},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,n=t.length;n>i;i++){var s=t[i];if(0==s.width||0==s.height){var r={popup:this,img:s};s._onImgLoad=OpenLayers.Function.bind(e,r),OpenLayers.Event.observe(s,"load",s._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),i=this.getContentDivPadding(),n=i.left+i.right,s=i.top+i.bottom;if(this.fixPadding(),n+=this.padding.left+this.padding.right,s+=this.padding.top+this.padding.bottom,this.closeDiv){var r=parseInt(this.closeDiv.style.width);n+=r+i.right}if(this.minSize&&(t.w=Math.max(t.w,this.minSize.w-n),t.h=Math.max(t.h,this.minSize.h-s)),this.maxSize&&(t.w=Math.min(t.w,this.maxSize.w-n),t.h=Math.min(t.h,this.maxSize.h-s)),this.map&&this.map.size){var a=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":a=l.x,o=this.map.size.h-l.y;break;case"tl":a=this.map.size.w-l.x,o=this.map.size.h-l.y;break;case"bl":a=this.map.size.w-l.x,o=l.y;break;case"br":a=l.x,o=l.y;break;default:a=l.x,o=this.map.size.h-l.y}}var u=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-s-o,h=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-a;t.w=Math.min(t.w,h),t.h=Math.min(t.h,u)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var n=t.x-i.x,s=t.y-i.y;this.map.pan(n,s)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.topInUnits.length,this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"),this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t,i=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,i),s=parseInt(e/n);return t=s>5?5:s>2?2:1,t*n},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*e*i[t],s=1;if(this.geodesic===!0){var r=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,a=n/i.km;s=r/a,n*=s}var o,l;n>1e5?(o=this.topOutUnits,l=this.bottomOutUnits):(o=this.topInUnits,l=this.bottomInUnits);var u=n/i[o],h=n/i[l],c=this.getBarLen(u),p=this.getBarLen(h);u=c/i[t]*i[o],h=p/i[t]*i[l];var d=u/e/s,m=h/e/s;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(m)+"px",this.eBottom.innerHTML=p+" "+l),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(d)+"px",this.eTop.innerHTML=c+" "+o)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,n){this.url=e,this.size=t||{w:20,h:20},this.offset=i||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=n;var s=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(s)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var i=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=i:(this.icon.url=i.url,this.icon.size=i.size,this.icon.offset=i.offset,this.icon.calculateOffset=i.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,n=typeof e;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(s){OpenLayers.Console.error("Trouble serializing: "+s)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,n,s,r=!1;for(i in e)e.hasOwnProperty(i)&&(n=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),s=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=n&&null!=s&&(r&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),s),r=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var n=0,s=e.length;s>n;++n)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=t&&(n>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var n=t[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var n=null,s=null;if(s="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof s.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(s,t))switch(t){case"Geometry":try{n=this.parseGeometry(s)}catch(r){OpenLayers.Console.error(r)}break;case"Feature":try{n=this.parseFeature(s),n.type="Feature"}catch(r){OpenLayers.Console.error(r)}break;case"FeatureCollection":switch(n=[],s.type){case"Feature":try{n.push(this.parseFeature(s))}catch(r){n=null,OpenLayers.Console.error(r)}break;case"FeatureCollection":for(var a=0,o=s.features.length;o>a;++a)try{n.push(this.parseFeature(s.features[a]))}catch(r){n=null,OpenLayers.Console.error(r)}break;default:try{var l=this.parseGeometry(s);n.push(new OpenLayers.Feature.Vector(l))}catch(r){n=null,OpenLayers.Console.error(r)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,n,s;n=e.properties?e.properties:{},s=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(r){throw r}return t=new OpenLayers.Feature.Vector(i,n),s&&(t.bounds=OpenLayers.Bounds.fromArray(s)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var n=e.geometries.length,s=new Array(n),r=0;n>r;++r)s[r]=this.parseGeometry.apply(this,[e.geometries[r]]);t=new OpenLayers.Geometry.Collection(s),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(a){throw a}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,n=0,s=e.length;s>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,n=0,s=e.length;s>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,n=0,s=e.length;s>n;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,n=[],s=0,r=e.length;r>s;++s){try{i=this.parseCoords.linestring.apply(this,[e[s]])}catch(a){throw a}t=new OpenLayers.Geometry.LinearRing(i.components),n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],i=null,n=0,s=e.length;s>n;++n){try{i=this.parseCoords.polygon.apply(this,[e[n]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var n=e.length;i.features=new Array(n);for(var s=0;n>s;++s){var r=e[s];if(!r instanceof OpenLayers.Feature.Vector){var a="FeatureCollection only supports collections of features: "+r;throw a}i.features[s]=this.extract.feature.apply(this,[r])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var n=parseInt(t.substring(t.indexOf(":")+1));i=4326==n?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+n}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t,i=e.CLASS_NAME.split(".")[2],n=this.extract[i.toLowerCase()].apply(this,[e]);return t="Collection"==i?{type:"GeometryCollection",geometries:n}:{type:i,coordinates:n}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),n=0;t>n;++n)i[n]=this.extract.geometry.apply(this,[e.components[n]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),e},cacheFeatures:function(e){this.paging||(this.clearCache(),this.features=e.features,this.pageNext(e))},clearCache:function(){if(this.features)for(var e=0;e<this.features.length;++e)this.features[e].destroy();this.features=null,this.num=null},pageCount:function(){var e=this.features?this.features.length:0;return Math.ceil(e/this.length)},pageNum:function(){return this.num},pageLength:function(e){return e&&e>0&&(this.length=e),this.length},pageNext:function(e){var t=!1;if(this.features){null===this.num&&(this.num=-1);var i=(this.num+1)*this.length;t=this.page(i,e)}return t},pagePrevious:function(){var e=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var t=(this.num-1)*this.length;e=this.page(t)}return e},page:function(e,t){var i=!1;if(this.features&&e>=0&&e<this.features.length){var n=Math.floor(e/this.length);if(n!=this.num){this.paging=!0;var s=this.features.slice(e,e+this.length);this.layer.removeFeatures(this.layer.features),this.num=n,t&&t.features?t.features=s:this.layer.addFeatures(s),this.paging=!1,i=!0}}return i},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,i,n,s,r,a){var o=[e,t,i,n,r,a];OpenLayers.Popup.prototype.initialize.apply(this,o),this.anchor=null!=s?s:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e)),this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(e)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),i=this.map.getExtent(),n=i.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(n)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),i=this.size||this.contentSize,n="t"==this.relativePosition.charAt(0);t.y+=n?-i.h:this.anchor.size.h;var s="l"==this.relativePosition.charAt(1);return t.x+=s?-i.w:this.anchor.size.w,t},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,i,n,s,r){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,r&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var e=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return e=e.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var i=this.positionBlocks[e],n=0;n<i.blocks.length;n++){var s={};this.blocks.push(s);var r=this.id+"_FrameDecorationDiv_"+n;s.div=OpenLayers.Util.createDiv(r,null,null,null,"absolute",null,"hidden",null);var a=this.id+"_FrameDecorationImg_"+n,o=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;s.image=o(a,null,this.imageSize,this.imageSrc,"absolute",null,null,null),s.div.appendChild(s.image),this.groupDiv.appendChild(s.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var i=e.blocks[t],n=this.blocks[t],s=i.anchor.left,r=i.anchor.bottom,a=i.anchor.right,o=i.anchor.top,l=isNaN(i.size.w)?this.size.w-(a+s):i.size.w,u=isNaN(i.size.h)?this.size.h-(r+o):i.size.h;n.div.style.width=(0>l?0:l)+"px",n.div.style.height=(0>u?0:u)+"px",n.div.style.left=null!=s?s+"px":"",n.div.style.bottom=null!=r?r+"px":"",n.div.style.right=null!=a?a+"px":"",n.div.style.top=null!=o?o+"px":"",n.image.style.left=i.position.x+"px",n.image.style.top=i.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,n=Math.abs(t-e.x),s=Math.abs(i-e.y),r=this.getBoxOffsets();this.zoomBox.style.width=n+r.width+1+"px",this.zoomBox.style.height=s+r.height+1+"px",this.zoomBox.style.left=(e.x<t?t-n-r.left:t-r.left)+"px",this.zoomBox.style.top=(e.y<i?i-s-r.top:i-r.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start,n=Math.min(i.y,e.y),s=Math.max(i.y,e.y),r=Math.min(i.x,e.x),a=Math.max(i.x,e.x);t=new OpenLayers.Bounds(r,s,a,n)}else t=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:i,right:n,top:s,bottom:r,width:t===!1?i+n:0,height:t===!1?s+r:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t;if(this.out){var i=Math.abs(e.right-e.left),n=Math.abs(e.top-e.bottom),s=Math.min(this.map.size.h/n,this.map.size.w/i),r=this.map.getExtent(),a=this.map.getLonLatFromPixel(e.getCenterPixel()),o=a.lon-r.getWidth()/2*s,l=a.lon+r.getWidth()/2*s,u=a.lat-r.getHeight()/2*s,h=a.lat+r.getHeight()/2*s;t=new OpenLayers.Bounds(o,u,l,h)}else{var c=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),p=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(c.lon,c.lat,p.lon,p.lat)}var d=this.map.getZoom();this.map.zoomToExtent(t),d==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(d+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()+1))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,n){i.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom+1)},defaultDblRightClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom-1)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var i=this.map.getZoom(),n=this.map.getZoom()+t;if(n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i){var s=this.map.getSize(),r=s.w/2-e.xy.x,a=e.xy.y-s.h/2,o=this.map.baseLayer.getResolutionForZoom(n),l=this.map.getLonLatFromPixel(e.xy),u=new OpenLayers.LonLat(l.lon+r*o,l.lat+a*o);this.map.setCenter(u,n)
}},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var n=this.layer.styleMap&&this.layer.styleMap.styles.temporary;n&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":n})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){var t=new OpenLayers.Feature.Vector(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&(t.state=OpenLayers.State.INSERT,this.layer.addFeatures([t]),this.featureAdded(t),this.events.triggerEvent("featureadded",{feature:t}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var e,t,i=this.point.geometry,n=this.control.layer.features,s=n.length-1;s>=0;--s)if(e=n[s].geometry,(e instanceof OpenLayers.Geometry.Polygon||e instanceof OpenLayers.Geometry.MultiPolygon)&&e.intersects(i)){t=n[s],this.control.layer.removeFeatures([t],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),t.geometry.addComponent(this.line.geometry),this.polygon=t,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var n=i[i.length-3];t.x=n.x,t.y=n.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,n=i.length-2;n>=0;--n)if(e.intersects(i[n])){t=!1;break}if(t)e:for(var n=i.length-2;n>0;--n)for(var s=i[n].components,r=0,a=s.length;a>r;++r)if(e.containsPoint(s[r])){t=!1;break e}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(e,t){OpenLayers.Control.Panel.prototype.initialize.apply(this,[t]),this.addControls([new OpenLayers.Control.Navigation]);var i=[new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(i)},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var n=this["read_"+i.nodeName];t=n?n.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var n=0,s=i.length;s>n;++n){var r=i[n],a=r.nodeName;r.prefix&&(a=a.split(":")[1]);var a=a.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(r,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var u=o[l],h=this.parseGeometry(u),c=this.parseAttributes(u),p=new OpenLayers.Feature.Vector(h.geometry,c,null);p.bounds=h.bounds,p.type=a,t.push(p)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,s=i.length;s>n;n++){var r,a=i[n],o=null,l={},u=a.attributes.length;if(u>0)for(r=0;u>r;r++){var h=a.attributes[r];l[h.nodeName]=h.nodeValue}else{var c=a.childNodes;for(r=0,u=c.length;u>r;++r){var p=c[r];3!=p.nodeType&&(l[p.getAttribute("name")]=p.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,n,s,r,a,o=[];if(e&&e.hasChildNodes()){i=e.childNodes,s=i.length;for(var l=0;s>l;l++){for(a=i[l];a&&1!=a.nodeType;)a=a.nextSibling,l++;n=a?a.nodeName:"",n.length>0&&n.indexOf(t)>-1?o.push(a):(r=this.getSiblingNodesByTagCriteria(a,t),r.length>0&&(0==o.length?o=r:o.push(r)))}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,n=i.length,s=0;n>s;++s){var r=i[s];if(1==r.nodeType){var a=r.childNodes,o=r.prefix?r.nodeName.split(":")[1]:r.nodeName;if(0==a.length)t[o]=null;else if(1==a.length){var l=a[0];if(3==l.nodeType||4==l.nodeType){var u=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=u}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),n=null;return i&&(t=i.geometry&&i.geometry.clone(),n=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,t,i){this.rgb={r:e,g:t,b:i}},setRed:function(e){this.rgb.r=e},setGreen:function(e){this.rgb.g=e},setBlue:function(e){this.rgb.b=e},setHue:function(e){var t=this.asHSB();t.h=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setSaturation:function(e){var t=this.asHSB();t.s=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setBrightness:function(e){var t=this.asHSB();t.b=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},darken:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.max(t.b-e,0))},brighten:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.min(t.b+e,1))},blend:function(e){this.rgb.r=Math.floor((this.rgb.r+e.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+e.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+e.rgb.b)/2)},isBright:function(){return this.asHSB(),this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length)for(var t=e,e="#",i=1;4>i;i++)e+=t.charAt(i)+t.charAt(i);0==e.indexOf("#")&&(e=e.substring(1));var n=e.substring(0,2),s=e.substring(2,4),r=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(n,16),parseInt(s,16),parseInt(r,16))},OpenLayers.Rico.Color.createColorFromBackground=function(e){var t=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(e),"backgroundColor");if("transparent"==t&&e.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(e.parentNode);if(null==t)return new OpenLayers.Rico.Color(255,255,255);if(0==t.indexOf("rgb(")){var i=t.substring(4,t.length-1),n=i.split(",");return new OpenLayers.Rico.Color(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]))}return 0==t.indexOf("#")?OpenLayers.Rico.Color.createFromHex(t):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(e,t,i){var n=0,s=0,r=0;if(0==t)n=parseInt(255*i+.5),s=n,r=n;else{var a=6*(e-Math.floor(e)),o=a-Math.floor(a),l=i*(1-t),u=i*(1-t*o),h=i*(1-t*(1-o));switch(parseInt(a)){case 0:n=255*i+.5,s=255*h+.5,r=255*l+.5;break;case 1:n=255*u+.5,s=255*i+.5,r=255*l+.5;break;case 2:n=255*l+.5,s=255*i+.5,r=255*h+.5;break;case 3:n=255*l+.5,s=255*u+.5,r=255*i+.5;break;case 4:n=255*h+.5,s=255*l+.5,r=255*i+.5;break;case 5:n=255*i+.5,s=255*l+.5,r=255*u+.5}}return{r:parseInt(n),g:parseInt(s),b:parseInt(r)}},OpenLayers.Rico.Color.RGBtoHSB=function(e,t,i){var n,s,r,a=e>t?e:t;i>a&&(a=i);var o=t>e?e:t;if(o>i&&(o=i),r=a/255,s=0!=a?(a-o)/a:0,0==s)n=0;else{var l=(a-e)/(a-o),u=(a-t)/(a-o),h=(a-i)/(a-o);n=e==a?h-u:t==a?2+l-h:4+u-l,n/=6,0>n&&(n+=1)}return{h:n,s:s,b:r}},OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(e,t){e=OpenLayers.Util.getElement(e),this._setOptions(t);var i=this.options.color;"fromElement"==this.options.color&&(i=this._background(e));var n=this.options.bgColor;"fromParent"==this.options.bgColor&&(n=this._background(e.offsetParent)),this._roundCornersImpl(e,i,n)},changeColor:function(e,t){e.style.backgroundColor=t;for(var i=e.parentNode.getElementsByTagName("span"),n=0;n<i.length;n++)i[n].style.backgroundColor=t},changeOpacity:function(e,t){var i=t,n="alpha(opacity="+100*t+")";e.style.opacity=i,e.style.filter=n;for(var s=e.parentNode.getElementsByTagName("span"),r=0;r<s.length;r++)s[r].style.opacity=i,s[r].style.filter=n},reRound:function(e,t){var i=e.parentNode.childNodes[0],n=e.parentNode.childNodes[2];e.parentNode.removeChild(i),e.parentNode.removeChild(n),this.round(e.parentNode,t)},_roundCornersImpl:function(e,t,i){this.options.border&&this._renderBorder(e,i),this._isTopRounded()&&this._roundTopCorners(e,t,i),this._isBottomRounded()&&this._roundBottomCorners(e,t,i)},_renderBorder:function(e,t){var i="1px solid "+this._borderColor(t),n="border-left: "+i,s="border-right: "+i,r="style='"+n+";"+s+"'";e.innerHTML="<div "+r+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,t,i){for(var n=this._createCorner(i),s=0;s<this.options.numSlices;s++)n.appendChild(this._createCornerSlice(t,i,s,"top"));e.style.paddingTop=0,e.insertBefore(n,e.firstChild)},_roundBottomCorners:function(e,t,i){for(var n=this._createCorner(i),s=this.options.numSlices-1;s>=0;s--)n.appendChild(this._createCornerSlice(t,i,s,"bottom"));e.style.paddingBottom=0,e.appendChild(n)},_createCorner:function(e){var t=document.createElement("div");return t.style.backgroundColor=this._isTransparent()?"transparent":e,t},_createCornerSlice:function(e,t,i,n){var s=document.createElement("span"),r=s.style;r.backgroundColor=e,r.display="block",r.height="1px",r.overflow="hidden",r.fontSize="1px";var a=this._borderColor(e,t);return this.options.border&&0==i?(r.borderTopStyle="solid",r.borderTopWidth="1px",r.borderLeftWidth="0px",r.borderRightWidth="0px",r.borderBottomWidth="0px",r.height="0px",r.borderColor=a):a&&(r.borderColor=a,r.borderStyle="solid",r.borderWidth="0px 1px"),this.options.compact||i!=this.options.numSlices-1||(r.height="2px"),this._setMargin(s,i,n),this._setBorder(s,i,n),s},_setOptions:function(e){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,e||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(e,t){return"transparent"==e?t:this.options.border?this.options.border:this.options.blend?this._blend(t,e):""},_setMargin:function(e,t,i){var n=this._marginSize(t),s="top"==i?this._whichSideTop():this._whichSideBottom();"left"==s?(e.style.marginLeft=n+"px",e.style.marginRight="0px"):"right"==s?(e.style.marginRight=n+"px",e.style.marginLeft="0px"):(e.style.marginLeft=n+"px",e.style.marginRight=n+"px")},_setBorder:function(e,t,i){var n=this._borderSize(t),s="top"==i?this._whichSideTop():this._whichSideBottom();"left"==s?(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth="0px"):"right"==s?(e.style.borderRightWidth=n+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px"),0!=this.options.border&&(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px")},_marginSize:function(e){if(this._isTransparent())return 0;var t=[5,3,2,1],i=[3,2,1,0],n=[2,1],s=[1,0];return this.options.compact&&this.options.blend?s[e]:this.options.compact?n[e]:this.options.blend?i[e]:t[e]},_borderSize:function(e){var t=[5,3,2,1],i=[2,1,1,1],n=[1,0],s=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?n[e]:this.options.blend?i[e]:this.options.border?s[e]:this._isTransparent()?t[e]:0},_hasString:function(e){for(var t=1;t<arguments.length;t++)if(e.indexOf(arguments[t])>=0)return!0;return!1},_blend:function(e,t){var i=OpenLayers.Rico.Color.createFromHex(e);return i.blend(OpenLayers.Rico.Color.createFromHex(t)),i},_background:function(e){try{return OpenLayers.Rico.Color.createColorFromBackground(e).asHex()}catch(t){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(e){return 1==e.childNodes.length&&3==e.childNodes[0].nodeType}},OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(){OpenLayers.Console.warn("AnchoredBubble is deprecated"),this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE),OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(){return OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments),this.setContentHTML(),this.setBackgroundColor(),this.setOpacity(),this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.setRicoCorners()},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&null!=this.contentDiv&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(e){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,e),null!=this.div&&null!=this.groupDiv&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var e=this.getCornersToRound(this.relativePosition),t={corners:e,color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,t),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,t),this.rounded=!0)},getCornersToRound:function(){var e=["tl","tr","bl","br"],t=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);return OpenLayers.Util.removeItem(e,t),e.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"}),OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5,OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),e},update:function(e){var t=this.getMapBounds();null!==t&&(e&&e.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(t))&&(this.calculateBounds(t),this.resolution=this.layer.map.getResolution(),this.triggerRead(e))},getMapBounds:function(){if(null===this.layer.map)return null;var e=this.layer.map.getExtent();return e&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(e=e.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),e},invalidBounds:function(e){e||(e=this.getMapBounds());var t=!this.bounds||!this.bounds.containsBounds(e);if(!t&&this.resFactor){var i=this.resolution/this.layer.map.getResolution();t=i>=this.resFactor||i<=1/this.resFactor}return t},calculateBounds:function(e){e||(e=this.getMapBounds());var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2)},triggerRead:function(e){!this.response||e&&e.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend")),this.layer.events.triggerEvent("loadstart"),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},e))},createFilter:function(){var e=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,e]})),e},merge:function(e){this.layer.destroyFeatures();var t=e.features;if(t&&t.length>0){var i=this.layer.projection,n=this.layer.map.getProjectionObject();if(!n.equals(i))for(var s,r=0,a=t.length;a>r;++r)s=t[r].geometry,s&&s.transform(i,n);this.layer.addFeatures(t)}this.response=null,this.layer.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e,t){var i=this.readers.ogc._expression.call(this,e);i&&(t.priority=i)},VendorOption:function(e,t){t.vendorOptions||(t.vendorOptions={}),t.vendorOptions[e.getAttribute("name")]=this.getChildValue(e)},TextSymbolizer:function(e,t){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var i=this.multipleSymbolizers?t.symbolizers[t.symbolizers.length-1]:t.symbolizer.Text;void 0===i.graphic&&(i.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e){return this.writers.sld._OGCExpression.call(this,"sld:Priority",e)},VendorOption:function(e){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:e.name},value:e.value})},TextSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.TextSymbolizer.apply(this,arguments);return e.graphic!==!1&&(e.externalGraphic||e.graphicName)&&this.writeNode("Graphic",e,i),"priority"in e&&this.writeNode("Priority",e.priority,i),this.addVendorOptions(i,e)},PointSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)},LineSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)},PolygonSymbolizer:function(e){var t=OpenLayers.Format.SLD.v1_0_0.prototype.writers,i=t.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(i,e)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(e,t){var i=t.vendorOptions;if(i)for(var n in t.vendorOptions)this.writeNode("VendorOption",{name:n,value:t.vendorOptions[n]},e);return e},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Protocol.CSW=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.CSW.DEFAULTS);var t=OpenLayers.Protocol.CSW["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSW version: "+e.version;return new t(e)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");var i=e.contents;i.layers;for(var n,s=0,r=i.layers.length;r>s;++s)if(i.layers[s].identifier===t.layer){n=i.layers[s];break}if(!n)throw new Error("Layer not found");var a=t.format;!a&&n.formats&&n.formats.length&&(a=n.formats[0]);var o;if(t.matrixSet?o=i.tileMatrixSets[t.matrixSet]:n.tileMatrixSetLinks.length>=1&&(o=i.tileMatrixSets[n.tileMatrixSetLinks[0].tileMatrixSet]),!o)throw new Error("matrixSet not found");for(var l,s=0,r=n.styles.length;r>s&&(l=n.styles[s],!l.isDefault);++s);var u=t.requestEncoding;if(!u&&(u="KVP",e.operationsMetadata.GetTile.dcp.http)){var h=e.operationsMetadata.GetTile.dcp.http;if(h.get[0].constraints){var c=h.get[0].constraints;!c.GetEncoding.allowedValues.KVP&&c.GetEncoding.allowedValues.REST&&(u="REST")}}var p=[],d=t.params||{};delete t.params;for(var m=0,f=n.dimensions.length;f>m;m++){var y=n.dimensions[m];p.push(y.identifier),d.hasOwnProperty(y.identifier)||(d[y.identifier]=y["default"])}var g=t.projection||o.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),v=t.units||("EPSG:4326"===g?"degrees":"m"),b=[];if(t.isBaseLayer!==!1)for(var L in o.matrixIds)o.matrixIds.hasOwnProperty(L)&&b.push(28e-5*o.matrixIds[L].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[v]);var O;if("REST"===u&&n.resourceUrls){O=[];var w;n.resourceUrls;for(var _=0,x=n.resourceUrls.length;x>_;++_)w=n.resourceUrls[_],w.format===a&&"tile"===w.resourceType&&O.push(w.template)}else{var S=e.operationsMetadata.GetTile.dcp.http.get;O=[];for(var C,s=0,r=S.length;r>s;s++)C=S[s].constraints,(!C||C&&C.GetEncoding.allowedValues[u])&&O.push(S[s].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:O,requestEncoding:u,name:n.title,style:l.identifier,format:a,matrixIds:o.matrixIds,matrixSet:o.identifier,projection:g,units:v,resolutions:t.isBaseLayer===!1?void 0:b,tileFullExtent:o.bounds,dimensions:p,params:d}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var e,t=OpenLayers.Layer.Google.cache[this.map.id];if(t)e=t.mapObject,++t.count;else{var i=this.map.viewPortDiv,n=document.createElement("div");n.id=this.map.id+"_GMapContainer",n.style.position="absolute",n.style.width="100%",n.style.height="100%",i.appendChild(n);var s=this.map.getCenter();e=new google.maps.Map(n,{center:s?new google.maps.LatLng(s.lat,s.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),t={mapObject:e,count:1},OpenLayers.Layer.Google.cache[this.map.id]=t,this.repositionListener=google.maps.event.addListenerOnce(e,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))}this.mapObject=e,this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var e=this.mapObject.getDiv().firstChild;if(!e||e.childNodes.length<3)return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1;for(var t=OpenLayers.Layer.Google.cache[this.map.id],i=this.map.viewPortDiv,n=e.children.length-1;n>=0;--n){if(1000001==e.children[n].style.zIndex){var s=e.children[n];i.appendChild(s),s.style.zIndex="1100",s.style.bottom="",s.className="olLayerGoogleCopyright olLayerGoogleV3",s.style.display="",t.termsOfUse=s}if(1e6==e.children[n].style.zIndex){var r=e.children[n];i.appendChild(r),r.style.zIndex="1100",r.style.bottom="",r.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",r.style.display="",t.poweredBy=r}10000002==e.children[n].style.zIndex&&i.appendChild(e.children[n])}this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility)google.maps.event.trigger(this.mapObject,"resize");else{var e=OpenLayers.Layer.Google.cache[this.map.id];if(!e.resized){var t=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(t.mapObject,"resize"),t.moveTo(t.map.getCenter(),t.map.getZoom()),delete e.resized})}e.resized=!0}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){for(var i,n=this.type,s=this.map.layers,r=s.length-1;r>=0;--r)if(i=s[r],i instanceof OpenLayers.Layer.Google&&i.visibility===!0&&i.inRange===!0){n=i.type,e=!0;break}var a=this.mapObject.getDiv();e===!0?(this.mapObject.setMapTypeId(n),a.style.left="",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.left="",t.termsOfUse.style.display="",t.poweredBy.style.display=""),t.displayed=this.id):(delete t.displayed,a.style.left="-9999px",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.display="none",t.termsOfUse.style.left="-9999px",t.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),n=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lon),new google.maps.LatLng(n.lat,n.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize(),i=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),n=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),s=this.map.getResolution(),r=e.x-t.w/2,a=e.y-t.h/2,o=new OpenLayers.LonLat(i+r*s,n-a*s);return this.wrapDateLine&&(o=o.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(o.lon,o.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e),i=this.getLatitudeFromMapObjectLonLat(e),n=this.map.getResolution(),s=this.map.getExtent();return this.getMapObjectPixelFromXY(1/n*(t-s.left),1/n*(s.top-i))},setMapObjectCenter:function(e,t){if(this.animationEnabled===!1&&t!=this.mapObject.zoom){var i=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){i.style.visibility=""}),i.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var n=this.inverseMercator(e,t);i=new google.maps.LatLng(n.lat,n.lon)}else i=new google.maps.LatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener),this.repositionTimer&&window.clearTimeout(this.repositionTimer),OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);
var t={};return this.readNode(e,t),t},readers:{wps:{ProcessDescriptions:function(e,t){t.processDescriptions={},this.readChildNodes(e,t.processDescriptions)},ProcessDescription:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),n={processVersion:i,statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,n),t[n.identifier]=n},DataInputs:function(e,t){t.dataInputs=[],this.readChildNodes(e,t.dataInputs)},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},ComplexOutput:function(e,t){t.complexOutput={},this.readChildNodes(e,t.complexOutput)},LiteralOutput:function(e,t){t.literalOutput={},this.readChildNodes(e,t.literalOutput)},Input:function(e,t){var i={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,i),t.push(i)},BoundingBoxData:function(e,t){t.boundingBoxData={},this.readChildNodes(e,t.boundingBoxData)},CRS:function(e,t){t.CRSs||(t.CRSs={}),t.CRSs[this.getChildValue(e)]=!0},LiteralData:function(e,t){t.literalData={},this.readChildNodes(e,t.literalData)},ComplexData:function(e,t){t.complexData={},this.readChildNodes(e,t.complexData)},Default:function(e,t){t["default"]={},this.readChildNodes(e,t["default"])},Supported:function(e,t){t.supported={},this.readChildNodes(e,t.supported)},Format:function(e,t){var i={};this.readChildNodes(e,i),t.formats||(t.formats={}),t.formats[i.mimeType]=!0},MimeType:function(e,t){t.mimeType=this.getChildValue(e)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,n;e=e.replace(/[\n\r]/g," ");var s=this.regExes.typeStr.exec(e);if(s&&(i=s[1].toLowerCase(),n=s[2],this.parse[i]&&(t=this.parse[i].apply(this,[n])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var r=0,a=t.length;a>r;r++){var o=t[r];o.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,n;e.constructor==Array?(t=e,n=!0):(t=[e],n=!1);var s=[];n&&s.push("GEOMETRYCOLLECTION(");for(var r=0,a=t.length;a>r;++r)n&&r>0&&s.push(","),i=t[r].geometry,s.push(this.extractGeometry(i));return n&&s.push(")"),s.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),n=i+"("+this.extract[t].apply(this,[e])+")";return n},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),n=[],s=0,r=i.length;r>s;++s)t=i[s].replace(this.regExes.trimParens,"$1"),n.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(n))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],n=0,s=t.length;s>n;++n)i.push(this.parse.point.apply(this,[t[n]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),n=[],s=0,r=i.length;r>s;++s)t=i[s].replace(this.regExes.trimParens,"$1"),n.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(n))},polygon:function(e){for(var t,i,n,s=OpenLayers.String.trim(e).split(this.regExes.parenComma),r=[],a=0,o=s.length;o>a;++a)t=s[a].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,n=new OpenLayers.Geometry.LinearRing(i.components),r.push(n);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(r))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),n=[],s=0,r=i.length;r>s;++s)t=i[s].replace(this.regExes.trimParens,"$1"),n.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(n))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],n=0,s=t.length;s>n;++n)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[n]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(e){if(e=e||{},this.description){if(e.callback){var t=this.description;window.setTimeout(function(){e.callback.call(e.scope,t)},0)}}else this.client.describeProcess(this.server,this.identifier,function(t){this.description||this.parseDescription(t),e.callback&&e.callback.call(e.scope,this.description)},this)},configure:function(e){return this.describe({callback:function(){var t,i,n,s=this.description,r=e.inputs;for(i=0,n=s.dataInputs.length;n>i;++i)t=s.dataInputs[i],this.setInputData(t,r[t.identifier]);e.callback&&e.callback.call(e.scope)},scope:this}),this},execute:function(e){this.configure({inputs:e.inputs,callback:function(){var t=this,i=this.getOutputIndex(t.description.processOutputs,e.output);t.setResponseForm({outputIndex:i}),function n(){return OpenLayers.Util.removeItem(t.executeCallbacks,n),0!==t.chained?(t.executeCallbacks.push(n),void 0):(OpenLayers.Request.POST({url:t.client.servers[t.server].url,data:(new OpenLayers.Format.WPSExecute).write(t.description),success:function(n){var s=t.description.processOutputs[i],r=t.findMimeType(s.complexOutput.supported.formats),a=t.formats[r].read(n.responseText);if(a instanceof OpenLayers.Feature.Vector&&(a=[a]),e.success){var o={};o[e.output||"result"]=a,e.success.call(e.scope,o)}},scope:t}),void 0)}()},scope:this})},output:function(e){return new OpenLayers.WPSProcess.ChainLink({process:this,output:e})},parseDescription:function(){var e=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(e.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(e,t){if(delete e.data,delete e.reference,t instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,e.reference={method:"POST",href:t.process.server===this.server?this.localWPS:this.client.servers[t.process.server].url},t.process.describe({callback:function(){--this.chained,this.chainProcess(e,t)},scope:this});else{e.data={};var i=e.complexData;if(i){var n=this.findMimeType(i.supported.formats);e.data.complexData={mimeType:n,value:this.formats[n].write(this.toFeatures(t))}}else e.data.literalData={value:t}}},setResponseForm:function(e){e=e||{};var t=this.description.processOutputs[e.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:t.identifier,mimeType:this.findMimeType(t.complexOutput.supported.formats,e.supportedFormats)}}},getOutputIndex:function(e,t){var i;if(t){for(var n=e.length-1;n>=0;--n)if(e[n].identifier===t){i=n;break}}else i=0;return i},chainProcess:function(e,t){var i=this.getOutputIndex(t.process.description.processOutputs,t.output);e.reference.mimeType=this.findMimeType(e.complexData.supported.formats,t.process.description.processOutputs[i].complexOutput.supported.formats);var n={};for(n[e.reference.mimeType]=!0,t.process.setResponseForm({outputIndex:i,supportedFormats:n}),e.reference.body=t.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(e){var t=OpenLayers.Util.isArray(e);t||(e=[e]);for(var i,n=new Array(e.length),s=0,r=e.length;r>s;++s)i=e[s],n[s]=i instanceof OpenLayers.Feature.Vector?i:new OpenLayers.Feature.Vector(i);return t?n:n[0]},findMimeType:function(e,t){t=t||this.formats;for(var i in e)if(i in t)return i},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(e){OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.servers={};for(var t in e.servers)this.servers[t]="string"==typeof e.servers[t]?{url:e.servers[t],version:this.version,processDescription:{}}:e.servers[t]},execute:function(e){var t=this.getProcess(e.server,e.process);t.execute({inputs:e.inputs,success:e.success,scope:e.scope})},getProcess:function(e,t){var i=new OpenLayers.WPSProcess({client:this,server:e,identifier:t});return this.lazy||i.describe(),i},describeProcess:function(e,t,i,n){var s=this.servers[e];s.processDescription[t]?window.setTimeout(function(){i.call(n,s.processDescription[t])},0):t in s.processDescription?this.events.register("describeprocess",this,function r(e){e.identifier===t&&(this.events.unregister("describeprocess",this,r),i.call(n,e.raw))}):(s.processDescription[t]=null,OpenLayers.Request.GET({url:s.url,params:{SERVICE:"WPS",VERSION:s.version,REQUEST:"DescribeProcess",IDENTIFIER:t},success:function(e){s.processDescription[t]=e.responseText,this.events.triggerEvent("describeprocess",{identifier:t,raw:e.responseText})},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[],this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");""!=i&&(t.version=i)},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");""!=i&&(t.SearchStatus.timestamp=i)},SearchResults:function(e,t){this.readChildNodes(e,t);for(var i=e.attributes,n={},s=0,r=i.length;r>s;++s)n[i[s].name]="numberOfRecordsMatched"==i[s].name||"numberOfRecordsReturned"==i[s].name||"nextRecord"==i[s].name?parseInt(i[s].nodeValue):i[s].nodeValue;t.SearchResults=n},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i),t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i),t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i),t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i),t.records.push(i)},"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();t[i]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i),t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=[]);for(var n={},s=e.attributes,r=0,a=s.length;a>r;++r)n[s[r].name]=s[r].nodeValue;n.value=this.getChildValue(e),""!=n.value&&t[i].push(n)}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=[]),t[i].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(e,t){t.bounds&&(t.BoundingBox=[{crs:t.projection,value:[t.bounds.left,t.bounds.bottom,t.bounds.right,t.bounds.top]}],delete t.projection,delete t.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var t=this.writeNode("csw:GetRecords",e);return t.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){e||(e={});var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});(e.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t);var i=e.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var n=0,s=i.length;s>n;n++)this.writeNode("csw:ResponseHandler",i[n],t);return this.writeNode("Query",e.Query||this.Query,t),t},DistributedSearch:function(e){var t=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}});return t},ResponseHandler:function(e){var t=this.createElementNSPlus("csw:ResponseHandler",{value:e.value});return t},Query:function(e){e||(e={});var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}}),i=e.ElementName;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var n=0,s=i.length;s>n;n++)this.writeNode("csw:ElementName",i[n],t);else this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t);return e.Constraint&&this.writeNode("csw:Constraint",e.Constraint,t),e.SortBy&&this.writeNode("ogc:SortBy",e.SortBy,t),t},ElementName:function(e){var t=this.createElementNSPlus("csw:ElementName",{value:e.value});return t},ElementSetName:function(e){var t=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value});return t},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new OpenLayers.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var n=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(n)}return t}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(e,t,i){this.bounds=e,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(t,i)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(e,t){e||(e="red"),t||(t=2),this.div.style.border=t+"px solid "+e},draw:function(e,t){return OpenLayers.Util.modifyDOMElement(this.div,null,e,t),this.div},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsBounds(this.bounds,!0,!0)}return e},display:function(e){this.div.style.display=e?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(e){e=e||{},e.extractStyles!==!1&&(e.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){for(var t,i=e.split("\n"),n=[],s=0;s<i.length-1;s++){var r=i[s].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=r.charAt(0))if(t){for(var a=r.split("	"),o=new OpenLayers.Geometry.Point(0,0),l={},u=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,h=!1,c=0;c<a.length;c++)if(a[c])if("point"==t[c]){var p=a[c].split(",");o.y=parseFloat(p[0]),o.x=parseFloat(p[1]),h=!0}else if("lat"==t[c])o.y=parseFloat(a[c]),h=!0;else if("lon"==t[c])o.x=parseFloat(a[c]),h=!0;else if("title"==t[c])l.title=a[c];else if("image"==t[c]||"icon"==t[c]&&u)u.externalGraphic=a[c];else if("iconSize"==t[c]&&u){var d=a[c].split(",");u.graphicWidth=parseFloat(d[0]),u.graphicHeight=parseFloat(d[1])}else if("iconOffset"==t[c]&&u){var m=a[c].split(",");u.graphicXOffset=parseFloat(m[0]),u.graphicYOffset=parseFloat(m[1])}else"description"==t[c]?l.description=a[c]:"overflow"==t[c]?l.overflow=a[c]:l[t[c]]=a[c];if(h){this.internalProjection&&this.externalProjection&&o.transform(this.externalProjection,this.internalProjection);var f=new OpenLayers.Feature.Vector(o,l,u);n.push(f)}}else t=r.split("	")}return n},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var e=function(){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:e,scope:this}),this.loaded=!0}},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(e){var t=e.responseText,i={};OpenLayers.Util.extend(i,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());for(var n=new OpenLayers.Format.Text(i),s=n.read(t),r=0,a=s.length;a>r;r++){var o,l,u,h={},c=s[r];o=new OpenLayers.LonLat(c.geometry.x,c.geometry.y),c.style.graphicWidth&&c.style.graphicHeight&&(l=new OpenLayers.Size(c.style.graphicWidth,c.style.graphicHeight)),void 0!==c.style.graphicXOffset&&void 0!==c.style.graphicYOffset&&(u=new OpenLayers.Pixel(c.style.graphicXOffset,c.style.graphicYOffset)),null!=c.style.externalGraphic?h.icon=new OpenLayers.Icon(c.style.externalGraphic,l,u):(h.icon=OpenLayers.Marker.defaultIcon(),null!=l&&h.icon.setSize(l)),null!=c.attributes.title&&null!=c.attributes.description&&(h.popupContentHTML="<h2>"+c.attributes.title+"</h2>"+"<p>"+c.attributes.description+"</p>"),h.overflow=c.attributes.overflow||"auto";var p=new OpenLayers.Feature(this,o,h);this.features.push(p);var d=p.createMarker();null!=c.attributes.title&&null!=c.attributes.description&&d.events.register("click",p,this.markerClick),this.addMarker(d)}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,n=this.layer.map.popups.length;n>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);t||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),e=!0}return e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius;var t=this.layer.getLonLatFromViewPortPx(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var n=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,n)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var s,r=i.x-this.origin.x,a=i.y-this.origin.y;s=0==a?r/(this.radius*Math.sqrt(2)):r/a,this.feature.geometry.resize(1,this.origin,s),this.feature.geometry.move(r/2,a/2)}this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var n=0;n<this.sides;++n)t=i.components[n],e=this.angle+2*n*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var n=Math.PI/180*this.snapAngle;this.angle=Math.round(i/n)*n}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new e(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var e in this.layerCache)delete this.layerCache[e];for(var e in this.wfsCache)delete this.wfsCache[e];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(e){this.setVisibility(e.object.getVisibility())},createSelectionLayer:function(e){var t;return this.layerCache[e.id]?t=this.layerCache[e.id]:(t=new OpenLayers.Layer.WMS(e.name,e.url,e.params,OpenLayers.Util.applyDefaults(this.layerOptions,e.getOptions())),this.layerCache[e.id]=t,this.layerOptions.displayInLayerSwitcher===!1&&e.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:t}),this.map.addLayer(t)),t},createSLD:function(e,t,i){for(var n={version:"1.0.0",namedLayers:{}},s=[e.params.LAYERS].join(",").split(","),r=0,a=s.length;a>r;r++){var o=s[r];n.namedLayers[o]={name:o,userStyles:[]};var l=this.selectionSymbolizer,u=i[r];u.type.indexOf("Polygon")>=0?l={Polygon:this.selectionSymbolizer.Polygon}:u.type.indexOf("LineString")>=0?l={Line:this.selectionSymbolizer.Line}:u.type.indexOf("Point")>=0&&(l={Point:this.selectionSymbolizer.Point});var h=t[r];n.namedLayers[o].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:h,maxScaleDenominator:e.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(n)},parseDescribeLayer:function(e){var t=new OpenLayers.Format.WMSDescribeLayer,i=e.responseXML;i&&i.documentElement||(i=e.responseText);for(var n=t.read(i),s=[],r=null,a=0,o=n.length;o>a;a++)"WFS"==n[a].owsType&&(s.push(n[a].typeName),r=n[a].owsURL);var l={url:r,params:{SERVICE:"WFS",TYPENAME:s.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(e){var t=new OpenLayers.Format.WFSDescribeFeatureType,i=e.responseXML;i&&i.documentElement||(i=e.responseText);var n=t.read(i);this.control.wfsCache[this.layer.id]=n,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(l)},getGeometryAttributes:function(e){for(var t=[],i=this.wfsCache[e.id],n=0,s=i.featureTypes.length;s>n;n++)for(var r=i.featureTypes[n],a=r.properties,o=0,l=a.length;l>o;o++){var u=a[o],h=u.type;(h.indexOf("LineString")>=0||h.indexOf("GeometryAssociationType")>=0||h.indexOf("GeometryPropertyType")>=0||h.indexOf("Point")>=0||h.indexOf("Polygon")>=0)&&t.push(u)}return t},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);if(e)for(var t=0,i=this.layers.length;i>t;t++){var n=this.layers[t];if(n&&!this.wfsCache[n.id]){var s={url:n.url,params:{SERVICE:"WMS",VERSION:n.params.VERSION,LAYERS:n.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:n,control:this}};OpenLayers.Request.GET(s)}}return e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);if(e)for(var t=0,i=this.layers.length;i>t;t++){var n=this.layers[t];if(n&&this.clearOnDeactivate===!0){var s=this.layerCache,r=s[n.id];r&&(n.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:r}),r.destroy(),delete s[n.id])}}return e},setLayers:function(e){this.active?(this.deactivate(),this.layers=e,this.activate()):this.layers=e},createFilter:function(e,t){var i=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?i=this.handler.irregular===!0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e.name,value:t.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Polygon?i=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Path?i=e.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Click&&(i=e.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t})),i},select:function(e){this._queue=function(){for(var t=0,i=this.layers.length;i>t;t++){for(var n=this.layers[t],s=this.getGeometryAttributes(n),r=[],a=0,o=s.length;o>a;a++){var l=s[a];if(null!==l){if(!(e instanceof OpenLayers.Geometry)){var u=this.map.getLonLatFromPixel(e.xy);e=new OpenLayers.Geometry.Point(u.lon,u.lat)}var h=this.createFilter(l,e);null!==h&&r.push(h)}}var c=this.createSelectionLayer(n);this.events.triggerEvent("selected",{layer:n,filters:r});var p=this.createSLD(n,r,s);c.mergeNewParams({SLD_BODY:p}),delete this._queue}},this.applySelection()},applySelection:function(){for(var e=!0,t=0,i=this.layers.length;i>t;t++)if(!this.wfsCache[this.layers[t].id]){e=!1;break}e&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.element=OpenLayers.Util.getElement(e)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var e;if(this.geodesic===!0){var t=this.map.getUnits();if(!t)return;var i=OpenLayers.INCHES_PER_UNIT;e=(this.map.getGeodesicPixelSize().w||1e-6)*i.km*OpenLayers.DOTS_PER_INCH}else e=this.map.getScale();e&&(e=e>=9500&&95e4>=e?Math.round(e/1e3)+"K":e>=95e4?Math.round(e/1e6)+"M":Math.round(e),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:e}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(e,t,i,n){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),(null==n||null==n.isBaseLayer)&&(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),n&&null!=n.useOverlay&&(this.useOverlay=n.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))
},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t,i=e.getCenterLonLat(),n=this.map.getSize();if(this.singleTile){var s={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:n.h*this.ratio,setdisplaywidth:n.w*this.ratio,setviewcenterx:i.lon,setviewcentery:i.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var r={};r=OpenLayers.Util.extend(r,s),r.operation="GETVISIBLEMAPEXTENT",r.version="1.0.0",r.session=this.params.session,r.mapName=this.params.mapName,r.format="text/xml",t=this.getFullRequestString(r),OpenLayers.Request.GET({url:t,async:!1})}t=this.getFullRequestString(s)}else{var a=this.map.getResolution(),o=Math.floor((e.left-this.maxExtent.left)/a);o=Math.round(o/this.tileSize.w);var l=Math.floor((this.maxExtent.top-e.top)/a);l=Math.round(l/this.tileSize.h),t=this.useHttpTile?this.getImageFilePath({tilecol:o,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:o,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1})}return t},getFullRequestString:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var n=i,s=OpenLayers.Util.extend({},this.params);s=OpenLayers.Util.extend(s,e);var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var a in s)a.toUpperCase()in r&&delete s[a];var o=OpenLayers.Util.getParameterString(s);if(o=o.replace(/,/g,"+"),""!=o){var l=i.charAt(i.length-1);n+="&"==l||"?"==l?o:-1==i.indexOf("?")?"?"+o:"&"+o}return n},getImageFilePath:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var n=i,s="",r="";e.tilerow<0&&(s="-"),s+=0==e.tilerow?"0":Math.floor(Math.abs(e.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,e.tilecol<0&&(r="-"),r+=0==e.tilecol?"0":Math.floor(Math.abs(e.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var a="/S"+Math.floor(e.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+s+"/C"+r+"/"+e.tilerow%this.params.tileRowsPerFolder+"_"+e.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(a+="?"+this.params.querystring),n+=a},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){this.immediate=e,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&this.deactivate(),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var i,n;e.CLASS_NAME.indexOf("LineString")>-1?(i=this.getBestLength(e),n=1):(i=this.getBestArea(e),n=2),this.events.triggerEvent(t,{measure:i[0],units:i[1],order:n,geometry:e})},getBestArea:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],s=0,r=n.length;r>s&&(t=n[s],i=this.getArea(e,t),!(i>1));++s);return[i,t]},getArea:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),n="m"):(i=e.getArea(),n=this.map.getUnits());var s=OpenLayers.INCHES_PER_UNIT[t];if(s){var r=OpenLayers.INCHES_PER_UNIT[n];i*=Math.pow(r/s,2)}return i},getBestLength:function(e){for(var t,i,n=this.displaySystemUnits[this.displaySystem],s=0,r=n.length;r>s&&(t=n[s],i=this.getLength(e,t),!(i>1));++s);return[i,t]},getLength:function(e,t){var i,n;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),n="m"):(i=e.getLength(),n=this.map.getUnits());var s=OpenLayers.INCHES_PER_UNIT[t];if(s){var r=OpenLayers.INCHES_PER_UNIT[n];i*=r/s}return i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])},read_wmc_SRS:function(e,t){var i=this.getChildValue(t);"object"!=typeof e.projections&&(e.projections={});for(var n=i.split(/ +/),s=0,r=n.length;r>s;s++)e.projections[n[s]]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.srs){var i=[];for(var n in e.srs)i.push(n);t.appendChild(this.createElementDefaultNS("SRS",i.join(" ")))}t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};i.layers=[],this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,n=this.getChildValue(e),s=n.split(" ");if(t.supportedCRS){var r=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[r]}t.topLeftCorner=i?new OpenLayers.LonLat(s[1],s[0]):new OpenLayers.LonLat(s[0],s[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var n=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(n)},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},LegendURL:function(e,t){t.legend={},t.legend.href=e.getAttribute("xlink:href"),t.legend.format=e.getAttribute("format")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t["default"]=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(e,t,i,n,s,r){this.lzd=i,this.zoomLevels=n;var a=[];a.push(e,t,s,r),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var e=this.map.getZoom();return this.map.getMaxExtent(),e-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(e){e=this.adjustBounds(e);var t=this.getZoom(),i=this.map.getMaxExtent(),n=this.lzd/Math.pow(2,this.getZoom()),s=Math.floor((e.left-i.left)/n),r=Math.floor((e.bottom-i.bottom)/n);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:t,X:s,Y:r}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{gml:OpenLayers.Util.applyDefaults({name:function(e,t){t.name=this.getChildValue(e)},TimePeriod:function(e,t){t.timePeriod={},this.readChildNodes(e,t.timePeriod)},beginPosition:function(e,t){t.beginPosition=this.getChildValue(e)},endPosition:function(e,t){t.endPosition=this.getChildValue(e)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},this.readChildNodes(e,t.contents)},ObservationOfferingList:function(e,t){t.offeringList={},this.readChildNodes(e,t.offeringList)},ObservationOffering:function(e,t){var i=this.getAttributeNS(e,this.namespaces.gml,"id");t[i]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(e,t[i])},time:function(e,t){t.time={},this.readChildNodes(e,t.time)},procedure:function(e,t){t.procedures.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},observedProperty:function(e,t){t.observedProperties.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},featureOfInterest:function(e,t){t.featureOfInterestIds.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},responseFormat:function(e,t){t.responseFormats.push(this.getChildValue(e))},resultModel:function(e,t){t.resultModels.push(this.getChildValue(e))},responseMode:function(e,t){t.responseModes.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;return this.pinching=!1,OpenLayers.Event.isMultiTouch(e)?(this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown):(this.started=!1,this.start=null,this.last=null),OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}return!0},touchend:function(e){return this.started&&(this.started=!1,this.pinching=!1,this.callback("done",[e,this.start,this.last]),this.start=null,this.last=null),!0},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,e=!0),e},getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(t.clientX-i.clientX,2)+Math.pow(t.clientY-i.clientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:i}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e){this.pinchOrigin=e.xy,this.currentCenter=e.xy},pinchMove:function(e,t){var i=t.scale,n=this.map.layerContainerOriginPx,s=this.pinchOrigin,r=e.xy,a=Math.round(r.x-s.x+(i-1)*(n.x-s.x)),o=Math.round(r.y-s.y+(i-1)*(n.y-s.y));this.applyTransform("translate("+a+"px, "+o+"px) scale("+i+")"),this.currentCenter=r},applyTransform:function(e){var t=this.map.layerContainerDiv.style,i=OpenLayers.Util.vendorPrefix.style("transform");i&&(t[i]=e)},pinchDone:function(e,t,i){this.applyTransform("");var n=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var s=this.map.getResolutionForZoom(n),r=this.map.getLonLatFromPixel(this.pinchOrigin),a=this.currentCenter,o=this.map.getSize();r.lon+=s*(o.w/2-a.x),r.lat-=s*(o.h/2-a.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(r,n)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.stop(),e},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(e){var t=new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(t),this.events.triggerEvent("locationupdated",{position:e,point:new OpenLayers.Geometry.Point(t.lon,t.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(e){this.events.triggerEvent("locationfailed",{error:e})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(e,t,i,n){var s=[];i=OpenLayers.Util.upperCaseObject(i),s.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.projection.getCode().split(":"),i=t[t.length-1],n=this.getImageSize(),s={BBOX:e.toBBOX(),SIZE:n.w+","+n.h,F:"image",BBOXSR:i,IMAGESR:i};if(this.layerDefs){var r,a=[];for(r in this.layerDefs)this.layerDefs.hasOwnProperty(r)&&this.layerDefs[r]&&(a.push(r),a.push(":"),a.push(this.layerDefs[r]),a.push(";"));a.length>0&&(s.LAYERDEFS=a.join(""))}var o=this.getFullRequestString(s);return o},setLayerFilter:function(e,t){this.layerDefs||(this.layerDefs={}),t?this.layerDefs[e]=t:delete this.layerDefs[e]},clearLayerFilter:function(e){e?delete this.layerDefs[e]:delete this.layerDefs},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){return this.passesTolerance(e.xy)&&(this.clearTimer(),this.callback("move",[e]),this.px=e.xy,e=OpenLayers.Util.extend({},e),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)),!this.stopMove},mouseout:function(e){return OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[e])),!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),e=!0),e},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(e){e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var e in this.handlers)this.handlers[e].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var e in this.handlers)this.handlers[e].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(e){var t=this.pixelToBounds(e.xy);this.setModifiers(e),this.request(t,{single:this.single})},selectBox:function(e){var t;if(e instanceof OpenLayers.Bounds){var i=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),n=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(i.lon,i.lat,n.lon,n.lat)}else{if(this.click)return;t=this.pixelToBounds(e)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(t)},selectHover:function(e){var t=this.pixelToBounds(e.xy);this.request(t,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,t){t=t||{};var i=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var n=this.protocol.read({maxFeatures:1==t.single?this.maxFeatures:void 0,filter:i,callback:function(i){i.success()&&(i.features.length?1==t.single?this.selectBestFeature(i.features,e.getCenterLonLat(),t):this.select(i.features):t.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==t.hover&&(this.hoverResponse=n)},selectBestFeature:function(e,t,i){if(i=i||{},e.length){for(var n,s,r,a=new OpenLayers.Geometry.Point(t.lon,t.lat),o=Number.MAX_VALUE,l=0;l<e.length&&(n=e[l],!(n.geometry&&(r=a.distanceTo(n.geometry,{edge:!1}),o>r&&(o=r,s=n,0==o))));++l);1==i.hover?this.hoverSelect(s):this.select(s||e)}},setModifiers:function(e){this.modifiers={multiple:this.multiple||this.multipleKey&&e[this.multipleKey],toggle:this.toggle||this.toggleKey&&e[this.toggleKey]}},select:function(e){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(e)||(e=[e]);var t=this.events.triggerEvent("beforefeaturesselected",{features:e});if(t!==!1){for(var i,n=[],s=0,r=e.length;r>s;++s)i=e[s],this.features[i.fid||i.id]?this.modifiers.toggle&&this.unselect(this.features[i.fid||i.id]):(t=this.events.triggerEvent("beforefeatureselected",{feature:i}),t!==!1&&(this.features[i.fid||i.id]=i,n.push(i),this.events.triggerEvent("featureselected",{feature:i})));this.events.triggerEvent("featuresselected",{features:n})}},hoverSelect:function(e){var t=e?e.fid||e.id:null,i=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;i&&i!=t&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),t&&t!=i&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(e){delete this.features[e.fid||e.id],this.events.triggerEvent("featureunselected",{feature:e})},unselectAll:function(){for(var e in this.features)this.unselect(this.features[e])},setMap:function(e){for(var t in this.handlers)this.handlers[t].setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(e){var t=e.add(-this.clickTolerance/2,this.clickTolerance/2),i=e.add(this.clickTolerance/2,-this.clickTolerance/2),n=this.map.getLonLatFromPixel(t),s=this.map.getLonLatFromPixel(i);return new OpenLayers.Bounds(n.lon,n.lat,s.lon,s.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function e(e){return e=e.replace(/%/g,"\\%"),e=e.replace(/\\\\\.(\*)?/g,function(e,t){return t?e:"\\\\_"}),e=e.replace(/\\\\\.\*/g,"\\\\%"),e=e.replace(/(\\)?\.(\*)?/g,function(e,t,i){return t||i?e:"_"}),e=e.replace(/(\\)?\.\*/g,function(e,t){return t?e:"%"}),e=e.replace(/\\\./g,"."),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"*"})}var t={};return t[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",t[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",t[OpenLayers.Filter.Comparison.LESS_THAN]="lt",t[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",t[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",t[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",t[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(i,n){n=n||{};var s=i.CLASS_NAME,r=s.substring(s.lastIndexOf(".")+1);switch(r){case"Spatial":switch(i.type){case OpenLayers.Filter.Spatial.BBOX:n.bbox=i.value.toArray(),this.srsInBBOX&&i.projection&&n.bbox.push(i.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:n.tolerance=i.distance;case OpenLayers.Filter.Spatial.WITHIN:n.lon=i.value.x,n.lat=i.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+i.type)}break;case"Comparison":var a=t[i.type];if(void 0!==a){var o=i.value;i.type==OpenLayers.Filter.Comparison.LIKE&&(o=e(o),this.wildcarded&&(o="%"+o+"%")),n[i.property+"__"+a]=o,n.queryable=n.queryable||[],n.queryable.push(i.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+i.type);break;case"Logical":if(i.type===OpenLayers.Filter.Logical.AND)for(var l=0,u=i.filters.length;u>l;l++)n=this.write(i.filters[l],n);else OpenLayers.Console.warn("Unsupported logical filter type "+i.type);break;default:OpenLayers.Console.warn("Unknown filter type "+r)}return n},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(e){var t;if(null==e)return this.reset(),void 0;if(null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity)return this.lastXy=e.xy,void 0;
if(t=this.map.getLonLatFromPixel(e.xy)){this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy;var i=this.formatOutput(t);i!=this.element.innerHTML&&(this.element.innerHTML=i)}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits),i=this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix;return i},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var t=new OpenLayers.Protocol.Script({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=e.data},scope:this});t.read(),this.request=t}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),200===e.status&&this.parseData(e.responseText)},scope:this});else this.unload();return e},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(e,t){var i=null;if(this.json){var n=this.getFeatureId(e,t);null!==n&&(i={id:n,data:this.json.data[n]})}return i},getFeatureId:function(e,t){var i=null;if(this.json){var n=this.utfgridResolution,s=Math.floor(t/n),r=Math.floor(e/n),a=this.json.grid[s].charCodeAt(r),o=this.indexFromCharCode(a),l=this.json.keys;!isNaN(o)&&o in l&&(i=l[o])}return i},indexFromCharCode:function(e){return e>=93&&e--,e>=35&&e--,e-32},parseData:function(e){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(e)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions),this.previous=new OpenLayers.Control.Button(t);var i={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(i,this.nextOptions),this.next=new OpenLayers.Control.Button(i),this.clear()},onPreviousChange:function(e){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e,this.next.setMap(e),this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();return void 0!=t?(this.nextStack.unshift(e),this.previousStack.unshift(t),this.restoring=!0,this.restore(t),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(e),t},nextTrigger:function(){var e=this.nextStack.shift();return void 0!=e&&(this.previousStack.unshift(e),this.restoring=!0,this.restore(e),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),e},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,i;if(this.map.getProjectionObject()==e.projection)i=this.map.getZoomForResolution(e.resolution),t=e.center;else{t=e.center.clone(),t.transform(e.projection,this.map.getProjectionObject());var n=e.units,s=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,r=n&&s?OpenLayers.INCHES_PER_UNIT[n]/OpenLayers.INCHES_PER_UNIT[s]:1;i=this.map.getZoomForResolution(r*e.resolution)}this.map.setCenter(t,i)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0,0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear(),e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var n=e.headers||{};n["Content-Type"]="application/x-www-form-urlencoded",i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:n})}else i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers});return i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),s=this.updateWithPOST?"POST":"PUT";return n.priv=OpenLayers.Request[s]({url:i,callback:this.createCallback(this.handleUpdate,n,t),headers:t.headers,data:this.format.write(e)}),n},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),s=this.deleteWithPOST?"POST":"DELETE",r={url:i,callback:this.createCallback(this.handleDelete,n,t),headers:t.headers};return this.deleteWithPOST&&(r.data=this.format.write(e)),n.priv=OpenLayers.Request[s](r),n},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&i.status<300?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=new Array(t),s=0;t>s;++s)i[s]=e.features[s].fid;m.insertIds=i,n.apply(this,[e])}function n(e){this.callUserCallback(e,t),d=d&&e.success(),r++,r>=p&&t.callback&&(m.code=d?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[m]))}t=OpenLayers.Util.applyDefaults(t,this.options);var s=[],r=0,a={};a[OpenLayers.State.INSERT]=[],a[OpenLayers.State.UPDATE]=[],a[OpenLayers.State.DELETE]=[];for(var o,l,u=[],h=0,c=e.length;c>h;++h)o=e[h],l=a[o.state],l&&(l.push(o),u.push(o));var p=(a[OpenLayers.State.INSERT].length>0?1:0)+a[OpenLayers.State.UPDATE].length+a[OpenLayers.State.DELETE].length,d=!0,m=new OpenLayers.Protocol.Response({reqFeatures:u}),f=a[OpenLayers.State.INSERT];f.length>0&&s.push(this.create(f,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),f=a[OpenLayers.State.UPDATE];for(var h=f.length-1;h>=0;--h)s.push(this.update(f[h],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.update)));f=a[OpenLayers.State.DELETE];for(var h=f.length-1;h>=0;--h)s.push(this["delete"](f[h],OpenLayers.Util.applyDefaults({callback:n,scope:this},t["delete"])));return s},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})),e},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this.cluster(),t=!1),t},clearCache:function(){this.features=null},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var i,n,s,r=[],a=0;a<this.features.length;++a)if(i=this.features[a],i.geometry){n=!1;for(var o=r.length-1;o>=0;--o)if(s=r[o],this.shouldCluster(s,i)){this.addToCluster(s,i),n=!0;break}n||r.push(this.createCluster(this.features[a]))}if(this.layer.removeAllFeatures(),r.length>0){if(this.threshold>1){var l=r.slice();r=[];for(var u,a=0,h=l.length;h>a;++a)u=l[a],u.attributes.count<this.threshold?Array.prototype.push.apply(r,u.cluster):r.push(u)}this.clustering=!0,this.layer.addFeatures(r),this.clustering=!1}this.clusters=r}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var i=e.geometry.getBounds().getCenterLonLat(),n=t.geometry.getBounds().getCenterLonLat(),s=Math.sqrt(Math.pow(i.lon-n.lon,2)+Math.pow(i.lat-n.lat,2))/this.resolution;return s<=this.distance},addToCluster:function(e,t){e.cluster.push(t),e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});return i.cluster=[e],i},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),e},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var i,n=0,s=t.length;s>n;++n)i=t[n],this.filter.evaluate(i)?e.features.push(i):this.cache.push(i)}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),t.length>0){var i={features:t};this.handleAdd(i),i.features.length>0&&(this.caching=!0,this.layer.addFeatures(i.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Protocol.SOS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.SOS.DEFAULTS);var t=OpenLayers.Protocol.SOS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported SOS version: "+e.version;return new t(e)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point"),i=this.getElementsByTagNameNS(e,this.geons,"lat"),n=this.getElementsByTagNameNS(e,this.geons,"long"),s=this.getElementsByTagNameNS(e,this.georssns,"line"),r=this.getElementsByTagNameNS(e,this.georssns,"polygon"),a=this.getElementsByTagNameNS(e,this.georssns,"where"),o=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||i.length>0&&n.length>0){var l;t.length>0?(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/),2!=l.length&&(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/))):l=[parseFloat(i[0].firstChild.nodeValue),parseFloat(n[0].firstChild.nodeValue)];var u=new OpenLayers.Geometry.Point(l[1],l[0])}else if(s.length>0){for(var t,h=OpenLayers.String.trim(this.getChildValue(s[0])).split(/\s+/),c=[],p=0,d=h.length;d>p;p+=2)t=new OpenLayers.Geometry.Point(h[p+1],h[p]),c.push(t);u=new OpenLayers.Geometry.LineString(c)}else if(r.length>0){for(var t,h=OpenLayers.String.trim(this.getChildValue(r[0])).split(/\s+/),c=[],p=0,d=h.length;d>p;p+=2)t=new OpenLayers.Geometry.Point(h[p+1],h[p]),c.push(t);u=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(c)])}else if(a.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var m=this.gmlParser.parseFeature(a[0]);u=m.geometry}else if(o.length>0){var t,h=OpenLayers.String.trim(o[0].firstChild.nodeValue).split(/\s+/),c=[];h.length>3&&(t=new OpenLayers.Geometry.Point(h[1],h[0]),c.push(t),t=new OpenLayers.Geometry.Point(h[1],h[2]),c.push(t),t=new OpenLayers.Geometry.Point(h[3],h[2]),c.push(t),t=new OpenLayers.Geometry.Point(h[3],h[0]),c.push(t),t=new OpenLayers.Geometry.Point(h[1],h[0]),c.push(t)),u=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(c)])}return u&&this.internalProjection&&this.externalProjection&&u.transform(this.externalProjection,this.internalProjection),u},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e),i=this._getChildValue(e,"*","title",this.featureTitle),n=this._getChildValue(e,"*","description",this._getChildValue(e,"*","content",this._getChildValue(e,"*","summary",this.featureDescription))),s=this._getChildValue(e,"*","link");if(!s)try{s=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(r){s=null}var a=this._getChildValue(e,"*","id",null),o={title:i,description:n,link:s},l=new OpenLayers.Feature.Vector(t,o);return l.fid=a,l},_getChildValue:function(e,t,i,n){var s,r=this.getElementsByTagNameNS(e,t,i);return s=r&&r[0]&&r[0].firstChild&&r[0].firstChild.nodeValue?this.getChildValue(r[0]):void 0==n?"":n},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;t=this.getElementsByTagNameNS(e,"*","item"),0==t.length&&(t=this.getElementsByTagNameNS(e,"*","entry"));for(var i=t.length,n=new Array(i),s=0;i>s;s++)n[s]=this.createFeatureFromItem(t[s]);return n},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNS(this.rssns,"rss");for(var i=0,n=e.length;n>i;i++)t.appendChild(this.createFeatureXML(e[i]))}else t=this.createFeatureXML(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.rssns,"item"),n=this.createElementNS(this.rssns,"title");n.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:""));var s=this.createElementNS(this.rssns,"description");if(s.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:"")),i.appendChild(n),i.appendChild(s),e.attributes.link){var r=this.createElementNS(this.rssns,"link");r.appendChild(this.createTextNode(e.attributes.link)),i.appendChild(r)}for(var a in e.attributes)if("link"!=a&&"title"!=a&&"description"!=a){var o=this.createTextNode(e.attributes[a]),l=a;-1!=a.search(":")&&(l=a.split(":")[1]);var u=this.createElementNS(this.featureNS,"feature:"+l);u.appendChild(o),i.appendChild(u)}return i.appendChild(t),i},buildGeometryNode:function(e){this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t;if("OpenLayers.Geometry.Polygon"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:polygon"),t.appendChild(this.buildCoordinatesNode(e.components[0]));else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:line"),t.appendChild(this.buildCoordinatesNode(e));else{if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw"Couldn't parse "+e.CLASS_NAME;t=this.createElementNS(this.georssns,"georss:point"),t.appendChild(this.buildCoordinatesNode(e))}return t},buildCoordinatesNode:function(e){var t=null;e.components&&(t=e.components);var i;if(t){for(var n=t.length,s=new Array(n),r=0;n>r;r++)s[r]=t[r].y+" "+t[r].x;i=s.join(" ")}else i=e.y+" "+e.x;return this.createTextNode(i)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{Capabilities:function(e,t){this.readChildNodes(e,t)},ProcessOfferings:function(e,t){t.processOfferings={},this.readChildNodes(e,t.processOfferings)},Process:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),n={processVersion:i};this.readChildNodes(e,n),t[n.identifier]=n},Languages:function(e,t){t.languages=[],this.readChildNodes(e,t.languages)},Default:function(e,t){var i={isDefault:!0};this.readChildNodes(e,i),t.push(i)},Supported:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy();delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(e){var t=this.map.getLayerPxFromLonLat({lon:e.bounds.left,lat:e.bounds.top}),i=this.map.getLayerPxFromLonLat({lon:e.bounds.right,lat:e.bounds.bottom});if(null==i||null==t)e.display(!1);else{var n=e.draw(t,{w:Math.max(1,i.x-t.x),h:Math.max(1,i.y-t.y)});e.drawn||(this.div.appendChild(n),e.drawn=!0)}},removeMarker:function(e){OpenLayers.Util.removeItem(this.markers,e),null!=e.div&&e.div.parentNode==this.div&&this.div.removeChild(e.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},OnlineResource:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.onlineResource=i)},Keywords:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.keywords=i.split(", "))},Capability:function(e,t){t.capability={},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetFeature:function(e,t){t.getfeature={href:{},formats:[]},this.readChildNodes(e,t.getfeature)},ResultFormat:function(e,t){for(var i,n=e.childNodes,s=0;s<n.length;s++)i=n[s],1==i.nodeType&&t.formats.push(i.nodeName)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t.href)},Get:function(e,t){t.get=e.getAttribute("onlineResource")},Post:function(e,t){t.post=e.getAttribute("onlineResource")},SRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(e){e=e||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[e.name,e])},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),e.events.register("moveend",this,this.onMoveEnd)},removeMap:function(e){e.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(e){this.ratio=e,this.updateGrid(!0)},setMaxFeatures:function(e){this.maxFeatures=e,this.updateGrid(!0)},setSpacing:function(e,t){this.dx=e,this.dy=t||e,this.updateGrid(!0)},setOrigin:function(e){this.origin=e,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(e){this.rotation=e,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var e=this.map.getExtent();if(this.rotation){var t=this.getOrigin(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),n=e.toGeometry();n.rotate(-this.rotation,i),e=n.getBounds()}return e},updateGrid:function(e){if(e||this.invalidBounds()){var t=this.getViewBounds(),i=this.getOrigin(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),s=t.getWidth(),r=t.getHeight(),a=s/r,o=Math.sqrt(this.dx*this.dy*this.maxFeatures/a),l=o*a,u=Math.min(s*this.ratio,l),h=Math.min(r*this.ratio,o),c=t.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(c.lon-u/2,c.lat-h/2,c.lon+u/2,c.lat+h/2);for(var p,d,m,f=Math.floor(h/this.dy),y=Math.floor(u/this.dx),g=i.lon+this.dx*Math.ceil((this.gridBounds.left-i.lon)/this.dx),v=i.lat+this.dy*Math.ceil((this.gridBounds.bottom-i.lat)/this.dy),b=new Array(f*y),L=0;y>L;++L){p=g+L*this.dx;for(var O=0;f>O;++O)d=v+O*this.dy,m=new OpenLayers.Geometry.Point(p,d),this.rotation&&m.rotate(this.rotation,n),b[L*f+O]=new OpenLayers.Feature.Vector(m)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(b,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(e,t,i,n){this.initializeZoomify(i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,i,{},n])},initializeZoomify:function(e){var t=e.clone();this.size=e.clone();var i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize));for(this.tierSizeInTiles=[i],this.tierImageSize=[t];t.w>this.standardTileSize||t.h>this.standardTileSize;)t=new OpenLayers.Size(Math.floor(t.w/2),Math.floor(t.h/2)),i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize)),this.tierSizeInTiles.push(i),this.tierImageSize.push(t);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length;var n=[1];this.tileCountUpToTier=[0];for(var s=1;s<this.numberOfTiers;s++)n.unshift(Math.pow(2,s)),this.tileCountUpToTier.push(this.tierSizeInTiles[s-1].w*this.tierSizeInTiles[s-1].h+this.tileCountUpToTier[s-1]);this.serverResolutions||(this.serverResolutions=n)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),s=this.getZoomForResolution(t),r=i+n*this.tierSizeInTiles[s].w+this.tileCountUpToTier[s],a="TileGroup"+Math.floor(r/256)+"/"+s+"-"+i+"-"+n+".jpg",o=this.url;return OpenLayers.Util.isArray(o)&&(o=this.selectUrl(a,o)),o+a},getImageSize:function(){if(arguments.length>0){var e=this.adjustBounds(arguments[0]),t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),n=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),s=this.getZoomForResolution(t),r=this.standardTileSize,a=this.standardTileSize;if(i==this.tierSizeInTiles[s].w-1)var r=this.tierImageSize[s].w%this.standardTileSize;if(n==this.tierSizeInTiles[s].h-1)var a=this.tierImageSize[s].h%this.standardTileSize;return new OpenLayers.Size(r,a)}return this.tileSize},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw new Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var n=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,n),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var s=this.matrixIds.length;if(s&&"string"==typeof this.matrixIds[0]){var r=this.matrixIds;this.matrixIds=new Array(s);for(var a=0;s>a;++a)this.matrixIds[a]={identifier:r[a]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t){return(t||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,n=Number.POSITIVE_INFINITY,s=0,r=this.matrixIds.length;r>s;++s)t=Math.abs(1-this.matrixIds[s].scaleDenominator/i),n>t&&(n=t,e=this.matrixIds[s]);
else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),n=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),s=Math.floor(i),r=Math.floor(n);return{col:s,row:r,i:Math.floor((i-s)*this.tileSize.w),j:Math.floor((n-r)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var i=e.getCenterLonLat(),n=this.getTileInfo(i);this.matrix.identifier;var s,r=this.dimensions;if(t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,n.row,n.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(s=this.params,-1!==t.indexOf("{")){var a=t.replace(/\{/g,"${"),o={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:n.row,TileCol:n.col};if(r){var l,u;for(u=r.length-1;u>=0;--u)l=r[u],o[l]=s[l.toUpperCase()]}t=OpenLayers.String.format(a,o)}else{var h=this.version+"/"+this.layer+"/"+this.style+"/";if(r)for(var u=0;u<r.length;u++)s[r[u]]&&(h=h+s[r[u]]+"/");h=h+this.matrixSet+"/"+this.matrix.identifier+"/"+n.row+"/"+n.col+"."+this.formatSuffix,t.match(/\/$/)||(t+="/"),t+=h}else"KVP"===this.requestEncoding.toUpperCase()&&(s={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:n.row,TILECOL:n.col,FORMAT:this.format},t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[s]))}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,t,i,n){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),(null==n||null==n.isBaseLayer)&&(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=[e.left,e.bottom,e.right,e.top],i=this.getImageSize(),n=this.getFullRequestString({mapext:t,imgext:t,map_size:[i.w,i.h],imgx:i.w/2,imgy:i.h/2,imgxy:[i.w,i.h]});return n},getFullRequestString:function(e,t){var i=null==t?this.url:t,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var s=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(s,i));var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var a in n)a.toUpperCase()in r&&delete n[a];s=OpenLayers.Util.getParameterString(n);var o=i;if(s=s.replace(/,/g,"+"),""!=s){var l=i.charAt(i.length-1);o+="&"==l||"?"==l?s:-1==i.indexOf("?")?"?"+s:"&"+s}return o},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var e=document.createStyleSheet(),t=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],i=0,n=t.length;n>i;i++)e.addRule("olv\\:"+t[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),s=0|e.left/n,r=0|e.top/n-this.size.h;t||!this.offset?(this.offset={x:s,y:r},s=0,r=0):(s-=this.offset.x,r-=this.offset.y);var a=s-this.xOffset+" "+r;this.root.coordorigin=a;for(var o,l=[this.root,this.vectorRoot,this.textRoot],u=0,h=l.length;h>u;++u){o=l[u];var c=this.size.w+" "+this.size.h;o.coordsize=c}return this.root.style.flip="y",i},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var e,t=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],i=this.size.w+"px",n=this.size.h+"px",s=0,r=t.length;r>s;++s)e=t[s],e.style.width=i,e.style.height=n},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="olv:shape"}return i},setStyle:function(e,t,i,n){t=t||e._style,i=i||e._options;var s=t.fillColor,r=t.title||t.graphicTitle;if(r&&(e.title=r),"OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0;var a=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius,o=o?o:2*t.pointRadius;var l=this.getResolution(),u=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),h=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o);e.style.left=(0|(n.x-this.featureDx)/l-this.offset.x+u)+"px",e.style.top=(0|n.y/l-this.offset.y-(h+o))+"px",e.style.width=a+"px",e.style.height=o+"px",e.style.flip="y",s="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var c=this.importSymbol(t.graphicName);e.path=c.path,e.coordorigin=c.left+","+c.bottom;var p=c.size;e.coordsize=p+","+p,this.drawCircle(e,n,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,n,t.pointRadius);i.isFilled?e.fillcolor=t.externalGraphic?"none":s:e.filled="false";var d=e.getElementsByTagName("fill"),m=0==d.length?null:d[0];if(i.isFilled){if(m||(m=this.createNode("olv:fill",e.id+"_fill")),m.opacity=t.fillOpacity,t.externalGraphic){if(m.src!=t.externalGraphic||(m.size?parseFloat(m.size.value.split(",")[1]):0)!=72*2*t.pointRadius/96){t.graphicOpacity&&(m.opacity=t.graphicOpacity),m.src=t.externalGraphic,m.type="OpenLayers.Geometry.Point"===e._geometryClass?"frame":"tile";var f=new Image;f.onload=OpenLayers.Function.bind(function(){var e=72*f.height/96,i=72*f.width/96;if(t.pointRadius){var n=i/e;e=72*2*t.pointRadius/96,i=e*n}m.size=i+"pt,"+e+"pt"}),f.src=t.externalGraphic,t.graphicWidth&&t.graphicHeight||(m.aspect="atmost")}}else t.graphicName&&"OpenLayers.Geometry.Point"!==e._geometryClass&&OpenLayers.Console.error("WellKnownName is not yet supported as GraphicFill by the VML renderer!");m.parentNode!=e&&e.appendChild(m)}else m&&e.removeChild(m);var y=t.rotation;(void 0!==y||void 0!==e._rotation)&&(e._rotation=y,t.externalGraphic?(this.graphicRotate(e,u,h,t),m.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=y||0));var g=e.getElementsByTagName("stroke"),v=0==g.length?null:g[0];return i.isStroked?(v||(v=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(v)),v.on=!0,v.color=t.strokeColor,v.weight=t.strokeWidth+"px",v.opacity=t.strokeOpacity,v.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(v.dashstyle=this.dashStyle(t))):(e.stroked=!1,v&&(v.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,n){var s,r,n=n||e._style,a=n.rotation||0;if(!n.graphicWidth||!n.graphicHeight){var o=new Image;return o.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==o.readyState||"interactive"==o.readyState)&&(s=o.width/o.height,r=Math.max(2*n.pointRadius,n.graphicWidth||0,n.graphicHeight||0),t*=s,n.graphicWidth=r*s,n.graphicHeight=r,this.graphicRotate(e,t,i,n))},this),o.src=n.externalGraphic,void 0}r=Math.max(n.graphicWidth,n.graphicHeight),s=n.graphicWidth/n.graphicHeight;var l=Math.round(n.graphicWidth||r*s),u=Math.round(n.graphicHeight||r);e.style.width=l+"px",e.style.height=u+"px";var h=document.getElementById(e.id+"_image");h||(h=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(h)),h.style.width=l+"px",h.style.height=u+"px",h.src=n.externalGraphic,h.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var c=a*Math.PI/180,p=Math.sin(c),d=Math.cos(c),m="progid:DXImageTransform.Microsoft.Matrix(M11="+d+",M12="+-p+",M21="+p+",M22="+d+",SizingMethod='auto expand')\n",f=n.graphicOpacity||n.fillOpacity;f&&1!=f&&(m+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+f+")\n"),e.style.filter=m;var y=new OpenLayers.Geometry.Point(-t,-i),g=new OpenLayers.Bounds(0,0,l,u).toGeometry();g.rotate(n.rotation,y);var v=g.getBounds();e.style.left=Math.round(parseInt(e.style.left)+v.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-v.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var n=this.getResolution(),s=new OpenLayers.Bounds(0|(i.left-this.featureDx)/n-this.offset.x,0|i.bottom/n-this.offset.y,0|(i.right-this.featureDx)/n-this.offset.x,0|i.top/n-this.offset.y);e.style.left=s.left+"px",e.style.top=s.top+"px",e.style.width=s.getWidth()+"px",e.style.height=s.getHeight()+"px",e.coordorigin=s.left+" "+s.top,e.coordsize=s.getWidth()+" "+s.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,n=i.indexOf(":");-1!=n&&(i=i.substr(n+1));var s=e.nodeName;return n=s.indexOf(":"),-1!=n&&(s=s.substr(n+1)),i==s},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var n=this.getResolution();e.style.left=(0|(t.x-this.featureDx)/n-this.offset.x)-i+"px",e.style.top=(0|t.y/n-this.offset.y)-i+"px";var s=2*i;return e.style.width=s+"px",e.style.height=s+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var n,s,r,a=this.getResolution(),o=t.components.length,l=new Array(o),u=0;o>u;u++)n=t.components[u],s=0|(n.x-this.featureDx)/a-this.offset.x,r=0|n.y/a-this.offset.y,l[u]=" "+s+","+r+" l ";var h=i?" x e":" e";return e.path="m"+l.join("")+h,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,n,s,r,a,o,l,u,h,c,p,d,m=this.getResolution(),f=[];for(i=0,n=t.components.length;n>i;i++){for(f.push("m"),s=t.components[i].components,r=0===i,a=null,o=null,l=0,u=s.length;u>l;l++)h=s[l],p=0|(h.x-this.featureDx)/m-this.offset.x,d=0|h.y/m-this.offset.y,c=" "+p+","+d,f.push(c),0==l&&f.push(" l"),r||(a?a!=c&&(o?o!=c&&(r=!0):o=c):a=c);f.push(r?" x ":" ")}return f.push("e"),e.path=f.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=(0|(t.x-this.featureDx)/i-this.offset.x)+"px",e.style.top=(0|t.y/i-this.offset.y)+"px",e.style.width=(0|t.width/i)+"px",e.style.height=(0|t.height/i)+"px",e},drawText:function(e,t,i){var n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),s=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),r=this.getResolution();n.style.left=(0|(i.x-this.featureDx)/r-this.offset.x)+"px",n.style.top=(0|i.y/r-this.offset.y)+"px",n.style.flip="y",s.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(s.style.cursor=t.cursor),t.fontColor&&(s.style.color=t.fontColor),t.fontOpacity&&(s.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(s.style.fontFamily=t.fontFamily),t.fontSize&&(s.style.fontSize=t.fontSize),t.fontWeight&&(s.style.fontWeight=t.fontWeight),t.fontStyle&&(s.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(n._featureId=e,s._featureId=e,s._geometry=i,s._geometryClass=i.CLASS_NAME),s.style.whiteSpace="nowrap",s.inset="1px,0px,0px,0px",n.parentNode||(n.appendChild(s),this.textRoot.appendChild(n));var a=t.labelAlign||"cm";1==a.length&&(a+="m");var o=s.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[a.substr(0,1)],l=s.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[a.substr(1,1)];n.style.left=parseInt(n.style.left)-o-1+"px",n.style.top=parseInt(n.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");for(var s=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),r=["m"],a=0;a<n.length;a+=2){var o=n[a],l=n[a+1];s.left=Math.min(s.left,o),s.bottom=Math.min(s.bottom,l),s.right=Math.max(s.right,o),s.top=Math.max(s.top,l),r.push(o),r.push(l),0==a&&r.push("l")}r.push("x e");var u=r.join(" "),h=(s.getWidth()-s.getHeight())/2;return h>0?(s.bottom=s.bottom-h,s.top=s.top+h):(s.left=s.left+h,s.right=s.right-h),i={path:u,size:s.getWidth(),left:s.left,bottom:s.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var t,i=this.layers||e.layers;for(t=i.length-1;t>=0;--t)this.addLayer({layer:i[t]});this.layers||e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(e){e.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(e){e.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(e){if(this.active&&window.localStorage&&e.tile instanceof OpenLayers.Tile.Image){var t=e.tile,i=t.url;!t.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===i.indexOf(OpenLayers.ProxyHost)&&(i=OpenLayers.Control.CacheWrite.urlMap[i]);var n=window.localStorage.getItem("olCache_"+i);n&&(t.url=n,"tileerror"===e.type&&t.setImgSrc(n))}},destroy:function(){if(this.layers||this.map){var e,t=this.layers||this.map.layers;for(e=t.length-1;e>=0;--e)this.removeLayer({layer:t[e]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(e){if(e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.request(e.xy,{})},getInfoForHover:function(e){this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t=this.layers||this.map.layers,i=[],n=t.length-1;n>=0&&(e=t[n],!(e instanceof OpenLayers.Layer.WMTS&&e.requestEncoding===this.requestEncoding)||this.queryVisible&&!e.getVisibility()||(i.push(e),this.drillDown&&!this.hover));--n);return i},buildRequestOptions:function(e,t){var i=this.map.getLonLatFromPixel(t),n=e.getURL(new OpenLayers.Bounds(i.lon,i.lat,i.lon,i.lat)),s=OpenLayers.Util.getParameters(n),r=e.getTileInfo(i);return OpenLayers.Util.extend(s,{service:"WMTS",version:e.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:r.i,j:r.j}),OpenLayers.Util.applyDefaults(s,this.vendorParams),{url:OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,params:OpenLayers.Util.upperCaseObject(s),callback:function(i){this.handleResponse(t,i,e)},scope:this}},request:function(e,t){t=t||{};var i=this.findLayers();if(i.length>0){for(var n,s,r=0,a=i.length;a>r;r++)if(s=i[r],n=this.events.triggerEvent("beforegetfeatureinfo",{xy:e,layer:s}),n!==!1){++this.pending;var o=this.buildRequestOptions(s,e),l=OpenLayers.Request.GET(o);t.hover===!0&&(this.hoverRequest=l)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(e,t,i){if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),t.status&&(t.status<200||t.status>=300))this.events.triggerEvent("exception",{xy:e,request:t,layer:i});else{var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var s,r;try{s=this.format.read(n)}catch(a){r=!0,this.events.triggerEvent("exception",{xy:e,request:t,error:a,layer:i})}r||this.events.triggerEvent("getfeatureinfo",{text:t.responseText,features:s,request:t,xy:e,layer:i})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.format.write(e.params||e);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&i.status<300?(e.data=this.parseData(i),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseData:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(e){e=e||{},e.layerName=e.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[e]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var e=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":e}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var e=this.map.getExtent();if(e){this.gratLayer.destroyFeatures();var t=new OpenLayers.Projection("EPSG:4326"),i=this.map.getProjectionObject(),n=this.map.getResolution();i.proj&&"longlat"==i.proj.projName&&(this.numPoints=1);var s=this.map.getCenter(),r=new OpenLayers.Pixel(s.lon,s.lat);OpenLayers.Projection.transform(r,i,t);var a=this.targetSize*n;a*=a;for(var o,l=0;l<this.intervals.length;++l){o=this.intervals[l];var u=o/2,h=r.offset({x:-u,y:-u}),c=r.offset({x:u,y:u});OpenLayers.Projection.transform(h,t,i),OpenLayers.Projection.transform(c,t,i);var p=(h.x-c.x)*(h.x-c.x)+(h.y-c.y)*(h.y-c.y);if(a>=p)break}r.x=Math.floor(r.x/o)*o,r.y=Math.floor(r.y/o)*o;var d,m=0,f=[r.clone()],y=r.clone();do y=y.offset({x:0,y:o}),d=OpenLayers.Projection.transform(y.clone(),t,i),f.unshift(y);while(e.containsPixel(d)&&++m<1e3);y=r.clone();do y=y.offset({x:0,y:-o}),d=OpenLayers.Projection.transform(y.clone(),t,i),f.push(y);while(e.containsPixel(d)&&++m<1e3);m=0;var g=[r.clone()];y=r.clone();do y=y.offset({x:-o,y:0}),d=OpenLayers.Projection.transform(y.clone(),t,i),g.unshift(y);while(e.containsPixel(d)&&++m<1e3);y=r.clone();do y=y.offset({x:o,y:0}),d=OpenLayers.Projection.transform(y.clone(),t,i),g.push(y);while(e.containsPixel(d)&&++m<1e3);for(var v=[],l=0;l<g.length;++l){for(var b=g[l].x,L=[],O=null,w=Math.min(f[0].y,90),_=Math.max(f[f.length-1].y,-90),x=(w-_)/this.numPoints,S=_,C=0;C<=this.numPoints;++C){var k=new OpenLayers.Geometry.Point(b,S);k.transform(t,i),L.push(k),S+=x,k.y>=e.bottom&&!O&&(O=k)}if(this.labelled){var M=new OpenLayers.Geometry.Point(O.x,e.bottom),P={value:b,label:this.labelled?OpenLayers.Util.getFormattedLonLat(b,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(M,P))}var E=new OpenLayers.Geometry.LineString(L);v.push(new OpenLayers.Feature.Vector(E))}for(var C=0;C<f.length;++C)if(S=f[C].y,!(-90>S||S>90)){for(var L=[],N=g[0].x,T=g[g.length-1].x,z=(T-N)/this.numPoints,b=N,O=null,l=0;l<=this.numPoints;++l){var k=new OpenLayers.Geometry.Point(b,S);k.transform(t,i),L.push(k),b+=z,k.x<e.right&&(O=k)}if(this.labelled){var M=new OpenLayers.Geometry.Point(e.right,O.y),P={value:S,label:this.labelled?OpenLayers.Util.getFormattedLonLat(S,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(M,P))}var E=new OpenLayers.Geometry.LineString(L);v.push(new OpenLayers.Feature.Vector(E))}this.gratLayer.addFeatures(v)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(e){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e.name,e.url,{},e]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.UTFGrid(this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getFeatureInfo:function(e){var t=null,i=this.getTileData(e);return i.tile&&(t=i.tile.getFeatureInfo(i.i,i.j)),t},getFeatureId:function(e){var t=null,i=this.getTileData(e);return i.tile&&(t=i.tile.getFeatureId(i.i,i.j)),t},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options),e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(i){t.data=i,this.handleRead(t,e)},this));return t.priv=i,t},createRequest:function(e,t,i){var n=OpenLayers.Protocol.Script.register(i),s=OpenLayers.String.format(this.callbackTemplate,{id:n});t=OpenLayers.Util.extend({},t),t[this.callbackKey]=this.callbackPrefix+s,e=OpenLayers.Util.urlAppend(e,OpenLayers.Util.getParameterString(t));var r=document.createElement("script");r.type="text/javascript",r.src=e,r.id="OpenLayers_Protocol_Script_"+n,this.pendingRequests[r.id]=r;var a=document.getElementsByTagName("head")[0];return a.appendChild(r),r},destroyRequest:function(e){OpenLayers.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var e=OpenLayers.Protocol.Script,t=0;e.registry={},e.register=function(i){var n="c"+ ++t;return e.registry[n]=function(){i.apply(this,arguments)},n},e.unregister=function(t){delete e.registry[t]}}(),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var e=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),e=!0),e},setMap:function(e){this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(e,t){t=OpenLayers.Util.applyDefaults(t,{rotation:0,scale:1,ratio:1});var i=this.rotation,n=this.center;OpenLayers.Util.extend(this,t);var s=this.events.triggerEvent("beforesetfeature",{feature:e});if(s!==!1){this.feature=e,this.activate(),this._setfeature=!0;var r=this.feature.geometry.getBounds();this.box.move(r.getCenterLonLat()),this.box.geometry.rotate(-i,n),this._angle=0;var a;if(this.rotation){var o=e.geometry.clone();o.rotate(-this.rotation,this.center);var l=new OpenLayers.Feature.Vector(o.getBounds().toGeometry());l.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(l.geometry.getBounds().getCenterLonLat());var u=l.geometry.components[0].components[0];a=u.getBounds().getCenterLonLat()}else a=new OpenLayers.LonLat(r.left,r.bottom);this.handles[0].move(a),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:e})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var e=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(t,i){e._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),e.center.move(t,i),delete e._moving};for(var t,i,n,s=function(e,t){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(e,t),this._handle.geometry.move(e,t)},r=function(e,t,i){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(e,t,i),this._handle.geometry.resize(e,t,i)},a=function(e,t){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(e,t),this._handle.geometry.rotate(e,t)},o=function(t,i){var n=this.x,s=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var r=e.dragControl.handlers.drag.evt,a=!e._setfeature&&e.preserveAspectRatio,o=!(a||r&&r.shiftKey),l=new OpenLayers.Geometry.Point(n,s),u=e.center;this.rotate(-e.rotation,u),l.rotate(-e.rotation,u);var h=this.x-u.x,c=this.y-u.y,p=h-(this.x-l.x),d=c-(this.y-l.y);e.irregular&&!e._setfeature&&(h-=(this.x-l.x)/2,c-=(this.y-l.y)/2),this.x=n,this.y=s;var m,f=1;if(o)m=Math.abs(d)<1e-5?1:c/d,f=(Math.abs(p)<1e-5?1:h/p)/m;else{var y=Math.sqrt(p*p+d*d),g=Math.sqrt(h*h+c*c);m=g/y}if(e._moving=!0,e.box.geometry.rotate(-e.rotation,u),delete e._moving,e.box.geometry.resize(m,u,f),e.box.geometry.rotate(e.rotation,u),e.transformFeature({scale:m,ratio:f}),e.irregular&&!e._setfeature){var v=u.clone();v.x+=Math.abs(n-u.x)<1e-5?0:this.x-n,v.y+=Math.abs(s-u.y)<1e-5?0:this.y-s,e.box.geometry.move(this.x-n,this.y-s),e.transformFeature({center:v})}}},l=function(t,i){var n=this.x,s=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var r=e.dragControl.handlers.drag.evt,a=r&&r.shiftKey?45:1,o=e.center,l=this.x-o.x,u=this.y-o.y,h=l-t,c=u-i;this.x=n,this.y=s;var p=Math.atan2(c,h),d=Math.atan2(u,l),m=d-p;m*=180/Math.PI,e._angle=(e._angle+m)%360;var f=e.rotation%a;(Math.abs(e._angle)>=a||0!==f)&&(m=Math.round(e._angle/a)*a-f,e._angle=0,e.box.geometry.rotate(m,o),e.transformFeature({rotation:m}))}},u=new Array(8),h=new Array(4),c=["sw","s","se","e","ne","n","nw","w"],p=0;8>p;++p)t=this.box.geometry.components[p],i=new OpenLayers.Feature.Vector(t.clone(),{role:c[p]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==p%2&&(n=new OpenLayers.Feature.Vector(t.clone(),{role:c[p]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),n.geometry.move=l,t._rotationHandle=n,h[p/2]=n),t.move=s,t.resize=r,t.rotate=a,i.geometry.move=o,t._handle=i,u[p]=i;
this.rotationHandles=h,this.handles=u},createControl:function(){var e=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(){this.feature===e.feature&&(this.feature=e.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(t){t===e.box&&e.transformFeature({center:e.center})},onStart:function(t){var i=!e.geometryTypes||-1!==OpenLayers.Util.indexOf(e.geometryTypes,t.geometry.CLASS_NAME),n=OpenLayers.Util.indexOf(e.handles,t);n+=OpenLayers.Util.indexOf(e.rotationHandles,t),t!==e.feature&&t!==e.box&&-2==n&&i&&e.setFeature(t)},onComplete:function(){e.events.triggerEvent("transformcomplete",{feature:e.feature})}})},drawHandles:function(){for(var e=this.layer,t=0;8>t;++t)this.rotate&&0===t%2&&e.drawFeature(this.rotationHandles[t/2],this.rotationHandleSymbolizer),e.drawFeature(this.handles[t],this.renderIntent)},transformFeature:function(e){if(!this._setfeature){this.scale*=e.scale||1,this.ratio*=e.ratio||1;var t=this.rotation;if(this.rotation=(this.rotation+(e.rotation||0))%360,this.events.triggerEvent("beforetransform",e)!==!1){var i=this.feature,n=i.geometry,s=this.center;n.rotate(-t,s),e.scale||e.ratio?n.resize(e.scale,s,e.ratio):e.center&&i.move(e.center.getBounds().getCenterLonLat()),n.rotate(this.rotation,s),this.layer.drawFeature(i),i.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",e)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var e,t=0;8>t;++t)e=this.box.geometry.components[t],e._handle.destroy(),e._handle=null,e._rotationHandle&&e._rotationHandle.destroy(),e._rotationHandle=null;this.center=null,this.feature=null,this.handles=null,this.rotationHandleSymbolizer=null,this.rotationHandles=null,this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var e=this.layerInfo,t=new OpenLayers.Bounds(e.fullExtent.xmin,e.fullExtent.ymin,e.fullExtent.xmax,e.fullExtent.ymax);if(this.projection="EPSG:"+e.spatialReference.wkid,this.sphericalMercator=102100==e.spatialReference.wkid,this.units="esriFeet"==e.units?"ft":"m",e.tileInfo){this.tileSize=new OpenLayers.Size(e.tileInfo.width||e.tileInfo.cols,e.tileInfo.height||e.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(e.tileInfo.origin.x,e.tileInfo.origin.y);var i=new OpenLayers.Geometry.Point(t.left,t.top),n=new OpenLayers.Geometry.Point(t.right,t.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var s in e.tileInfo.lods)if(e.tileInfo.lods.hasOwnProperty(s)){var r=e.tileInfo.lods[s];this.useScales?this.scales.push(r.scale):this.resolutions.push(r.resolution);var a=this.getContainingTileCoords(i,r.resolution);r.startTileCol=a.x,r.startTileRow=a.y;var o=this.getContainingTileCoords(n,r.resolution);r.endTileCol=o.x,r.endTileRow=o.y,this.lods.push(r)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&e.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=e.tileInfo.dpi)}}},getContainingTileCoords:function(e,t){return new OpenLayers.Pixel(Math.max(Math.floor((e.x-this.tileOrigin.lon)/(this.tileSize.w*t)),0),Math.max(Math.floor((this.tileOrigin.lat-e.y)/(this.tileSize.h*t)),0))},calculateMaxExtentWithLOD:function(e){var t=e.endTileCol-e.startTileCol+1,i=e.endTileRow-e.startTileRow+1,n=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,s=n+t*this.tileSize.w*e.resolution,r=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution,a=r-i*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(n,a,s,r)},calculateMaxExtentWithExtent:function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.top),n=new OpenLayers.Geometry.Point(e.right,e.bottom),s=this.getContainingTileCoords(i,t),r=this.getContainingTileCoords(n,t),a={resolution:t,startTileCol:s.x,startTileRow:s.y,endTileCol:r.x,endTileRow:r.y};return this.calculateMaxExtentWithLOD(a)},getUpperLeftTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(t,e)},getLowerRightTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(t,e)},getMaxExtentForResolution:function(e){var t=this.getUpperLeftTileCoord(e),i=this.getLowerRightTileCoord(e),n=i.x-t.x+1,s=i.y-t.y+1,r=this.tileOrigin.lon+t.x*this.tileSize.w*e,a=r+n*this.tileSize.w*e,o=this.tileOrigin.lat-t.y*this.tileSize.h*e,l=o-s*this.tileSize.h*e;return new OpenLayers.Bounds(r,l,a,o)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},getMaxExtent:function(){var e=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(e)},getTileOrigin:function(){var e=this.getMaxExtent();return new OpenLayers.LonLat(e.left,e.bottom)},getURL:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,n=this.tileOrigin.lat-t*this.tileSize.h/2,s=e.getCenterLonLat();({x:s.lon,y:s.lat});var r=Math.round(Math.abs((s.lon-i)/(t*this.tileSize.w))),a=Math.round(Math.abs((n-s.lat)/(t*this.tileSize.h))),o=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(r<l.startTileCol||r>l.endTileCol||a<l.startTileRow||a>l.endTileRow)return null}else{var u=this.getUpperLeftTileCoord(t),h=this.getLowerRightTileCoord(t);if(r<u.x||r>=h.x||a<u.y||a>=h.y)return null}var c=this.url,p=""+r+a+o;return OpenLayers.Util.isArray(c)&&(c=this.selectUrl(p,c)),this.useArcGISServer?c+="/tile/${z}/${y}/${x}":(r="C"+this.zeroPad(r,8,16),a="R"+this.zeroPad(a,8,16),o="L"+this.zeroPad(o,2,16),c=c+"/${z}/${y}/${x}."+this.type),c=OpenLayers.String.format(c,{x:r,y:a,z:o}),OpenLayers.Util.urlAppend(c,OpenLayers.Util.getParameterString(this.params))},zeroPad:function(e,t,i){for(var n=e.toString(i||10);n.length<t;)n="0"+n;return n},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){if(e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t,i=this.layers||this.map.layers,n=[],s=i.length-1;s>=0;--s)e=i[s],e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())&&(t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,this.drillDown!==!1||this.url||(this.url=t),(this.drillDown===!0||this.urlMatches(t))&&n.push(e));return n},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var i=0,n=this.layerUrls.length;n>i;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],e)){t=!0;break}return t},buildWMSOptions:function(e,t,i,n){for(var s=[],r=[],a=0,o=t.length;o>a;a++)null!=t[a].params.LAYERS&&(s=s.concat(t[a].params.LAYERS),r=r.concat(this.getStyleNames(t[a])));var l=t[0],u=this.map.getProjection(),h=l.projection;h&&h.equals(this.map.getProjectionObject())&&(u=h.getCode());var c=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:n,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:u,i:parseInt(i.x),j:parseInt(i.y)}:{srs:u,x:parseInt(i.x),y:parseInt(i.y)});return 0!=s.length&&(c=OpenLayers.Util.extend({layers:s,query_layers:s,styles:r},c)),OpenLayers.Util.applyDefaults(c,this.vendorParams),{url:e,params:OpenLayers.Util.upperCaseObject(c),callback:function(t){this.handleResponse(i,t,e)},scope:this}},getStyleNames:function(e){var t;return t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){var i=this.findLayers();if(0==i.length)return this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),void 0;if(t=t||{},this.drillDown===!1){var n=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),s=OpenLayers.Request.GET(n);t.hover===!0&&(this.hoverRequest=s)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var r,a={},o=0,l=i.length;l>o;o++){var u=i[o];r=OpenLayers.Util.isArray(u.url)?u.url[0]:u.url,r in a?a[r].push(u):(this._numRequests++,a[r]=[u])}var i;for(var r in a){i=a[r];var n=this.buildWMSOptions(r,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(n)}}},triggerGetFeatureInfo:function(e,t,i){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:i,request:e,xy:t}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,i){var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var s=this.format.read(n);this.drillDown===!1?this.triggerGetFeatureInfo(t,e,s):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:i,features:s}):(this._features||[]).concat(s),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(t,e,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(e,t){OpenLayers.Format.GML.prototype.initialize.apply(this,[e]),this.layer=t,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var t=this.createElementNS(this.wfsns,"wfs:Transaction");t.setAttribute("version","1.0.0"),t.setAttribute("service","WFS");for(var i=0;i<e.length;i++)switch(e[i].state){case OpenLayers.State.INSERT:t.appendChild(this.insert(e[i]));break;case OpenLayers.State.UPDATE:t.appendChild(this.update(e[i]));break;case OpenLayers.State.DELETE:t.appendChild(this.remove(e[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.featureNS,"feature:"+this.geometryName);i.appendChild(t);var n=this.createElementNS(this.featureNS,"feature:"+this.featureName);n.appendChild(i);for(var s in e.attributes){var r=this.createTextNode(e.attributes[s]),a=s;-1!=s.search(":")&&(a=s.split(":")[1]);var o=this.createElementNS(this.featureNS,"feature:"+a);o.appendChild(r),n.appendChild(o)}return n},insert:function(e){var t=this.createElementNS(this.wfsns,"wfs:Insert");return t.appendChild(this.createFeatureXML(e)),t},update:function(e){e.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var t=this.createElementNS(this.wfsns,"wfs:Update");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.wfsns,"wfs:Property"),n=this.createElementNS(this.wfsns,"wfs:Name"),s=this.createTextNode(this.geometryName);n.appendChild(s),i.appendChild(n);var r=this.createElementNS(this.wfsns,"wfs:Value"),a=this.buildGeometryNode(e.geometry);e.layer&&a.setAttribute("srsName",e.layer.projection.getCode()),r.appendChild(a),i.appendChild(r),t.appendChild(i);for(var o in e.attributes)i=this.createElementNS(this.wfsns,"wfs:Property"),n=this.createElementNS(this.wfsns,"wfs:Name"),n.appendChild(this.createTextNode(o)),i.appendChild(n),r=this.createElementNS(this.wfsns,"wfs:Value"),r.appendChild(this.createTextNode(e.attributes[o])),i.appendChild(r),t.appendChild(i);var l=this.createElementNS(this.ogcns,"ogc:Filter"),u=this.createElementNS(this.ogcns,"ogc:FeatureId");return u.setAttribute("fid",e.fid),l.appendChild(u),t.appendChild(l),t},remove:function(e){if(!e.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var t=this.createElementNS(this.wfsns,"wfs:Delete");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.ogcns,"ogc:Filter"),n=this.createElementNS(this.ogcns,"ogc:FeatureId");return n.setAttribute("fid",e.fid),i.appendChild(n),t.appendChild(i),t},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(e){this.handlerMode=e,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(e){e=e||{},e.handlerOptions=e.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[e]),this.resetHandler()},handleEvent:function(e){if(null==e)return this.reset(),void 0;var t=this.map.getLonLatFromPixel(e.xy);if(t){var i=this.findLayers();if(i.length>0){for(var n,s,r={},a=0,o=i.length;o>a;a++)n=i[a],s=OpenLayers.Util.indexOf(this.map.layers,n),r[s]=n.getFeatureInfo(t);this.callback(r,t,e.xy)}}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var e,t=this.layers||this.map.layers,i=[],n=t.length-1;n>=0;--n)e=t[n],e instanceof OpenLayers.Layer.UTFGrid&&i.push(e);return i},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Format.CQL=function(){function e(e,t){return t instanceof RegExp?t.exec(e):t(e)}function t(t,i){var n,s,a=i.length;for(n=0;a>n;n++){s=i[n];var o=r[s],l=e(t,o);if(l){var u=l[0],h=t.substr(u.length).replace(/^\s*/,"");return{type:s,text:u,remainder:h}}}var c="ERROR: In parsing: ["+t+"], expected one of: ";for(n=0;a>n;n++)s=i[n],c+="\n    "+s+": "+r[s];throw new Error(c)}function i(e){var i,n=[],s=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(i=t(e,s),e=i.remainder,s=a[i.type],"END"!=i.type&&!s)throw new Error("No follows list for "+i.type);n.push(i)}while("END"!=i.type);return n}function n(e){function t(){var e=n.pop();switch(e.type){case"LOGICAL":var i=t(),s=t();return new OpenLayers.Filter.Logical({filters:[s,i],type:u[e.text.toUpperCase()]});case"NOT":var r=t();return new OpenLayers.Filter.Logical({filters:[r],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var a,l,h;return n.pop(),l=t(),a=t(),h=t(),new OpenLayers.Filter.Comparison({property:h,lowerBoundary:a,upperBoundary:l,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var c=t(),h=t();return new OpenLayers.Filter.Comparison({property:h,value:c,type:o[e.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(e.text)?e.text.substr(1,e.text.length-2):Number(e.text);case"SPATIAL":switch(e.text.toUpperCase()){case"BBOX":var p=t(),d=t(),m=t(),f=t(),y=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:y,value:OpenLayers.Bounds.fromArray([f,m,d,p])});case"INTERSECTS":var c=t(),h=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:h,value:c});case"WITHIN":var c=t(),h=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:h,value:c});case"CONTAINS":var c=t(),h=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:h,value:c});case"DWITHIN":var g=t(),c=t(),h=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:c,property:h,distance:Number(g)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(e.text);default:return e.text}}for(var i=[],n=[];e.length;){var s=e.shift();switch(s.type){case"PROPERTY":case"GEOMETRY":case"VALUE":n.push(s);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(var r=c[s.type];i.length>0&&c[i[i.length-1].type]<=r;)n.push(i.pop());i.push(s);break;case"SPATIAL":case"NOT":case"LPAREN":i.push(s);break;case"RPAREN":for(;i.length>0&&"LPAREN"!=i[i.length-1].type;)n.push(i.pop());i.pop(),i.length>0&&"SPATIAL"==i[i.length-1].type&&n.push(i.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+s.type)}}for(;i.length>0;)n.push(i.pop());var a=t();if(n.length>0){for(var l="Remaining tokens after building AST: \n",h=n.length-1;h>=0;h--)l+=n[h].type+": "+n[h].text+"\n";throw new Error(l)}return a}var s,r={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length,n=e.indexOf("(",t[0].length);if(n>-1)for(var s=1;i>n&&s>0;)switch(n++,e.charAt(n)){case"(":s++;break;case")":s--}return[e.substr(0,n+1)]}},END:/^$/},a={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},o={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},l={},u={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},h={},c={RPAREN:3,LOGICAL:2,COMPARISON:1};for(s in o)o.hasOwnProperty(s)&&(l[o[s]]=s);for(s in u)u.hasOwnProperty(s)&&(h[u[s]]=s);return OpenLayers.Class(OpenLayers.Format,{read:function(e){var t=n(i(e));return this.keepData&&(this.data=t),t},write:function(e){if(e instanceof OpenLayers.Geometry)return e.toString();switch(e.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw new Error("Unknown spatial filter type: "+e.type)}case"OpenLayers.Filter.Logical":if(e.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(e.filters[0])+")";for(var t="(",i=!0,n=0;n<e.filters.length;n++)i?i=!1:t+=") "+h[e.type]+" (",t+=this.write(e.filters[n]);return t+")";case"OpenLayers.Filter.Comparison":return e.type==OpenLayers.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):e.property+" "+l[e.type]+" "+this.write(e.value);case void 0:if("string"==typeof e)return"'"+e+"'";if("number"==typeof e)return String(e);default:throw new Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.source&&this.setSource(this.options.source)},setSource:function(e){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=e,this.activate()):this.source=e},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(e){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(e)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),e},onSketchComplete:function(e){return this.feature=null,!this.considerSplit(e.feature)},afterFeatureModified:function(e){if(e.modified){var t=e.feature;"function"==typeof t.geometry.split&&(this.feature=e.feature,this.considerSplit(e.feature))}},removeByGeometry:function(e,t){for(var i=0,n=e.length;n>i;++i)if(e[i].geometry===t){e.splice(i,1);break}},isEligible:function(e){return e.geometry?e.state!==OpenLayers.State.DELETE&&"function"==typeof e.geometry.split&&this.feature!==e&&(!this.targetFilter||this.targetFilter.evaluate(e.attributes)):!1},considerSplit:function(e){var t=!1,i=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(e.attributes)){for(var n,s,r,a,o,l,u,h=this.layer&&this.layer.features||[],c=[],p=[],d=this.layer===this.source&&this.mutual,m={edge:this.edge,tolerance:this.tolerance,mutual:d},f=[e.geometry],y=0,g=h.length;g>y;++y)if(a=h[y],this.isEligible(a)){o=[a.geometry];for(var v=0;v<f.length;++v){l=f[v];for(var b=0;b<o.length;++b)n=o[b],l.getBounds().intersectsBounds(n.getBounds())&&(s=l.split(n,m),s&&(r=this.events.triggerEvent("beforesplit",{source:e,target:a}),r!==!1&&(d&&(u=s[0],u.length>1&&(u.unshift(v,1),Array.prototype.splice.apply(f,u),v+=u.length-3),s=s[1]),s.length>1&&(s.unshift(b,1),Array.prototype.splice.apply(o,s),b+=s.length-3))))}o&&o.length>1&&(this.geomsToFeatures(a,o),this.events.triggerEvent("split",{original:a,features:o}),Array.prototype.push.apply(c,o),p.push(a),i=!0)}if(f&&f.length>1&&(this.geomsToFeatures(e,f),this.events.triggerEvent("split",{original:e,features:f}),Array.prototype.push.apply(c,f),p.push(e),t=!0),t||i){if(this.deferDelete){for(var L,O=[],y=0,g=p.length;g>y;++y)L=p[y],L.state===OpenLayers.State.INSERT?O.push(L):(L.state=OpenLayers.State.DELETE,this.layer.drawFeature(L));this.layer.destroyFeatures(O,{silent:!0});for(var y=0,g=c.length;g>y;++y)c[y].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(p,{silent:!0});this.layer.addFeatures(c,{silent:!0}),this.events.triggerEvent("aftersplit",{source:e,features:c})}}return t},geomsToFeatures:function(e,t){var i=e.clone();delete i.geometry;for(var n,s=0,r=t.length;r>s;++s)n=i.clone(),n.geometry=t[s],n.state=OpenLayers.State.INSERT,t[s]=n},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.format,n=OpenLayers.Format.XML.prototype.write.apply(i,[i.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),data:n}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&i.status<300?(e.features=this.parseFeatures(i),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),s=-Math.round(e.top/t),r=Math.floor(n/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,a=Math.floor(s/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,o=["/",this.params.map,"/",i,"/",this.params.g.replace(/\s/g,"_"),"/def/t",a,"/l",r,"/t",s,"l",n,".",this.extension],l=this.url;return OpenLayers.Util.isArray(l)&&(l=this.selectUrl(o.join(""),l)),l+o.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(e,t,i,n){this.layername=i,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},n]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){function t(e,t){e=String(e);for(var i=[],n=0;t>n;++n)i.push("0");return i.join("").substring(0,t-e.length)+e}var i=this.getServerResolution(),n=this.maxExtent,s=this.tileSize,r=Math.round((e.left-n.left)/(i*s.w)),a=Math.round((e.bottom-n.bottom)/(i*s.h)),o=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,i):this.map.getZoom(),l=[this.layername,t(o,2),t(parseInt(r/1e6),3),t(parseInt(r/1e3)%1e3,3),t(parseInt(r)%1e3,3),t(parseInt(a/1e6),3),t(parseInt(a/1e3)%1e3,3),t(parseInt(a)%1e3,3)+"."+this.extension],u=l.join("/"),h=this.url;return OpenLayers.Util.isArray(h)&&(h=this.selectUrl(u,h)),h="/"==h.charAt(h.length-1)?h:h+"/",h+u},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]},this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i),t.tileSets.push(i)},Resolutions:function(e,t){for(var i=this.getChildValue(e).split(" "),n=0,s=i.length;s>n;n++)""!=i[n]&&t.resolutions.push(parseFloat(i[n]))},Width:function(e,t){t.width=parseInt(this.getChildValue(e))},Height:function(e,t){t.height=parseInt(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[],this.roundedCorner&&OpenLayers.Console.warn("roundedCorner option is deprecated")},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(e){var t=e.buttonElement;t===this.minimizeDiv?this.minimizeControl():t===this.maximizeDiv?this.maximizeControl():t._layerSwitcher===this.id&&(t["for"]&&(t=document.getElementById(t["for"])),t.disabled||("radio"==t.type?(t.checked=!0,this.map.setBaseLayer(this.map.getLayer(t._layer))):(t.checked=!t.checked,this.updateMap())))},clearLayersArray:function(e){this[e+"LayersDiv"].innerHTML="",this[e+"Layers"]=[]},checkRedraw:function(){var e=!1;if(this.layerStates.length&&this.map.layers.length==this.layerStates.length)for(var t=0,i=this.layerStates.length;i>t;t++){var n=this.layerStates[t],s=this.map.layers[t];if(n.name!=s.name||n.inRange!=s.inRange||n.id!=s.id||n.visibility!=s.visibility){e=!0;break}}else e=!0;return e},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var e=!1,t=!1,i=this.map.layers.length;
this.layerStates=new Array(i);for(var n=0;i>n;n++){var s=this.map.layers[n];this.layerStates[n]={name:s.name,visibility:s.visibility,inRange:s.inRange,id:s.id}}var r=this.map.layers.slice();this.ascending||r.reverse();for(var n=0,i=r.length;i>n;n++){var s=r[n],a=s.isBaseLayer;if(s.displayInLayerSwitcher){a?t=!0:e=!0;var o=a?s==this.map.baseLayer:s.getVisibility(),l=document.createElement("input");l.id=this.id+"_input_"+s.name,l.name=a?this.id+"_baseLayers":s.name,l.type=a?"radio":"checkbox",l.value=s.name,l.checked=o,l.defaultChecked=o,l.className="olButton",l._layer=s.id,l._layerSwitcher=this.id,a||s.inRange||(l.disabled=!0);var u=document.createElement("label");u["for"]=l.id,OpenLayers.Element.addClass(u,"labelSpan olButton"),u._layer=s.id,u._layerSwitcher=this.id,a||s.inRange||(u.style.color="gray"),u.innerHTML=s.name,u.style.verticalAlign=a?"bottom":"baseline";var h=document.createElement("br"),c=a?this.baseLayers:this.dataLayers;c.push({layer:s,inputElem:l,labelSpan:u});var p=a?this.baseLayersDiv:this.dataLayersDiv;p.appendChild(l),p.appendChild(u),p.appendChild(h)}}return this.dataLbl.style.display=e?"":"none",this.baseLbl.style.display=t?"":"none",this.div},updateMap:function(){for(var e=0,t=this.baseLayers.length;t>e;e++){var i=this.baseLayers[e];i.inputElem.checked&&this.map.setBaseLayer(i.layer,!1)}for(var e=0,t=this.dataLayers.length;t>e;e++){var i=this.dataLayers[e];i.layer.setVisibility(i.inputElem.checked)}},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":"",this.layersDiv.style.display=e?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75));var e=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,e,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv);var e=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,e,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){var e=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(e){var t=this.layer.getURL(this.bounds),i=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&t.length>this.maxGetUrlLength;var n=i&&!this.useIFrame,s=!i&&this.useIFrame;(n||s)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,n?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank"))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var e=document.createElement("div"),t=e.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex=1,t.backgroundImage="url("+this._blankImageUrl+")",this.frame.appendChild(e)}var i,n=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(i=document.createElement('<iframe name="'+n+'">'),i.style.backgroundColor="#FFFFFF",i.style.filter="chroma(color=#FFFFFF)"):(i=document.createElement("iframe"),i.style.backgroundColor="transparent",i.name=n),i.scrolling="no",i.marginWidth="0px",i.marginHeight="0px",i.frameBorder="0",i.style.position="absolute",i.style.width="100%",i.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(i),this.imgDiv=i,i}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),e.target=this.id+"_iFrame";var i,n=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var s in n)i=document.createElement("input"),i.type="hidden",i.name=s,i.value=n[s],e.appendChild(i);return e},setImgSrc:function(e){if(this.useIFrame===!0)if(e){var t=this.createRequestForm();this.frame.appendChild(t),t.submit(),this.frame.removeChild(t)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var e;return this.useIFrame===!1&&(e=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),e}},OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(e){return"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),this.parseFeatures(e)},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNSPlus("atom:feed"),t.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var i=0,n=e.length;n>i;i++)t.appendChild(this.buildEntryNode(e[i]))}else t=this.buildEntryNode(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},buildContentNode:function(e){var t=this.createElementNSPlus("atom:content",{attributes:{type:e.type||null}});if(e.src)t.setAttribute("src",e.src);else if("text"==e.type||null==e.type)t.appendChild(this.createTextNode(e.value));else if("html"==e.type){if("string"!=typeof e.value)throw"HTML content must be in form of an escaped string";t.appendChild(this.createTextNode(e.value))}else"xhtml"==e.type?t.appendChild(e.value):"xhtml"==e.type||e.type.match(/(\+|\/)xml$/)?t.appendChild(e.value):t.appendChild(this.createTextNode(e.value));return t},buildEntryNode:function(e){var t=e.attributes,i=t.atom||{},n=this.createElementNSPlus("atom:entry");if(i.authors)for(var s=OpenLayers.Util.isArray(i.authors)?i.authors:[i.authors],r=0,a=s.length;a>r;r++)n.appendChild(this.buildPersonConstructNode("author",s[r]));if(i.categories)for(var o,l=OpenLayers.Util.isArray(i.categories)?i.categories:[i.categories],r=0,a=l.length;a>r;r++)o=l[r],n.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:o.term,scheme:o.scheme||null,label:o.label||null}}));if(i.content&&n.appendChild(this.buildContentNode(i.content)),i.contributors)for(var u=OpenLayers.Util.isArray(i.contributors)?i.contributors:[i.contributors],r=0,a=u.length;a>r;r++)n.appendChild(this.buildPersonConstructNode("contributor",u[r]));if(e.fid&&n.appendChild(this.createElementNSPlus("atom:id",{value:e.fid})),i.links)for(var h,c=OpenLayers.Util.isArray(i.links)?i.links:[i.links],r=0,a=c.length;a>r;r++)h=c[r],n.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null}}));if(i.published&&n.appendChild(this.createElementNSPlus("atom:published",{value:i.published})),i.rights&&n.appendChild(this.createElementNSPlus("atom:rights",{value:i.rights})),(i.summary||t.description)&&n.appendChild(this.createElementNSPlus("atom:summary",{value:i.summary||t.description})),n.appendChild(this.createElementNSPlus("atom:title",{value:i.title||t.title||this.defaultEntryTitle})),i.updated&&n.appendChild(this.createElementNSPlus("atom:updated",{value:i.updated})),e.geometry){var p=this.createElementNSPlus("georss:where");p.appendChild(this.buildGeometryNode(e.geometry)),n.appendChild(p)}return n},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(e){this.gmlParser||this.initGmlParser();var t=this.gmlParser.writeNode("feature:_geometry",e);return t.firstChild},buildPersonConstructNode:function(e,t){var i=["uri","email"],n=this.createElementNSPlus("atom:"+e);n.appendChild(this.createElementNSPlus("atom:name",{value:t.name}));for(var s=0,r=i.length;r>s;s++)t[i[s]]&&n.appendChild(this.createElementNSPlus("atom:"+i[s],{value:t[i[s]]}));return n},getFirstChildValue:function(e,t,i,n){var s,r=this.getElementsByTagNameNS(e,t,i);return s=r&&r.length>0?this.getChildValue(r[0],n):n},parseFeature:function(e){var t={},i=null,n=null,s=null,r=this.namespaces.atom;this.parsePersonConstructs(e,"author",t),n=this.getElementsByTagNameNS(e,r,"category"),n.length>0&&(t.categories=[]);for(var a=0,o=n.length;o>a;a++)i={},i.term=n[a].getAttribute("term"),s=n[a].getAttribute("scheme"),s&&(i.scheme=s),s=n[a].getAttribute("label"),s&&(i.label=s),t.categories.push(i);n=this.getElementsByTagNameNS(e,r,"content"),n.length>0&&(i={},s=n[0].getAttribute("type"),s&&(i.type=s),s=n[0].getAttribute("src"),s?i.src=s:(i.value="text"==i.type||"html"==i.type||null==i.type?this.getFirstChildValue(e,r,"content",null):"xhtml"==i.type||i.type.match(/(\+|\/)xml$/)?this.getChildEl(n[0]):this.getFirstChildValue(e,r,"content",null),t.content=i)),this.parsePersonConstructs(e,"contributor",t),t.id=this.getFirstChildValue(e,r,"id",null),n=this.getElementsByTagNameNS(e,r,"link"),n.length>0&&(t.links=new Array(n.length));for(var l=["rel","type","hreflang","title","length"],a=0,o=n.length;o>a;a++){i={},i.href=n[a].getAttribute("href");for(var u=0,h=l.length;h>u;u++)s=n[a].getAttribute(l[u]),s&&(i[l[u]]=s);t.links[a]=i}i=this.getFirstChildValue(e,r,"published",null),i&&(t.published=i),i=this.getFirstChildValue(e,r,"rights",null),i&&(t.rights=i),i=this.getFirstChildValue(e,r,"summary",null),i&&(t.summary=i),t.title=this.getFirstChildValue(e,r,"title",null),t.updated=this.getFirstChildValue(e,r,"updated",null);var c={title:t.title,description:t.summary,atom:t},p=this.parseLocations(e)[0],d=new OpenLayers.Feature.Vector(p,c);return d.fid=t.id,d},parseFeatures:function(e){var t=[],i=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");0==i.length&&(i=[e]);for(var n=0,s=i.length;s>n;n++)t.push(this.parseFeature(i[n]));return t},parseLocations:function(e){var t=this.namespaces.georss,i={components:[]},n=this.getElementsByTagNameNS(e,t,"where");if(n&&n.length>0){this.gmlParser||this.initGmlParser();for(var s=0,r=n.length;r>s;s++)this.gmlParser.readChildNodes(n[s],i)}var a=i.components,o=this.getElementsByTagNameNS(e,t,"point");if(o&&o.length>0)for(var s=0,r=o.length;r>s;s++){var l=OpenLayers.String.trim(o[s].firstChild.nodeValue).split(/\s+/);2!=l.length&&(l=OpenLayers.String.trim(o[s].firstChild.nodeValue).split(/\s*,\s*/)),a.push(new OpenLayers.Geometry.Point(l[1],l[0]))}var u=this.getElementsByTagNameNS(e,t,"line");if(u&&u.length>0)for(var h,c,p,s=0,r=u.length;r>s;s++){h=OpenLayers.String.trim(u[s].firstChild.nodeValue).split(/\s+/),p=[];for(var d=0,m=h.length;m>d;d+=2)c=new OpenLayers.Geometry.Point(h[d+1],h[d]),p.push(c);a.push(new OpenLayers.Geometry.LineString(p))}var f=this.getElementsByTagNameNS(e,t,"polygon");if(f&&f.length>0)for(var h,c,p,s=0,r=f.length;r>s;s++){h=OpenLayers.String.trim(f[s].firstChild.nodeValue).split(/\s+/),p=[];for(var d=0,m=h.length;m>d;d+=2)c=new OpenLayers.Geometry.Point(h[d+1],h[d]),p.push(c);a.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(a)]))}if(this.internalProjection&&this.externalProjection)for(var s=0,r=a.length;r>s;s++)a[s]&&a[s].transform(this.externalProjection,this.internalProjection);return a},parsePersonConstructs:function(e,t,i){for(var n=[],s=this.namespaces.atom,r=this.getElementsByTagNameNS(e,s,t),a=["uri","email"],o=0,l=r.length;l>o;o++){var u={};u.name=this.getFirstChildValue(r[o],s,"name",null);for(var h=0,c=a.length;c>h;h++){var p=this.getFirstChildValue(r[o],s,a[h],null);p&&(u[a[h]]=p)}n.push(u)}n.length>0&&(i[t+"s"]=n)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var e=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:e})},defaultKeyPress:function(e){var t,i=!0;if("undefined"==typeof e.target||"INPUT"!=e.target.tagName&&"TEXTAREA"!=e.target.tagName&&"SELECT"!=e.target.tagName){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:t=this.map.getSize(),this.map.pan(0,-.75*t.h);break;case 34:t=this.map.getSize(),this.map.pan(0,.75*t.h);break;case 35:t=this.map.getSize(),this.map.pan(.75*t.w,0);break;case 36:t=this.map.getSize(),this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:i=!1}i&&OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),Oskari.clazz.define("Oskari.mapframework.bundle.oskariui.OskariUIBundle",function(){this.conf={}},{create:function(){return this},update:function(){},start:function(){var e=this.conf.partsMap||{},t=Oskari.clazz.create("Oskari.framework.bundle.oskariui.DomManager",jQuery,e);Oskari.setDomManager(t)},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/jquery-ui-1.9.2.custom.min.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery.base64.min.js"},{type:"text/css",src:"../../../../resources/framework/bundle/oskariui/css/jquery-ui-1.9.2.custom.css"},{type:"text/css",src:"../../../../resources/framework/bundle/oskariui/bootstrap-grid.css"},{type:"text/javascript",src:"../../../../libraries/lodash/2.3.0/lodash.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/DomManager.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/Layout.js"}],locales:[]},bundle:{manifest:{"Bundle-Identifier":"oskariui","Bundle-Name":"oskariui","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("oskariui","Oskari.mapframework.bundle.oskariui.OskariUIBundle"),function(e,t){function i(t,i){var s,r,a,o=t.nodeName.toLowerCase();return"area"===o?(s=t.parentNode,r=s.name,t.href&&r&&"map"===s.nodeName.toLowerCase()?(a=e("img[usemap=#"+r+"]")[0],!!a&&n(a)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var s=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,s,r=e(this[0]);r.length&&r[0]!==document;){if(n=r.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(s=parseInt(r.css("zIndex"),10),!isNaN(s)&&0!==s))return s;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function s(t,i,n,s){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===n?["Left","Right"]:["Top","Bottom"],a=n.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?o["inner"+n].call(this):this.each(function(){e(this).css(a,s(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?o["outer"+n].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,i)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(t,!s)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));i.offsetHeight,e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var s,r=e.ui[t].prototype;for(s in n)r.plugins[s]=r.plugins[s]||[],r.plugins[s].push([i,n[s]])},call:function(e,t,i){var n,s=e.plugins[t];if(s&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<s.length;n++)e.options[s[n][0]]&&s[n][1].apply(e.element,i)}},contains:e.contains,hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[n]>0?!0:(t[n]=1,s=t[n]>0,t[n]=0,s)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,s,r,a){return e.ui.isOverAxis(t,n,r)&&e.ui.isOverAxis(i,s,a)}}))}(jQuery),function(e,t){var i=0,n=Array.prototype.slice,s=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(r){}s(t)},e.widget=function(t,i,n){var s,r,a,o,l=t.split(".")[0];t=t.split(".")[1],s=l+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},r=e[l][t],a=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new a(e,t)},e.extend(a,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(n,function(t,s){e.isFunction(s)&&(n[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=r,t}}())}),a.prototype=e.widget.extend(o,{widgetEventPrefix:o.widgetEventPrefix||t},n,{constructor:a,namespace:l,widgetName:t,widgetBaseClass:s,widgetFullName:s}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete r._childConstructors):i._childConstructors.push(a),e.widget.bridge(t,a)},e.widget.extend=function(i){for(var s,r,a=n.call(arguments,1),o=0,l=a.length;l>o;o++)for(s in a[o])r=a[o][s],a[o].hasOwnProperty(s)&&r!==t&&(i[s]=e.isPlainObject(r)?e.isPlainObject(i[s])?e.widget.extend({},i[s],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,s){var r=s.prototype.widgetFullName;e.fn[i]=function(a){var o="string"==typeof a,l=n.call(arguments,1),u=this;return a=!o&&l.length?e.widget.extend.apply(null,[a].concat(l)):a,o?this.each(function(){var n,s=e.data(this,r);return s?e.isFunction(s[a])&&"_"!==a.charAt(0)?(n=s[a].apply(s,l),n!==s&&n!==t?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+a+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(a||{})._init():new s(a,this)}),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetName,this),e.data(n,this.widgetFullName,this),this._on(this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var s,r,a,o=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(o={},s=i.split("."),i=s.shift(),s.length){for(r=o[i]=e.widget.extend({},this.options[i]),a=0;a<s.length-1;a++)r[s[a]]=r[s[a]]||{},r=r[s[a]];if(i=s.pop(),n===t)return r[i]===t?null:r[i];r[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i){var n,s=this;i?(t=n=e(t),this.bindings=this.bindings.add(t)):(i=t,t=this.element,n=this.widget()),e.each(i,function(i,r){function a(){return s.options.disabled===!0||e(this).hasClass("ui-state-disabled")?void 0:("string"==typeof r?s[r]:r).apply(s,arguments)}"string"!=typeof r&&(a.guid=r.guid=r.guid||a.guid||e.guid++);var o=i.match(/^(\w+)\s*(.*)$/),l=o[1]+s.eventNamespace,u=o[2];u?n.delegate(u,l,a):t.bind(l,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var s,r,a=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent,r)for(s in r)s in i||(i[s]=r[s]);return this.element.trigger(i,n),!(e.isFunction(a)&&a.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,s,r){"string"==typeof s&&(s={effect:s});var a,o=s?s===!0||"number"==typeof s?i:s.effect||i:t;s=s||{},"number"==typeof s&&(s={duration:s}),a=!e.isEmptyObject(s),s.complete=r,s.delay&&n.delay(s.delay),a&&e.effects&&(e.effects.effect[o]||e.uiBackCompat!==!1&&e.effects[o])?n[t](s):o!==t&&n[o]?n[o](s.duration,s.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1===i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return s&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function i(e,t,i){return[parseInt(e[0],10)*(p.test(e[0])?t/100:1),parseInt(e[1],10)*(p.test(e[1])?i/100:1)]}function n(t,i){return parseInt(e.css(t,i),10)||0}e.ui=e.ui||{};var s,r=Math.max,a=Math.abs,o=Math.round,l=/left|center|right/,u=/top|center|bottom/,h=/[\+\-]\d+%?/,c=/^\w+/,p=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(s!==t)return s;var i,n,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=r.children()[0];return e("body").append(r),i=a.offsetWidth,r.css("overflow","scroll"),n=a.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),s=i-n},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),n=t.isWindow?"":t.element.css("overflow-y"),s="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,r="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var s,p,m,f,y,g=e(t.of),v=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(v),L=g[0],O=(t.collision||"flip").split(" "),w={};return 9===L.nodeType?(p=g.width(),m=g.height(),f={top:0,left:0}):e.isWindow(L)?(p=g.width(),m=g.height(),f={top:g.scrollTop(),left:g.scrollLeft()}):L.preventDefault?(t.at="left top",p=m=0,f={top:L.pageY,left:L.pageX}):(p=g.outerWidth(),m=g.outerHeight(),f=g.offset()),y=e.extend({},f),e.each(["my","at"],function(){var e,i,n=(t[this]||"").split(" ");1===n.length&&(n=l.test(n[0])?n.concat(["center"]):u.test(n[0])?["center"].concat(n):["center","center"]),n[0]=l.test(n[0])?n[0]:"center",n[1]=u.test(n[1])?n[1]:"center",e=h.exec(n[0]),i=h.exec(n[1]),w[this]=[e?e[0]:0,i?i[0]:0],t[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]
}),1===O.length&&(O[1]=O[0]),"right"===t.at[0]?y.left+=p:"center"===t.at[0]&&(y.left+=p/2),"bottom"===t.at[1]?y.top+=m:"center"===t.at[1]&&(y.top+=m/2),s=i(w.at,p,m),y.left+=s[0],y.top+=s[1],this.each(function(){var l,u,h=e(this),c=h.outerWidth(),d=h.outerHeight(),L=n(this,"marginLeft"),_=n(this,"marginTop"),x=c+L+n(this,"marginRight")+b.width,S=d+_+n(this,"marginBottom")+b.height,C=e.extend({},y),k=i(w.my,h.outerWidth(),h.outerHeight());"right"===t.my[0]?C.left-=c:"center"===t.my[0]&&(C.left-=c/2),"bottom"===t.my[1]?C.top-=d:"center"===t.my[1]&&(C.top-=d/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=o(C.left),C.top=o(C.top)),l={marginLeft:L,marginTop:_},e.each(["left","top"],function(i,n){e.ui.position[O[i]]&&e.ui.position[O[i]][n](C,{targetWidth:p,targetHeight:m,elemWidth:c,elemHeight:d,collisionPosition:l,collisionWidth:x,collisionHeight:S,offset:[s[0]+k[0],s[1]+k[1]],my:t.my,at:t.at,within:v,elem:h})}),e.fn.bgiframe&&h.bgiframe(),t.using&&(u=function(e){var i=f.left-C.left,n=i+p-c,s=f.top-C.top,o=s+m-d,l={target:{element:g,left:f.left,top:f.top,width:p,height:m},element:{element:h,left:C.left,top:C.top,width:c,height:d},horizontal:0>n?"left":i>0?"right":"center",vertical:0>o?"top":s>0?"bottom":"middle"};c>p&&a(i+n)<p&&(l.horizontal="center"),d>m&&a(s+o)<m&&(l.vertical="middle"),l.important=r(a(i),a(n))>r(a(s),a(o))?"horizontal":"vertical",t.using.call(this,e,l)}),h.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,s=n.isWindow?n.scrollLeft:n.offset.left,a=n.width,o=e.left-t.collisionPosition.marginLeft,l=s-o,u=o+t.collisionWidth-a-s;t.collisionWidth>a?l>0&&0>=u?(i=e.left+l+t.collisionWidth-a-s,e.left+=l-i):e.left=u>0&&0>=l?s:l>u?s+a-t.collisionWidth:s:l>0?e.left+=l:u>0?e.left-=u:e.left=r(e.left-o,e.left)},top:function(e,t){var i,n=t.within,s=n.isWindow?n.scrollTop:n.offset.top,a=t.within.height,o=e.top-t.collisionPosition.marginTop,l=s-o,u=o+t.collisionHeight-a-s;t.collisionHeight>a?l>0&&0>=u?(i=e.top+l+t.collisionHeight-a-s,e.top+=l-i):e.top=u>0&&0>=l?s:l>u?s+a-t.collisionHeight:s:l>0?e.top+=l:u>0?e.top-=u:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var i,n,s=t.within,r=s.offset.left+s.scrollLeft,o=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,u=e.left-t.collisionPosition.marginLeft,h=u-l,c=u+t.collisionWidth-o-l,p="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,d="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,m=-2*t.offset[0];0>h?(i=e.left+p+d+m+t.collisionWidth-o-r,(0>i||i<a(h))&&(e.left+=p+d+m)):c>0&&(n=e.left-t.collisionPosition.marginLeft+p+d+m-l,(n>0||a(n)<c)&&(e.left+=p+d+m))},top:function(e,t){var i,n,s=t.within,r=s.offset.top+s.scrollTop,o=s.height,l=s.isWindow?s.scrollTop:s.offset.top,u=e.top-t.collisionPosition.marginTop,h=u-l,c=u+t.collisionHeight-o-l,p="top"===t.my[1],d=p?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,m="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,f=-2*t.offset[1];0>h?(n=e.top+d+m+f+t.collisionHeight-o-r,e.top+d+m+f>h&&(0>n||n<a(h))&&(e.top+=d+m+f)):c>0&&(i=e.top-t.collisionPosition.marginTop+d+m+f-l,e.top+d+m+f>c&&(i>0||a(i)<c)&&(e.top+=d+m+f))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,n,s,r,a=document.getElementsByTagName("body")[0],o=document.createElement("div");t=document.createElement(a?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in n)t.style[r]=n[r];t.appendChild(o),i=a||document.documentElement,i.insertBefore(t,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",s=e(o).offset().left,e.support.offsetFractions=s>10&&11>s,t.innerHTML="",i.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var i=e.fn.position;e.fn.position=function(n){if(!n||!n.offset)return i.call(this,n);var s=n.offset.split(" "),r=n.at.split(" ");return 1===s.length&&(s[1]=s[0]),/^\d/.test(s[0])&&(s[0]="+"+s[0]),/^\d/.test(s[1])&&(s[1]="+"+s[1]),1===r.length&&(/left|center|right/.test(r[0])?r[1]="center":(r[1]=r[0],r[0]="center")),i.call(this,e.extend(n,{at:r[0]+s[0]+" "+r[1]+s[1],offset:t}))}}(jQuery)}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var n=this.element[0],s=!1;n&&(n=n.parentNode);)n==document&&(s=!0);if(!s&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]!=this.element[0]&&!/(fixed|absolute)/.test(n.css("position"))&&n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),n=i[0];if(!n)return;var s=(i.offset(),"hidden"!=e(n).css("overflow"));this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(s?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:s.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName),r=t.pageX,a=t.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;t.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),t.pageY-this.offset.click.top<o[1]&&(a=o[1]+this.offset.click.top),t.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),t.pageY-this.offset.click.top>o[3]&&(a=o[3]+this.offset.click.top)}if(i.grid){var u=i.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;a=o?u-this.offset.click.top<o[1]||u-this.offset.click.top>o[3]?u-this.offset.click.top<o[1]?u+i.grid[1]:u-i.grid[1]:u:u;var h=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o?h-this.offset.click.left<o[0]||h-this.offset.click.left>o[2]?h-this.offset.click.left<o[0]?h+i.grid[0]:h-i.grid[0]:h:h}}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),s=n.options,r=e.extend({},i,{item:n.element});n.sortables=[],e(s.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var n=e(this).data("draggable"),s=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,s))})},drag:function(t,i){var n=e(this).data("draggable"),s=this;e.each(n.sortables,function(){var r=!1,a=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!=a&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(a.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),s=e(this).data("draggable").options;n.css("opacity")&&(s._opacity=n.css("opacity")),n.css("opacity",s.opacity)},stop:function(t,i){var n=e(this).data("draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,s=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),s=n.options,r=s.snapTolerance,a=i.offset.left,o=a+n.helperProportions.width,l=i.offset.top,u=l+n.helperProportions.height,h=n.snapElements.length-1;h>=0;h--){var c=n.snapElements[h].left,p=c+n.snapElements[h].width,d=n.snapElements[h].top,m=d+n.snapElements[h].height;if(a>c-r&&p+r>a&&l>d-r&&m+r>l||a>c-r&&p+r>a&&u>d-r&&m+r>u||o>c-r&&p+r>o&&l>d-r&&m+r>l||o>c-r&&p+r>o&&u>d-r&&m+r>u){if("inner"!=s.snapMode){var f=Math.abs(d-u)<=r,y=Math.abs(m-l)<=r,g=Math.abs(c-o)<=r,v=Math.abs(p-a)<=r;f&&(i.position.top=n._convertPositionTo("relative",{top:d-n.helperProportions.height,left:0}).top-n.margins.top),y&&(i.position.top=n._convertPositionTo("relative",{top:m,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c-n.helperProportions.width}).left-n.margins.left),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:p}).left-n.margins.left)}var b=f||y||g||v;if("outer"!=s.snapMode){var f=Math.abs(d-l)<=r,y=Math.abs(m-u)<=r,g=Math.abs(c-a)<=r,v=Math.abs(p-o)<=r;f&&(i.position.top=n._convertPositionTo("relative",{top:d,left:0}).top-n.margins.top),y&&(i.position.top=n._convertPositionTo("relative",{top:m-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c}).left-n.margins.left),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:p-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[h].snapping&&(f||y||g||v||b)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[h].item})),n.snapElements[h].snapping=f||y||g||v||b}else n.snapElements[h].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[h].item})),n.snapElements[h].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),s=e(this).data("draggable").options;n.css("zIndex")&&(s._zIndex=n.css("zIndex")),n.css("zIndex",s.zIndex)},stop:function(t,i){var n=e(this).data("draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;i<t.length;i++)t[i]==this&&t.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return!1;var s=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(s=!0,!1):void 0}),s?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,i,n){if(!i.offset)return!1;var s=(t.positionAbs||t.position.absolute).left,r=s+t.helperProportions.width,a=(t.positionAbs||t.position.absolute).top,o=a+t.helperProportions.height,l=i.offset.left,u=l+i.proportions.width,h=i.offset.top,c=h+i.proportions.height;switch(n){case"fit":return s>=l&&u>=r&&a>=h&&c>=o;case"intersect":return l<s+t.helperProportions.width/2&&r-t.helperProportions.width/2<u&&h<a+t.helperProportions.height/2&&o-t.helperProportions.height/2<c;case"pointer":var p=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,d=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,m=e.ui.isOver(d,p,h,l,i.proportions.height,i.proportions.width);return m;case"touch":return(a>=h&&c>=a||o>=h&&c>=o||h>a&&o>c)&&(s>=l&&u>=s||r>=l&&u>=r||l>s&&r>u);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,r=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var a=0;a<n.length;a++)if(!(n[a].options.disabled||t&&!n[a].accept.call(n[a].element[0],t.currentItem||t.element))){for(var o=0;o<r.length;o++)if(r[o]==n[a].element[0]){n[a].proportions.height=0;continue e}n[a].visible="none"!=n[a].element.css("display"),n[a].visible&&("mousedown"==s&&n[a]._activate.call(n[a],i),n[a].offset=n[a].element.offset(),n[a].proportions={width:n[a].element[0].offsetWidth,height:n[a].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n=e.ui.intersect(t,this,this.options.tolerance),s=n||1!=this.isover?n&&0==this.isover?"isover":null:"isout";if(s){var r;if(this.options.greedy){var a=this.options.scope,o=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===a});o.length&&(r=e.data(o[0],"droppable"),r.greedyChild="isover"==s?1:0)}r&&"isover"==s&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[s]=1,this["isout"==s?"isover":"isout"]=0,this["isover"==s?"_over":"_out"].call(this,i),r&&"isout"==s&&(r.isout=0,r.isover=1,r._over.call(r,i))}}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var s=0;s<n.length;s++){var r=e.trim(n[s]),a="ui-resizable-"+r,o=e('<div class="ui-resizable-handle '+a+'"></div>');o.css({zIndex:i.zIndex}),"se"==r&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=e(this.handles[i],this.element),s=0;s=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth();var r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(r,s),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())}).mouseleave(function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")}).insertAfter(i),i.remove()
}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var n in this.handles)e(this.handles[n])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var n=this.options,s=this.element.position(),r=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy();var a=t(this.helper.css("left")),o=t(this.helper.css("top"));n.containment&&(a+=e(n.containment).scrollLeft()||0,o+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:a,top:o},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:a,top:o},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),r.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var t=this.helper,i=(this.options,this.originalMousePosition),n=this.axis,s=e.pageX-i.left||0,r=e.pageY-i.top||0,a=this._change[n];if(!a)return!1;var o=a.apply(this,[e,s,r]);return this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(o=this._updateRatio(o,e)),o=this._respectSize(o,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(o),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,n=this;if(this._helper){var s=this._proportionallyResizeElements,r=s.length&&/textarea/i.test(s[0].nodeName),a=r&&e.ui.hasScroll(s[0],"left")?0:n.sizeDiff.height,o=r?0:n.sizeDiff.width,l={width:n.helper.width()-o,height:n.helper.height()-a},u=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,h=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:h,left:u})),n.helper.height(n.size.height),n.helper.width(n.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,s,r,a,o=this.options;a={minWidth:i(o.minWidth)?o.minWidth:0,maxWidth:i(o.maxWidth)?o.maxWidth:1/0,minHeight:i(o.minHeight)?o.minHeight:0,maxHeight:i(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,n=a.maxHeight*this.aspectRatio,r=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),n<a.maxWidth&&(a.maxWidth=n),r<a.maxHeight&&(a.maxHeight=r)),this._vBoundaries=a},_updateCache:function(e){this.options,this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),n=this.size,s=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==s&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"==s&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e,t){var n=(this.helper,this._vBoundaries),s=(this._aspectRatio||t.shiftKey,this.axis),r=i(e.width)&&n.maxWidth&&n.maxWidth<e.width,a=i(e.height)&&n.maxHeight&&n.maxHeight<e.height,o=i(e.width)&&n.minWidth&&n.minWidth>e.width,l=i(e.height)&&n.minHeight&&n.minHeight>e.height;o&&(e.width=n.minWidth),l&&(e.height=n.minHeight),r&&(e.width=n.maxWidth),a&&(e.height=n.maxHeight);var u=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,c=/sw|nw|w/.test(s),p=/nw|ne|n/.test(s);o&&c&&(e.left=u-n.minWidth),r&&c&&(e.left=u-n.maxWidth),l&&p&&(e.top=h-n.minHeight),a&&p&&(e.top=h-n.maxHeight);var d=!e.width&&!e.height;return d&&!e.left&&e.top?e.top=null:d&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(this.options,this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;i<this._proportionallyResizeElements.length;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var s=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=e.map(s,function(e,t){var i=parseInt(e,10)||0,n=parseInt(r[t],10)||0;return i+n})}n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.ui.ie6?1:0,s=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+s,height:this.element.outerHeight()+s,position:"absolute",left:this.elementOffset.left-n+"px",top:this.elementOffset.top-n+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=(this.options,this.originalSize),s=this.originalPosition;return{top:s.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("resizable"),s=n.options,r=n.originalSize,a=n.originalPosition,o={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-a.top||0,left:n.position.left-a.left||0},l=function(t,n){e(t).each(function(){var t=e(this),s=e(this).data("resizable-alsoresize"),r={},a=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})};"object"!=typeof s.alsoResize||s.alsoResize.nodeType?l(s.alsoResize):e.each(s.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),n=i.options,s=i._proportionallyResizeElements,r=s.length&&/textarea/i.test(s[0].nodeName),a=r&&e.ui.hasScroll(s[0],"left")?0:i.sizeDiff.height,o=r?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-a},u=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,h=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,h&&u?{top:h,left:u}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};s&&s.length&&e(s[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),n=i.options,s=i.element,r=n.containment,a=r instanceof e?r.get(0):/parent/.test(r)?s.parent().get(0):r;if(a)if(i.containerElement=e(a),/document/.test(r)||r==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var o=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(o.css("padding"+i))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-l[3],width:o.innerWidth()-l[1]};var u=i.containerOffset,h=i.containerSize.height,c=i.containerSize.width,p=e.ui.hasScroll(a,"left")?a.scrollWidth:c,d=e.ui.hasScroll(a)?a.scrollHeight:h;i.parentData={element:a,left:u.left,top:u.top,width:p,height:d}}},resize:function(t){var i=e(this).data("resizable"),n=i.options,s=(i.containerSize,i.containerOffset),r=(i.size,i.position),a=i._aspectRatio||t.shiftKey,o={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(o=s),r.left<(i._helper?s.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-s.left:i.position.left-o.left),a&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=n.helper?s.left:0),r.top<(i._helper?s.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-s.top:i.position.top),a&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?s.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var u=Math.abs((i._helper?i.offset.left-o.left:i.offset.left-o.left)+i.sizeDiff.width),h=Math.abs((i._helper?i.offset.top-o.top:i.offset.top-s.top)+i.sizeDiff.height),c=i.containerElement.get(0)==i.element.parent().get(0),p=/relative|absolute/.test(i.containerElement.css("position"));c&&p&&(u-=i.parentData.left),u+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-u,a&&(i.size.height=i.size.width/i.aspectRatio)),h+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-h,a&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,n=(t.position,t.containerOffset),s=t.containerPosition,r=t.containerElement,a=e(t.helper),o=a.offset(),l=a.outerWidth()-t.sizeDiff.width,u=a.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:o.left-s.left-n.left,width:l,height:u}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:o.left-s.left-n.left,width:l,height:u})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){var i=e(this).data("resizable"),n=i.options,s=i.size,r=i.originalSize,a=i.originalPosition,o=i.axis;n._aspectRatio||t.shiftKey,n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var l=Math.round((s.width-r.width)/(n.grid[0]||1))*(n.grid[0]||1),u=Math.round((s.height-r.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u):/^(ne)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=a.top-u):/^(sw)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+u,i.position.left=a.left-l):(i.size.width=r.width+l,i.size.height=r.height+u,i.position.top=a.top-u,i.position.left=a.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var n=this.options;this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,!t.metaKey&&!t.ctrlKey&&(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().andSelf().each(function(){var n=e.data(this,"selectable-item");if(n){var s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected");return n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var n=this.options,s=this.opos[0],r=this.opos[1],a=t.pageX,o=t.pageY;if(s>a){var l=a;a=s,s=l}if(r>o){var l=o;o=r,r=l}return this.helper.css({left:s,top:r,width:a-s,height:o-r}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var u=!1;"touch"==n.tolerance?u=!(l.left>a||l.right<s||l.top>o||l.bottom<r):"fit"==n.tolerance&&(u=l.left>s&&l.right<a&&l.top>r&&l.bottom<o),u?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&!t.metaKey&&!t.ctrlKey&&!l.startselected&&(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element})))}}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,this.options,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);var s=null;if(e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")==n?(s=e(this),!1):void 0}),e.data(t.target,n.widgetName+"-item")==n&&(s=e(t.target)),!s)return!1;if(this.options.handle&&!i){var r=!1;if(e(this.options.handle,s).find("*").andSelf().each(function(){this==t.target&&(r=!0)}),!r)return!1}return this.currentItem=s,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",s.cursor)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var s=this.items.length-1;s>=0;s--){var r=this.items[s],a=r.item[0],o=this._intersectsWithPointer(r);if(o&&r.instance===this.currentContainer&&a!=this.currentItem[0]&&this.placeholder[1==o?"next":"prev"]()[0]!=a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"==this.options.type?!e.contains(this.element[0],a):!0)){if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,s=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,r=e.left,a=r+e.width,o=e.top,l=o+e.height,u=this.offset.click.top,h=this.offset.click.left,c=n+u>o&&l>n+u&&t+h>r&&a>t+h;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:r<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<a&&o<n+this.helperProportions.height/2&&s-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=i&&n,r=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"==a||"down"==r?2:1:r&&("down"==r?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&n||"left"==r&&!n:s&&("down"==s&&i||"up"==s&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],s=this._connectWith();if(s&&t)for(var r=s.length-1;r>=0;r--)for(var a=e(s[r]),o=a.length-1;o>=0;o--){var l=e.data(a[o],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=n.length-1;r>=0;r--)n[r][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],s=this._connectWith();if(s&&this.ready)for(var r=s.length-1;r>=0;r--)for(var a=e(s[r]),o=a.length-1;o>=0;o--){var l=e.data(a[o],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var r=n.length-1;r>=0;r--)for(var u=n[r][1],h=n[r][0],o=0,c=h.length;c>o;o++){var p=e(h[o]);p.data(this.widgetName+"-item",u),i.push({item:p,instance:u,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var s=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=s.outerWidth(),n.height=s.outerHeight());var r=s.offset();n.left=r.left,n.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var i=t.options;if(!i.placeholder||i.placeholder.constructor==String){var n=i.placeholder;i.placeholder={element:function(){var i=e(document.createElement(t.currentItem[0].nodeName)).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return n||(i.style.visibility="hidden"),i},update:function(e,s){(!n||i.forcePlaceholderSize)&&(s.height()||s.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),s.width()||s.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}}t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var i=null,n=null,s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(i&&e.contains(this.containers[s].element[0],i.element[0]))continue;i=this.containers[s],n=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",t,this._uiHash(this)),this.containers[s].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else{for(var r=1e4,a=null,o=this.containers[n].floating?"left":"top",l=this.containers[n].floating?"width":"height",u=this.positionAbs[o]+this.offset.click[o],h=this.items.length-1;h>=0;h--)if(e.contains(this.containers[n].element[0],this.items[h].item[0])&&this.items[h].item[0]!=this.currentItem[0]){var c=this.items[h].item.offset()[o],p=!1;Math.abs(c-u)>Math.abs(c+this.items[h][l]-u)&&(p=!0,c+=this.items[h][l]),Math.abs(c-u)<r&&(r=Math.abs(c-u),a=this.items[h],this.direction=p?"up":"down")}if(!a&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n
},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),s="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(s?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(s?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:s.scrollLeft())*n}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);"relative"==this.cssPosition&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var r=t.pageX,a=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),i.grid)){var o=this.originalPageY+Math.round((a-this.originalPageY)/i.grid[1])*i.grid[1];a=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+i.grid[1]:o-i.grid[1]:o:o;var l=this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0];r=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this.counter;this._delay(function(){s==this.counter&&this.refreshPositions(!n)})},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var s in this._storedCSS)("auto"==this._storedCSS[s]||"static"==this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!i&&n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(i||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var s=this.containers.length-1;s>=0;s--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var s=0;s<n.length;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var s=0;s<n.length;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var i,n,s=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(s.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),s.range&&(s.range===!0&&(s.values||(s.values=[this._valueMin(),this._valueMin()]),s.values.length&&2!==s.values.length&&(s.values=[s.values[0],s.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===s.range||"max"===s.range?" ui-slider-range-"+s.range:""))),n=s.values&&s.values.length||1,i=r.length;n>i;i++)o.push(a);this.handles=r.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){s.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){s.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(i){var n,s,r,a,o=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),n=this._start(i,o),n===!1))return}switch(a=this.options.step,s=r=this.options.values&&this.options.values.length?this.values(o):this.value(),i.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;r=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;r=this._trimAlignValue(s-a)}this._slide(i,o,r)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,s,r,a,o,l,u,h=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-h.values(t));s>i&&(s=i,r=e(this),a=t)}),c.range===!0&&this.values(1)===c.min&&(a+=1,r=e(this.handles[a])),o=this._start(t,a),o===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,r.addClass("ui-state-active").focus(),l=r.offset(),u=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,a,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,s,r;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),r=this._valueMin()+n*s,this._trimAlignValue(r)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,s,r;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(s=this.values(),s[t]=i,r=this._trigger("slide",e,{handle:this.handles[t],value:i,values:s}),n=this.values(t?0:1),r!==!1&&this.values(t,i,!0))):i!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:i}),r!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var n,s,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,s=arguments[0],r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(s[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,i){var n,s=0;switch(e.isArray(this.options.values)&&(s=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,s,r,a=this.options.range,o=this.options,l=this,u=this._animateOff?!1:o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=100*((l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())),h["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[u?"animate":"css"](h,o.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[u?"animate":"css"]({left:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[u?"animate":"css"]({bottom:i+"%"},o.animate),1===n&&l.range[u?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(n=this.value(),s=this._valueMin(),r=this._valueMax(),i=r!==s?100*((n-s)/(r-s)):0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[u?"animate":"css"](h,o.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:i+"%"},o.animate),"max"===a&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:i+"%"},o.animate),"max"===a&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))}})}(jQuery),function(e){function t(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),s=e.inArray(i,n);-1!==s&&n.splice(s,1),t.removeData("ui-tooltip-id"),n=e.trim(n.join(" ")),n?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")}var n=0;e.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var n=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var s=e.Event("blur");s.target=s.currentTarget=n[0],t.close(s,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);if(n.length)return this.options.track&&n.data("ui-tooltip-id")?(this._find(n).position(e.extend({of:n},this.options.position)),this._off(this.document,"mousemove"),void 0):(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t;e(this).data("tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),this.title&&(e(this).uniqueId(),i.parents[this.id]={element:this,title:this.title},this.title="")}),this._updateContent(n,t),void 0)},_updateContent:function(e,t){var i,n=this.options.content,s=this;return"string"==typeof n?this._open(t,e,n):(i=n.call(e[0],function(i){e.data("tooltip-open")&&s._delay(function(){this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(i,n,s){function r(e){u.of=e,a.is(":hidden")||a.position(u)}var a,o,l,u=e.extend({},this.options.position);if(s){if(a=this._find(n),a.length)return a.find(".ui-tooltip-content").html(s),void 0;n.is("[title]")&&(i&&"mouseover"===i.type?n.attr("title",""):n.removeAttr("title")),a=this._tooltip(n),t(n,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.options.track&&i&&/^mouse/.test(i.originalEvent.type)?(this._on(this.document,{mousemove:r}),r(i)):a.position(e.extend({of:n},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(l=setInterval(function(){a.is(":visible")&&(r(u.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:a}),o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},i&&"mouseover"!==i.type||(o.mouseleave="close"),i&&"focusin"!==i.type||(o.focusout="close"),this._on(n,o)}},close:function(t){var n=this,s=e(t?t.currentTarget:this.element),r=this._find(s);this.closing||(s.data("ui-tooltip-title")&&s.attr("title",s.data("ui-tooltip-title")),i(s),r.stop(!0),this._hide(r,this.options.hide,function(){n._removeTooltip(e(this))}),s.removeData("tooltip-open"),this._off(s,"mouseleave focusout keyup"),s[0]!==this.element[0]&&this._off(s,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(e,t){t.element.title=t.title,delete n.parents[e]}),this.closing=!0,this._trigger("close",t,{tooltip:r}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,s=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(s),s.appendTo(this.document[0].body),e.fn.bgiframe&&s.bgiframe(),this.tooltips[i]=t,s},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var s=e.Event("blur");s.target=s.currentTarget=n[0],t.close(s,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})}})}(jQuery),jQuery.base64=function(){function e(e,t){var i=r.indexOf(e.charAt(t));if(-1===i)throw"Cannot decode base64";return i}function t(t){var i,n,r=0,a=t.length,o=[];if(t=String(t),0===a)return t;if(0!==a%4)throw"Cannot decode base64";for(t.charAt(a-1)===s&&(r=1,t.charAt(a-2)===s&&(r=2),a-=4),i=0;a>i;i+=4)n=e(t,i)<<18|e(t,i+1)<<12|e(t,i+2)<<6|e(t,i+3),o.push(String.fromCharCode(n>>16,255&n>>8,255&n));switch(r){case 1:n=e(t,i)<<18|e(t,i+1)<<12|e(t,i+2)<<6,o.push(String.fromCharCode(n>>16,255&n>>8));break;case 2:n=e(t,i)<<18|e(t,i+1)<<12,o.push(String.fromCharCode(n>>16))}return o.join("")}function i(e,t){var i=e.charCodeAt(t);if(i>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return i}function n(e){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";e=String(e);var t,n,a=[],o=e.length-e.length%3;if(0===e.length)return e;for(t=0;o>t;t+=3)n=i(e,t)<<16|i(e,t+1)<<8|i(e,t+2),a.push(r.charAt(n>>18)),a.push(r.charAt(63&n>>12)),a.push(r.charAt(63&n>>6)),a.push(r.charAt(63&n));switch(e.length-o){case 1:n=i(e,t)<<16,a.push(r.charAt(n>>18)+r.charAt(63&n>>12)+s+s);break;case 2:n=i(e,t)<<16|i(e,t+1)<<8,a.push(r.charAt(n>>18)+r.charAt(63&n>>12)+r.charAt(63&n>>6)+s)}return a.join("")}var s="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="1.0";return{decode:t,encode:n,VERSION:a}}(jQuery),function(){function e(e,t,i){for(var n=(i||0)-1,s=e?e.length:0;++n<s;)if(e[n]===t)return n;return-1}function t(t,i){var n=typeof i;if(t=t.cache,"boolean"==n||null==i)return t[i]?0:-1;"number"!=n&&"string"!=n&&(n="object");var s="number"==n?i:g+i;return t=(t=t[n])&&t[s],"object"==n?t&&e(t,i)>-1?0:-1:t?0:-1}function i(e){var t=this.cache,i=typeof e;if("boolean"==i||null==e)t[e]=!0;else{"number"!=i&&"string"!=i&&(i="object");var n="number"==i?e:g+e,s=t[i]||(t[i]={});"object"==i?(s[n]||(s[n]=[])).push(e):s[n]=!0}}function n(e){return e.charCodeAt(0)}function s(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||"undefined"==typeof i)return 1;if(n>i||"undefined"==typeof n)return-1}return e.index-t.index}function r(e){var t=-1,n=e.length,s=e[0],r=e[0|n/2],a=e[n-1];if(s&&"object"==typeof s&&r&&"object"==typeof r&&a&&"object"==typeof a)return!1;var o=l();o["false"]=o["null"]=o["true"]=o.undefined=!1;var u=l();for(u.array=e,u.cache=o,u.push=i;++t<n;)u.push(e[t]);return u}function a(e){return"\\"+Q[e]}function o(){return m.pop()||[]}function l(){return f.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function u(e){e.length=0,m.length<b&&m.push(e)}function h(e){var t=e.cache;t&&h(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,f.length<b&&f.push(e)}function c(e,t,i){t||(t=0),"undefined"==typeof i&&(i=e?e.length:0);for(var n=-1,s=i-t||0,r=Array(0>s?0:s);++n<s;)r[n]=e[t+n];return r}function p(i){function m(e){return e&&"object"==typeof e&&!Kn(e)&&Tn.call(e,"__wrapped__")?e:new f(e)}function f(e,t){this.__chain__=!!t,this.__wrapped__=e}function b(e){function t(){if(n){var e=n.slice();In.apply(e,arguments)}if(this instanceof t){var r=Z(i.prototype),a=i.apply(r,e||arguments);return Nt(a)?a:r}return i.apply(s,e||arguments)}var i=e[0],n=e[2],s=e[4];return Yn(t,e),t}function Q(e,t,i,n,s){if(i){var r=i(e);if("undefined"!=typeof r)return r}var a=Nt(e);if(!a)return e;var l=Sn.call(e);if(!U[l])return e;var h=Xn[l];switch(l){case j:case F:return new h(+e);case B:case H:return new h(e);case q:return r=h(e.source,S.exec(e)),r.lastIndex=e.lastIndex,r}var p=Kn(e);if(t){var d=!n;n||(n=o()),s||(s=o());for(var m=n.length;m--;)if(n[m]==e)return s[m];r=p?h(e.length):{}}else r=p?c(e):ss({},e);return p&&(Tn.call(e,"index")&&(r.index=e.index),Tn.call(e,"input")&&(r.input=e.input)),t?(n.push(e),s.push(r),(p?Yt:os)(e,function(e,a){r[a]=Q(e,t,i,n,s)}),d&&(u(n),u(s)),r):r}function Z(e){return Nt(e)?Bn(e):{}}function Y(e,t,i){if("function"!=typeof e)return Yi;if("undefined"==typeof t||!("prototype"in e))return e;var n=e.__bindData__;if("undefined"==typeof n&&(Zn.funcNames&&(n=!e.name),n=n||!Zn.funcDecomp,!n)){var s=En.call(e);Zn.funcNames||(n=!C.test(s)),n||(n=E.test(s),Yn(e,n))}if(n===!1||n!==!0&&1&n[1])return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,s){return e.call(t,i,n,s)};case 4:return function(i,n,s,r){return e.call(t,i,n,s,r)}}return Ii(e,t)}function et(e){function t(){var e=l?a:this;if(s){var m=s.slice();In.apply(m,arguments)}if((r||h)&&(m||(m=c(arguments)),r&&In.apply(m,r),h&&m.length<o))return n|=16,et([i,p?n:-4&n,m,null,a,o]);if(m||(m=arguments),u&&(i=e[d]),this instanceof t){e=Z(i.prototype);var f=i.apply(e,m);return Nt(f)?f:e}return i.apply(e,m)}var i=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=1&n,u=2&n,h=4&n,p=8&n,d=i;return Yn(t,e),t}function tt(i,n){var s=-1,a=ht(),o=i?i.length:0,l=o>=v&&a===e,u=[];if(l){var c=r(n);c?(a=t,n=c):l=!1}for(;++s<o;){var p=i[s];a(n,p)<0&&u.push(p)}return l&&h(n),u}function it(e,t,i,n){for(var s=(n||0)-1,r=e?e.length:0,a=[];++s<r;){var o=e[s];if(o&&"object"==typeof o&&"number"==typeof o.length&&(Kn(o)||dt(o))){t||(o=it(o,t,i));var l=-1,u=o.length,h=a.length;for(a.length+=u;++l<u;)a[h++]=o[l]}else i||a.push(o)}return a}function nt(e,t,i,n,s,r){if(i){var a=i(e,t);if("undefined"!=typeof a)return!!a}if(e===t)return 0!==e||1/e==1/t;var l=typeof e,h=typeof t;if(!(e!==e||e&&W[l]||t&&W[h]))return!1;if(null==e||null==t)return e===t;var c=Sn.call(e),p=Sn.call(t);if(c==I&&(c=D),p==I&&(p=D),c!=p)return!1;switch(c){case j:case F:return+e==+t;case B:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case q:case H:return e==Ln(t)}var d=c==R;if(!d){var m=Tn.call(e,"__wrapped__"),f=Tn.call(t,"__wrapped__");if(m||f)return nt(m?e.__wrapped__:e,f?t.__wrapped__:t,i,n,s,r);if(c!=D)return!1;var y=e.constructor,g=t.constructor;if(y!=g&&!(Et(y)&&y instanceof y&&Et(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t)return!1}var v=!s;s||(s=o()),r||(r=o());for(var b=s.length;b--;)if(s[b]==e)return r[b]==t;var L=0;if(a=!0,s.push(e),r.push(t),d){if(b=e.length,L=t.length,a=L==e.length,!a&&!n)return a;for(;L--;){var O=b,w=t[L];if(n)for(;O--&&!(a=nt(e[O],w,i,n,s,r)););else if(!(a=nt(e[L],w,i,n,s,r)))break}return a}return as(t,function(t,o,l){return Tn.call(l,o)?(L++,a=Tn.call(e,o)&&nt(e[o],t,i,n,s,r)):void 0}),a&&!n&&as(e,function(e,t,i){return Tn.call(i,t)?a=--L>-1:void 0}),v&&(u(s),u(r)),a}function st(e,t,i,n,s){(Kn(t)?Yt:os)(t,function(t,r){var a,o,l=t,u=e[r];if(t&&((o=Kn(t))||ls(t))){for(var h=n.length;h--;)if(a=n[h]==t){u=s[h];break}if(!a){var c;i&&(l=i(u,t),(c="undefined"!=typeof l)&&(u=l)),c||(u=o?Kn(u)?u:[]:ls(u)?u:{}),n.push(t),s.push(u),c||st(u,t,i,n,s)}}else i&&(l=i(u,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(u=l);e[r]=u})}function rt(e,t){return e+Pn(Qn()*(t-e+1))}function at(i,n,s){var a=-1,l=ht(),c=i?i.length:0,p=[],d=!n&&c>=v&&l===e,m=s||d?o():p;if(d){var f=r(m);f?(l=t,m=f):(d=!1,m=s?m:(u(m),p))}for(;++a<c;){var y=i[a],g=s?s(y,a,i):y;(n?!a||m[m.length-1]!==g:l(m,g)<0)&&((s||d)&&m.push(g),p.push(y))}return d?(u(m.array),h(m)):s&&u(m),p}function ot(e){return function(t,i,n){var s={};i=m.createCallback(i,n,3);var r=-1,a=t?t.length:0;if("number"==typeof a)for(;++r<a;){var o=t[r];e(s,o,i(o,r,t),t)}else os(t,function(t,n,r){e(s,t,i(t,n,r),r)});return s}}function lt(e,t,i,n,s,r){var a=1&t,o=2&t,l=4&t,u=16&t,h=32&t;if(!o&&!Et(e))throw new On;u&&!i.length&&(t&=-17,u=i=!1),h&&!n.length&&(t&=-33,h=n=!1);var c=e&&e.__bindData__;if(c&&c!==!0)return c=c.slice(),!a||1&c[1]||(c[4]=s),!a&&1&c[1]&&(t|=8),!l||4&c[1]||(c[5]=r),u&&In.apply(c[2]||(c[2]=[]),i),h&&In.apply(c[3]||(c[3]=[]),n),c[1]|=t,lt.apply(null,c);var p=1==t||17===t?b:et;return p([e,t,i,n,s,r])}function ut(e){return es[e]}function ht(){var t=(t=m.indexOf)===vi?e:t;return t}function ct(e){var t,i;return e&&Sn.call(e)==D&&(t=e.constructor,!Et(t)||t instanceof t)?(as(e,function(e,t){i=t}),"undefined"==typeof i||Tn.call(e,i)):!1}function pt(e){return ts[e]}function dt(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Sn.call(e)==I||!1}function mt(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i=t,t=!1),Q(e,t,"function"==typeof i&&Y(i,n,1))}function ft(e,t,i){return Q(e,!0,"function"==typeof t&&Y(t,i,1))}function yt(e,t){var i=Z(e);return t?ss(i,t):i}function gt(e,t,i){var n;return t=m.createCallback(t,i,3),os(e,function(e,i,s){return t(e,i,s)?(n=i,!1):void 0}),n}function vt(e,t,i){var n;return t=m.createCallback(t,i,3),Lt(e,function(e,i,s){return t(e,i,s)?(n=i,!1):void 0}),n}function bt(e,t,i){var n=[];as(e,function(e,t){n.push(t,e)});var s=n.length;for(t=Y(t,i,3);s--&&t(n[s--],n[s],e)!==!1;);return e}function Lt(e,t,i){var n=Jn(e),s=n.length;for(t=Y(t,i,3);s--;){var r=n[s];if(t(e[r],r,e)===!1)break}return e}function Ot(e){var t=[];return as(e,function(e,i){Et(e)&&t.push(i)}),t.sort()}function wt(e,t){return e?Tn.call(e,t):!1}function _t(e){for(var t=-1,i=Jn(e),n=i.length,s={};++t<n;){var r=i[t];s[e[r]]=r}return s}function xt(e){return e===!0||e===!1||e&&"object"==typeof e&&Sn.call(e)==j||!1}function St(e){return e&&"object"==typeof e&&Sn.call(e)==F||!1}function Ct(e){return e&&1===e.nodeType||!1}function kt(e){var t=!0;if(!e)return t;var i=Sn.call(e),n=e.length;return i==R||i==H||i==I||i==D&&"number"==typeof n&&Et(e.splice)?!n:(os(e,function(){return t=!1}),t)}function Mt(e,t,i,n){return nt(e,t,"function"==typeof i&&Y(i,n,2))}function Pt(e){return qn(e)&&!Hn(parseFloat(e))}function Et(e){return"function"==typeof e}function Nt(e){return!(!e||!W[typeof e])}function Tt(e){return It(e)&&e!=+e}function zt(e){return null===e
}function It(e){return"number"==typeof e||e&&"object"==typeof e&&Sn.call(e)==B||!1}function Rt(e){return e&&"object"==typeof e&&Sn.call(e)==q||!1}function jt(e){return"string"==typeof e||e&&"object"==typeof e&&Sn.call(e)==H||!1}function Ft(e){return"undefined"==typeof e}function At(e){var t=arguments,i=2;if(!Nt(e))return e;if("number"!=typeof t[2]&&(i=t.length),i>3&&"function"==typeof t[i-2])var n=Y(t[--i-1],t[i--],2);else i>2&&"function"==typeof t[i-1]&&(n=t[--i]);for(var s=c(arguments,1,i),r=-1,a=o(),l=o();++r<i;)st(e,s[r],n,a,l);return u(a),u(l),e}function Bt(e,t,i){var n={};if("function"!=typeof t){var s=[];as(e,function(e,t){s.push(t)}),s=tt(s,it(arguments,!0,!1,1));for(var r=-1,a=s.length;++r<a;){var o=s[r];n[o]=e[o]}}else t=m.createCallback(t,i,3),as(e,function(e,i,s){t(e,i,s)||(n[i]=e)});return n}function Dt(e){for(var t=-1,i=Jn(e),n=i.length,s=pn(n);++t<n;){var r=i[t];s[t]=[r,e[r]]}return s}function qt(e,t,i){var n={};if("function"!=typeof t)for(var s=-1,r=it(arguments,!0,!1,1),a=Nt(e)?r.length:0;++s<a;){var o=r[s];o in e&&(n[o]=e[o])}else t=m.createCallback(t,i,3),as(e,function(e,i,s){t(e,i,s)&&(n[i]=e)});return n}function Ht(e,t,i,n){var s=Kn(e);if(null==i)if(s)i=[];else{var r=e&&e.constructor,a=r&&r.prototype;i=Z(a)}return t&&(t=m.createCallback(t,n,4),(s?Yt:os)(e,function(e,n,s){return t(i,e,n,s)})),i}function Ut(e){for(var t=-1,i=Jn(e),n=i.length,s=pn(n);++t<n;)s[t]=e[i[t]];return s}function Gt(e){for(var t=arguments,i=-1,n=it(t,!0,!1,1),s=t[2]&&t[2][t[1]]===e?1:n.length,r=pn(s);++i<s;)r[i]=e[n[i]];return r}function Vt(e,t,i){var n=-1,s=ht(),r=e?e.length:0,a=!1;return i=(0>i?Gn(0,r+i):i)||0,Kn(e)?a=s(e,t,i)>-1:"number"==typeof r?a=(jt(e)?e.indexOf(t,i):s(e,t,i))>-1:os(e,function(e){return++n>=i?!(a=e===t):void 0}),a}function Wt(e,t,i){var n=!0;t=m.createCallback(t,i,3);var s=-1,r=e?e.length:0;if("number"==typeof r)for(;++s<r&&(n=!!t(e[s],s,e)););else os(e,function(e,i,s){return n=!!t(e,i,s)});return n}function Qt(e,t,i){var n=[];t=m.createCallback(t,i,3);var s=-1,r=e?e.length:0;if("number"==typeof r)for(;++s<r;){var a=e[s];t(a,s,e)&&n.push(a)}else os(e,function(e,i,s){t(e,i,s)&&n.push(e)});return n}function Xt(e,t,i){t=m.createCallback(t,i,3);var n=-1,s=e?e.length:0;if("number"!=typeof s){var r;return os(e,function(e,i,n){return t(e,i,n)?(r=e,!1):void 0}),r}for(;++n<s;){var a=e[n];if(t(a,n,e))return a}}function Zt(e,t,i){var n;return t=m.createCallback(t,i,3),Kt(e,function(e,i,s){return t(e,i,s)?(n=e,!1):void 0}),n}function Yt(e,t,i){var n=-1,s=e?e.length:0;if(t=t&&"undefined"==typeof i?t:Y(t,i,3),"number"==typeof s)for(;++n<s&&t(e[n],n,e)!==!1;);else os(e,t);return e}function Kt(e,t,i){var n=e?e.length:0;if(t=t&&"undefined"==typeof i?t:Y(t,i,3),"number"==typeof n)for(;n--&&t(e[n],n,e)!==!1;);else{var s=Jn(e);n=s.length,os(e,function(e,i,r){return i=s?s[--n]:--n,t(r[i],i,r)})}return e}function $t(e,t){var i=c(arguments,2),n=-1,s="function"==typeof t,r=e?e.length:0,a=pn("number"==typeof r?r:0);return Yt(e,function(e){a[++n]=(s?t:e[t]).apply(e,i)}),a}function Jt(e,t,i){var n=-1,s=e?e.length:0;if(t=m.createCallback(t,i,3),"number"==typeof s)for(var r=pn(s);++n<s;)r[n]=t(e[n],n,e);else r=[],os(e,function(e,i,s){r[++n]=t(e,i,s)});return r}function ei(e,t,i){var s=-1/0,r=s;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Kn(e))for(var a=-1,o=e.length;++a<o;){var l=e[a];l>r&&(r=l)}else t=null==t&&jt(e)?n:m.createCallback(t,i,3),Yt(e,function(e,i,n){var a=t(e,i,n);a>s&&(s=a,r=e)});return r}function ti(e,t,i){var s=1/0,r=s;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Kn(e))for(var a=-1,o=e.length;++a<o;){var l=e[a];r>l&&(r=l)}else t=null==t&&jt(e)?n:m.createCallback(t,i,3),Yt(e,function(e,i,n){var a=t(e,i,n);s>a&&(s=a,r=e)});return r}function ii(e,t){var i=-1,n=e?e.length:0;if("number"==typeof n)for(var s=pn(n);++i<n;)s[i]=e[i][t];return s||Jt(e,t)}function ni(e,t,i,n){if(!e)return i;var s=arguments.length<3;t=m.createCallback(t,n,4);var r=-1,a=e.length;if("number"==typeof a)for(s&&(i=e[++r]);++r<a;)i=t(i,e[r],r,e);else os(e,function(e,n,r){i=s?(s=!1,e):t(i,e,n,r)});return i}function si(e,t,i,n){var s=arguments.length<3;return t=m.createCallback(t,n,4),Kt(e,function(e,n,r){i=s?(s=!1,e):t(i,e,n,r)}),i}function ri(e,t,i){return t=m.createCallback(t,i,3),Qt(e,function(e,i,n){return!t(e,i,n)})}function ai(e,t,i){if(e&&"number"!=typeof e.length&&(e=Ut(e)),null==t||i)return e?e[rt(0,e.length-1)]:d;var n=oi(e);return n.length=Vn(Gn(0,t),n.length),n}function oi(e){var t=-1,i=e?e.length:0,n=pn("number"==typeof i?i:0);return Yt(e,function(e){var i=rt(0,++t);n[t]=n[i],n[i]=e}),n}function li(e){var t=e?e.length:0;return"number"==typeof t?t:Jn(e).length}function ui(e,t,i){var n;t=m.createCallback(t,i,3);var s=-1,r=e?e.length:0;if("number"==typeof r)for(;++s<r&&!(n=t(e[s],s,e)););else os(e,function(e,i,s){return!(n=t(e,i,s))});return!!n}function hi(e,t,i){var n=-1,r=e?e.length:0,a=pn("number"==typeof r?r:0);for(t=m.createCallback(t,i,3),Yt(e,function(e,i,s){var r=a[++n]=l();r.criteria=t(e,i,s),r.index=n,r.value=e}),r=a.length,a.sort(s);r--;){var o=a[r];a[r]=o.value,h(o)}return a}function ci(e){return e&&"number"==typeof e.length?c(e):Ut(e)}function pi(e){for(var t=-1,i=e?e.length:0,n=[];++t<i;){var s=e[t];s&&n.push(s)}return n}function di(e){return tt(e,it(arguments,!0,!0,1))}function mi(e,t,i){var n=-1,s=e?e.length:0;for(t=m.createCallback(t,i,3);++n<s;)if(t(e[n],n,e))return n;return-1}function fi(e,t,i){var n=e?e.length:0;for(t=m.createCallback(t,i,3);n--;)if(t(e[n],n,e))return n;return-1}function yi(e,t,i){var n=0,s=e?e.length:0;if("number"!=typeof t&&null!=t){var r=-1;for(t=m.createCallback(t,i,3);++r<s&&t(e[r],r,e);)n++}else if(n=t,null==n||i)return e?e[0]:d;return c(e,0,Vn(Gn(0,n),s))}function gi(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(e=Jt(e,i,n)),it(e,t)}function vi(t,i,n){if("number"==typeof n){var s=t?t.length:0;n=0>n?Gn(0,s+n):n||0}else if(n){var r=ki(t,i);return t[r]===i?r:-1}return e(t,i,n)}function bi(e,t,i){var n=0,s=e?e.length:0;if("number"!=typeof t&&null!=t){var r=s;for(t=m.createCallback(t,i,3);r--&&t(e[r],r,e);)n++}else n=null==t||i?1:t||n;return c(e,0,Vn(Gn(0,s-n),s))}function Li(i){for(var n=arguments,s=n.length,a=-1,l=o(),c=-1,p=ht(),d=i?i.length:0,m=[],f=o();++a<s;){var y=n[a];l[a]=p===e&&(y?y.length:0)>=v&&r(a?n[a]:f)}e:for(;++c<d;){var g=l[0];if(y=i[c],(g?t(g,y):p(f,y))<0){for(a=s,(g||f).push(y);--a;)if(g=l[a],(g?t(g,y):p(n[a],y))<0)continue e;m.push(y)}}for(;s--;)g=l[s],g&&h(g);return u(l),u(f),m}function Oi(e,t,i){var n=0,s=e?e.length:0;if("number"!=typeof t&&null!=t){var r=s;for(t=m.createCallback(t,i,3);r--&&t(e[r],r,e);)n++}else if(n=t,null==n||i)return e?e[s-1]:d;return c(e,Gn(0,s-n))}function wi(e,t,i){var n=e?e.length:0;for("number"==typeof i&&(n=(0>i?Gn(0,n+i):Vn(i,n-1))+1);n--;)if(e[n]===t)return n;return-1}function _i(e){for(var t=arguments,i=0,n=t.length,s=e?e.length:0;++i<n;)for(var r=-1,a=t[i];++r<s;)e[r]===a&&(jn.call(e,r--,1),s--);return e}function xi(e,t,i){e=+e||0,i="number"==typeof i?i:+i||1,null==t&&(t=e,e=0);for(var n=-1,s=Gn(0,kn((t-e)/(i||1))),r=pn(s);++n<s;)r[n]=e,e+=i;return r}function Si(e,t,i){var n=-1,s=e?e.length:0,r=[];for(t=m.createCallback(t,i,3);++n<s;){var a=e[n];t(a,n,e)&&(r.push(a),jn.call(e,n--,1),s--)}return r}function Ci(e,t,i){if("number"!=typeof t&&null!=t){var n=0,s=-1,r=e?e.length:0;for(t=m.createCallback(t,i,3);++s<r&&t(e[s],s,e);)n++}else n=null==t||i?1:Gn(0,t);return c(e,n)}function ki(e,t,i,n){var s=0,r=e?e.length:s;for(i=i?m.createCallback(i,n,1):Yi,t=i(t);r>s;){var a=s+r>>>1;i(e[a])<t?s=a+1:r=a}return s}function Mi(){return at(it(arguments,!0,!0))}function Pi(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(i=m.createCallback(i,n,3)),at(e,t,i)}function Ei(e){return tt(e,c(arguments,1))}function Ni(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,i=e?ei(ii(e,"length")):0,n=pn(0>i?0:i);++t<i;)n[t]=ii(e,t);return n}function Ti(e,t){for(var i=-1,n=e?e.length:0,s={};++i<n;){var r=e[i];t?s[r]=t[i]:r&&(s[r[0]]=r[1])}return s}function zi(e,t){if(!Et(t))throw new On;return function(){return--e<1?t.apply(this,arguments):void 0}}function Ii(e,t){return arguments.length>2?lt(e,17,c(arguments,2),null,t):lt(e,1,null,null,t)}function Ri(e){for(var t=arguments.length>1?it(arguments,!0,!1,1):Ot(e),i=-1,n=t.length;++i<n;){var s=t[i];e[s]=lt(e[s],1,null,null,e)}return e}function ji(e,t){return arguments.length>2?lt(t,19,c(arguments,2),null,e):lt(t,3,null,null,e)}function Fi(){for(var e=arguments,t=e.length;t--;)if(!Et(e[t]))throw new On;return function(){for(var t=arguments,i=e.length;i--;)t=[e[i].apply(this,t)];return t[0]}}function Ai(e,t,i){var n=typeof e;if(null==e||"function"==n)return Y(e,t,i);if("object"!=n)return function(t){return t[e]};var s=Jn(e),r=s[0],a=e[r];return 1!=s.length||a!==a||Nt(a)?function(t){for(var i=s.length,n=!1;i--&&(n=nt(t[s[i]],e[s[i]],null,!0)););return n}:function(e){var t=e[r];return a===t&&(0!==a||1/a==1/t)}}function Bi(e,t){return t="number"==typeof t?t:+t||e.length,lt(e,4,null,null,null,t)}function Di(e,t,i){var n,s,r,a,o,l,u,h=0,c=!1,p=!0;if(!Et(e))throw new On;if(t=Gn(0,t)||0,i===!0){var m=!0;p=!1}else Nt(i)&&(m=i.leading,c="maxWait"in i&&(Gn(t,i.maxWait)||0),p="trailing"in i?i.trailing:p);var f=function(){var i=t-(zn()-a);if(0>=i){s&&Mn(s);var c=u;s=l=u=d,c&&(h=zn(),r=e.apply(o,n),l||s||(n=o=null))}else l=Rn(f,i)},y=function(){l&&Mn(l),s=l=u=d,(p||c!==t)&&(h=zn(),r=e.apply(o,n),l||s||(n=o=null))};return function(){if(n=arguments,a=zn(),o=this,u=p&&(l||!m),c===!1)var i=m&&!l;else{s||m||(h=a);var d=c-(a-h),g=0>=d;g?(s&&(s=Mn(s)),h=a,r=e.apply(o,n)):s||(s=Rn(y,d))}return g&&l?l=Mn(l):l||t===c||(l=Rn(f,t)),i&&(g=!0,r=e.apply(o,n)),!g||l||s||(n=o=null),r}}function qi(e){if(!Et(e))throw new On;var t=c(arguments,1);return Rn(function(){e.apply(d,t)},1)}function Hi(e,t){if(!Et(e))throw new On;var i=c(arguments,2);return Rn(function(){e.apply(d,i)},t)}function Ui(e,t){if(!Et(e))throw new On;var i=function(){var n=i.cache,s=t?t.apply(this,arguments):g+arguments[0];return Tn.call(n,s)?n[s]:n[s]=e.apply(this,arguments)};return i.cache={},i}function Gi(e){var t,i;if(!Et(e))throw new On;return function(){return t?i:(t=!0,i=e.apply(this,arguments),e=null,i)}}function Vi(e){return lt(e,16,c(arguments,1))}function Wi(e){return lt(e,32,null,c(arguments,1))}function Qi(e,t,i){var n=!0,s=!0;if(!Et(e))throw new On;return i===!1?n=!1:Nt(i)&&(n="leading"in i?i.leading:n,s="trailing"in i?i.trailing:s),G.leading=n,G.maxWait=t,G.trailing=s,Di(e,t,G)}function Xi(e,t){return lt(t,16,[e])}function Zi(e){return null==e?"":Ln(e).replace(ns,ut)}function Yi(e){return e}function Ki(e,t){var i=e,n=!t||Et(i);t||(i=f,t=e,e=m),Yt(Ot(t),function(s){var r=e[s]=t[s];n&&(i.prototype[s]=function(){var t=this.__wrapped__,n=[t];In.apply(n,arguments);var s=r.apply(e,n);return t&&"object"==typeof t&&t===s?this:(s=new i(s),s.__chain__=this.__chain__,s)})})}function $i(){return i._=xn,this}function Ji(){}function en(e,t,i){var n=null==e,s=null==t;if(null==i&&("boolean"==typeof e&&s?(i=e,e=1):s||"boolean"!=typeof t||(i=t,s=!0)),n&&s&&(t=1),e=+e||0,s?(t=e,e=0):t=+t||0,i||e%1||t%1){var r=Qn();return Vn(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)}return rt(e,t)}function tn(e,t){if(e){var i=e[t];return Et(i)?e[t]():i}}function nn(e,t,i){var n=m.templateSettings;e=Ln(e||""),i=rs({},i,n);var s,r=rs({},i.imports,n.imports),o=Jn(r),l=Ut(r),u=0,h=i.interpolate||P,c="__p += '",p=bn((i.escape||P).source+"|"+h.source+"|"+(h===k?x:P).source+"|"+(i.evaluate||P).source+"|$","g");e.replace(p,function(t,i,n,r,o,l){return n||(n=r),c+=e.slice(u,l).replace(N,a),i&&(c+="' +\n__e("+i+") +\n'"),o&&(s=!0,c+="';\n"+o+";\n__p += '"),n&&(c+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+t.length,t}),c+="';\n";var f=i.variable,y=f;y||(f="obj",c="with ("+f+") {\n"+c+"\n}\n"),c=(s?c.replace(O,""):c).replace(w,"$1").replace(_,"$1;"),c="function("+f+") {\n"+(y?"":f+" || ("+f+" = {});\n")+"var __t, __p = '', __e = _.escape"+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}";var g="\n/*\n//# sourceURL="+(i.sourceURL||"/lodash/template/source["+z++ +"]")+"\n*/";try{var v=fn(o,"return "+c+g).apply(d,l)}catch(b){throw b.source=c,b}return t?v(t):(v.source=c,v)}function sn(e,t,i){e=(e=+e)>-1?e:0;var n=-1,s=pn(e);for(t=Y(t,i,1);++n<e;)s[n]=t(n);return s}function rn(e){return null==e?"":Ln(e).replace(is,pt)}function an(e){var t=++y;return Ln(null==e?"":e)+t}function on(e){return e=new f(e),e.__chain__=!0,e}function ln(e,t){return t(e),e}function un(){return this.__chain__=!0,this}function hn(){return Ln(this.__wrapped__)}function cn(){return this.__wrapped__}i=i?J.defaults(X.Object(),i,J.pick(X,T)):X;var pn=i.Array,dn=i.Boolean,mn=i.Date,fn=i.Function,yn=i.Math,gn=i.Number,vn=i.Object,bn=i.RegExp,Ln=i.String,On=i.TypeError,wn=[],_n=vn.prototype,xn=i._,Sn=_n.toString,Cn=bn("^"+Ln(Sn).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),kn=yn.ceil,Mn=i.clearTimeout,Pn=yn.floor,En=fn.prototype.toString,Nn=Cn.test(Nn=vn.getPrototypeOf)&&Nn,Tn=_n.hasOwnProperty,zn=Cn.test(zn=mn.now)&&zn||function(){return+new mn},In=wn.push,Rn=i.setTimeout,jn=wn.splice,Fn="function"==typeof(Fn=$&&K&&$.setImmediate)&&!Cn.test(Fn)&&Fn,An=function(){try{var e={},t=Cn.test(t=vn.defineProperty)&&t,i=t(e,e,e)&&t}catch(n){}return i}(),Bn=Cn.test(Bn=vn.create)&&Bn,Dn=Cn.test(Dn=pn.isArray)&&Dn,qn=i.isFinite,Hn=i.isNaN,Un=Cn.test(Un=vn.keys)&&Un,Gn=yn.max,Vn=yn.min,Wn=i.parseInt,Qn=yn.random,Xn={};Xn[R]=pn,Xn[j]=dn,Xn[F]=mn,Xn[A]=fn,Xn[D]=vn,Xn[B]=gn,Xn[q]=bn,Xn[H]=Ln,f.prototype=m.prototype;var Zn=m.support={};Zn.funcDecomp=!Cn.test(i.WinRTError)&&E.test(p),Zn.funcNames="string"==typeof fn.name,m.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:k,variable:"",imports:{_:m}},Bn||(Z=function(){function e(){}return function(t){if(Nt(t)){e.prototype=t;var n=new e;e.prototype=null}return n||i.Object()}}());var Yn=An?function(e,t){V.value=t,An(e,"__bindData__",V)}:Ji,Kn=Dn||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Sn.call(e)==R||!1},$n=function(e){var t,i=e,n=[];if(!i)return n;if(!W[typeof e])return n;for(t in i)Tn.call(i,t)&&n.push(t);return n},Jn=Un?function(e){return Nt(e)?Un(e):[]}:$n,es={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ts=_t(es),is=bn("("+Jn(ts).join("|")+")","g"),ns=bn("["+Jn(es).join("")+"]","g"),ss=function(e,t,i){var n,s=e,r=s;if(!s)return r;var a=arguments,o=0,l="number"==typeof i?2:a.length;if(l>3&&"function"==typeof a[l-2])var u=Y(a[--l-1],a[l--],2);else l>2&&"function"==typeof a[l-1]&&(u=a[--l]);for(;++o<l;)if(s=a[o],s&&W[typeof s])for(var h=-1,c=W[typeof s]&&Jn(s),p=c?c.length:0;++h<p;)n=c[h],r[n]=u?u(r[n],s[n]):s[n];return r},rs=function(e,t,i){var n,s=e,r=s;if(!s)return r;for(var a=arguments,o=0,l="number"==typeof i?2:a.length;++o<l;)if(s=a[o],s&&W[typeof s])for(var u=-1,h=W[typeof s]&&Jn(s),c=h?h.length:0;++u<c;)n=h[u],"undefined"==typeof r[n]&&(r[n]=s[n]);return r},as=function(e,t,i){var n,s=e,r=s;if(!s)return r;if(!W[typeof s])return r;t=t&&"undefined"==typeof i?t:Y(t,i,3);for(n in s)if(t(s[n],n,e)===!1)return r;return r},os=function(e,t,i){var n,s=e,r=s;if(!s)return r;if(!W[typeof s])return r;t=t&&"undefined"==typeof i?t:Y(t,i,3);for(var a=-1,o=W[typeof s]&&Jn(s),l=o?o.length:0;++a<l;)if(n=o[a],t(s[n],n,e)===!1)return r;return r},ls=function(e){if(!e||Sn.call(e)!=D)return!1;var t=e.valueOf,i="function"==typeof t&&(i=Nn(t))&&Nn(i);return i?e==i||Nn(e)==i:ct(e)},us=ot(function(e,t,i){Tn.call(e,i)?e[i]++:e[i]=1}),hs=ot(function(e,t,i){(Tn.call(e,i)?e[i]:e[i]=[]).push(t)}),cs=ot(function(e,t,i){e[i]=t}),ps=Qt;Fn&&(qi=function(e){if(!Et(e))throw new On;return Fn.apply(i,arguments)});var ds=8==Wn(L+"08")?Wn:function(e,t){return Wn(jt(e)?e.replace(M,""):e,t||0)};return m.after=zi,m.assign=ss,m.at=Gt,m.bind=Ii,m.bindAll=Ri,m.bindKey=ji,m.chain=on,m.compact=pi,m.compose=Fi,m.countBy=us,m.create=yt,m.createCallback=Ai,m.curry=Bi,m.debounce=Di,m.defaults=rs,m.defer=qi,m.delay=Hi,m.difference=di,m.filter=Qt,m.flatten=gi,m.forEach=Yt,m.forEachRight=Kt,m.forIn=as,m.forInRight=bt,m.forOwn=os,m.forOwnRight=Lt,m.functions=Ot,m.groupBy=hs,m.indexBy=cs,m.initial=bi,m.intersection=Li,m.invert=_t,m.invoke=$t,m.keys=Jn,m.map=Jt,m.max=ei,m.memoize=Ui,m.merge=At,m.min=ti,m.omit=Bt,m.once=Gi,m.pairs=Dt,m.partial=Vi,m.partialRight=Wi,m.pick=qt,m.pluck=ii,m.pull=_i,m.range=xi,m.reject=ri,m.remove=Si,m.rest=Ci,m.shuffle=oi,m.sortBy=hi,m.tap=ln,m.throttle=Qi,m.times=sn,m.toArray=ci,m.transform=Ht,m.union=Mi,m.uniq=Pi,m.values=Ut,m.where=ps,m.without=Ei,m.wrap=Xi,m.zip=Ni,m.zipObject=Ti,m.collect=Jt,m.drop=Ci,m.each=Yt,m.eachRight=Kt,m.extend=ss,m.methods=Ot,m.object=Ti,m.select=Qt,m.tail=Ci,m.unique=Pi,m.unzip=Ni,Ki(m),m.clone=mt,m.cloneDeep=ft,m.contains=Vt,m.escape=Zi,m.every=Wt,m.find=Xt,m.findIndex=mi,m.findKey=gt,m.findLast=Zt,m.findLastIndex=fi,m.findLastKey=vt,m.has=wt,m.identity=Yi,m.indexOf=vi,m.isArguments=dt,m.isArray=Kn,m.isBoolean=xt,m.isDate=St,m.isElement=Ct,m.isEmpty=kt,m.isEqual=Mt,m.isFinite=Pt,m.isFunction=Et,m.isNaN=Tt,m.isNull=zt,m.isNumber=It,m.isObject=Nt,m.isPlainObject=ls,m.isRegExp=Rt,m.isString=jt,m.isUndefined=Ft,m.lastIndexOf=wi,m.mixin=Ki,m.noConflict=$i,m.noop=Ji,m.parseInt=ds,m.random=en,m.reduce=ni,m.reduceRight=si,m.result=tn,m.runInContext=p,m.size=li,m.some=ui,m.sortedIndex=ki,m.template=nn,m.unescape=rn,m.uniqueId=an,m.all=Wt,m.any=ui,m.detect=Xt,m.findWhere=Xt,m.foldl=ni,m.foldr=si,m.include=Vt,m.inject=ni,os(m,function(e,t){m.prototype[t]||(m.prototype[t]=function(){var t=[this.__wrapped__],i=this.__chain__;In.apply(t,arguments);var n=e.apply(m,t);return i?new f(n,i):n})}),m.first=yi,m.last=Oi,m.sample=ai,m.take=yi,m.head=yi,os(m,function(e,t){var i="sample"!==t;m.prototype[t]||(m.prototype[t]=function(t,n){var s=this.__chain__,r=e(this.__wrapped__,t,n);return s||null!=t&&(!n||i&&"function"==typeof t)?new f(r,s):r})}),m.VERSION="2.3.0",m.prototype.chain=un,m.prototype.toString=hn,m.prototype.value=cn,m.prototype.valueOf=cn,Yt(["join","pop","shift"],function(e){var t=wn[e];m.prototype[e]=function(){var e=this.__chain__,i=t.apply(this.__wrapped__,arguments);return e?new f(i,e):i}}),Yt(["push","reverse","sort","unshift"],function(e){var t=wn[e];m.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Yt(["concat","slice","splice"],function(e){var t=wn[e];m.prototype[e]=function(){return new f(t.apply(this.__wrapped__,arguments),this.__chain__)}}),m}var d,m=[],f=[],y=0,g=+new Date+"",v=75,b=40,L=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",O=/\b__p \+= '';/g,w=/\b(__p \+=) '' \+/g,_=/(__e\(.*?\)|\b__t\)) \+\n'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,S=/\w*$/,C=/^\s*function[ \n\r\t]+\w/,k=/<%=([\s\S]+?)%>/g,M=RegExp("^["+L+"]*0+(?=.$)"),P=/($^)/,E=/\bthis\b/,N=/['\n\r\t\u2028\u2029\\]/g,T=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],z=0,I="[object Arguments]",R="[object Array]",j="[object Boolean]",F="[object Date]",A="[object Function]",B="[object Number]",D="[object Object]",q="[object RegExp]",H="[object String]",U={};U[A]=!1,U[I]=U[R]=U[j]=U[F]=U[B]=U[D]=U[q]=U[H]=!0;var G={leading:!1,maxWait:0,trailing:!1},V={configurable:!1,enumerable:!1,value:null,writable:!1},W={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=W[typeof window]&&window||this,Z=W[typeof exports]&&exports&&!exports.nodeType&&exports,Y=W[typeof module]&&module&&!module.nodeType&&module,K=Y&&Y.exports===Z&&Z,$=W[typeof global]&&global;!$||$.global!==$&&$.window!==$||(X=$);var J=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=J,define(function(){return J})):Z&&Y?K?(Y.exports=J)._=J:Z._=J:X._=J}.call(this),Oskari.clazz.define("Oskari.framework.bundle.oskariui.DomManager",function(e,t){this.$=e,this.partsMap=t||{},this.layout=null,this.layouts=[]},{getEl:function(e){return this.$(e)},getElForPart:function(e){return this.$(this.partsMap[e])},setElForPart:function(e,t){this.partsMap[e]=this.$(t)},setElParts:function(e){this.partsMap=e},getElParts:function(){return this.partsMap},pushLayout:function(e){this.layout&&this.layout.removeLayout(this),this.layout=e,this.layouts.push(e),e.applyLayout(this)},popLayout:function(){var e=this.layouts.pop();return e&&e.removeLayout(this),0===this.layouts.length?(this.layout=null,void 0):(e=this.layouts[this.layouts.length-1],this.layout=e,e.applyLayout(this),void 0)},getLayout:function(){return this.layout}},{protocol:["Oskari.dom.DomManager"]}),Oskari.clazz.define("Oskari.framework.bundle.oskariui.Layout",function(){},{applyLayout:function(){},removeLayout:function(){}},{protocol:["Oskari.dom.Layout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.MapWmtsBundleInstance")},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/domain/WmtsLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/instance.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapwmts","Bundle-Name":"mapwmts","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"WMTS",Title:"WMTS"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext"]}}}),Oskari.bundle_manager.installBundleClass("mapwmts","Oskari.mapframework.bundle.MapWmtsBundle"),Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this.config=e},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e),i=t.getService("Oskari.mapframework.service.MapLayerService");if(i){i.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var n=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");i.registerLayerModelBuilder("wmtslayer",n)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this.afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,s=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId(),i.isLayerOfType("WMTS")&&(s.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},addMapLayerToMap:function(e){if(e.isLayerOfType("WMTS")){var t=this,i=t.getMap(),n=e.getWmtsMatrixSet().matrixIds,s=e.getWmtsLayerDef(),r=null;r=e.isBaseLayer()||e.isGroupLayer()?"basemap_"+e.getId():"layer_"+e.getId();var a=this._sandbox,o="image/png",l="KVP",u=s.resourceUrl?s.resourceUrl.tile?s.resourceUrl.tile.template:void 0:void 0;u?l="REST":u=e.getWmtsUrls()[0][0].url;var h=e.getWmtsMatrixSet();n=[];var c,p,d,m=[],f=[];for(c=0;c<h.matrixIds.length;c++)n.push(h.matrixIds[c]),p=h.matrixIds[c].scaleDenominator,d=p/90.71446714322*OpenLayers.METERS_PER_INCH,m.push(d),f.push(d);var y={name:r.split(".").join(""),url:u,requestEncoding:l,layer:e.getWmtsName(),matrixSet:h.identifier,format:o,style:e.getCurrentStyle().getName(),visibility:!0,transparent:!0,matrixIds:n,isBaseLayer:e.isBaseLayer(),buffer:0,serverResolutions:f,visibility:e.isInScale(a.getMap().getScale()),layerDef:s};a.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+h.identifier+" / "+y.id+"/"+y.layer+"/"+y.url);var g=new OpenLayers.Layer.WMTS(y);g.opacity=e.getOpacity()/100,a.printDebug("[WmtsLayerPlugin] created WMTS layer "+g),i.addLayers([g])}},getOLMapLayers:function(e){return e.isLayerOfType("WMTS")?e.isBaseLayer()||e.isGroupLayer()?this._map.getLayersByName("basemap_"+e.getId()):this._map.getLayersByName("layer_"+e.getId()):null},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){var t=this.getOLMapLayers(e);t&&t[0]&&t[0].destroy()},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer(),i=this.getOLMapLayers(t),n=t.getOpacity()/100;i&&i[0]&&i[0].setOpacity(n)},afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer(),i=this.getOLMapLayers(t),n=t.getCurrentStyle().getName();i&&i[0]&&i[0].mergeNewParams({styles:n})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._WmtsLayerName=null,this._WmtsMatrixSet=null,this._WmtsUrls=[],this._layerType="WMTS"},{setWmtsName:function(e){this._WmtsName=e},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(e){this._WmtsMatrixSet=e},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(e){this._WmtsLayerDef=e},getWmtsLayerDef:function(){return this._WmtsLayerDef},addWmtsUrl:function(e){this._WmtsUrls.push(e)},getWmtsUrls:function(){return this._WmtsUrls}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(e){this.mapLayerService=e,this.capabilities={}},{setCapabilities:function(e,t){this.capabilities[e]=t},getCapabilities:function(e){return this.capabilities[e]},readWMTSCapabilites:function(e,t,i,n,s){var r=this,a=new OpenLayers.Format.WMTSCapabilities,o=OpenLayers.Util.extend({url:t,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(t){var s=t.responseXML;s&&s.documentElement||(s=t.responseText);var o=a.read(s);r.setCapabilities(e,o);var l=r.parseCapabilitiesToLayers(e,o,i);n&&n.apply(this,[l,o])},failure:function(){alert("Trouble getting capabilities doc"),OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}},s||{});console.log(o),OpenLayers.Request.GET(o)},parseCapabilitiesToLayers:function(e,t,i){var n=this.mapLayerService,s=null;s=t.operationsMetadata.GetTile.dcp.http.getArray?t.operationsMetadata.GetTile.dcp.http.getArray:t.operationsMetadata.GetTile.dcp.http.get;var r,a,o,l,u,h,c,p,d,m,f,y=t.contents.layers,g=t.contents,v=g.tileMatrixSets[i],b=[];for(r=0;r<y.length;r++){for(a=y[r],o=a.identifier,l=a.identifier,u={wmtsName:o,descriptionLink:"",orgName:e,type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:!0,style:"",dataUrl:"",name:o,opacity:100,inspire:e,maxScale:1},h=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer"),h.setAsNormalLayer(),h.setId(o.split(".").join("_")),h.setName(u.name),h.setWmtsName(u.wmtsName),h.setOpacity(u.opacity),h.setMaxScale(u.maxScale),h.setMinScale(u.minScale),h.setDescription(u.info),h.setDataUrl(u.dataUrl),h.setOrganizationName(u.orgName),h.setInspireName(u.inspire),h.setWmtsMatrixSet(v),h.setWmtsLayerDef(a),h.setVisible(!0),h.addWmtsUrl(s),c=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),m=0,f=a.styles.length;f>m;++m)if(p=a.styles[m],d=c(),d.setName(p.identifier),d.setTitle(p.identifier),h.addStyle(d),p.isDefault){h.selectStyle(p.identifier);break}n.addLayer(h,!1),b.push(h)}return b}}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(e,t){var i,n,s,r;if(e.setWmtsName(t.wmsName),t.wmsUrl)for(r=t.wmsUrl.split(","),i=0;i<r.length;i++)e.addWmtsUrl(r[i]);var a,o=Oskari.clazz.builder("Oskari.mapframework.domain.Style");for(i=0,n=t.styles.length;n>i;++i)if(a=t.styles[i],s=o(),s.setName(a.identifier),s.setTitle(a.identifier),e.addStyle(s),a.isDefault){e.selectStyle(a.identifier);break}if(e.setFeatureInfoEnabled(!0),t.tileMatrixSetData&&t.tileLayerData)e.setWmtsMatrixSet(t.tileMatrixSetData),e.setWmtsLayerDef(t.tileLayerData);else if(t.tileMatrixSetData&&t.tileMatrixSetId){var l=t.tileMatrixSetId;if(t.tileMatrixSetData.contents&&t.tileMatrixSetData.contents.tileMatrixSets){var u=t.tileMatrixSetData.contents.tileMatrixSets[l];e.setWmtsMatrixSet(u)}var h,c=e.getWmtsName(),p=t.tileMatrixSetData.contents.layers;for(h=0;h<p.length;h++)if(p[h].identifier===c){e.setWmtsLayerDef(p[h]);break}}}}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(){this.name="MapWmts",this.mediator=null,this.sandbox=null,this.service=null,this.ui=null},{start:function(){if("started"!==this.mediator.getState()){var e=this,t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);this.sandbox=n;var s=n.getService("Oskari.mapframework.service.MapLayerService");s.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var r=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");s.registerLayerModelBuilder("wmtslayer",r);var a=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",s);return this.service=a,this.mediator.setState("started"),this}},update:function(e,t,i,n){e.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+n)},stop:function(){return this.mediator.setState("stopped"),this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.MapWfsBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance")},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/WfsLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/WfsLayerModelBuilder.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/QueuedTile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/TileQueue.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/WfsTileRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/event/WFSFeaturesSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/service/WfsTileService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesGrid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesStrategy.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/WfsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/instance.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"mapwfs","Bundle-Name":"mapwfs","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"WFS",Title:"WFS"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext"]}}}),Oskari.bundle_manager.installBundleClass("mapwfs","Oskari.mapframework.bundle.mapwfs.MapWfsBundle"),Oskari.clazz.define("Oskari.mapframework.domain.WfsLayer",function(){this._layerType="WFS"
},{},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.domain.WfsLayerModelBuilder",function(e){this.sandbox=e,this.localization=Oskari.getLocalization("MapWfs")},{parseLayerData:function(e){var t=this,i=this.localization["object-data"],n=Oskari.clazz.builder("Oskari.mapframework.domain.Tool"),s=n();s.setName("objectData"),s.setTitle(i),s.setTooltip(i),s.setCallback(function(){t.sandbox.postRequestByName("ShowFeatureDataRequest",[e.getId()])}),e.addTool(s)}}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTile",function(e){for(p in e)this[p]=e[p]},{getBounds:function(){return this.bounds}}),Oskari.clazz.define("Oskari.mapframework.gridcalc.TileQueue",function(){this.queue=[]},{getQueue:function(){return this.queue},getLength:function(){return this.queue.length},popJob:function(){var e=this.queue,t=e.length;if(0===t)return null;if(4>t)return e.shift(-1);var i=null,n=Math.floor(t/2);return i=e[n],this.queue=e.slice(0,n).concat(e.slice(n+1)),i},pushJob:function(e){this.queue.push(e)},flushQueue:function(){this.queue=[]}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest",function(e,t,i,n,s,r){this._bbox=t,this._mapWidth=i,this._mapHeight=n,this._mapLayer=e,this._creator=s,this._sequenceNumber=r},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getSequenceNumber:function(){return this._sequenceNumber}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.event.WFSFeaturesSelectedEvent",function(e,t,i){this._wfsFeatureIds=e,this._addToSelection=i,this._mapLayer=t},{__name:"WFSFeaturesSelectedEvent",getName:function(){return this.__name},getWfsFeatureIds:function(){return this._wfsFeatureIds},isKeepSelection:function(){return this._addToSelection?this._addToSelection:!1},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",function(e){this.plugin=e,this._TILE_SIZE_IN_PIXELS=256,this._componentName="WfsRequestTiler",this._mapPollingInterval=100,this._simultaneousPngRequest=4,this._wfsMapUpdateRequests={},this._WFSFeaturesSelectedEvent=null,this._tileCount=16,this._doMapLayerReArrange=!1,this.sandbox=e._sandbox,this.pngUrl=this.sandbox.getAjaxUrl()},{__qname:"Oskari.mapframework.bundle.mapwfs.service.WfsTileService",getQName:function(){return this.__qname},__name:"WfsTileService",getName:function(){return this.__name},scheduleMapLayerRearrangeAfterWfsMapTilesAreReady:function(){this._doMapLayerReArrange=!0},removeWFsLayerRequests:function(e){var t=e.getId();null!==this._wfsMapUpdateRequests[t]&&(this._wfsMapUpdateRequests[t]=null,delete this._wfsMapUpdateRequests[t])},removeWFSMapHighlightRequest:function(){this._WFSFeaturesSelectedEvent=null},scheduleWFSMapLayerUpdate:function(e,t,i,n,s){var r=e.getId(),a=this._wfsMapUpdateRequests[r];null!==a&&(this._wfsMapUpdateRequests[r]=null,delete this._wfsMapUpdateRequests[r]),this._wfsMapUpdateRequests[r]=[];var o=this.splitBbox(t,i,n,this._TILE_SIZE_IN_PIXELS);this._tileCount=o.length;for(var l=Oskari.clazz.builder("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest"),u=0;u<o.length;u++){var h=l(e,o[u],i,n,s,u);this._wfsMapUpdateRequests[r].push(h)}this._doMapLayerReArrange=!0},scheduleWFSMapHighlightUpdate:function(e){this._WFSFeaturesSelectedEvent=e,this.processHighlightQueue()},splitBbox:function(){var e=this.sandbox.getMap(),t=[];if(e){var i=this.plugin.getTileQueue();i&&(t=i.getQueue())}return t},processMapQueue:function(){var e=this;this.sandbox.printDebug("[WfsTileService.processMapQueue] Looping this._wfsMapUpdateRequests...");for(var t in this._wfsMapUpdateRequests){var i=this._wfsMapUpdateRequests[t];if(null!==i&&i.length>0){this.sandbox.printDebug("[WfsTileService.processMapQueue] Got requestArray of size "+i.length+" for id "+t);var n=i[0];this.sandbox.printDebug("[WfsTileService.processMapQueue] Creating request for '"+n.getMapLayer().getName()+"'");var s=n.getBbox(),r=this.sandbox.getMap().getZoom(),a=this.pngUrl+"&flow_pm_wfsLayerId="+n.getMapLayer().getId()+"&flow_pm_bbox_min_x="+s.bounds.left+"&flow_pm_bbox_min_y="+s.bounds.bottom+"&flow_pm_bbox_max_x="+s.bounds.right+"&flow_pm_bbox_max_y="+s.bounds.top+"&flow_pm_map_width="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_map_height="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_zoom_level="+r+"&srs="+this.sandbox.getMap().getSrsName()+"&action_route=GET_PNG_MAP",o="WFS_LAYER_IMAGE_"+n.getMapLayer().getId()+"_"+n.getSequenceNumber();return e.plugin.drawImageTile(n.getMapLayer(),a,s,o),this.sandbox.printDebug("[WfsTileService.processMapQueue] removing handled element"),i.splice(0,1),0===i.length&&(delete this._wfsMapUpdateRequests[t],this.sandbox.printDebug("[WfsTileService.processMapQueue] deleting empty requestArray")),void 0}}if(this.sandbox.printDebug("[WfsTileService.processMapQueue] _doMapLayerReArrange is "+this._doMapLayerReArrange),this._doMapLayerReArrange){var l=this.sandbox.getRequestBuilder("RearrangeSelectedMapLayerRequest"),u=l();this.sandbox.request(this.plugin,u),this._doMapLayerReArrange=!1}},processHighlightQueue:function(){var e=this._WFSFeaturesSelectedEvent;if(e)try{var t=e.getMapLayer();if(!t.isLayerOfType("WFS"))throw"Trying to highlight feature from layer that is not WFS layer!";var i=e.getWfsFeatureIds();if(!i||0==i.length)return e.isKeepSelection()||this.plugin.removeHighlightOnMapLayer(t.getId()),void 0;for(var n=this.sandbox.getMap(),s=n.getBbox(),r=n.getWidth(),a=n.getHeight(),o=this,l=o.pngUrl+"&flow_pm_wfsLayerId="+t.getId()+"&flow_pm_bbox_min_x="+s.left+"&flow_pm_bbox_min_y="+s.bottom+"&flow_pm_bbox_max_x="+s.right+"&flow_pm_bbox_max_y="+s.top+"&flow_pm_map_width="+r+"&flow_pm_map_height="+a+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE",u=function(n){o.plugin.drawImageTile(t,l+"&wfsFeatureId="+n,s,"HIGHLIGHTED_FEATURE",e.isKeepSelection()||i.length>1)},h=0;h<i.length;++h)u(i[h])}finally{}},startPollers:function(){for(i=0;i<this._tileCount;i++)this.processMapQueue()}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesGrid",function(e){this.grid=[],this.map=null,this.tileSize=null,this.maxExtent=null,this.buffer=0,this.numLoadingTiles=0;for(p in e)this[p]=e[p]},{destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],n=0,s=i.length;s>n;n++){var r=i[n];r.destroy()}this.grid=[]}},moveTo:function(e,t){if(e=e||this.map.getExtent(),null!=e){var i=!this.grid.length||t,n=this.getTilesBounds();i||!n.containsBounds(e,!0)?this.initGriddedTiles(e):this.moveGriddedTiles(e)}},setTileSize:function(){},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],n=this.grid[0].length-1,s=this.grid[0][n];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,s.bounds.right,s.bounds.top)}return e},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,s=i*this.tileSize.h,r=e.left-t.left,a=Math.floor(r/n)-this.buffer,o=r/n-a,l=-o*this.tileSize.w,u=t.left+a*n,h=e.top-(t.bottom+s),c=Math.ceil(h/s)+this.buffer,p=c-h/s,d=-p*this.tileSize.h,m=t.bottom+c*s;return{tilelon:n,tilelat:s,tileoffsetlon:u,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),n=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),s=this.maxExtent,r=this.map.getResolution(),a=this.calculateGridLayout(e,s,r),o=Math.round(a.tileoffsetx),l=Math.round(a.tileoffsety),u=a.tileoffsetlon,h=a.tileoffsetlat,c=a.tilelon,p=a.tilelat;this.origin=new OpenLayers.Pixel(o,l);var d=o,m=u,f=0,y=parseInt(this.map.layerContainerDiv.style.left),g=parseInt(this.map.layerContainerDiv.style.top);do{var v=this.grid[f++];v||(v=[],this.grid.push(v)),u=m,o=d;var b=0;do{var L=new OpenLayers.Bounds(u,h,u+c,h+p),O=o;O-=y;var w=l;w-=g;var _=new OpenLayers.Pixel(O,w),x=v[b++];x?x.moveTo(L,_,!1):(x=this.addTile(L,_),v.push(x)),u+=c,o+=this.tileSize.w}while(u<=e.right+c*this.buffer||n>b);h-=p,l+=this.tileSize.h}while(h>=e.bottom-p*this.buffer||i>f);this.removeExcessTiles(f,b)},addTile:function(e,t){return new OpenLayers.Tile(this.layer,e,t,"",this.tileSize)},moveGriddedTiles:function(){for(var e=this.buffer||1;;){var t=this.grid[0][0].position,i=this.map.getViewPortPxFromLayerPx(t);if(i.x>-this.tileSize.w*(e-1))this.shiftColumn(!0);else if(i.x<-this.tileSize.w*e)this.shiftColumn(!1);else if(i.y>-this.tileSize.h*(e-1))this.shiftRow(!0);else{if(!(i.y<-this.tileSize.h*e))break;this.shiftRow(!1)}}},shiftRow:function(e){for(var t=e?0:this.grid.length-1,i=this.grid,n=i[t],s=this.map.getResolution(),r=e?-this.tileSize.h:this.tileSize.h,a=s*-r,o=e?i.pop():i.shift(),l=0,u=n.length;u>l;l++){var h=n[l],c=h.bounds.clone(),p=h.position.clone();c.bottom=c.bottom+a,c.top=c.top+a,p.y=p.y+r,o[l].moveTo(c,p)}e?i.unshift(o):i.push(o)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),n=i*t,s=0,r=this.grid.length;r>s;s++){var a=this.grid[s],o=e?0:a.length-1,l=a[o],u=l.bounds.clone(),h=l.position.clone();u.left=u.left+n,u.right=u.right+n,h.x=h.x+t;var c=e?this.grid[s].pop():this.grid[s].shift();c.moveTo(u,h),e?a.unshift(c):a.push(c)}},removeExcessTiles:function(e,t){for(;this.grid.length>e;)for(var i=this.grid.pop(),n=0,s=i.length;s>n;n++){var r=i[n];r.destroy()}for(;this.grid[0].length>t;)for(var n=0,s=this.grid.length;s>n;n++){var i=this.grid[n],r=i.pop();r.destroy()}},onMapResize:function(){},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesGrid"}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesStrategy",function(e){this.debugGridFeatures=!0,this.options=e,this.tileQueue=e.tileQueue,this.autoActivate=!0,this.autoDestroy=!1,this.grid=null,this.bounds=null;for(p in e)this[p]=e[p];this.active=!1},{setLayer:function(e){this.layer=e},flushTileQueue:function(){for(var e=this.tileQueue.queue,t=[],i=0;i<e.length;i++)null!=e[i].tileFeature&&(t.push(e[i].tileFeature),e[i].tileFeature=null);t.length>0&&this.layer.destroyFeatures(t),this.tileQueue.flushQueue()},unloadOutOfViewFeatures:function(){},ratio:1,activate:function(){return this.active?!1:(this.active=!0,this.grid=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesGrid",{map:this.layer.map,layer:this.layer,maxExtent:this.layer.map.getMaxExtent(),tileSize:this.layer.map.getTileSize()}),this.layer.events.on({refresh:this.updateRefresh,scope:this}),!0)},deactivate:function(){return this.active?(this.layer.events.un({refresh:this.update,scope:this}),this.grid.destroy(),this.grid=null,!0):!1},updateRefresh:function(){this.update()},updateMoveEnd:function(){this.update()},update:function(){return},invalidBounds:function(e){return e||(e=this.layer.map.getExtent()),!this.bounds||!this.bounds.containsBounds(e)},triggerUnload:function(){this.layer.destroyFeatures()},triggerRead:function(){for(var e=this.grid.grid,t=[],i=this.debugGridFeatures,n=0;n<e.length;n++)for(var s=0;s<e[n].length;s++){var r=e[n][s].bounds.clone(),a={left:r.left,top:r.top,right:r.right,bottom:r.bottom},o=null;if(i){var l=new OpenLayers.Geometry.Point(r.left,r.bottom),u=new OpenLayers.Geometry.Point(r.right,r.top),h=new OpenLayers.Geometry.Point(r.left,r.top),c=new OpenLayers.Geometry.Point(r.right,r.bottom),p=new OpenLayers.Geometry.LineString([l,c,u,h,l]),o=new OpenLayers.Feature.Vector(p,{featureClassName:this.CLASS_NAME,description:""});o.renderIntent="tile",t.push(o)}var d=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTile",{bounds:a,tileFeature:o});this.tileQueue.pushJob(d)}i&&this.layer.addFeatures(t)},merge:function(e){var t=e.features;t&&t.length>0&&this.layer.addFeatures(t)},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesStrategy"}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.plugin.wfslayer.WfsLayerPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this.service=null,this.config=e},{__name:"WfsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},init:function(){var e=(this.config?this.config.sandbox:null)||"sandbox",t=Oskari.getSandbox(e),i=t.getService("Oskari.mapframework.service.MapLayerService");if(i){i.registerLayerModel("wfslayer","Oskari.mapframework.domain.WfsLayer");var n=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.domain.WfsLayerModelBuilder",t);i.registerLayerModelBuilder("wfslayer",n)}},register:function(){this.getMapModule().setLayerPlugin("wfslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wfslayer",null)},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.createTilesGrid(),this.service=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",this),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(e){var t=this._sandbox.getObjectCreator(e);this._sandbox.printDebug("[WfsLayerPlugin] got AfterMapMoveEvent from "+t),this.afterAfterMapMoveEvent()},AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();t.isLayerOfType("WFS")&&this.afterMapLayerRemoveEvent(e)},AfterHighlightWFSFeatureRowEvent:function(e){this.handleAfterHighlightWFSFeatureRowEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterDimMapLayerEvent:function(e){this.handleAfterDimMapLayerEvent(e)},MapClickedEvent:function(e){if(!this._sandbox.getMap().isMoving()){var t=e.getLonLat(),i=e.getMouseX(),n=e.getMouseY();this._getFeatureIds(t,i,n)}},WFSFeaturesSelectedEvent:function(e){this.service.scheduleWFSMapHighlightUpdate(e)},MapLayerVisibilityChangedEvent:function(e){e.getMapLayer().isVisible()&&this.afterAfterMapMoveEvent()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;i<e.length;i++){var n=e[i],s=n.getId();n.isLayerOfType("WFS")&&(t.printDebug("[WfsLayerPlugin] preselecting "+s),this.addMapLayerToMap(n,!0,n.isBaseLayer()))}},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WFS"))for(var i=this.getOLMapLayers(t),n=0;n<i.length;n++)i[n].setOpacity(t.getOpacity()/100)},handleAfterDimMapLayerEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WFS"))for(var i=new RegExp("wfs_layer_"+t.getId()+"_HIGHLIGHTED_FEATURE*","i"),n=this._map.getLayersByName(i),s=0;s<n.length;s++)n[s].destroy()},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap()),this.afterAfterMapMoveEvent()},addMapLayerToMap:function(){},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.service.removeWFsLayerRequests(t),this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){for(var t=this.getOLMapLayers(e),i=0;i<t.length;i++)t[i].destroy()},getOLMapLayers:function(e){if(!e||e.isLayerOfType("WFS")){var t="";e&&(t="_"+e.getId());var i=new RegExp("wfs_layer"+t+"_*","i");return this._map.getLayersByName(i)}},drawImageTile:function(e,t,i,n,s){var r="wfs_layer_"+e.getId()+"_"+n,a=null;if(i.bounds&&i.bounds.left&&i.bounds.right&&i.bounds.top&&i.bounds.bottom?a=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,i.bounds.right,i.bounds.top):i.left&&i.right&&i.top&&i.bottom&&(a=new OpenLayers.Bounds(i.left,i.bottom,i.right,i.top)),t&&e&&a){var o=this.mapModule.calculateLayerScales(e.getMaxScale(),e.getMinScale()),l=null;if(!s)for(var u=this._map.getLayersByName(r),h=0;h<u.length;h++)l=this._map.getLayerIndex(u[h]),u[h].destroy();var c=new OpenLayers.Size(256,256),p=new OpenLayers.Layer.Image(r,t,a,c,{scales:o,transparent:!0,format:"image/png",isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});p.opacity=e.getOpacity()/100,this._map.addLayer(p),p.setVisibility(!0),p.redraw(!0);var d=this._map.layers.length,m=this._map.getLayersByName("Markers");m.length>0&&(this._map.setLayerIndex(m[0],d),d--),null!==l&&null!==p&&this._map.setLayerIndex(p,l);var f=new RegExp("wfs_layer_"+e.getId()+"_WFS_LAYER_IMAGE*","i"),y=this._map.getLayersByName(f);if(y.length>0){var g=this._map.getLayerIndex(y[y.length-1]),v=this._map.getLayersByName(r);v.length>0&&this._map.setLayerIndex(v[0],g)}}},handleAfterHighlightWFSFeatureRowEvent:function(e){var t=e.getWfsFeatureIds();if(0==t.length&&!e.isKeepSelection()){var i=e.getMapLayer();this.removeHighlightOnMapLayer(i.getId())}},removeHighlightOnMapLayer:function(e){var t="";e&&(t="wfs_layer_"+e);for(var i=new RegExp(t+"_HIGHLIGHTED_FEATURE*","i"),n=this._map.getLayersByName(i),s=0;s<n.length;s++)n[s].destroy()},updateWfsImages:function(){for(var e=Oskari.$().sandbox.findAllSelectedMapLayers(),t=0;t<e.length;t++)e[t].isInScale()&&e[t].isVisible()&&e[t].isLayerOfType("WFS")&&this.doWfsLayerRelatedQueries(e[t])},doWfsLayerRelatedQueries:function(e){if(e.isInScale()){var t=this._sandbox.getMap(),i=t.getBbox(),n=t.getWidth(),s=t.getHeight();this.service.scheduleWFSMapLayerUpdate(e,i,n,s,this.getName()),this.service.startPollers()}},afterAfterMapMoveEvent:function(){this.tileStrategy.update(),this.updateWfsImages(this.getName()),this.service.processHighlightQueue()},createTilesGrid:function(){var e=this;e._sandbox;var t=Oskari.clazz.create("Oskari.mapframework.gridcalc.TileQueue"),i=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesStrategy",{tileQueue:t});i.debugGridFeatures=!1,this.tileQueue=t,this.tileStrategy=i},getTileQueue:function(){return this.tileQueue},_getFeatureIds:function(e){var t=this,i=this._sandbox,n=i.findAllHighlightedLayers();if(0!=n.length&&n[0]&&n[0].isLayerOfType("WFS")){if(1!=n.length)return i.printDebug("Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+n.length),void 0;var s=n[0];if(!s.isInScale())return i.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!"),void 0;var r=i.getMap(),a=this._map.getExtent(),o="&flow_pm_wfsLayerId="+s.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+a.left+"&flow_pm_bbox_min_y="+a.bottom+"&flow_pm_bbox_max_x="+a.right+"&flow_pm_bbox_max_y="+a.top+"&flow_pm_zoom_level="+r.getZoom()+"&flow_pm_map_width="+r.getWidth()+"&flow_pm_map_height="+r.getHeight()+"&srs="+r.getSrsName()+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:i.getAjaxUrl()+o,data:o,success:function(e){t._handleGetFeatureIdsResponse(e,s,l)}})}},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this._sandbox;if(!response||"true"==response.error)return sandbox.printWarn("Couldn't get feature id for selected map point."),void 0;var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];null!=selectedFeatures&&null!=selectedFeatures.id&&featureIds.push(selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance",function(){this._localization=null,this._pluginInstances={}},{__name:"MapWFS",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,n.register(e);for(p in e.eventHandlers)n.registerForEventByName(e,p)}},update:function(){},stop:function(){var e=this.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.sandbox.unregister(this),this.started=!1},init:function(){return null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{MapClickedEvent:function(e){if(!this.sandbox.getMap().isMoving()){var t=e.getLonLat(),i=e.getMouseX(),n=e.getMouseY();this._getFeatureIds(t,i,n)}}},_getFeatureIds:function(e){var t=this,i=this.sandbox,n=i.findAllHighlightedLayers();if(0!=n.length&&n[0]&&n[0].isLayerOfType("WFS")){if(1!=n.length)throw"Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+n.length;var s=n[0];if(!s.isInScale())return core.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!"),void 0;var r=i.getMap(),a=this._map.getExtent(),o="&flow_pm_wfsLayerId="+s.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+a.left+"&flow_pm_bbox_min_y="+a.bottom+"&flow_pm_bbox_max_x="+a.right+"&flow_pm_bbox_max_y="+a.top+"&flow_pm_zoom_level="+r.getZoom()+"&flow_pm_map_width="+r.getWidth()+"&flow_pm_map_height="+r.getHeight()+"&srs="+r.getSrsName()+"&actionKey=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",url:this.endpointUrl+o,data:o,success:function(e){t._handleGetFeatureIdsResponse(e,s,l)}})}},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this.sandbox;"true"==response.error&&sandbox.printWarn("Couldn't get feature id for selected map point.");var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];null!=selectedFeatures&&null!=selectedFeatures.id&&(featureIds=selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.service.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-base","Bundle-Name":"mapframework.service.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("service-base","Oskari.mapframework.service.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used"},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!"}}),Oskari.clazz.define("Oskari.mapframework.event.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/after-rearrange-selected-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-opacity-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-style-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-highlight-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-dim-map-layer-event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map-layer","Bundle-Name":"mapframework.event.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-map-layer","Oskari.mapframework.event.map.layer.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(e,t,i){this._creator=null,this._movedMapLayer=e,this._fromPosition=t,this._toPosition=i},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.request.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/rearrange-selected-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-opacity-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-style-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/highlight-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/dim-map-layer-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map-layer","Bundle-Name":"mapframework.request.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-map-layer","Oskari.mapframework.request.map.layer.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(e,t){this._mapLayerId=e,this._toPosition=t},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._opacity=t},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._style=t},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.PluginMapModuleBundle",function(){},{create:function(){return this},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/ui/module/map-module.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/Plugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiMouse.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-measurement-request.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/getinfo/css/getinfo.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkerRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MarkerRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/service/searchservice.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/datasource/DataSourcePlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/datasource/css/datasource.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/scalebar/css/scalebar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/fullscreen/FullScreen.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/fullscreen/css/fullscreen.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/BackgroundLayerSelectionPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/layers/css/backgroundlayerselection.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/location/GeoLocationPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/ActiveDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/PublisherToolbarPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/request/ToolContainerRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/css/publishertoolbar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/GetInfoResultEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapSizeChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/ClearHistoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ClearHistoryHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/zoombar/css/porttizoombar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/css/mapmodule.css"}],locales:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/fi.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sv.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/en.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/cs.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/de.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"mapmodule-plugin","Bundle-Name":"mapmodule","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Kartta",Title:"Kartta"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext","OpenLayers"]}}}),Oskari.bundle_manager.installBundleClass("mapmodule-plugin","Oskari.mapframework.bundle.PluginMapModuleBundle"),Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(e,t,i){this._id=e,this._imageUrl=t,this._options={resolutions:[2e3,1e3,500,200,100,50,20,10,4,2,1,.5,.25],srsName:"EPSG:3067",units:"m"};
var n;if(i)for(n in i)i.hasOwnProperty(n)&&(this._options[n]=i[n]);this._controls={},this._layerPlugins={},this._supportedFormats={},this._map=null,this._mapScales=[],this._sandbox=null,this._stealth=!1,this._pluginInstances={},this._navigationHistoryTool=new OpenLayers.Control.NavigationHistory,this._navigationHistoryTool.id="navigationhistory",this._localization=null},{getImageUrl:function(){return this._imageUrl?this._imageUrl:"/Oskari/resources"},getControls:function(){return this._controls},getMapControl:function(e){return this._controls[e]},addMapControl:function(e,t){this._controls[e]=t,this._map.addControl(t)},removeMapControl:function(e){this._map.removeControl(this._controls[e]),this._controls[e]=null,delete this._controls[e]},_addMapControlPluginContainers:function(){var e,t,i=["bottom center","top center","right center","left center","bottom right","bottom left","top right","top left"],n=jQuery("#mapdiv");for(t=0;t<i.length;t++)e=jQuery('<div class="mapplugins"><div class="mappluginsContainer"><div class="mappluginsContent"></div></div></div>'),e.addClass(i[t]),e.attr("data-location",i[t]),n.append(e)},setMapControlPlugin:function(e,t,i){var n,s=".mapplugins."+(t+" ").split(" ").join(".")+" .mappluginsContainer .mappluginsContent",r=jQuery(s),a=i+"",o=/^(?=.*\bbottom\b)((?=.*\bleft\b)|(?=.*\bright\b)).+/.test(t),l=null;if(!e)throw"Element is non-existent.";if(!t)throw"No container classes.";if(!r||!r.length)throw'Container with classes "'+s+'" not found.';e.attr("data-position",i),e.detach(),null!==i&&void 0!==i?(r.find(".mapplugin").each(function(){n=$(this),(!o&&n.attr("data-position")<=a||o&&n.attr("data-position")>a)&&(l=n)}),l?l.after(e):r.prepend(e)):r.append(e)},setLayerPlugin:function(e,t){this._layerPlugins[e]=t},getLayerPlugin:function(e){return this._layerPlugins[e]},getLayerPlugins:function(){return this._layerPlugins},clearNavigationHistory:function(){this._navigationHistoryTool.clear()},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(e,t){return this._localization&&t!==!0||(this._localization=Oskari.getLocalization("MapModule")),e?this._localization[e]:this._localization},init:function(e){e.printDebug("Initializing map module...#############################################"),this._sandbox=e,this._sandbox&&this._sandbox.getMap().setSrsName(this._options.srsName);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",e,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",e,this),clearHistoryHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",e,this)},e.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler),e.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler),e.addRequestHandler("ClearHistoryRequest",this.requestHandlers.clearHistoryHandler),this._createMap();var i=this._calculateScalesFromResolutions(this._options.resolutions,this._map.units);return this._mapScales=i,this._createBaseLayer(),this.addMapControl("navigationHistoryTool",this._navigationHistoryTool),this.getMapControl("navigationHistoryTool").activate(),this._addMapControlPluginContainers(),this._map},_calculateScalesFromResolutions:function(e,t){for(var i=[],n=0;n<e.length;++n){var s=OpenLayers.Util.getScaleFromResolution(e[n],t);s=1e8*s,s=Math.round(s),s/=1e8,i.push(s)}return i},getPluginInstances:function(){return this._pluginInstances},getPluginInstance:function(e){return this._pluginInstances[this.getName()+e]},isPluginActivated:function(e){var t=this._pluginInstances[this.getName()+e];return t?!0:!1},registerPlugin:function(e){var t=this._sandbox;e.setMapModule(this);var i=e.getName();t.printDebug("["+this.getName()+"]"+" Registering "+i),e.register(),this._pluginInstances[i]=e},unregisterPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Unregistering "+i),e.unregister(),this._pluginInstances[i]=void 0,e.setMapModule(null),delete this._pluginInstances[i]},startPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+i),e.startPlugin(t)},stopPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+i),e.stopPlugin(t)},startPlugins:function(e){var t;for(t in this._pluginInstances)this._pluginInstances.hasOwnProperty(t)&&(e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].startPlugin(e))},stopPlugins:function(e){var t;for(t in this._pluginInstances)this._pluginInstances.hasOwnProperty(t)&&(e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].stopPlugin(e))},getStealth:function(){return this._stealth},setStealth:function(e){this._stealth=!!e},notifyAll:function(e,t){this._stealth||this._sandbox.notifyAll(e,t)},getMap:function(){return this._map},getMapViewPortDiv:function(){return this._map.viewPortDiv},getMapLayersContainerDiv:function(){return this._map.layerContainerDiv},transformCoordinates:function(e,t){return e.transform(new OpenLayers.Projection(t),this.getMap().getProjectionObject())},_createMap:function(){this._sandbox;var e=new OpenLayers.LonLat(0,0),t=new OpenLayers.Bounds(0,0,1e7,1e7);return null!==this._options&&void 0!==this._options&&null!==this._options.maxExtent&&void 0!==this._options.maxExtent&&null!==this._options.maxExtent.left&&void 0!==this._options.maxExtent.left&&null!==this._options.maxExtent.bottom&&void 0!==this._options.maxExtent.bottom&&null!==this._options.maxExtent.right&&void 0!==this._options.maxExtent.right&&null!==this._options.maxExtent.top&&void 0!==this._options.maxExtent.top&&(t=new OpenLayers.Bounds(this._options.maxExtent.left,this._options.maxExtent.bottom,this._options.maxExtent.right,this._options.maxExtent.top)),this._map=new OpenLayers.Map({controls:[],units:this._options.units,maxExtent:t,resolutions:this._options.resolutions,projection:this._options.srsName,isBaseLayer:!0,center:e,fallThrough:!0,theme:null,zoom:0,zoomMethod:null}),this._map},getProjection:function(){return this._options.srsName},_createBaseLayer:function(){var e=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:!0,displayInLayerSwitcher:!1});this._map.addLayer(e)},moveMapToLanLot:function(e,t,i){var n=i===!0;this._map.setCenter(e,this._map.getZoom(),n),t&&this.adjustZoomLevel(t,!0),this._updateDomain()},panMapToLonLat:function(e,t){this._map.setCenter(e,this._map.getZoom()),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},zoomToScale:function(e,t,i){var n=t===!0;this._map.zoomToScale(e,n),this._updateDomain(),i!==!0&&this.notifyMoveEnd()},centerMap:function(e,t,i){this._map.setCenter(e,t,!1),this._updateDomain(),i!==!0&&this.notifyMoveEnd()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(e){this.setZoomLevel(e,!1)},panMapEast:function(){var e=this._map.getSize();this.panMapByPixels(.75*e.w,0)},panMapWest:function(){var e=this._map.getSize();this.panMapByPixels(-.75*e.w,0)},panMapNorth:function(){var e=this._map.getSize();this.panMapByPixels(0,-.75*e.h)},panMapSouth:function(){var e=this._map.getSize();this.panMapByPixels(0,.75*e.h)},panMapByPixels:function(e,t,i,n,s){this._map.pan(e,t,{dragging:s?!0:!1,animate:!1}),this._updateDomain(),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd()},moveMapByPixels:function(e,t,i,n){this._map.moveByPx(e,t),this._updateDomain(),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd()},centerMapByPixels:function(e,t,i,n){var s=new OpenLayers.Pixel(e,t),r=this._map.getLonLatFromViewPortPx(s);this.isValidLonLat(r.lon,r.lat)&&(this.moveMapToLanLot(r),i!==!0&&this.notifyStartMove(),n!==!0&&this.notifyMoveEnd())},isValidLonLat:function(e,t){var i=!0;return 625e4>t||t>82e5?i=!1:((0>e||e>135e4)&&(i=!1),i)},zoomToExtent:function(e,t,i){this._map.zoomToExtent(e),this._updateDomain(),t!==!0&&this.notifyStartMove(),i!==!0&&this.notifyMoveEnd()},adjustZoomLevel:function(e,t){var i=this._getNewZoomLevel(e);this._map.zoomTo(i),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},setZoomLevel:function(e,t){e!==this._map.getZoom()&&((0>e||e>this._map.getNumZoomLevels)&&(e=this._map.getZoom()),this._map.zoomTo(e),this._updateDomain(),t!==!0&&this.notifyMoveEnd())},_getNewZoomLevel:function(e){var t=this._map.getZoom()+e;return t>=0&&t<=this._map.getNumZoomLevels()?t:this._map.getZoom()},notifyStartMove:function(){if(!this.getStealth()){this._sandbox.getMap().setMoving(!0);var e=this._map.getCenter().lon,t=this._map.getCenter().lat,i=this._sandbox.getEventBuilder("MapMoveStartEvent")(e,t);this._sandbox.notifyAll(i)}},notifyMoveEnd:function(){if(!this.getStealth()){var e=this._sandbox;e.getMap().setMoving(!1);var t=this._map.getCenter();this._updateDomain();var i=e.getEventBuilder("AfterMapMoveEvent")(t.lon,t.lat,this._map.getZoom(),!1,this._map.getScale());e.notifyAll(i)}},updateSize:function(){this.getMap().updateSize(),this._updateDomain();var e=this._sandbox,t=e.getMap(),i=e.getEventBuilder("MapSizeChangedEvent")(t.getWidth(),t.getHeight());e.notifyAll(i)},_updateDomain:function(){if(!this.getStealth()){var e=this._sandbox,t=e.getMap(),i=this._map.getCenter();t.moveTo(i.lon,i.lat,this._map.getZoom()),t.setScale(this._map.getScale());var n=this._map.getCurrentSize();t.setWidth(n.w),t.setHeight(n.h),t.setResolution(this._map.getResolution()),t.setExtent(this._map.getExtent()),t.setMaxExtent(this._map.getMaxExtent()),t.setBbox(this._map.calculateBounds())}},getMapScales:function(){return this._mapScales},calculateLayerScales:function(e,t){var i,n=[];for(i=0;i<this._mapScales.length;i++)(!t||t>=this._mapScales[i])&&(!e||e<=this._mapScales[i])&&n.push(this._mapScales[i]);return n},calculateLayerResolutions:function(e,t){var i,n=[];for(i=0;i<this._mapScales.length;i++)(!t||t>=this._mapScales[i])&&(!e||e<=this._mapScales[i])&&n.push(this._options.resolutions[i]);return n},getClosestZoomLevel:function(e,t){var i,n=this._map.getZoom();if(!t||!e)return n;var s=this._map.getScale();if(t>s){for(i=n;i>0;i--)if(this._mapScales[i]>=t)return i}else if(s>e)for(i=n;i<this._mapScales.length;i++)if(this._mapScales[i]<=e)return i;return n},start:function(e){this.started||(e.printDebug("Starting "+this.getName()),this.startPlugins(e),this.updateCurrentState(),this.started=!0)},stop:function(e){this.started&&(this.stopPlugins(e),this.started=!1)},_drawMarker:function(){this._removeMarkers();var e=this._map.getCenter(),t=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(t);var i=new OpenLayers.Size(32,32),n=new OpenLayers.Pixel(-16,-i.h),s=new OpenLayers.Icon(this.getImageUrl()+"/framework/bundle/mapmodule-plugin/images/marker.png",i,n),r=new OpenLayers.Marker(e,s);t.addMarker(r)},_removeMarkers:function(){var e=this,t=this._map.getLayersByName("Markers");return _.each(t,function(t){e._map.removeLayer(t,!1)}),t},_hasMarkers:function(){var e,t=this._map.getLayersByName("Markers");if(t)for(e=0;e<t.length;e++)if(t[e]&&t[e].markers&&t[e].markers.length>0)return!0;return!1},eventHandlers:{AfterMapLayerAddEvent:function(e){this._afterMapLayerAddEvent(e)},SearchClearedEvent:function(){this._removeMarkers()},LayerToolsEditModeEvent:function(e){this._isInLayerToolsEditMode=e.isInMode()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},_afterMapLayerAddEvent:function(e){var t=this.getMap(),i=e.getMapLayer(),n=e.getKeepLayersOrder(),s=e.isBasemap(),r=this.getLayerPlugins(),a=t.getLayersByName("Markers");_.each(r,function(e){_.isFunction(e.addMapLayerToMap)&&e.addMapLayerToMap(i,n,s)}),_.each(a,function(e){t.raiseLayer(e,t.layers.length)})},getOLMapLayers:function(e){var t=this,i=t._sandbox,n=i.findMapLayerFromSelectedMapLayers(e);if(!n)return null;var s,r,a,o=this.getLayerPlugins(),l=[];for(s in o)o.hasOwnProperty(s)&&(r=o[s],a=r.getOLMapLayers(n),a&&(l=l.concat(a)));return l},updateCurrentState:function(){var e,t,i=this,n=i._sandbox,s=n.findAllSelectedMapLayers(),r=this.getLayerPlugins();for(t in r)r.hasOwnProperty(t)&&(e=r[t],n.printDebug("preselecting "+t),e.preselectLayers(s))},changeCssClasses:function(e,t,i){var n,s,r;for(n=0;n<i.length;n++)r=i[n],r.removeClass(function(e,i){var n="",r=i.split(" ");for(s=0;s<r.length;++s)t.test(r[s])&&(n+=r[s]+" ");return n}),r.addClass(e)},isInLayerToolsEditMode:function(){return this._isInLayerToolsEditMode}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setMapModule:function(){throw"Implement your own"},register:function(){throw"Implement your own"},unregister:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.conf=e||{}},{__name:"ControlsPlugin",getName:function(){return this.pluginName},hasUI:function(){return!1},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name,this._createMapControls())},register:function(){},unregister:function(){},init:function(e){var t=this,i=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",t.getMapModule());this.requestHandlers={ToolSelectionRequest:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",e,t),EnableMapKeyboardMovementRequest:i,DisableMapKeyboardMovementRequest:i,EnableMapMouseMovementRequest:i,DisableMapMouseMovementRequest:i}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t,i;for(t in this.requestHandlers)this.requestHandlers.hasOwnProperty(t)&&e.addRequestHandler(t,this.requestHandlers[t]);for(i in this.eventHandlers)this.eventHandlers.hasOwnProperty(i)&&e.registerForEventByName(this,i);this._addMapControls()},stopPlugin:function(e){var t,i;for(t in this.requestHandlers)this.requestHandlers.hasOwnProperty(t)&&e.removeRequestHandler(t,this.requestHandlers[t]);for(i in this.eventHandlers)this.eventHandlers.hasOwnProperty(i)&&e.unregisterFromEventByName(this,i);e.unregister(this),this._removeMapControls(),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.conf.zoomBox!==!1&&this._zoomBoxTool.deactivate(),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate())}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_addMapControls:function(){this.conf.zoomBox!==!1&&(this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool),this._zoomBoxTool.deactivate()),this.getMapModule().addMapControl("keyboardControls",this._keyboardControls),this.getMapModule().getMapControl("keyboardControls").activate(),this.conf.measureControls!==!1&&(this.getMapModule().addMapControl("measureControls_line",this._measureControls.line),this._measureControls.line.deactivate(),this.getMapModule().addMapControl("measureControls_area",this._measureControls.area),this._measureControls.area.deactivate()),this.getMapModule().addMapControl("mouseControls",this._mouseControls)},_removeMapControls:function(){this.conf.zoomBox!==!1&&(this._zoomBoxTool.deactivate(),this.getMapModule().removeMapControl("zoomBoxTool",this._zoomBoxTool)),this._keyboardControls.deactivate(),this.getMapModule().removeMapControl("keyboardControls",this._keyboardControls),this.conf.measureControls!==!1&&(this._measureControls.line.deactivate(),this._measureControls.area.deactivate(),this.getMapModule().removeMapControl("measureControls_line",this._measureControls.line),this.getMapModule().removeMapControl("measureControls_area",this._measureControls.area)),this._mouseControls.deactivate(),this.getMapModule().removeMapControl("mouseControls",this._mouseControls)},_createMapControls:function(){function e(e,i){var n=t._sandbox,s=e.geometry,r=e.units,a=e.order,o=e.measure,l=null;1===a?l=o.toFixed(3)+" "+r:2===a&&(l=o.toFixed(3)+" "+r+"<sup>2</sup>");var u=null,h=null;if(i&&OpenLayers.Format.GeoJSON){var c=new OpenLayers.Format.GeoJSON;u=c.write(s,!0),h="application/json"}n.request(t,n.getRequestBuilder("ShowMapMeasurementRequest")(l,i,u,h))}var t=this;if(t._sandbox,!this._zoomBoxTool){this.conf.zoomBox!==!1&&(OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(e){this.zoomBox(e),t.getMapModule()&&t.getMapModule().notifyMoveEnd()}},{keyMask:this.keyMask})},this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:!0})),this.conf.keyboardControls!==!1&&(this._keyboardControls=new OpenLayers.Control.PorttiKeyboard,this._keyboardControls.setup(this.getMapModule()));var i={handlerOptions:{persist:!0},immediate:!0},n={handlerOptions:{persist:!0},immediate:!0};this._measureControls={},this.conf.measureControls!==!1&&(this._measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,i),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,n)});var s,r;for(s in this._measureControls)this._measureControls.hasOwnProperty(s)&&(r=this._measureControls[s],r.events.on({measure:function(t){e(t,!0)},measurepartial:function(t){e(t,!1)}}));this.conf.mouseControls!==!1&&(this._mouseControls=new OpenLayers.Control.PorttiMouse(this.conf.mouse),this._mouseControls.setup(this.getMapModule()))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:50,core:null,setup:function(e){this.mapmodule=e,this.sandbox=e.getSandbox()},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(e){if(!(jQuery("input:focus").length>0))switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,!1,!0);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,!1,!0);break;case 17:this.sandbox.postRequestByName("CtrlKeyDownRequest");break;case 27:this.sandbox.postRequestByName("EscPressedEvent");break;case 33:this.mapmodule.notifyStartMove(),this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove(),this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove(),this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove(),this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut();break;case 70:this.sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest")}},defaultKeyUp:function(e){switch(e.keyCode){case 17:this.sandbox.postRequestByName("CtrlKeyUpRequest");break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd()}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"}),OpenLayers.Control.PorttiMouse=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,useCenterMapInWheelZoom:!1,useCenterMapInDblClickZoom:!1,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},setup:function(e){this.mapmodule=e,this.sandbox=this.mapmodule.getSandbox(),this._hoverEventBuilder=this.sandbox.getEventBuilder("MouseHoverEvent"),this._hoverEvent=this._hoverEventBuilder(),this._mapClickedBuilder=this.sandbox.getEventBuilder("MapClickedEvent")},destroy:function(){this.deactivate(),this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.handlers.drag.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.handlers.hover.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.handlers.drag.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),this.handlers.hover.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag}),this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var t={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},i={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,t,i);var n={move:this.defaultHoverMove,pause:this.defaultHoverPause},s=this,r={pixelTolerance:1.1,passesTolerance:function(e){var t=!0;if(s.panned)return!1;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t}};if(this.handlers.hover=new OpenLayers.Handler.Hover(this,n,r),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions),OpenLayers.Control.PinchZoom){var a=this.pinchZoomOptions||{};a.pinchDone=function(e,t,i){this.applyTransform("");var n=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var r=this.map.getResolutionForZoom(n),a=this.map.getLonLatFromPixel(this.pinchOrigin),o=this.currentCenter,l=this.map.getSize();a.lon+=r*(l.w/2-o.x),a.lat-=r*(l.h/2-o.y),s.sendMapSetCenter(a,n)}},this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},a))}},defaultClick:function(e){if(e.lastTouches&&2==e.lastTouches.length)this.sendMapZoomOut();else{var t=-1!=navigator.userAgent.indexOf("MSIE 8.0");if(t){var i=(new Date).getTime();this.lastDblClickMs?i-this.lastDblClickMs<1e3||this.sendMapClickEvent(e):this.sendMapClickEvent(e)}else this.sendMapClickEvent(e)}},defaultDblClick:function(e){var t=1,i=this.map.getZoom(),n=this.map.getZoom()+Math.round(t);if(n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i){var s=this.map.getSize(),r=s.w/2-e.xy.x,a=e.xy.y-s.h/2,o=this.map.baseLayer.getResolutionForZoom(n),l=this.map.getLonLatFromPixel(e.xy),u=null;u=this.useCenterMapInDblClickZoom?this.map.getCenter():new OpenLayers.LonLat(l.lon+r*o,l.lat+a*o);var h=-1!=navigator.userAgent.indexOf("MSIE 8.0");h&&(this.lastDblClickMs=(new Date).getTime()),this.sendMapSetCenter(u,n)}},defaultDblRightClick:function(){this.sendMapZoomOut()},wheelChange:function(e,t){var i=this.map.getZoom(),n=this.map.getZoom()+Math.round(t);if(n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels()),n!==i){var s=this.map.getSize(),r=s.w/2-e.xy.x,a=e.xy.y-s.h/2,o=this.map.baseLayer.getResolutionForZoom(n),l=this.map.getLonLatFromPixel(e.xy),u=null;u=this.useCenterMapInWheelZoom?this.map.getCenter():new OpenLayers.LonLat(l.lon+r*o,l.lat+a*o),this.sendMapSetCenter(u,n)}},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},panMapStart:function(){this.kinetic&&this.kinetic.begin(),this.panned=!1},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned||this.mapmodule.notifyStartMove(),this.panned=!0,this.map.pan(this.handlers.drag.last.x-e.x,this.handlers.drag.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.mapmodule.panMapByPixels(this.handlers.drag.x-e.x,this.handlers.drag.y-e.y,!0,!1,!1),t){var i=this;this.kinetic.move(t,function(e,t){i.mapmodule.panMapByPixels(e,t,!0,!1,!1)})}this.panned=!1}},defaultHoverMove:function(e){if(!this.panned){var t=this.map.getLonLatFromViewPortPx(e.xy);this._hoverEvent.set(t.lon,t.lat,!1,e.pageX,e.pageY),this.sandbox.notifyAll(this._hoverEvent,!0)}},defaultHoverPause:function(e){if(!this.panned){var t=this.map.getLonLatFromViewPortPx(e.xy),i=this._hoverEventBuilder();i.set(t.lon,t.lat,!1,e.pageX,e.pageY,!0),this.sandbox.notifyAll(i)}},sendMapClickEvent:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy),e=this._mapClickedBuilder(t,e.xy.x,e.xy.y);this.sandbox.notifyAll(e)},sendMapSetCenter:function(e,t){this.mapmodule.centerMap(e,t)},sendMapZoomOut:function(){this.mapmodule.zoomOut()},sendMapZoomIn:function(){this.mapmodule.zoomIn()},CLASS_NAME:"OpenLayers.Control.PorttiMouse"}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapMouseMovementRequest",function(){this._creator=null},{__name:"DisableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapMouseMovementRequest",function(){this._creator=null},{__name:"EnableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",function(e){this.mapModule=e},{handleRequest:function(e,t){var i;"EnableMapKeyboardMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("keyboardControls"),i&&i.activate()):"DisableMapKeyboardMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("keyboardControls"),i&&i.deactivate()):"EnableMapMouseMovementRequest"===t.getName()?(i=this.mapModule.getMapControl("mouseControls"),i&&(i.activate(),i.registerMouseEvents())):"DisableMapMouseMovementRequest"===t.getName()&&(i=this.mapModule.getMapControl("mouseControls"),i&&(i.deactivate(),i.unregisterMouseEvents()))}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapMeasurementRequest",function(e,t,i,n){this._creator=null,this._value=e,this._geometry=i,this._finished=t,this._geometryMimeType=n},{__name:"ShowMapMeasurementRequest",getName:function(){return this.__name},getValue:function(){return this._value},getGeometry:function(){return this._geometry},getGeometryMimeType:function(){return this._geometryMimeType},isFinished:function(){return this._finished}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",function(e){this.getInfoPlugin=e},{handleRequest:function(e,t){"MapModulePlugin.GetFeatureInfoRequest"==t.getName()?this.getInfoPlugin.handleGetInfo({lon:t.getLon(),lat:t.getLat()},t.getX(),t.getY()):"MapModulePlugin.GetFeatureInfoActivationRequest"==t.getName()&&this.getInfoPlugin.setEnabled(t.isEnabled())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoRequest",function(e,t,i,n){this._lon=e,this._lat=t,this._x=i,this._y=n},{__name:"MapModulePlugin.GetFeatureInfoRequest",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoActivationRequest",function(e){this._enable=e===!0},{__name:"MapModulePlugin.GetFeatureInfoActivationRequest",getName:function(){return this.__name},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(e,t){var i=this;i.config=e,i._locale=t,i.mapModule=null,i.pluginName=null,i._sandbox=null,i._map=null,i.enabled=!0,i.infoboxId="getinforesult",i._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null},i.template={};var n;for(n in i.__templates)i.__templates.hasOwnProperty(n)&&(i.template[n]=jQuery(i.__templates[n]))},{__templates:{wrapper:"<div></div>",getinfo_result_table:'<table class="getinforesult_table"></table>',link_outside:'<a target="_blank"></a>',tableRow:"<tr></tr>",tableCell:"<td></td>",span:"<span></span>",header:'<div class="getinforesult_header"><div class="icon-bubble-left"></div>',headerTitle:'<div class="getinforesult_header_title"></div>',myPlacesWrapper:'<div class="myplaces_place"><h3 class="myplaces_header"></h3><p class="myplaces_desc"></p><a class="myplaces_imglink" target="_blank"><img class="myplaces_img"></img></a><a class="myplaces_link"></a></div>'},__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this;t._sandbox=e,t._sandbox.printDebug("[GetInfoPlugin] init"),t.getGFIHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",t)},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;e&&e.register&&(i._sandbox=e),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoRequest",i.getGFIHandler),i._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",i.getGFIHandler)},stopPlugin:function(e){var t,i=this;i._closeGfiInfo(),e&&e.register&&(i._sandbox=e);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.unregisterFromEventByName(i,t);
i._sandbox.unregister(i),i._map=null,i._sandbox=null},start:function(){},stop:function(){},setEnabled:function(e){this.enabled=e===!0,this.enabled||this._closeGfiInfo()},eventHandlers:{EscPressedEvent:function(){this._closeGfiInfo()},MapClickedEvent:function(e){if(this.enabled){var t=e.getLonLat(),i=e.getMouseX(),n=e.getMouseY();this.handleGetInfo(t,i,n)}},AfterMapMoveEvent:function(){this._cancelAjaxRequest()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_cancelAjaxRequest:function(){var e=this;if(e._pendingAjaxQuery.busy){var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null,t&&(this._sandbox.printDebug("[GetInfoPlugin] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1)}},_buildLayerIdList:function(){var e,t,i=this,n=i._sandbox.findAllSelectedMapLayers(),s=null,r=i._sandbox.getMap().getScale();for(e=0;e<n.length;e++)t=n[e],!i._isIgnoredLayerType(t)&&t.getQueryable&&t.getQueryable()&&t.isInScale(r)&&t.isVisible()&&(s||(s=""),""!==s&&(s+=","),s+=t.getId());return s},_isIgnoredLayerType:function(e){if(null!==this.config&&void 0!==this.config&&this.config.ignoredLayerTypes){var t;for(t=0;t<this.config.ignoredLayerTypes.length;t++)if(e.isLayerOfType(this.config.ignoredLayerTypes[t]))return!0}return!1},_startAjaxRequest:function(e){this._pendingAjaxQuery.busy=!0,this._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){this._pendingAjaxQuery.busy=!1,this._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[GetInfoPlugin] finished jqhr ajax request")},_notifyAjaxFailure:function(){this._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo AJAX failed")},_isAjaxRequestBusy:function(){return this._pendingAjaxQuery.busy},handleGetInfo:function(e,t,i){var n=this,s=new Date,r=s.getTime();if(n._pendingAjaxQuery.busy&&n._pendingAjaxQuery.timestamp&&r-n._pendingAjaxQuery.timestamp<500)return n._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo NOT SENT (time difference < 500ms)"),void 0;n._cancelAjaxRequest();var a=n._buildLayerIdList();if(!a){var o={fragments:[],lonlat:e,popupid:this.infoboxId,title:""},l=this.getMapModule().getLocalization("plugin",!0),u=l[this.__name];o.title=u.title;var h=n._sandbox.getEventBuilder("GetInfoResultEvent")(o);return n._sandbox.notifyAll(h),n._sandbox.printDebug("[GetInfoPlugin] NO layers with featureInfoEnabled, in scale and visible"),void 0}n._startAjaxRequest(r);var c=this._sandbox.getAjaxUrl(),p=e.lon,d=e.lat,m=n._sandbox.getMap();jQuery.ajax({beforeSend:function(e){n._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){if(t.data&&t.data instanceof Array){t.lonlat=e;var i=n._parseGfiResponse(t);if(!i)return;if(i.popupid=n.infoboxId,i.lonlat=e,!n._isAjaxRequestBusy())return;n._showFeatures(i)}n._finishAjaxRequest()},error:function(){n._finishAjaxRequest(),n._notifyAjaxFailure()},always:function(){n._finishAjaxRequest()},complete:function(){n._finishAjaxRequest()},data:{layerIds:a,projection:n.mapModule.getProjection(),x:t,y:i,lon:p,lat:d,width:m.getWidth(),height:m.getHeight(),bbox:m.getBbox().toBBOX(),zoom:m.getZoom(),srs:m.getSrsName()},type:"POST",dataType:"json",url:c+"action_route=GetFeatureInfoWMS"})},_closeGfiInfo:function(){var e=this._sandbox.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.infoboxId);this._sandbox.request(this,e)},_showGfiInfo:function(e,t){var i=this._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest")("getinforesult","GetInfo Result",e,t,!0);this._sandbox.request(this,i)},_formatResponseForInfobox:function(e){var t=[];if(!e||!e.data)return t;var i=this,n=[];e.data.length?n=e.data:n.push(e.data);var s,r,a;for(s=0;s<n.length;s++)r=n[s],a=i._formatGfiDatum(r),null!==a&&void 0!==a&&t.push({html:a});return t},_parseGfiResponse:function(e){var t=this._sandbox,i=e.data,n=[],s=e.lonlat,r=s.lon+", "+s.lat,a=e.layerCount;if(0!==a&&0!==i.length&&i instanceof Array){var o,l,u,h,c,p,d,m,f,y,g,v,b,L,O,w;for(o=0;o<i.length;o++)if(l=i[o],u=l.layerId,h=t.findMapLayerFromSelectedMapLayers(u),c=h?h.getName():"",p=l.type,"wfslayer"===p){if(d=l.features,d&&d.length)for(m=0;m<d.length;m++)if(f=d[m],y=f.children,y&&y.length)for(g=0;g<y.length;g++)v=y[g],b=v.pnr_PaikanNimi,b&&b["pnr:kirjoitusasu"]&&(r=b["pnr:kirjoitusasu"]),L=this._json2html(v),n.push({markup:L,layerId:u,layerName:c,type:p})}else L=this._formatGfiDatum(l),null!==L&&void 0!==L&&(O=l.layerId&&"string"==typeof l.layerId&&l.layerId.match("myplaces_")?!0:!1,w={markup:L,layerId:u,layerName:c,type:p,isMyPlace:O},n.push(w));return{fragments:n,title:r}}},_formatJSONValue:function(e){if(e){var t=this.template.span.clone();if("[object Array]"===Object.prototype.toString.call(e)){var i,n,s,r,a,o,l;for(i=0;i<e.length;++i){n=e[i];for(s in n)n.hasOwnProperty(s)&&(r=this._formatJSONValue(n[s]),r&&(a=this.getMapModule().getLocalization("plugin",!0),o=a[this.__name],l=o[s],t.append(l||s),t.append(": "),t.append(r),t.append("<br/>")))}}else if(e.indexOf&&e.indexOf("://")>0&&e.indexOf("://")<7){var u=this.template.link_outside.clone();u.attr("href",e),u.append(e),t.append(u)}else t.append(e);return t}},_formatGfiDatum:function(e){if(!e.presentationType)return null;var t=this,i=t.template.wrapper.clone(),n=typeof e.content,s=!1;if("string"===n&&(s=e.content.indexOf("<html")>=0,s=s||e.content.indexOf("<HTML")>=0),"JSON"===e.presentationType||e.content&&e.content.parsed){if(e.layerId&&"string"==typeof e.layerId&&e.layerId.match("myplaces_"))return t._formatMyPlacesGfi(e);var r=!1,a=e.content.parsed,o=[];"[object Array]"===Object.prototype.toString.call(a)?o=a:o.push(a);var l,u,h,c,p,d,m,f,y,g,v;for(l=0;l<o.length;++l){h=o[l],c=t.template.getinfo_result_table.clone();for(u in h)h.hasOwnProperty(u)&&(p=t._formatJSONValue(h[u]),p&&(d=t.template.tableRow.clone(),c.append(d),r||d.addClass("odd"),r=!r,m=t.template.tableCell.clone(),f=this.getMapModule().getLocalization("plugin",!0),y=f[this.__name],g=y[u],m.append(g||u),d.append(m),v=t.template.tableCell.clone(),v.append(p),d.append(v)));i.append(c)}return i}if(s){var b=jQuery("<div></div>").append(e.content);b.find("link, meta, script, style, title").remove(),b.find("table").addClass("getinforesult_table"),b.find("tr:even").addClass("odd"),i.append(b.html())}else i.append(e.content);return i},_formatMyPlacesGfi:function(e){var t,i,n,s=this,r=s.template.wrapper.clone(),a=e.content.parsed.places,o=a.length;for(r.addClass("myplaces_wrapper"),n=0;o>n;++n)t=a[n],i=s.template.myPlacesWrapper.clone(),i.find("h3.myplaces_header").html(t.name),i.find("p.myplaces_desc").html(t.description),t.imageUrl?(i.find("img.myplaces_img").attr({src:t.imageUrl}),i.find("a.myplaces_imglink").attr({href:t.imageUrl})):i.find("img.myplaces_img").remove(),i.find("a.myplaces_link").attr({href:t.link}).html(t.link),r.append(i);return r},_json2html:function(e){if(null===e||void 0===e)return"";var t,i=!0,n=this.template.getinfo_result_table.clone(),s=null,r=null,a=null;for(t in e)if(e.hasOwnProperty(t)){var o,l=e[t],u=(typeof l).toLowerCase();switch(u){case"string":0===l.indexOf("http://")?(o=this.template.link_outside.clone(),o.attr("href",l),o.append(l)):o=l;break;case"undefined":o="n/a";break;case"boolean":o=l?"true":"false";break;case"number":o=l.toString();break;case"function":o="?";break;case"object":o=this._json2html(l);break;default:o=""}i=!i,s=this.template.tableRow.clone(),i||s.addClass("odd"),r=this.template.tableCell.clone(),r.append(t),s.append(r),a=this.template.tableCell.clone(),a.append(o),s.append(a),n.append(s)}return n},_showFeatures:function(e){var t,i,n,s,r,a,o,l,u,h,c,p,d=this,m={},f=d.template.wrapper.clone();for(m.html="",m.actions={},t=0;t<e.fragments.length;t++)i=e.fragments[t],n=i.layerName,s=i.markup,r=d.template.wrapper.clone(),i.isMyPlace||(a=d.template.header.clone(),o=d.template.headerTitle.clone(),o.append(n),o.attr("title",n),a.append(o),r.append(a)),s&&r.append(s),f.append(r);this.config&&this.config.colourScheme&&(e.colourScheme=this.config.colourScheme),this.config&&this.config.font&&(e.font=this.config.font),m.html=f,l=this.getMapModule().getLocalization("plugin",!0),u=l[this.__name],e.title=u.title,(!this.config||this.config.infoBox)&&(h=d._sandbox.getRequestBuilder("InfoBox.ShowInfoBoxRequest"),h&&(c=h(e.popupid,e.title,[m],e.lonlat,!0,e.colourScheme,e.font),d._sandbox.request(d,c))),p=d._sandbox.getEventBuilder("GetInfoResultEvent")(e),d._sandbox.notifyAll(p)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.requestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",this)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this._createMapMarkersLayer(),e.register(this),this._sandbox.addRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){this._sandbox.removeRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},removeMapMarkers:function(){var e=this.getMapModule();e&&e._removeMarkers()},_createMapMarkersLayer:function(){this._sandbox;var e=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(e)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkerRequest",function(e){this._list=e},{__name:"MapModulePlugin.RemoveMarkerRequest",getName:function(){return this.__name},getMarkerIds:function(){return this._list}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",function(e){this.markersPlugin=e},{handleRequest:function(e,t){"MapModulePlugin.RemoveMarkerRequest"===t.getName()&&this.markersPlugin.removeMapMarkers(t.getMarkerIds())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.conf=e,t.element=null,t.loc=null},{__name:"SearchPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this,i=t.getMapModule().getLocalization("plugin",!0);t.loc=i[t.__name],t.template=jQuery('<div class="mapplugin search default-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-textarea-and-button"><input placeholder="'+t.loc.placeholder+'" type="text" />'+'<input type="button" value="'+t.loc.search+'" name="search" />'+"</div>"+'<div class="results">'+'<div class="header">'+'<div class="close icon-close" title="'+t.loc.close+'"></div>'+"</div>"+'<div class="content">&nbsp;</div>'+"</div>"+"</div>"),t.styledTemplate=jQuery('<div class="mapplugin search published-search-div" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"><div class="search-area-div search-textarea-and-button"><div class="search-left"></div><div class="search-middle"><input class="search-input" placeholder="'+t.loc.placeholder+'" type="text" />'+'<div class="close-results icon-close" title="'+t.loc.close+'"></div>'+"</div>"+'<div class="search-right"></div>'+"</div>"+'<div class="results published-search-results">'+'<div class="content published-search-content"></div>'+"</div>"+"</div>"),t.templateResultsTable=jQuery("<table class='search-results'><thead><tr><th>"+t.loc.column_name+"</th>"+"<th>"+t.loc.column_village+"</th>"+"<th>"+t.loc.column_type+"</th>"+"</tr></thead><tbody></tbody></table>"),t.templateResultsRow=jQuery("<tr><td><a href='JavaScript:void(0);'></a></td><td></td><td></td></tr>");var n=null;n=t.conf&&t.conf.url?t.conf.url:e.getAjaxUrl()+"action_route=GetSearchResult",t.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",n)},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(){var e,t=this;t.element.remove();for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){if(this.isInLayerToolsEditMode!==e)if(this.isInLayerToolsEditMode=e,this.isInLayerToolsEditMode){this._inputField.prop("disabled",!0),this._searchButton.prop("disabled",!0);var t=jQuery('<div class="search-editmode-overlay">');this.element.find(".search-textarea-and-button").css({position:"relative"}).append(t),t.mousedown(function(e){e.preventDefault()})}else this._inputField.prop("disabled",!1),this._searchButton.prop("disabled",!1),this.element.find(".search-editmode-overlay").remove()},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,1)},_createUI:function(){var e,t=this;t.conf&&t.conf.toolStyle?(e=t.styledTemplate.clone(),t.element=e,t._inputField=e.find("input[type=text]"),t._searchButton=e.find("input[type=button]"),t.changeToolStyle(t.conf.toolStyle,e)):(e=t.template.clone(),t.element=e,t._inputField=e.find("input[type=text]"),t._searchButton=e.find("input[type=button]")),t._bindUIEvents()},_bindUIEvents:function(){var e=this,t=e._sandbox,i=this.element,n="top left",s=1;e._inputField.focus(function(){t.request(e.getName(),t.getRequestBuilder("DisableMapKeyboardMovementRequest")())}),e._inputField.blur(function(){t.request(e.getName(),t.getRequestBuilder("EnableMapKeyboardMovementRequest")())}),e._inputField.keypress(function(t){e.isInLayerToolsEditMode||e._checkForEnter(t)}),e._searchButton.click(function(){e.isInLayerToolsEditMode||e._doSearch()}),i.find("div.search-right").click(function(){e.isInLayerToolsEditMode||e._doSearch()}),i.find("div.close").click(function(){e.isInLayerToolsEditMode||(e._hideSearch(),e._inputField.val(""))}),i.find("div.close-results").click(function(){e.isInLayerToolsEditMode||(e._hideSearch(),e._inputField.val(""))}),i.find("div.results").hide(),e.conf&&e.conf.location&&(n=e.conf.location.classes||n,s=e.conf.location.position||s),e.getMapModule().setMapControlPlugin(i,n,s),e.conf&&e.conf.font&&e.changeFont(e.conf.font,i),e.conf&&e.conf.toolStyle&&e._inputField.keyup(function(t){(27===t.keyCode||8===t.keyCode&&!jQuery(this).val())&&e._hideSearch()}),e._setLayerToolsEditMode(e.getMapModule().isInLayerToolsEditMode())},_checkForEnter:function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),13===e.keyCode&&this._doSearch()},_doSearch:function(){if(!this._searchInProgess){var e=this;e._hideSearch(),e._searchInProgess=!0;var t=e.element.find("input[type=text]");t.addClass("search-loading");var i=t.val(),n=function(t){e._showResults(t),e._enableSearch()},s=function(){e._enableSearch()};e.service.doSearch(i,n,s)}},_showResults:function(e){var t=e.error,i=this,n=i.element.find("div.results"),s=n.find("div.header"),r=n.find("div.content");if(t)return r.html(t),n.show(),void 0;var a,o,l,u=e.totalCount;if(0===u)r.html(this.loc.noresults),n.show();else if(1===u)o=e.locations[0].lon,a=e.locations[0].lat,l=e.locations[0].zoomLevel,i._sandbox.request(i.getName(),i._sandbox.getRequestBuilder("MapMoveRequest")(o,a,l,!1));else{var h,c=i.templateResultsTable.clone(),p=c.find("tbody"),d=function(){return i._resultClicked(jQuery(this).attr("data-location")),!1};for(h=0;u>h;h+=1){if(h>=100){p.append("<tr><td class='search-result-too-many' colspan='3'>"+i.loc.toomanyresults+"</td></tr>");break}o=e.locations[h].lon,a=e.locations[h].lat,l=e.locations[h].zoomLevel;var m=o+"---"+a+"---"+l,f=i.templateResultsRow.clone(),y=e.locations[h].name,g=e.locations[h].village,v=e.locations[h].type,b=f.find("td"),L=jQuery(b[0]).find("a");f.attr("data-location",m),L.attr("data-location",m),L.attr("title",y),L.append(y),L.click(d),jQuery(b[1]).attr("title",g).append(g),jQuery(b[2]).attr("title",v).append(v),jQuery.browser.msie&&f.append(jQuery('<td style="width: 0px;"></td>')),p.append(f)}i.conf&&i.conf.toolStyle||p.find(":odd").addClass("odd"),r.html(c),n.show(),i.conf&&i.conf.font&&i.changeFont(i.conf.font,r),i.conf&&i.conf.toolStyle&&(s.remove(),i.changeResultListStyle(i.conf.toolStyle,n))}},_resultClicked:function(e){var t=e.split("---"),i=t[0],n=t[1],s=t[2];this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(i,n,s,!1))},_enableSearch:function(){this._searchInProgess=!1,jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.element.find("div.results").hide(),this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())},changeToolStyle:function(e,t){if(t=t||this.element,e&&t){if(null===e.val)return this.conf.toolStyle=null,t.remove(),this._createUI(),void 0;if(t.hasClass("default-search-div"))return t.removeClass("default-search-div").addClass("published-search-div"),t.empty(),this.styledTemplate.children().clone().appendTo(t),this.changeToolStyle(this.conf.toolStyle,t),this._bindUIEvents(),void 0;var i=this,n=this.getMapModule().getImageUrl(),s=n+"/framework/bundle/mapmodule-plugin/plugin/search/images/",r=e.val,a=s+"search-tool-"+r+"_01.png",o=s+"search-tool-"+r+"_02.png",l=s+"search-tool-"+r+"_03.png",u=t.find("div.search-left"),h=t.find("div.search-middle"),c=t.find("div.search-right"),p=h.find("div.close-results"),d=t.find("input.search-input"),m=318-(e.widthLeft+e.widthRight),f=m-35;u.css({"background-image":'url("'+a+'")',width:e.widthLeft+"px"}),h.css({"background-image":'url("'+o+'")',"background-repeat":"repeat-x",width:m+"px"}),c.css({"background-image":'url("'+l+'")',width:e.widthRight+"px"}),d.css({width:f+"px"}),p.removeClass("icon-close icon-close-white"),/dark/.test(r)?(p.addClass("icon-close-white"),p.css({"margin-top":"8px"}),d.css({color:"#ddd"})):(p.addClass("icon-close"),p.css({"margin-top":"10px"}),d.css({color:""})),i._setLayerToolsEditMode(i.getMapModule().isInLayerToolsEditMode())}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i=[];i.push(t.find("table.search-results")),i.push(t.find("input"));var n="oskari-publisher-font-"+e,s=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(n,s,i)}},changeResultListStyle:function(e,t){var i="oskari-publisher-search-results-"+e.val,n=/oskari-publisher-search-results-/;this.getMapModule().changeCssClasses(i,n,[t])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(e){this._searchUrl=e},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,i){var n=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:"searchKey="+e+"&Language="+n,error:i,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",function(e){this.conf=e,this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=null},{templates:{main:jQuery("<div class='mapplugin logoplugin' data-clazz='Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin'><div class='icon'></div><div class='terms'><a href='JavaScript:void(0);'></a></div><div class='data-sources'></div></div>"),dataSourcesDialog:jQuery("<div class='data-sources-dialog'><div class='layers'><h4></h4></div><div class='indicators'><h4></h4></div></div>")},__name:"LogoPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.find("a").unbind("click"),t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{"StatsGrid.IndicatorsEvent":function(e){this._addIndicatorsToDataSourcesDialog(e.getIndicators())},LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=!!e.isInMode(),this.isInLayerToolsEditMode||this.setLocation(this.element.parents(".mapplugins").attr("data-location"))},MapSizeChangedEvent:function(){if(this.dataSourcesDialog){var e=jQuery("div.logoplugin div.data-sources");e&&this.dataSourcesDialog.moveTo(e,"top")}}},onEvent:function(e){var t=this.eventHandlers[e.getName()];return t?t.apply(this,[e]):void 0},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,1)},_createUI:function(){var e,t,i,n,s,r=this,a=r._sandbox,o=r.getMapModule().getLocalization("plugin",!0),l=o[r.__name],u="bottom left",h=1;r.conf&&(i=a.getLocalizedProperty(r.conf.mapUrlPrefix),n=a.getLocalizedProperty(r.conf.termsUrl)),r.element||(r.element=r.templates.main.clone()),r.conf&&r.conf.location&&(u=r.conf.location.classes||u,h=r.conf.location.position||h),r.getMapModule().setMapControlPlugin(r.element,u,h),e=r.element.find("div.icon"),i&&e.bind("click",function(){return r.isInLayerToolsEditMode?void 0:(t=a.generateMapLinkParameters(),i+=t,window.open(i,"_blank"),!1)}),e=r.element.find("a"),n?(e.append(l.terms),e.bind("click",function(){return r.isInLayerToolsEditMode?void 0:(window.open(n,"_blank"),!1)})):e.hide(),s=r.element.find("div.data-sources"),r.conf&&r.conf.hideDataSourceLink?s.remove():(s.html(l.dataSources),s.click(function(e){r.isInLayerToolsEditMode||(r._openDataSourcesDialog(e.target),r._requestDataSources())})),this.isInLayerToolsEditMode=r.getMapModule().isInLayerToolsEditMode()},changeFont:function(e,t){var i,n;t=t||this.element,t&&e&&(i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/,this.getMapModule().changeCssClasses(i,n,[t]))},_requestDataSources:function(){var e,t=this,i=t._sandbox.getRequestBuilder("StatsGrid.IndicatorsRequest");i&&(e=i(),t._sandbox.request(t,e))},_openDataSourcesDialog:function(e){var t,i,n=this,s=n.getMapModule().getLocalization("plugin",!0)[n.__name],r=s.dataSources,a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=Oskari.clazz.create("Oskari.userinterface.component.Button"),l=n.templates.dataSourcesDialog.clone(),u=l.find("div.layers"),h=s.layersHeader,c=n._sandbox.findAllSelectedMapLayers(),p=c.length;if(o.setTitle("OK"),o.setHandler(function(){n.dataSourcesDialog=null,a.close(!0)}),0===p)u.remove();else for(u.find("h4").html(h),i=0;p>i;++i)t=c[i],u.append("<div>"+t.getName()+" - "+t.getOrganizationName()+"</div>");this.dataSourcesDialog=a,a.show(r,l,[o]),e=e||n.element.find("div.data-sources"),a.moveTo(e,"top")},_addIndicatorsToDataSourcesDialog:function(e){var t=this.dataSourcesDialog;if(t){var i,n,s,r=this.getMapModule().getLocalization("plugin",!0)[this.__name],a=t.getJqueryContent(),o=a.find("div.indicators"),l=r.indicatorsHeader;if(e=e||{},jQuery.isEmptyObject(e))o.remove();else{o.find("h4").html(l);for(n in e)e.hasOwnProperty(n)&&(i=e[n],o.append("<div>"+i.title+" - "+i.organization+"</div>"))}s=s||this.element.find("div.data-sources"),t.moveTo(s,"top")}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.DataSourcePlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.template=null,this.element=null,this.sandbox=null,this.tool=null},{__name:"DataSourcePlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.template=jQuery("<div class='oskari-datasource'><div class='link'><a href='JavaScript:void(0);'></a></div></div>"),this.templateinfoIcon=jQuery('<div class="icon-info"></div>'),this.templategroupTemplate=jQuery('<ul style="padding: 0 12px;"></ul>'),this.templatecontent=jQuery("<div></div>"),this.templateheading=jQuery("<b></b>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);this._createUI()},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null,this.element.find("a").unbind("click"),this.element.remove(),this.element=void 0},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_layerListComparator:function(e,t){var i=e.getOrganizationName().toLowerCase(),n=t.getOrganizationName().toLowerCase(),s=0;return i===n&&(i=e.getName().toLowerCase(),n=t.getName().toLowerCase()),n>i&&(s=-1),i>n&&(s=1),s},_createUI:function(){var e=this;e._sandbox;var t=jQuery(this._map.div);this.element||(this.element=this.template.clone()),t.append(this.element);var i=this.getMapModule().getLocalization("plugin",!0);this.localization=i[this.__name];var n=this.element.find("a");n.append(this.localization.link),n.bind("click",function(){return e._openDialog(),!1})},_openDialog:function(){var e=this;e._sandbox;var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.localization.button.close);this.templateinfoIcon.clone();var n,s,r,a,o=this.templategroupTemplate.clone(),l=this._getLayers(),u=null,h=this.templatecontent.clone(),c=null;for(n=0;n<l.length;++n)s=l[n],u!==s.getOrganizationName()&&(u=s.getOrganizationName(),r=this.templateheading.clone(),u?r.append(u):r.append("N/A"),h.append(r),c=o.clone(),h.append(c)),a=this._getLayerContainer(s),a&&c.append(a);t.show(this.localization.popup.title,h,[i]),t.moveTo(this.element.find("a"),"top")},_getLayers:function(){var e=this,t=this._sandbox.findAllSelectedMapLayers();return t.sort(function(t,i){return e._layerListComparator(t,i)}),t},_getLayerContainer:function(e){var t=this,i=this.templateinfoIcon.clone(),n=e.getName();if(n){var s=jQuery("<li>"+n+"</li>"),r=e.getMetadataIdentifier();if(r){var a=i.clone();a.bind("click",function(){t._getMetadataInfoCallback(e)}),s.append(a)}return s}return null},_getMetadataInfoCallback:function(e){var t=this,i=t._sandbox,n=e.getMetadataIdentifier(),s=[],r={};r[n]=!0;var a,o,l=e.getSubLayers();if(l&&l.length>0)for(a=0;a<l.length;a++)o=l[a].getMetadataIdentifier(),o&&""!==o&&!r[o]&&(r[o]=!0,s.push({uuid:o}));i.postRequestByName("catalogue.ShowMetadataRequest",[{uuid:n},s])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.conf=e,t.element=null,t._indexMap=null,t._indexMapUrl="/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png",t.isInLayerToolsEditMode=!1},{templates:{main:jQuery('<div class="mapplugin indexmap" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"></div>'),toggle:jQuery('<div class="indexmapToggle"></div>')},__name:"IndexMapPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,5)},_createUI:function(){var e=this,t=new OpenLayers.Layer.Image("Overview map image",e.getMapModule().getImageUrl()+e._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173)),i="bottom right",n=5;e.element=e.templates.main.clone();var s={div:e.element[0],mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:e._map.getProjection(),numZoomLevels:1},layers:[t],size:new OpenLayers.Size(120,173),autoPan:!1,controls:[]};e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.getMapModule().setMapControlPlugin(e.element,i,n),e._indexMap=new OpenLayers.Control.OverviewMap(s),this.isInLayerToolsEditMode=e.getMapModule().isInLayerToolsEditMode()},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._createUI(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.getMapModule().addMapControl("overviewMap",i._indexMap);var n=i.templates.toggle.clone();i._bindIcon(n),i.element.append(n)},_bindIcon:function(e){var t=this;e.bind("click",function(e){e.preventDefault();var i=t.element.find(".olControlOverviewMapElement");i.toggle()})},stopPlugin:function(){var e,t=this;t.getMapModule().removeMapControl("overviewMap");for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._indexMap&&this._indexMap.update()},LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){if(this.isInLayerToolsEditMode!==e){this.isInLayerToolsEditMode=e;var t=this.element.find(".indexmapToggle");if(e){var i=this.element.find(".olControlOverviewMapElement");i.hide(),t.unbind("click")}else this._bindIcon(t)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])
}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(e){var t=this;t.conf=e,t.element=null,t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t._scalebar=null},{templates:{main:jQuery('<div class="mapplugin scalebar" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"></div>')},__name:"ScaleBarPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){},register:function(){},unregister:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,3)},startPlugin:function(e){var t,i=this,n="bottom left",s=3;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i.element=i.templates.main.clone(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.conf&&i.conf.location&&(n=i.conf.location.classes||n,s=i.conf.location.position||s),i.getMapModule().setMapControlPlugin(i.element,n,s),i._scalebar=new OpenLayers.Control.ScaleLine({div:i.element[0]}),i.getMapModule().addMapControl("scaleBar",i._scalebar)},stopPlugin:function(){var e,t=this;t.getMapModule().removeMapControl("scaleBar");for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._scalebar&&this._scalebar.update()},LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=e.isInMode()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin",function(e){var t=this;t.conf=e||{},t.element=null,t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t._scalebar=null,t.toolbarId=t.conf.toolbarId,t.toolbarContent="publishedToolbarContent",t.toolbarPopupContent="publishedToolbarPopupContent",t.toolbarContainer="publishedToolbarContainer",t.isInLayerToolsEditMode=!1},{templates:{main:jQuery("<div class=\"mapplugin tools\" data-clazz=\"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin\"><div class='icon'></div><div class='publishedToolbarContainer'><div class='tools-top-arrow'></div></div></div>"),container:jQuery("<div></div>"),publishedToolbarPopupContent:jQuery('<div class="publishedToolPopupContent"><h3></h3><div class="content"></div><div class="actions"></div></div>')},__name:"PublisherToolbarPlugin",getName:function(){return this.pluginName},getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin"},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){var e=this,t=e.getMapModule().getLocalization("plugin",!0),i=e._sandbox.getRequestBuilder("ToolSelectionRequest"),n="MapModulePlugin.GetFeatureInfoActivationRequest",s=e._sandbox.getRequestBuilder(n);e.localization=t[e.__name],e.template=jQuery(e.templates.main),e.buttonGroups=[{name:"history",buttons:{history_back:{toolbarid:e.toolbarId,iconCls:"tool-history-back-dark",tooltip:e.localization.history.back,prepend:!0,enabled:!1,sticky:!1,callback:function(){e._sandbox.request(e,i("map_control_tool_prev"))}},history_forward:{toolbarid:e.toolbarId,iconCls:"tool-history-forward-dark",tooltip:e.localization.history.next,enabled:!1,sticky:!1,callback:function(){e._sandbox.request(e,i("map_control_tool_next"))}}}},{name:"basictools",buttons:{measureline:{toolbarid:e.toolbarId,iconCls:"tool-measure-line-dark",tooltip:e.localization.measure.line,enabled:!1,sticky:!0,callback:function(){var t="map_control_measure_tool";e._sandbox.request(e,s(!1)),e._sandbox.request(e,i(t))}},measurearea:{toolbarid:e.toolbarId,iconCls:"tool-measure-area-dark",tooltip:e.localization.measure.area,enabled:!1,sticky:!0,callback:function(){var t="map_control_measure_area_tool";e._sandbox.request(e,s(!1)),e._sandbox.request(e,i(t))}}}}],this.requestHandlers={toolContainerRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",e)}},register:function(){},unregister:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,0)},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._sandbox.addRequestHandler("Toolbar.ToolContainerRequest",this.requestHandlers.toolContainerRequestHandler),i._createUI()},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t.destroy(),t._sandbox.unregister(t),t._map=null,t._sandbox=null,t.element&&(t.element.remove(),t.element=void 0)},start:function(){},stop:function(){},eventHandlers:{LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){this.isInLayerToolsEditMode!==e&&(this.isInLayerToolsEditMode=e,e?(this.element.find("."+this.toolbarContainer).hide(),this.element.find("div.icon").unbind("click")):this._bindIcon())},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},show:function(e){var t=e?"show":"hide";this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,t])},destroy:function(){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"remove"])},changeName:function(e){this._sandbox.requestByName(this,"Toolbar.ToolbarRequest",[this.toolbarId,"changeName",e])},_createUI:function(){var e,t,i,n,s,r=this,a=(r._sandbox,[r.toolbarContent,r.toolbarPopupContent]);if(!r.element)for(r.element=r.template.clone(),t=r.element.find("."+r.toolbarContainer),n=0,s=a.length;s>n;n++)r.templates.container.clone().attr("class",a[n]).appendTo(t);this.conf&&this.conf.toolStyle&&this.changeToolStyle(this.conf.toolStyle,r.element),r.insertToMap(),e=r.element.find("."+r.toolbarContainer),e.hide(),r._bindIcon(),r.conf&&r.conf.font&&r.changeFont(r.conf.font,i)},_bindIcon:function(){var e=this,t=e.element.find("div.icon"),i=e.element.find("."+e.toolbarContainer);t.bind("click",function(){i.toggle()})},insertToMap:function(){var e=this,t="top left",i=0;e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i)},setToolbarContainer:function(){var e=this,t=e._sandbox,i=t.getRequestBuilder("Toolbar.ToolbarRequest");e.toolbarId&&e.toolbarContent&&null!==i&&void 0!==i&&t.requestByName(e,"Toolbar.ToolbarRequest",[e.toolbarId,"add",{title:e.localization.title,show:!1,toolbarContainer:e.element.find("."+e.toolbarContent),closeBoxCallback:function(){}}])},getToolOptions:function(){var e=this;return e.buttonGroups},changeToolStyle:function(e,t){var i=this;if(t=t||i.element){var n=i.getMapModule().getImageUrl(),s=n+"/framework/bundle/mapmodule-plugin/plugin/publishertoolbar/images/",r=s+"menu-"+e+".png",a=t.find(".icon"),o=t.find("."+i.toolbarContent),l=t.find("."+i.toolbarPopupContent),u=e?e.split("-")[1]:"dark";null===e?(a.removeAttr("style"),o.removeClass("light","dark"),l.removeClass("light","dark")):(a.css({"background-image":'url("'+r+'")'}),"dark"===u?(o.removeClass("light").addClass("dark"),l.removeClass("light").addClass("dark")):(o.removeClass("dark").addClass("light"),l.removeClass("dark").addClass("light")));var h,c,p,d=i.element.find("."+i.toolbarContent);for(h in i.buttonGroups)if(i.buttonGroups.hasOwnProperty(h)){var m=i.buttonGroups[h],f=d.find("div.toolrow[tbgroup="+i.toolbarId+"-"+m.name+"]");for(c in m.buttons)if(m.buttons.hasOwnProperty(c)){var y=m.buttons[c],g=y.iconCls.split("-"),v=g[0],b=g.length-1;for("dark"!==g[b]&&"light"!==g[b]&&(g.push("dark"),b++),p=1;p<g.length;p++)v+=b>p?"-"+g[p]:"-"+u;f.find("."+y.iconCls).removeClass(y.iconCls).addClass(v),y.iconCls=v}}}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i=[];i.push(t.find(".publishedToolbarPopupContent"));var n="oskari-publisher-font-"+e,s=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(n,s,i)}},setToolContent:function(e){var t,i,n=this,s=e.className||"",r=e.title||"",a=e.content||"",o=e.buttons||[],l=n.element.find("."+n.toolbarContent),u=n.element.find("."+s),h=!1;if(0===u.length&&(u=n.templates.publishedToolbarPopupContent.clone(),h=!0),u.find("h3").html(r),u.find(".content").html(a),s&&(u.removeClass(),u.addClass("publishedToolPopupContent "+s)),h&&o&&o.length>0)for(t=u.find(".actions"),t.empty(),i=0;i<o.length;i+=1)o[i].insertTo(t);else h&&u.bind("click",function(){n.resetToolContent()});return h&&(n.element.find("."+n.toolbarPopupContent).append(u),l.hide()),u},resetToolContent:function(e){var t=this,i=e.className||"publishedToolPopupContent",n=t.element.find("."+t.toolbarContent),s=t.element.find("."+i);s.remove(),n.show()},getToolConfs:function(){var e,t,i,n,s=this,r={};for(e in s.buttonGroups)if(s.buttonGroups.hasOwnProperty(e)){t=s.buttonGroups[e],r[t.name]={};for(i in t.buttons)t.buttons.hasOwnProperty(i)&&(n=t.buttons[i],r[t.name][i]={iconCls:n.iconCls})}return r}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.FullScreenPlugin",function(){var e=this;e.mapModule=null,e.pluginName=null,e._sandbox=null,e._map=null,e._fullscreen=null,e.templates={}},{__name:"FullScreenPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){var e=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/";this.templates.main=jQuery('<div class="fullscreenDiv"><img class="fullscreenDivImg" src="'+e+"hide-navigation.png"+'"></img>'+"</div>")},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),this._map=this.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i.createUI()},stopPlugin:function(e){var t;jQuery("div.fullscreenDiv").remove();for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location=e,t.element&&(t.stopPlugin(),t.startPlugin())},createUI:function(){var e=this,t=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/fullscreen/images/",i="top left",n=1;e.element||(e.element=e.templates.main.clone()),e.element.find(".fullscreenDivImg").bind("click",function(i){i.preventDefault(),e._sandbox.postRequestByName("MapFull.MapWindowFullScreenRequest"),jQuery(this).attr("src").match(/hide-navigation/)?jQuery(this).attr("src",t+"show-navigation.png"):jQuery(this).attr("src",t+"hide-navigation.png")}),e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.getMapModule().setMapControlPlugin(e.element,i,n)},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.element=void 0,t.conf=e,t.initialSetup=!0,t.isInLayerToolsEditMode=!1,t.templates={}},{__name:"LayerSelectionPlugin",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){var e=this;e.templates.main=jQuery('<div class=\'mapplugin layerselection\' data-clazz=\'Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin\'><div class="header"><div class="header-icon icon-arrow-white-right"></div></div><div class="content"><div class="layers"></div><div class="baselayers"></div></div></div>'),e.templates.layer=jQuery("<div class='layer'><label><span></span></label></div>"),e.templates.checkbox=jQuery("<input type='checkbox' />"),e.templates.radiobutton=jQuery("<input type='radio' name='defaultBaselayer'/>"),e.templates.baseLayerHeader=jQuery('<div class="baseLayerHeader"></div>'),e.templates.headerArrow=jQuery('<div class="styled-header-arrow"></div>'),e.templates.contentHeader=jQuery('<div class="content-header"><div class="content-header-title"></div><div class="content-close icon-close-white"></div></div>')},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(e){var t,i=this,n=e||this._sandbox;for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&n&&n.unregisterFromEventByName(i,t);n.unregister(i),i.element&&(i.element.remove(),i.element=void 0,delete i.element)},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.removeLayer(e.getMapLayer())},AfterMapLayerAddEvent:function(e){this.addLayer(e.getMapLayer()),this._checkBaseLayers(e.getMapLayer())},MapLayerVisibilityChangedEvent:function(e){this.updateLayer(e.getMapLayer())},AfterMapMoveEvent:function(){this._checkBaseLayers()},LayerToolsEditModeEvent:function(e){this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){if(this.isInLayerToolsEditMode!==e){var t=this.element.find("div.header");this.isInLayerToolsEditMode=e,e?(this.closeSelection(),t.unbind("click")):this._bindHeader(t)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},selectBaseLayer:function(e){var t,i=this.element.find("div.content div.baselayers");i&&0!==i.length&&(t=i.find("input[value="+e+"]"),t.attr("checked","checked"),this._changedBaseLayer())},addLayer:function(e){var t=this.element.find("div.content"),i=t.find("div.layers"),n=this.templates.layer.clone(),s=this.templates.checkbox.clone();n.find("span").append(e.getName()),s.attr("value",e.getId()),e.isVisible()?s.attr("checked",!0):s.attr("checked",!1),this._bindCheckbox(s,e),n.find("span").before(s),this.layerRefs[e.getId()]=n,i.append(n)},updateLayer:function(e){var t=this.layerRefs[e.getId()],i=t.find("input"),n=e.isVisible();n?i.is(":checked")||i.attr("checked","checked"):i.is(":checked")&&i.removeAttr("checked")},_bindCheckbox:function(e,t){var i=this;e.change(function(){var e=jQuery(this),n=e.is(":checked");n?i._setLayerVisible(t,!0):i._setLayerVisible(t,!1)})},_setLayerVisible:function(e,t){var i=this._sandbox,n=i.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),s=n(e.getId(),t);i.request(this,s)},removeLayer:function(e){var t=this.layerRefs[e.getId()];t.remove(),delete this.layerRefs[e.getId()]},addBaseLayer:function(e){if(e&&e.getId&&this.element){var t=this.layerRefs[e.getId()];t.remove();var i=t.find("input");i.remove(),i=this.templates.radiobutton.clone(),i.attr("value",e.getId());var n=this;i.bind("change",function(){n._changedBaseLayer()}),t.find("span").before(i);var s=this.element.find("div.content div.baselayers");if(0===s.find("div.layer").length){var r=this.getMapModule().getLocalization("plugin"),a=r[this.__name],o=this.templates.baseLayerHeader.clone();o.append(a.chooseDefaultBaseLayer),s.parent().find(".baseLayerHeader").remove(),s.before(o),i.attr("checked","checked")}s.append(t),n._changedBaseLayer()}},removeBaseLayer:function(e){var t=this.layerRefs[e.getId()];t.remove();var i=t.find("input"),n=i.is(":checked");i.remove(),i=this.templates.checkbox.clone(),i.attr("value",e.getId()),n&&i.attr("checked","checked"),this._bindCheckbox(i,e),t.find("span").before(i);var s=this.element.find("div.content div.layers");s.append(t),this._setLayerVisible(e,!0);var r=this.element.find("div.content div.baselayers"),a=r.find("div.layer");if(0===a.length){var o=this.element.find("div.content div.baseLayerHeader");o.remove()}else{var l=a.find("input:checked");0===l.length&&(jQuery(a.find("input").get(0)).attr("checked","checked"),this._changedBaseLayer())}},_changedBaseLayer:function(){var e,t,i,n=this,s=n._sandbox,r=n.getBaseLayers();for(e=0;e<r.baseLayers.length;e+=1)t=r.baseLayers[e],i=s.findMapLayerFromSelectedMapLayers(t),null!==i&&void 0!==i&&n._setLayerVisible(i,r.defaultBaseLayer+""==t+"");var a="RearrangeSelectedMapLayerRequest",o=s.getRequestBuilder(a),l=o(r.defaultBaseLayer,0);s.request(n,l)},setupLayers:function(){var e=this;delete this.layerRefs,this.layerRefs={};var t,i=this._sandbox.findAllSelectedMapLayers();for(t=0;t<i.length;t+=1)e.addLayer(i[t])},openSelection:function(){var e,t=this.element.find("div.header div.header-icon");t.removeClass("icon-arrow-white-right"),t.addClass("icon-arrow-white-down"),e=this.element.find("div.content").show()},closeSelection:function(){var e,t=this.element.find("div.header div.header-icon");t.removeClass("icon-arrow-white-down"),t.addClass("icon-arrow-white-right"),e=this.element.find("div.content").hide()},getBaseLayers:function(){var e,t,i=this.element.find("div.content div.baselayers div.layer input"),n=[],s=null;for(e=0;e<i.length;e+=1)t=jQuery(i[e]),n.push(t.val()),t.is(":checked")&&(s=t.val());return{baseLayers:n,defaultBaseLayer:s}},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location||(t.conf.location={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,3)},_bindHeader:function(e){var t=this;e.bind("click",function(){var e=t.element.find("div.content");e.is(":hidden")?t.openSelection():t.closeSelection()})},_createUI:function(){var e=this,t="top left",i=3;e.element||(e.element=e.templates.main.clone());var n=e.getMapModule().getLocalization("plugin",!0),s=n[e.__name],r=e.element.find("div.header");r.append(s.title),e._bindHeader(r),e.closeSelection(),e.setupLayers(),e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,e.element),e.conf&&e.conf.font&&e.changeFont(e.conf.font,e.element),e.conf&&e.conf.colourScheme&&e.changeColourScheme(e.conf.colourScheme,e.element)},changeToolStyle:function(e,t){if(t=t||this.element){if(null===e)return this.element&&(delete this.conf.toolStyle,this.stopPlugin(),this.startPlugin()),void 0;var i=this,n=this.getMapModule().getLocalization("plugin",!0),s=t.find("div.header"),r=this.templates.headerArrow.clone(),a=t.find("div.content"),o=this.templates.contentHeader.clone(),l=this.getMapModule().getImageUrl(),u=l+"/framework/bundle/mapmodule-plugin/plugin/layers/images/",h=u+"map-layer-button-"+e+".png";s.empty(),null!==e?(t.addClass("published-styled-layerselector"),a.addClass("published-styled-layerselector-content"),a.addClass("layerselection-styled-content"),s.addClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("oskari-publisher-layers-"+e,/oskari-publisher-layers-/,[a]),this.getMapModule().changeCssClasses("oskari-publisher-layers-header-"+e,/oskari-publisher-layers-header-/,[o]),s.css({"background-image":'url("'+h+'")'})):(t.removeClass("published-styled-layerselector"),a.removeClass("published-styled-layerselector-content"),a.removeClass("layerselection-styled-content"),s.removeClass("published-styled-layerselector-header"),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-/,[a]),this.getMapModule().changeCssClasses("",/oskari-publisher-layers-header-/,[o]),s.css({"background-image":""})),a.find("div.content-header").remove(),a.find("div.styled-header-arrow").remove(),o.find("div.content-header-title").append(n[this.__name].title),a.prepend(o),a.prepend(r),o.find("div.content-close").on("click",function(){i.closeSelection()}),this.conf&&this.conf.colourScheme&&this.changeColourScheme(this.conf.colourScheme,this.element)}},changeColourScheme:function(e,t){if(t=t||this.element,t&&e){t.find("div.content-header").css({"background-color":e.bgColour}),t.find("div.styled-header-arrow").css({"border-bottom-color":e.bgColour});var i=t.find("div.content-header div.content-close");i.removeClass("icon-close").removeClass("icon-close-white"),i.addClass(e.iconCls),t.find("div.content-header div.content-header-title").css({color:e.titleColour})}},changeFont:function(e,t){if(t=t||this.element,t&&e){var i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(i,n,[t])}},_checkBaseLayers:function(e){var t;if(this.conf&&this.conf.baseLayers)if(!this.initialSetup||null!==e&&void 0!==e){if(null!==e&&void 0!==e){for(t=0;t<this.conf.baseLayers.length;t++)this.conf.baseLayers[t]==e.getId()&&this.addBaseLayer(e);this.conf.defaultBaseLayer==e.getId()&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}else{for(this.initialSetup=!1,t=0;t<this.conf.baseLayers.length;t+=1)e=this._sandbox.findMapLayerFromSelectedMapLayers(this.conf.baseLayers[t]),this.addBaseLayer(e);this.conf.defaultBaseLayer&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.BackgroundLayerSelectionPlugin",function(e){var t;if(this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=void 0,this.conf=e,this.error=!(this.conf&&this.conf.baseLayers&&this.conf.baseLayers.length),!this.error)for(t=0;t<this.conf.baseLayers.length;t+=1)"number"==typeof this.conf.baseLayers[t]&&(this.conf.baseLayers[t]=this.conf.baseLayers[t].toString());this.initialSetup=!0},{__name:"BackgroundLayerSelectionPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){this.template=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"></div><div class="content">    <ul></ul>    <div class="currentSelection"></div></div></div>'),this.dropdownArrowTemplate=jQuery('<div class="header-icon icon-arrow-white-right"></div>'),this.layerSelectionTemplate=jQuery("<li></li>"),this.errorTemplate=jQuery('<div class="backgroundLayerSelectionPlugin oskariui mapplugin"><div class="bg"></div><div class="error">No baseLayers defined in configuration</div></div>')},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._map=i.getMapModule().getMap(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);i._createUI()},stopPlugin:function(){var e,t=this;for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t.element&&(t.element.remove(),t.element=void 0,delete t.element)},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(){this._updateUISelection()},AfterMapLayerRemoveEvent:function(){this._createLayerSelectionElements()},AfterMapLayerAddEvent:function(){this._createLayerSelectionElements()},MapLayerEvent:function(){this._createLayerSelectionElements()},"userinterface.ExtensionUpdatedEvent":function(e){if(jQuery.inArray(e.getExtension().getName(),["Analyse","Publisher","StatsGrid","Printout"])>-1){var t=this,i="close"!==e.getViewState();i?t.hiddenByMode||(t.hiddenByMode=!0,t.element.hide()):t.hiddenByMode&&(t.hiddenByMode=null,delete t.hiddenByMode,t.element.show())}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_toggleSelection:function(){var e=this.element.find("div.header-icon"),t=this.element.find("div.content");t.hasClass("open")?(e.addClass("icon-arrow-white-right"),e.removeClass("icon-arrow-white-down"),t.removeClass("open")):(e.removeClass("icon-arrow-white-right"),e.addClass("icon-arrow-white-down"),t.addClass("open"))},_getBottomLayer:function(){var e=0,t=this._sandbox.findAllSelectedMapLayers();return t&&t.length?t[e]:null},_updateSelection:function(e){if(!this.error){var t=this,i=t._getBottomLayer(),n="",s=(t.element.find("div.currentSelection"),t._sandbox.findMapLayerFromSelectedMapLayers(e)),r=!0;i&&(n+=i.getId(),jQuery.inArray(n,t.conf.baseLayers)>-1&&t._sandbox.postRequestByName("RemoveMapLayerRequest",[n])),s?t._sandbox.postRequestByName("RemoveMapLayerRequest",[e]):(s=t._sandbox.findMapLayerFromAllAvailable(e),r=s?s.isBaseLayer():!0),t._sandbox.postRequestByName("AddMapLayerRequest",[e,!1,r]),t._sandbox.postRequestByName("RearrangeSelectedMapLayerRequest",[e,0]),t._toggleSelection()}},_updateUISelection:function(e){var t,i,n=this,s=n._getBottomLayer(),r="",a="",o=n.element.find("div.currentSelection");s&&(r+=s.getId(),a=s.getName()),(e||r!==o.attr("data-layerId"))&&(n.element.find("li").each(function(){t=jQuery(this),t.toggleClass("selected",t.attr("data-layerId")===r)}),o.empty(),jQuery.inArray(r,n.conf.baseLayers)>-1&&(o.attr("data-layerId",r),o.attr("title",a),o.html(a)),i=n.dropdownArrowTemplate.clone(),n.element.find("div.content").hasClass("open")&&i.removeClass("icon-arrow-white-right").addClass("icon-arrow-white-down"),o.prepend(i),n.conf&&(n.conf.font&&n.changeFont(n.conf.font,n.element),n.conf.colorScheme&&n.changeColorScheme(n.conf.colorScheme,n.element)))},_createLayerSelectionElements:function(){if(!this.error){var e,t,i,n=this,s=n.conf.baseLayers,r=n.element.find("ul"),a=function(){n._updateSelection(jQuery(this).attr("data-layerId"))};for(r.empty(),i=0;i<s.length;i+=1)e=n._sandbox.findMapLayerFromAllAvailable(s[i]),e&&(t=n.layerSelectionTemplate.clone(),t.attr("data-layerId",s[i]).attr("title",e.getName()).html(e.getName()),r.append(t),t.bind("click",a));n._updateUISelection(!0)}},_createUI:function(){var e=this,t="bottom center",i=0;e.element||(e.error?e.element=e.errorTemplate.clone():(e.element=e.template.clone(),e.element.find("div.currentSelection").bind("click",function(){e._toggleSelection()}),e.element.find("div.content").toggleClass("dropdown",e.conf&&e.conf.showAsDropdown),e._createLayerSelectionElements())),e.conf&&e.conf.location&&(t=e.conf.location.classes||t,i=e.conf.location.position||i),e.getMapModule().setMapControlPlugin(e.element,t,i)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location=e,t.element&&(t.stopPlugin(),t.startPlugin())},changeColorScheme:function(e,t){t=t||this.element,t&&e&&(t.find("li").css({"background-color":e.buttonBackgroundColor,color:e.buttonColor}).filter(".selected").css({"background-color":e.buttonSelectedBackgroundColor,color:e.buttonSelectedColor}),t.find(".dropdown li").css({"background-color":e.buttonSelectedBackgroundColor,color:e.buttonSelectedColor,"border-color":e.buttonBorderColor}),t.find("div.currentSelection").css({"background-color":e.buttonBackgroundColor,color:e.buttonColor}))},changeFont:function(e,t){if(t=t||this.element,t&&e){var i="oskari-publisher-font-"+e,n=/oskari-publisher-font-/;this.getMapModule().changeCssClasses(i,n,[t])}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._visibilityPollingInterval=1500,this._visibilityCheckOrder=0,this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(e){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",e,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",e,this)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t);e.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(e){e.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(e){this._afterRearrangeSelectedMapLayerEvent(e)},MapMoveStartEvent:function(){this._visibilityCheckOrder++,this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null)},AfterMapMoveEvent:function(){this._scheduleVisiblityCheck()},AfterMapLayerAddEvent:function(e){this._parseGeometryForLayer(e.getMapLayer()),this._scheduleVisiblityCheck()}},_scheduleVisiblityCheck:function(){var e=this;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null),this._visibilityCheckOrder++,this._previousTimer=setTimeout(function(){e._checkLayersVisibility(e._visibilityCheckOrder)},this._visibilityPollingInterval)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},_parseGeometryForLayer:function(e){if(e.getGeometry&&0===e.getGeometry().length){var t=e.getGeometryWKT();if(!t)return;var i=new OpenLayers.Format.WKT,n=i.read(t);if(n){n.constructor!=Array&&(n=[n]);var s,r=[];for(s=0;s<n.length;++s)r.push(n[s].geometry);e.setGeometry(r)}}},_checkLayersVisibility:function(e){if(e===this._visibilityCheckOrder){var t,i,n=this._sandbox.findAllSelectedMapLayers();for(t=0;t<n.length;++t)i=n[t],i.isVisible()&&this.notifyLayerVisibilityChanged(i);this._visibilityCheckScheduled=!1}},_isInScale:function(e){var t=this._sandbox.getMap().getScale();return e.isInScale(t)},isInGeometry:function(e){var t=e.getGeometry();if(!t)return!0;if(0===t.length)return!0;var i,n,s=this.getMap().getExtent();for(i=0;i<t.length;++i)if(n=t[i].getBounds(),n&&n.intersectsBounds(s))return!0;return!1},notifyLayerVisibilityChanged:function(e){var t=e.isVisible(),i=e.isVisible();e.isVisible()&&(t=this._isInScale(e),i=this.isInGeometry(e)),this.getMap();
var n=this.getMapModule().getOLMapLayers(e.getId()),s=n.length?n[0]:null;t&&i&&e.isVisible()?s&&!s.getVisibility()&&(s.setVisibility(!0),s.display(!0)):s&&s.getVisibility()&&(s.setVisibility(!1),s.display(!1));var r=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(e,t,i);this._sandbox.notifyAll(r)},_afterRearrangeSelectedMapLayerEvent:function(){var e=this._sandbox.findAllSelectedMapLayers(),t=0,i=this._map.layers.length,n=this._map.getLayersByName("Markers");n.length>0&&(this._map.setLayerIndex(n[0],i),i--);var s,r,a,o,l;for(s=0,r=e.length;r>s;s++)if(null!==e[s]&&void 0!==e[s])for(l=this.getMapModule().getOLMapLayers(e[s].getId()),a=0,o=l.length;o>a;a++)this._map.setLayerIndex(l[a],t),t++}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._visible=t},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),n=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(n&&n.isVisible()!==t.getVisible()){n.setVisible(t.getVisible()),this.layersPlugin.getMap();var s,r=this.layersPlugin.getMapModule(),a=r.getOLMapLayers(n.getId());for(s=0;s<a.length;s++)a[s].setVisibility(n.isVisible()),a[s].display(n.isVisible());this.layersPlugin.notifyLayerVisibilityChanged(n)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),n=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(n){var s=this.layersPlugin.getMapModule().getClosestZoomLevel(n.getMinScale(),n.getMaxScale());if(this.layersPlugin.getMapModule().setZoomLevel(s,!0),n.getGeometry().length>0){var r=this.layersPlugin.isInGeometry(n);if(!r){var a=n.getGeometry()[0].getCentroid();this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(a.x,a.y))}}this.layersPlugin.getMapModule().notifyMoveEnd(),this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(e,t,i){this._mapLayer=e,this._inScale=1==t,this._geomMatch=0!=i},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this._afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,s=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId(),i.isLayerOfType("WMS")&&(s.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},addMapLayerToMap:function(e,t,i){if(e.isLayerOfType("WMS")){var n,s,r=[],a="layer_";for((e.isGroupLayer()||e.isBaseLayer()||1==i)&&e.getSubLayers().length>0?(r=e.getSubLayers(),a="basemap_"):r.push(e),n=0,s=r.length;s>n;n++){var o=r[n],l={layers:o.getWmsName(),transparent:!0,id:o.getId(),styles:o.getCurrentStyle().getName(),format:"image/png"},u={layerId:o.getWmsName(),isBaseLayer:!1,displayInLayerSwitcher:!1,visibility:o.isInScale(this.getMapModule().getMap().getScale()),buffer:0},h=o.getParams(),c=o.getOptions();if(o.getMaxScale()||o.getMinScale()){var p=this.getMapModule().calculateLayerResolutions(o.getMaxScale(),o.getMinScale());u.resolutions=p}var d;for(d in h)h.hasOwnProperty(d)&&(l[d]=h[d]);for(d in c)c.hasOwnProperty(d)&&(u[d]=c[d]);var m=new OpenLayers.Layer.WMS(a+o.getId(),o.getWmsUrls(),l,u);m.opacity=o.getOpacity()/100,this._map.addLayer(m),this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+o.getId()),t?this._map.setLayerIndex(m,this._map.layers.length):this._map.setLayerIndex(m,0)}}},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this._removeMapLayerFromMap(t)},_removeMapLayerFromMap:function(e){if(e.isLayerOfType("WMS")){var t;if(e.isBaseLayer()||e.isGroupLayer()){var i;if(e.getSubLayers().length>0)for(i=0;i<e.getSubLayers().length;i++){var n=e.getSubLayers()[i];t=this._map.getLayersByName("basemap_"+n.getId()),t&&t[0]&&t[0].destroy&&t[0].destroy()}else t=this._map.getLayersByName("layer_"+e.getId()),t[0].destroy()}else t=this._map.getLayersByName("layer_"+e.getId()),t[0].destroy()}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMS"))return null;if(e.isBaseLayer()||e.isGroupLayer()){if(e.getSubLayers().length>0){var t,i=[];for(t=0;t<e.getSubLayers().length;t++){var n=this._map.getLayersByName("basemap_"+e.getSubLayers()[t].getId());i.push(n[0])}return i}return this._map.getLayersByName("layer_"+e.getId())}return this._map.getLayersByName("layer_"+e.getId())},_afterChangeMapLayerOpacityEvent:function(e){var t,i=e.getMapLayer();if(i.isLayerOfType("WMS"))if(i.isBaseLayer()||i.isGroupLayer())if(i.getSubLayers().length>0){var n;for(n=0;n<i.getSubLayers().length;n++)t=this._map.getLayersByName("basemap_"+i.getSubLayers()[n].getId()),t[0].setOpacity(i.getOpacity()/100)}else t=this._map.getLayersByName("layer_"+i.getId()),null!==t[0]&&void 0!==t[0]&&t[0].setOpacity(i.getOpacity()/100);else this._sandbox.printDebug("Setting Layer Opacity for "+i.getId()+" to "+i.getOpacity()),t=this._map.getLayersByName("layer_"+i.getId()),null!==t[0]&&void 0!==t[0]&&t[0].setOpacity(i.getOpacity()/100)},_afterChangeMapLayerStyleEvent:function(e){if(e.getMapLayer().isLayerOfType("WMS")){var t=e.getMapLayer();if(!t.isBaseLayer()){var i=this._map.getLayersByName("layer_"+t.getId());null!==i&&void 0!==i&&i[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);var t;for(t in this.eventHandlers)e.registerForEventByName(this,t)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n=this._sandbox;for(t=0,i=e.length;i>t;t++){var s=e[t],r=s.getId();s.isLayerOfType("VECTOR")&&(n.printDebug("preselecting "+r),this.addMapLayerToMap(s,!0,s.isBaseLayer()))}},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",function(){this.read=function(e){return e}})},addMapLayerToMap:function(e,t){if(e.isLayerOfType("VECTOR")){var i=new OpenLayers.StyleMap,n={styleMap:i},s=e.getStyledLayerDescriptor();if(s){this._sandbox.printDebug(s);var r=this._sldFormat.read(s),a=r.namedLayers[0].userStyles,o=a[0];i.styles["default"]=o}var l=new OpenLayers.Layer.Vector("layer_"+e.getId(),n);l.opacity=e.getOpacity()/100,this._map.addLayer(l),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(l,this._map.layers.length):this._map.setLayerIndex(l,0)}},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("VECTOR")){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var i=this._map.getLayersByName("layer_"+t.getId());null!=i[0]&&i[0].setOpacity(t.getOpacity()/100)}},removeMapLayerFromMap:function(e){if(e.isLayerOfType("VECTOR")){var t=this._map.getLayersByName("layer_"+e.getId());t[0].destroy()}},getOLMapLayers:function(e){return e.isLayerOfType("VECTOR")?this._map.getLayersByName("layer_"+e.getId()):void 0},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer(),i=e.getMimeType(),n=e.getFeatures(),s=e.getOp(),r=this._map.getLayersByName("layer_"+t.getId())[0];if(r){s&&"replace"==s&&r.removeFeatures(r.features);var a=this._supportedFormats[i];if(a){var o=a.read(n);r.addFeatures(o)}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.GeoLocationPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._locationIsSet=!1},{__name:"GeoLocationPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!1},init:function(){},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._setupLocation()},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},hasSetLocation:function(){return this._locationIsSet},_setupLocation:function(){var e=this,t=function(t,i){var n=e.getMapModule().transformCoordinates(new OpenLayers.LonLat(t,i),"EPSG:4326");e.getMapModule().centerMap(n,6),e._locationIsSet=!0};if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){var i=e.coords.latitude,n=e.coords.longitude;t(n,i)},function(){},{maximumAge:36e5,timeout:6e3});else if("function"==typeof window.geoip_latitude&&"function"==typeof window.geoip_longitude){var i=geoip_latitude(),n=geoip_longitude();t(n,i)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.currentDrawMode=null,this.prefix="DrawPlugin.",e&&e.id&&(this.prefix=e.id+"."),e&&e.graphicFill&&(this.graphicFill=e.graphicFill),this.multipart=e&&e.multipart===!0},{__name:"DrawPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},startDrawing:function(e){if(e.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(this.drawLayer.destroyFeatures(),e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.modifyControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(e.drawMode)},stopDrawing:function(){this.toggleControl(),this.drawLayer.destroyFeatures()},forceFinishDraw:function(){try{this.finishedDrawing(!0)}catch(e){this.stopDrawing();var t=this._sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent")();this._sandbox.notifyAll(t)}},finishedDrawing:function(e){if(!this.multipart||e){var t,i,n=this._getActiveDrawControls();for(t=0;t<n.length;t++)if(typeof this.drawControls[n[t]].handler.finishGeometry==typeof Function){switch(n[t]){case"line":if(this.drawControls.line.handler.line.geometry.components.length<2)continue;break;case"area":if(i=this.drawControls.area.handler.polygon.geometry.components,i[i.length-1].components.length<3)continue}this.drawControls[n[t]].handler.finishGeometry()}this.toggleControl()}if(!this.editMode){var s=this.drawLayer.features.length-1;this.modifyControls.select.select(this.drawLayer.features[s])}var r;!this.multipart||e?(r=this._sandbox.getEventBuilder("DrawPlugin.FinishedDrawingEvent")(this.getDrawing(),this.editMode),this._sandbox.notifyAll(r)):(r=this._sandbox.getEventBuilder("DrawPlugin.AddedFeatureEvent")(this.getDrawing(),this.currentDrawMode),this._sandbox.notifyAll(r))},toggleControl:function(e){this.currentDrawMode=e;var t,i;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&(i=this.drawControls[t],e===t?i.activate():i.deactivate())},init:function(e){var t=this;if(this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",e,t),stopDrawingHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",e,t),getGeometryHandler:Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",e,t)},this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"DrawLayer",{eventListeners:{featuresadded:function(){t.finishedDrawing()},vertexmodified:function(){t._sendActiveGeometry(t.getDrawing())}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Path,{callbacks:{modify:function(e,i){t._sendActiveGeometry(t.getActiveDrawing(i.geometry),"line")}}}),area:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Polygon,{handlerOptions:{holeModifier:"altKey"},callbacks:{modify:function(e,i){t._sendActiveGeometry(t.getActiveDrawing(i.geometry),"area")}}}),box:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}})},null!==this.graphicFill&&void 0!==this.graphicFill){var i,n=this.graphicFill,s=new OpenLayers.Format.SLD,r=s.read(n);if(r&&r.namedLayers)for(i in r.namedLayers)if(r.namedLayers.hasOwnProperty(i)){this.drawLayer.styleMap.styles["default"]=r.namedLayers[i].userStyles[0],this.drawLayer.redraw();break}}this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(t.drawLayer,{standalone:!0})},this.modifyControls.select=new OpenLayers.Control.SelectFeature(t.drawLayer,{onBeforeSelect:this.modifyControls.modify.beforeSelectFeature,onSelect:this.modifyControls.modify.selectFeature,onUnselect:this.modifyControls.modify.unselectFeature,scope:this.modifyControls.modify}),this._map.addLayers([t.drawLayer]);var a;for(a in this.drawControls)this.drawControls.hasOwnProperty(a)&&this._map.addControl(this.drawControls[a]);for(a in this.modifyControls)this.modifyControls.hasOwnProperty(a)&&this._map.addControl(this.modifyControls[a]);this.modifyControls.modify.activate()},getDrawing:function(){if(0===this.drawLayer.features.length)return null;var e=this.drawLayer.features[0].geometry.CLASS_NAME;if("OpenLayers.Geometry.MultiPoint"===e||"OpenLayers.Geometry.MultiLineString"===e||"OpenLayers.Geometry.MultiPolygon"===e)return this.drawLayer.features[0].geometry;var t,i=null,n=[];for(t=0;t<this.drawLayer.features.length;t++)n.push(this.drawLayer.features[t].geometry);switch(e){case"OpenLayers.Geometry.Point":i=new OpenLayers.Geometry.MultiPoint(n);break;case"OpenLayers.Geometry.LineString":i=new OpenLayers.Geometry.MultiLineString(n);break;case"OpenLayers.Geometry.Polygon":i=new OpenLayers.Geometry.MultiPolygon(n)}return i},getActiveDrawing:function(e){var t,i=this.getDrawing();return null!=i?(t=i.clone(),t.addComponent(e),t):e},_getActiveDrawControls:function(){var e,t=[];for(e in this.drawControls)this.drawControls.hasOwnProperty(e)&&this.drawControls[e].active&&t.push(e);return t},_sendActiveGeometry:function(e,t){var i,n,s=this._sandbox.getEventBuilder("DrawPlugin.ActiveDrawingEvent");if(null==t)switch(n=e.CLASS_NAME){case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiLineString":t="line";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.MultiPolygon":t="area";break;default:return}s&&(i=s(e,t),this._sandbox.notifyAll(i))},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this),e.addRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.addRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.addRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(e){e.removeRequestHandler("DrawPlugin.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.removeRequestHandler("DrawPlugin.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.removeRequestHandler("DrawPlugin.GetGeometryRequest",this.requestHandlers.getGeometryHandler),e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.AddedFeatureEvent",function(e,t){this._drawing=e,this._drawingMode=t},{__name:"DrawPlugin.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.FinishedDrawingEvent",function(e,t){this._drawing=e,this._modification=1==t},{__name:"DrawPlugin.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.SelectedDrawingEvent",function(e,t){this._creator=null,this._place=e,this._dblClick=t},{__name:"DrawPlugin.SelectedDrawingEvent",getName:function(){return this.__name},getPlace:function(){return this._place},isDblClick:function(){return this._dblClick}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.event.ActiveDrawingEvent",function(e,t){this._drawing=e,this._drawMode=t},{__name:"DrawPlugin.ActiveDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawMode:function(){return this._drawMode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequest",function(e){this._creator=null,this._callbackMethod=e},{__name:"DrawPlugin.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getCallBack();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.GetGeometryRequestPluginHandler] geometry requested");var n=this.drawPlugin.getDrawing();i(n.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequest",function(e){if(e.geometry)this._geometry=e.geometry;else if(e.continueCurrent)this._continueCurrent=e.continueCurrent;else{if(!this.drawModes[e.drawMode])throw"Unknown draw mode '"+e.drawMode+"'";this._drawMode=e.drawMode}},{__name:"DrawPlugin.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent?!0:!1},drawModes:{point:"point",line:"line",area:"area",cut:"cut",box:"box"},getDrawMode:function(){return this._drawMode},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getDrawMode();this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StartDrawingRequestPluginHandler] Start Drawing: "+i),this.drawPlugin.startDrawing({drawMode:t.getDrawMode(),geometry:t.getGeometry(),isModify:t.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequest",function(e){this._creator=null,this._isCancel=1==e},{__name:"DrawPlugin.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin.request.StopDrawingRequestPluginHandler] Stop drawing"),t.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequest",function(e,t){this._op=e,this._data=t||{}},{__name:"Toolbar.ToolContainerRequest",getName:function(){return this.__name},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolContainerRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){e.getSandbox(),"set"==t.getOp()?this._toolbar.setToolContent(t.getData()):"reset"==t.getOp()&&this._toolbar.resetToolContent(t.getData())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ToolSelectionRequest",function(e){this._toolId=e},{tools:{navigate:"map_control_navigate_tool",zoom:"map_control_zoom_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",select:"map_control_select_tool",draw_area:"map_control_draw_area_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(e){this._toolId=e},getNamespace:function(){return-1==this._toolId.indexOf(".")?"":this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){return-1==this._toolId.indexOf(".")?this._toolId:this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(e,t){this.sandbox=e,this.controlsPlugin=t},{handleRequest:function(e,t){t.getToolId(),t.getNamespace();var i,n=t.getToolName();if("map_control_tool_prev"===n)i=this.sandbox.findRegisteredModuleInstance("StateHandler"),i&&i.historyMovePrevious();else if("map_control_tool_next"===n)i=this.sandbox.findRegisteredModuleInstance("StateHandler"),i&&i.historyMoveNext();else if("map_control_select_tool"===n){var s=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin");s&&s.clearBbox()}else"map_control_zoom_tool"===n&&this.controlsPlugin._zoomBoxTool?this.controlsPlugin._zoomBoxTool.activate():"map_control_measure_tool"===n&&this.controlsPlugin._measureControls?this.controlsPlugin._measureControls.line.activate():"map_control_measure_area_tool"===n&&this.controlsPlugin._measureControls&&this.controlsPlugin._measureControls.area.activate()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequest",function(e,t,i){this._layerId=e,this._forced=1==t,this._parameters=i},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){return this._forced},getParameters:function(){return this._parameters},setParameters:function(e){this._parameters=e}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i,n,s,r=t.getLayerId(),a=t.isForced(),o=t.getParameters(),l=this.sandbox,u=l.findMapLayerFromSelectedMapLayers(r);if(u)if(o&&u.isLayerOfType("WMS")){if(n=this.mapModule.getOLMapLayers(r),s=0,n)for(s=n.length,i=0;i<n.length;++i)n[i].mergeNewParams(o);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] WMS layer / merge new params: "+r+", found "+s)}else{if(n=this.mapModule.getOLMapLayers(r),s=0,n)for(s=n.length,i=0;i<n.length;++i)n[i].redraw(a);this.sandbox.printDebug("[MapLayerUpdateRequestHandler] Layer / update layer "+r+", found "+s)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i=t.getCenterX(),n=t.getCenterY(),s=t.getMarker(),r=t.getZoom(),a=t.getSrsName(),o=new OpenLayers.LonLat(i,n);if(a&&this.mapModule.getProjection()!==a){var l=Proj4js.defs[a];if(!l)throw"SrsName not supported!";o=this.mapModule.transformCoordinates(o,a)}this.mapModule.moveMapToLanLot(o,r,!1),(r||0===r)&&("OpenLayers.Bounds"===r.CLASS_NAME?this.mapModule._map.zoomToExtent(r):this.mapModule._map.zoomTo(r)),this.mapModule._updateDomain(),s&&this.mapModule._drawMarker(),this.mapModule.notifyMoveEnd(),this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapClickedEvent",function(e,t,i){this._lonlat=e,this._mouseX=t,this._mouseY=i},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.GetInfoResultEvent",function(e){this._data=e},{__name:"GetInfoResultEvent",getName:function(){return this.__name},getData:function(){return this._data}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapSizeChangedEvent",function(e,t){this._width=e,this._height=t},{__name:"MapSizeChangedEvent",getName:function(){return this.__name},getWidth:function(){return this._width},getHeight:function(){return this._height}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ClearHistoryRequest",function(){},{__name:"ClearHistoryRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",function(e,t){this.mapModule=t,this.sandbox=e},{handleRequest:function(){this.mapModule.clearNavigationHistory()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.templates={},this.element=null,this.__parent=null,this._slider=null,this._zoombar_messages={},this._suppressEvents=!1,this.conf=e},{__name:"Portti2Zoombar",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){this.templates.main=jQuery('<div class="oskariui mapplugin pzbDiv zoombar" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"><div class="pzbDiv-plus"  title="Katu"></div><input type=\'hidden\' /><div class="slider"></div><div class="pzbDiv-minus"  title="Koko Maa"></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){var t;this._sandbox=e||this.getMapModule().getSandbox(),this._sandbox.register(this);for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&this._sandbox.registerForEventByName(this,t);this._draw(),this._setZoombarValue(this._map.getZoom())},stopPlugin:function(){var e,t=this;t.element&&(t.element.remove(),t._slider.remove(),delete t.element);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(t),t._sandbox=null},_draw:function(){var e=this;e.__parent||(e.__parent=e._map.div),e.element||(e.element=e.templates.main.clone());var t="pzb-input-"+e.getName(),i="pzb-slider-"+e.getName(),n=e.element.find("div.slider"),s="top right",r=2;e.element.find("input").attr("id",t),n.attr("id",i),e.element.mousedown(function(t){e.isInLayerToolsEditMode||t.stopPropagation()
}),e.conf&&e.conf.location&&(s=e.conf.location.classes||s,r=e.conf.location.position||r),e.getMapModule().setMapControlPlugin(e.element,s.replace("with-panbuttons",""),r),n=e.element.find("div.slider"),n.css("height",11*e._map.getNumZoomLevels()+"px"),e._slider=n.slider({orientation:"vertical",range:"min",min:0,max:e._map.getNumZoomLevels()-1,value:e._map.getZoom(),slide:function(t,i){e.getMapModule().zoomTo(i.value)}});var a=e.element.find(".pzbDiv-plus");a.bind("click",function(){e.isInLayerToolsEditMode||e._slider.slider("value")<e._map.getNumZoomLevels()&&e.getMapModule().zoomTo(e._slider.slider("value")+1)});var o=e.element.find(".pzbDiv-minus");o.bind("click",function(){e.isInLayerToolsEditMode||e._slider.slider("value")>0&&e.getMapModule().zoomTo(e._slider.slider("value")-1)}),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,e.element),e._setLayerToolsEditMode(e.getMapModule().isInLayerToolsEditMode())},_setZoombarValue:function(e){var t=this;t._slider&&(this._suppressEvents=!0,t._slider.slider("value",e),this._suppressEvents=!1)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,2)},eventHandlers:{AfterMapMoveEvent:function(e){if(this._sandbox){var t=this;t._setZoombarValue(e.getZoom())}},LayerToolsEditModeEvent:function(e){this._sandbox&&this._setLayerToolsEditMode(e.isInMode())}},_setLayerToolsEditMode:function(e){this.isInLayerToolsEditMode=e,this._slider&&this.isInLayerToolsEditMode?this._slider.slider("option","disabled",!0):this._slider&&this._slider.slider("option","disabled",!1)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){},changeToolStyle:function(e,t){if(t=t||this.element,e&&t){var i=this.getMapModule().getImageUrl(),n=i+"/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/images/",s=e.val,r=n+"zoombar-"+s+".png",a=n+"zoombar-cursor-"+s+".png",o=n+"zoombar_minus-"+s+".png",l=n+"zoombar_plus-"+s+".png",u=t.find(".ui-slider-vertical"),h=t.find(".ui-slider-handle"),c=t.find(".pzbDiv-plus"),p=t.find(".pzbDiv-minus"),d=t.find("div.slider"),m=s&&s.match(/^rounded/),f=this._map.getNumZoomLevels()*e.heightCenter;null===e.val?(u.css({"background-image":"",width:"","margin-left":""}),h.css({"background-image":"",width:"",height:"","margin-left":""}),c.css({"background-image":"",width:"",height:""}),p.css({"background-image":"",width:"",height:""}),d.css({height:f+"px"})):(u.css({"background-image":'url("'+r+'")',width:e.widthCenter,"margin-left":"0"}),h.css({"background-image":'url("'+a+'")',width:e.widthCursor,height:e.heightCursor,"margin-left":m?"2px":"0"}),c.css({"background-image":'url("'+l+'")',width:e.widthPlus,height:e.heightPlus}),p.css({"background-image":'url("'+o+'")',width:e.widthMinus,height:e.heightMinus}),d.css({height:f+"px"}))}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(e){var t=this;t.mapModule=null,t.pluginName=null,t._sandbox=null,t._map=null,t.templates={},t.element=null,t.__parent=null,t.conf=e},{__name:"PanButtons",getClazz:function(){return"Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"},getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){var e=(new Date).getTime().toString();this.templates.main=jQuery('<div class="mapplugin panbuttonDiv panbuttons" data-clazz="Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"><div>  <img class="panbuttonDivImg" usemap="#panbuttons_'+e+'">'+'    <map name="panbuttons_'+e+'">'+'      <area shape="circle" '+'class="panbuttons_center" '+'coords="45,45,20" href="#">'+'      <area shape="polygon" '+'class="panbuttons_left" '+'coords="13,20,25,30,20,45,27,65,13,70,5,45" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_up" '+'coords="30,8,45,4,60,8,60,23,45,20,30,23" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_right" '+'coords="79,20,67,30,72,45,65,65,79,70,87,45" '+'href="#">'+'      <area shape="polygon" '+'class="panbuttons_down" '+'coords="30,82,45,86,60,82,60,68,45,70,30,68" '+'href="#">'+"    </map>"+"  </img>"+"</div>"+"</div>")},register:function(){},unregister:function(){},startPlugin:function(e){var t,i=this;i._sandbox=e||i.getMapModule().getSandbox(),i._sandbox.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&i._sandbox.registerForEventByName(i,t);this._draw()},stopPlugin:function(){var e,t=this;t.element&&(t.element.remove(),delete t.element);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&t._sandbox.unregisterFromEventByName(t,e);t._sandbox.unregister(this)},setLocation:function(e){var t=this;t.conf||(t.conf={}),t.conf.location.classes=e,t.element&&t.getMapModule().setMapControlPlugin(t.element,e,0)},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.element||(e.element=e.templates.main.clone());var t=e.element,i="top right",n=0;e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.mapModule.setMapControlPlugin(t,i,n);var s=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",r=t.find(".panbuttonDivImg");r.attr("src",s+"empty.png"),e.conf&&e.conf.toolStyle&&e.changeToolStyle(e.conf.toolStyle,t);var a=t.find(".panbuttons_center");a.bind("mouseover",function(){r.addClass("root")}),a.bind("mouseout",function(){r.removeClass("root")}),a.bind("click",function(){if(!e.isInLayerToolsEditMode){var t="StateHandler.SetStateRequest",i=e.getMapModule(),n=i.getSandbox(),s=n.getRequestBuilder(t);s?n.request(e,s()):n.resetState()}});var o=t.find(".panbuttons_left");o.bind("mouseover",function(){r.addClass("left")}),o.bind("mouseout",function(){r.removeClass("left")}),o.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(-100,0,!0)});var l=t.find(".panbuttons_right");l.bind("mouseover",function(){r.addClass("right")}),l.bind("mouseout",function(){r.removeClass("right")}),l.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(100,0,!0)});var u=t.find(".panbuttons_up");u.bind("mouseover",function(){r.addClass("up")}),u.bind("mouseout",function(){r.removeClass("up")}),u.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(0,-100,!0)});var h=t.find(".panbuttons_down");h.bind("mouseover",function(){r.addClass("down")}),h.bind("mouseout",function(){r.removeClass("down")}),h.bind("click",function(){e.isInLayerToolsEditMode||e.getMapModule().panMapByPixels(0,100,!0)}),t.mousedown(function(t){if(!e.isInLayerToolsEditMode){var i=Math.round(.5*r[0].width),n=r.offset(),s=n.left+i,a=n.top+i;Math.sqrt(Math.pow(s-t.pageX,2)+Math.pow(a-t.pageY,2))<i&&t.stopPropagation()}}),this.isInLayerToolsEditMode=e.getMapModule().isInLayerToolsEditMode()},eventHandlers:{LayerToolsEditModeEvent:function(e){this.isInLayerToolsEditMode=e.isInMode()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){},changeToolStyle:function(e,t){if(t=t||this.element){var i=t.find("img.panbuttonDivImg");if(null===e)i.removeAttr("style");else{var n=this.getMapModule().getImageUrl(),s=n+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",r=s+"panbutton-sprites-"+e+".png";i.css({"background-image":'url("'+r+'")'})}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.event.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-base","Bundle-Name":"mapframework.event.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-base","Oskari.mapframework.event.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used"},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/enhancement/start-map-with-link-enhancement.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapResizeEnabledRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapResizeEnabledRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/request/MapWindowFullScreenRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapfull/css/style.css"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapfull","Bundle-Name":"mapframework.mapfull.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"mapframework.mapfull.Bundle",Title:"mapframework.mapfull.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("mapfull","Oskari.mapframework.bundle.mapfull.MapFullBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance",function(){this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.state=void 0,this.mapDivId="mapdiv",this.contentMapDivId="contentMap"},{getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},_createUi:function(){var e=this,t=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",e.conf.imageLocation,e.conf.mapOptions);e.mapmodule=t;var i=e.sandbox.register(t);if(e.conf.size)jQuery("#"+e.mapDivId).width(e.conf.size.width),jQuery("#"+e.mapDivId).height(e.conf.size.height);else{var n,s=function(){if(null===e.resizeEnabled||void 0===e.resizeEnabled||e.resizeEnabled){var i=jQuery("#"+e.contentMapDivId),n=jQuery("#"+e.mapDivId),s=jQuery(window).height();i.height(s);var r=i.find(".oskariui-menutoolbar");r.length>0&&r.is(":visible")?n.height(s-r.height()):n.height(s),t.updateSize()}};jQuery(window).resize(function(){clearTimeout(n),n=setTimeout(s,100)}),s(),window.setTimeout(s,1e3)}if(t.start(e.sandbox),i.render(e.mapDivId),e.conf.plugins){var r,a=this.conf.plugins;for(r=0;r<a.length;r++)a[r].instance=Oskari.clazz.create(a[r].id,a[r].config),t.registerPlugin(a[r].instance),t.startPlugin(a[r].instance)}e.map=i},start:function(){Proj4js.defs={"EPSG:3067":"+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs","EPSG:4326":"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"};var e=this,t=e.conf;e.conf.projectionDefs&&(Proj4js.defs=e.conf.projectionDefs);var i=(Oskari.getLang(),Oskari.clazz.create("Oskari.mapframework.core.Core"));e.core=i;var n=i.getSandbox();e.sandbox=n;var s=(t?t.sandbox:null)||"sandbox";Oskari.setSandbox(s,n),jQuery.ajax({type:"POST",url:t.globalMapAjaxUrl+"action_route=GetSupportedLocales",timestamp:(new Date).getTime(),success:function(e){Oskari.setSupportedLocales(e.supportedLocales)},error:function(){}}),t&&(t.mapElement&&(e.mapDivId=t.mapElement),t.mapContainer&&(e.contentMapDivId=t.mapContainer)),n.setUser(t.user),n.setAjaxUrl(t.globalMapAjaxUrl);var r=e._createServices(t),a=[];a.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement")),i.init(r,a),e._createUi();var o,l,u=n.getService("Oskari.mapframework.service.MapLayerService"),h=t.layers;if(h)for(o=0;o<h.length;o++)l=u.createMapLayer(h[o]),u.addLayer(l,!0);n.registerAsStateful(e.mediator.bundleId,this);var c=!1;if(e.mapmodule.isPluginActivated("GeoLocationPlugin")){var p=e.mapmodule.getPluginInstance("GeoLocationPlugin");c=p.hasSetLocation()}e.setState(e.state,c),e.mapResizeEnabledRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",e),e.mapWindowFullScreenRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",e),n.addRequestHandler("MapFull.MapResizeEnabledRequest",e.mapResizeEnabledRequestHandler),n.addRequestHandler("MapFull.MapWindowFullScreenRequest",e.mapWindowFullScreenRequestHandler)},_teardownState:function(e){var t,i=this.sandbox.findAllSelectedMapLayers(),n=this.sandbox.getRequestBuilder("RemoveMapLayerRequest");for(t=0;t<i.length;t++)this.sandbox.request(e.getName(),n(i[t].getId()))},_createServices:function(e){var t=this,i=[],n=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",e.globalMapAjaxUrl+"action_route=GetMapLayers&lang="+Oskari.getLang(),t.core.getSandbox());return i.push(n),"true"==e.disableDevelopmentMode&&t.core.disableDebug(),i},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId),alert("Stopped!")},setState:function(e,t){var i,n,s,r,a,o,l,u=this,h=u.sandbox.findRegisteredModuleInstance("MainMapModule");if(u._teardownState(h),e.east&&t!==!0&&u.sandbox.getMap().moveTo(e.east,e.north,e.zoom),u.sandbox.syncMapState(!0),e.selectedLayers)for(i=u.sandbox.getRequestBuilder("AddMapLayerRequest"),n=u.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),s=u.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),r=u.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest"),a=e.selectedLayers.length,o=0;a>o;++o)l=e.selectedLayers[o],u.sandbox.request(h.getName(),i(l.id,!0)),u.sandbox.request(h.getName(),s(l.id,l.hidden!==!0)),l.style&&u.sandbox.request(h.getName(),r(l.id,l.style)),l.opacity&&u.sandbox.request(h.getName(),n(l.id,l.opacity))},getState:function(){var e,t,i,n=this.sandbox.getMap(),s=this.sandbox.findAllSelectedMapLayers(),r=(n.getZoom(),n.getX()),a=n.getY(),o={north:a,east:r,zoom:n.getZoom(),srs:n.getSrsName(),selectedLayers:[]};for(e=0;e<s.length;e++)t=s[e],i={id:t.getId(),opacity:t.getOpacity()},t.isVisible()||(i.hidden=!0),t.getCurrentStyle&&t.getCurrentStyle()&&t.getCurrentStyle().getName()&&"!default!"!==t.getCurrentStyle().getName()&&(i.style=t.getCurrentStyle().getName()),o.selectedLayers.push(i);return o},getStateParameters:function(){var e=this.getState(),t="zoomLevel="+e.zoom+"&coord="+e.east+"_"+e.north+"&mapLayers=",i=e.selectedLayers,n="",s=null,r=0,a=0;if(this.conf&&this.conf.link)for(var o in this.conf.link)t=o+"="+this.conf.link[o]+"&"+t;for(r=0,a=i.length;a>r;r++)s=i[r],s.hidden||(""!==n&&(n+=","),n+=s.id+"+"+s.opacity,n+=s.style?"+"+s.style:"+");return t+n},toggleFullScreen:function(){jQuery("#"+this.contentMapDivId).toggleClass("oskari-map-window-fullscreen"),this.mapmodule.updateSize()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]}),Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(e){function t(e){return e===!0||"true"===e}e.printDebug("Checking if map is started with link...");var i=e.getRequestParameter("coord"),n=e.getRequestParameter("zoomLevel");e.getRequestParameter("mapLayers");var s=e.getRequestParameter("showMarker"),r=e.getRequestParameter("isCenterMarker"),a=e.getRequestParameter("keepLayersOrder");if(null===a&&(a=!0),e.getMap().setMarkerVisible(t(s)||t(r)),null!==i&&null!==n){var o;o=i.indexOf("_")>=0?i.split("_"):i.split("%20");var l=o[0],u=o[1];if(null===l||null===u)return e.printDebug("Could not parse link location. Skipping."),void 0;e.printDebug("This is startup by link, moving map..."),e.getMap().moveTo(l,u,n)}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequest",function(e){this._creator=null,this._resizeEnabled=e},{__name:"MapFull.MapResizeEnabledRequest",getName:function(){return this.__name},getResizeEnabled:function(){return this._resizeEnabled}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapResizeEnabledRequestHandler",function(e){this.mapfull=e},{handleRequest:function(e,t){this.mapfull.resizeEnabled=t.getResizeEnabled()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequest",function(){this._creator=null},{__name:"MapFull.MapWindowFullScreenRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.request.MapWindowFullScreenRequestHandler",function(e){this.mapfull=e},{handleRequest:function(){this.mapfull.toggleFullScreen()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.core.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-enhancement-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-key-listener-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-base","Bundle-Name":"mapframework.core.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("core-base","Oskari.mapframework.core.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=[],this._mapLayersHighlighted=[],this._map=null,this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this),Oskari.$("sandbox")||Oskari.$("sandbox",this._sandbox),this._services=[],this._servicesByQName={},this._debug=!1,this._ctrlKeyDown=!1,this._allowMultipleHighlightLayers=!1,this._availableRequestsByName={},this._availableEventsByName={},this.externalHandlerCls={}},{init:function(e,t){this.printDebug("Initializing core...");var i;if(this._sandbox,this._services=e,e)for(i=0;i<e.length;i++)this.registerService(e[i]);this.printDebug("Sandbox ready, building up domain..."),this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map"),this.enhancements=t,this._doEnhancements(this.enhancements),this.printDebug("Modules started. Core ready.")},dispatch:function(e){this._sandbox.notifyAll(e)},defaultRequestHandlers:{AddMapLayerRequest:function(e){return this._handleAddMapLayerRequest(e),!0},RemoveMapLayerRequest:function(e){return this._handleRemoveMapLayerRequest(e),!0},ShowMapLayerInfoRequest:function(e){return this._handleShowMapLayerInfoRequest(e),!0},RearrangeSelectedMapLayerRequest:function(e){return this._handleRearrangeSelectedMapLayerRequest(e),!0},ChangeMapLayerOpacityRequest:function(e){return this._handleChangeMapLayerOpacityRequest(e),!0},ChangeMapLayerStyleRequest:function(e){return this._handleChangeMapLayerStyleRequest(e),!0},HighlightMapLayerRequest:function(e){return this._handleHighlightMapLayerRequest(e),!0},HighlightWFSFeatureRequest:function(e){return this.handleHighlightWFSFeatureRequest(e),!0},HideMapMarkerRequest:function(e){return this._handleHideMapMarkerRequest(e),!0},DimMapLayerRequest:function(e){return this._handleDimMapLayerRequest(e.getMapLayerId()),!0},CtrlKeyDownRequest:function(){return this._handleCtrlKeyDownRequest(),!0},CtrlKeyUpRequest:function(){return this._handleCtrlKeyUpRequest(),!0},__default:function(e){return this.printWarn("!!!"),this.printWarn("  There is no handler for"),this.printWarn("  '"+e.getName()+"'"),!1}},processRequest:function(e){var t,i,n=e.getName(),s=this.defaultRequestHandlers[n];return s?t=s.apply(this,[e]):(i=this.externalHandlerCls[n],i?t=i.handleRequest(this,e):(s=this.defaultRequestHandlers.__default,t=s.apply(this,[e]))),delete e,t},addRequestHandler:function(e,t){this.externalHandlerCls[e]=t},removeRequestHandler:function(e,t){this.externalHandlerCls[e]===t&&(this.externalHandlerCls[e]=null)},_getQNameForRequest:function(e){var t,i=this._availableRequestsByName[e];if(!i){this.printDebug("#!#!# ! Updating request metadata...");var n=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(t in n)if(n.hasOwnProperty(t)){var s=n[t],r=s._class.prototype.getName();this._availableRequestsByName[r]=t}this.printDebug("#!#!# ! Finished Updating request metadata..."),i=this._availableRequestsByName[e]}return i},getRequestBuilder:function(e){var t=this._getQNameForRequest(e);return t?Oskari.clazz.builder(t):void 0},_getQNameForEvent:function(e){var t=this._availableEventsByName[e];if(!t){this.printDebug("#!#!# ! Updating event metadata...");var i,n=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(i in n)if(n.hasOwnProperty(i)){var s=n[i],r=s._class.prototype.getName();this._availableEventsByName[r]=i}this.printDebug("#!#!# ! Finished Updating event metadata..."),t=this._availableEventsByName[e]}return t},getEventBuilder:function(e){var t=this._getQNameForEvent(e);return t?Oskari.clazz.builder(t):void 0},disableDebug:function(){this._debug=!1},enableDebug:function(){this._debug=!0},printDebug:function(e){this._debug&&null!==window.console&&void 0!==window.console&&(null!==window.console.debug&&void 0!==window.console.debug?console.debug(e):null!==window.console.log&&void 0!==window.console.log&&console.log(e))},printWarn:function(e){null!==window.console&&void 0!==window.console&&console.warn(e)},registerService:function(e){this._servicesByQName[e.getQName()]=e},getService:function(e){return this._servicesByQName[e]},getMap:function(){return this._map},getSandbox:function(){return this._sandbox},getRequestParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t,i="[\\?&]"+e+"=([^&#]*)",n=new RegExp(i),s=n.exec(window.location.href);return t=null===s||void 0===s?null:s[1]},getObjectName:function(e){return e.__name},getObjectCreator:function(e){return e._creator},setObjectCreator:function(e,t){e._creator=t},copyObjectCreatorToFrom:function(e,t){e._creator=t._creator}}),Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{_doEnhancements:function(e){var t;for(t=0;t<e.length;t++)e[t].enhance(this)}}),Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{_handleCtrlKeyDownRequest:function(){this._ctrlKeyDown=!0},_handleCtrlKeyUpRequest:function(){this._ctrlKeyDown=!1},isCtrlKeyDown:function(){return this._ctrlKeyDown}}),Oskari.clazz.define("Oskari.mapframework.request.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-base","Bundle-Name":"mapframework.request.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-base","Oskari.mapframework.request.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.Request",function(){throw this._creator=null,"mapframework.request.Request should not be used"},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),Oskari.clazz.define("Oskari.mapframework.domain.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/domain/AbstractLayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/wmslayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/vectorlayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/map.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/style.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/tool.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/user.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"domain","Bundle-Name":"mapframework.domain.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.domain.Bundle",Title:" mapframework.domain.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("domain","Oskari.mapframework.domain.Bundle"),Oskari.clazz.define("Oskari.mapframework.domain.AbstractLayer",function(e,t){var i=this;i._id=null,i._name=null,i._description=null,i._type=null,i._layerType="",i._params=e||{},i._options=t||{},i._metaType=null,i._maxScale=null,i._minScale=null,i._visible=null,i._opacity=100,i._isSticky=null,i._inspireName=null,i._organizationName=null,i._dataUrl=null,i._orderNumber=null,i._subLayers=[],i._styles=[],i._currentStyle=null,i._legendImage=null,i._featureInfoEnabled=null,i._queryable=null,i._queryFormat=null,i._permissions={},i._geometry=[],i._geometryWKT=null,i._tools=[],i._metadataIdentifier=null,i._backendStatus=null,i._featureData=!1,i._layerUrls=[],i._baseLayerId=-1},{setLocalization:function(e){var t,i,n={},s={},r={},a={};for(t in e)e.hasOwnProperty(t)&&(i=e[t],i.name&&(n[t]=i.name),i.subtitle&&(s[t]=i.subtitle),i.inspire&&(r[t]=i.inspire),i.orgName&&(a[t]=i.orgName));for(t in n)if(n.hasOwnProperty(t)){this.setName(n);break}for(t in s)if(s.hasOwnProperty(t)){this.setDescription(s);break}for(t in r)if(r.hasOwnProperty(t)){this.setInspireName(r);break}for(t in a)if(a.hasOwnProperty(t)){this.setOrganizationName(a);break}},setId:function(e){this._id=e},getId:function(){return this._id},setParentId:function(e){this._baseLayerId=e},getParentId:function(){return this._baseLayerId?this._baseLayerId:-1},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(e){return this._name&&"object"==typeof this._name?e?this._name[e]:this._name[Oskari.getLang()]:this._name},setType:function(e){this._type=e},getType:function(){return this._type},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(e){return this._organizationName&&"object"==typeof this._organizationName?e?this._organizationName[e]:this._organizationName[Oskari.getLang()]:this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(e){return this._inspireName&&"object"==typeof this._inspireName?e?this._inspireName[e]:this._inspireName[Oskari.getLang()]:this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(e){return this._description&&"object"==typeof this._description?e?this._description[e]:this._description[Oskari.getLang()]:this._description},addSubLayer:function(e){var t=this.getSubLayers();for(i=0,len=t.length;len>i;++i)if(t[i].getId()===e.getId())return!1;return t.push(e),!0},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},setOpacity:function(e){this._opacity=e},getOpacity:function(){return null===this._opacity||void 0===this._opacity?100:this._opacity},setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null,delete this._permissions[e]},getPermission:function(e){return this._permissions[e]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},addStyle:function(e){if(e&&e.getName&&"function"==typeof e.getName){for(var t=!1,i=0;i<this.getStyles().length;++i){var n=this.getStyles()[i];if(n.getName()==e.getName()){t=!0;break}}t||this.getStyles().push(e)}},getStyles:function(){return this._styles||(this._styles=[]),this._styles},selectStyle:function(e){for(var t=this,i=0;i<t.getStyles().length;i++){var n=t.getStyles()[i];if(n.getName()===e)return t._currentStyle=n,""!==n.getLegend()&&(t._legendImage=n.getLegend()),void 0}t._currentStyle||(this._currentStyle=this._createEmptyStyle())},_createEmptyStyle:function(){var e=Oskari.clazz.create("Oskari.mapframework.domain.Style");return e.setName(""),e.setTitle(""),e.setLegend(""),e},getCurrentStyle:function(){return this._currentStyle||this.selectStyle(""),this._currentStyle},getTools:function(){return this._tools},setTools:function(e){this._tools=e},addTool:function(e){this._tools.push(e)},getTool:function(e){var t,i=null;if(this._tools.length>0&&""!==e)for(t=0;t<this._tools.length;t++)if(i=this._tools[t],i.getName()===e)return i;return i},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){var e,t=!1;if(this._legendImage)t=!0;else for(e=0;e<this.getStyles().length;++e)if(this.getStyles()[e].getLegend()){t=!0;break}return t},setSticky:function(e){this._isSticky=e},isSticky:function(){return this._isSticky},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"
},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return"GROUP_LAYER"===this._type},isBaseLayer:function(){return"BASE_LAYER"===this._type},isInScale:function(e){var t=!1,i=this.getSubLayers();return e=e||Oskari.getSandbox().getMap().getScale(),i&&i.length?t=_.any(i,function(t){return t.isInScale(e)}):((e>this.getMaxScale()||!this.getMaxScale())&&e<this.getMinScale()||!this.getMinScale())&&(t=!0),t},getLayerType:function(){return this._layerType.toLowerCase()},isLayerOfType:function(e){return e&&e.toLowerCase()===this.getLayerType()},getIconClassname:function(){var e;return e=this.isBaseLayer()?"layer-base":this.isGroupLayer()?"layer-group":"layer-"+this.getLayerType()},getParams:function(){return this._params},getOptions:function(){return this._options},hasFeatureData:function(){return this._featureData},addLayerUrl:function(e){this._layerUrls.push(e)},getLayerUrls:function(){return this._layerUrls}}),Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._wmsLayerName=null,this._wmsUrls=[],this._layerType="WMS"},{addWmsUrl:function(e){this._wmsUrls.push(e)},getWmsUrls:function(){return this._wmsUrls},setWmsUrls:function(e){this._wmsUrls=e},setWmsName:function(e){this._wmsName=e},getWmsName:function(){return this._wmsName},setVersion:function(e){this._version=e},getVersion:function(){return this._version}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._sldspec=null,this._layerType="VECTOR"},{setStyledLayerDescriptor:function(e){this._sldspec=e},getStyledLayerDescriptor:function(){return this._sldspec}},{extend:["Oskari.mapframework.domain.AbstractLayer"]}),Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null,this._centerY=null,this._zoom=null,this._scale=null,this._bbox=null,this._markerVisible=null,this.width=null,this.height=null,this.resolution=null,this.extent=null,this.maxExtent=null,this._isMoving=!1,this._projectionCode="EPSG:3067"},{moveTo:function(e,t,i){this._centerX=e,this._centerY=t,this._zoom=i},setMoving:function(e){this._isMoving=e},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},setScale:function(e){this._scale=e},getScale:function(){return this._scale},setBbox:function(e){this._bbox=e},getBbox:function(){return this._bbox},setMarkerVisible:function(e){this._markerVisible=e===!0||"true"===e},isMarkerVisible:function(){return this._markerVisible===!0?!0:!1},setWidth:function(e){this.width=e},getWidth:function(){return this.width},setHeight:function(e){this.height=e},getHeight:function(){return this.height},setResolution:function(e){this.resolution=e},getResolution:function(){return this.resolution},setExtent:function(e){this.extent=e},getExtent:function(){return this.extent},setMaxExtent:function(e){this.maxExtent=e},getMaxExtent:function(){return this.maxExtent},setSrsName:function(e){this._projectionCode=e},getSrsName:function(){return this._projectionCode}}),Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null,this._title=null,this._legend=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setLegend:function(e){this._legend=e},getLegend:function(){return this._legend}}),Oskari.clazz.define("Oskari.mapframework.domain.Tool",function(){this._name=null,this._title=null,this._tooltip=null,this._iconCls=null,this._callback=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setTooltip:function(e){this._tooltip=e},getTooltip:function(){return this._tooltip},setIconCls:function(e){this._iconCls=e},getIconCls:function(){return this._iconCls},setCallback:function(e){this._callback=e},getCallback:function(){return this._callback}}),Oskari.clazz.define("Oskari.mapframework.domain.User",function(e){this._loggedIn=!1,e&&(this._firstName=e.firstName,this._lastName=e.lastName,this._nickName=e.nickName,this._loginName=e.loginName,this._uuid=e.userUUID,this._roles=e.roles,e.userUUID&&(this._loggedIn=!0))},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn},getRoles:function(){return this._roles},hasRole:function(e){var t,i,n,s,r=this.getRoles(),a=r.length.jlen=e.length;for(t=0;a>t;t++)for(n=r[t],i=0;jlen>i;i++)if(s=e[i],s===n.id)return!0;return!1}}),Oskari.clazz.define("Oskari.mapframework.core.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-map-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-map","Bundle-Name":"mapframework.core.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("core-map","Oskari.mapframework.core.map.Bundle"),Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{isLayerAlreadySelected:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return null!==i&&void 0!==i},findMapLayerFromSelectedMapLayers:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return i},isMapLayerAlreadyHighlighted:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._mapLayersHighlighted);return(null===i||void 0===i)&&this.printDebug("[core-map-layer-methods] "+e+" is not yet highlighted."),null!==i&&void 0!==i},findMapLayerFromAllAvailable:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e);return(null===i||void 0===i)&&this.printDebug("Cannot find map layer with id '"+e+"' from all available. "+"Check that current user has VIEW permissions to that layer."),i},getAllSelectedLayers:function(){return this._selectedLayers},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},allowMultipleHighlightLayers:function(e){this._allowMultipleHighlightLayers=e},_handleAddMapLayerRequest:function(e){var t=this,i=e.getMapLayerId(),n=e.getKeepLayersOrder(),s=e.isBasemap();if(t.printDebug("Trying to add map layer with id '"+i+"' AS "+(s?" BASE ":" NORMAL ")),t.isLayerAlreadySelected(i))return t.printDebug("Attempt to select already selected layer '"+i+"'"),void 0;var r=t.findMapLayerFromAllAvailable(i);if(!r)return t.printDebug("Attempt to select layer that is not available '"+i+"'"),void 0;if(1==s&&r.setType("BASE_LAYER"),null!==n&&void 0!==n&&n)this._selectedLayers.push(r);else if(r.isBaseLayer()||1==s){var a,o=[];for(o.push(r),a=0;a<this._selectedLayers.length;a++)o.push(this._selectedLayers[a]);delete this._selectedLayers,this._selectedLayers=o}else this._selectedLayers.push(r);var l;l=r.isBaseLayer()||s?t.getEventBuilder("AfterMapLayerAddEvent")(r,n,s):t.getEventBuilder("AfterMapLayerAddEvent")(r,!0,s),t.copyObjectCreatorToFrom(l,e),t.dispatch(l)},_handleRemoveMapLayerRequest:function(e){var t=this,i=e.getMapLayerId();if(t.printDebug("Trying to remove map layer with id '"+i+"'"),!t.isLayerAlreadySelected(i))return t.printDebug("Attempt to remove layer '"+i+"' that is not selected."),void 0;var n,s=t.findMapLayerFromAllAvailable(i),r=-1;for(n=0;n<t._selectedLayers.length;n++)if(t._selectedLayers[n]===s){r=n;break}t._selectedLayers.splice(r,1),t.isMapLayerAlreadyHighlighted(i)&&(t.printDebug("Maplayer is also highlighted, removing it from highlight list."),t._handleDimMapLayerRequest(i));var a=t.getEventBuilder("AfterMapLayerRemoveEvent")(s);t.copyObjectCreatorToFrom(a,e),t.dispatch(a)},_handleShowMapLayerInfoRequest:function(e){var t=this.findMapLayerFromAllAvailable(e.getMapLayerId()),i=this.getEventBuilder("AfterShowMapLayerInfoEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)},_handleRearrangeSelectedMapLayerRequest:function(e){var t=e.getToPosition(),i=e.getMapLayerId(),n=null,s=0;if(null!==i&&void 0!==i&&null!==t&&void 0!==t){n=this.findMapLayerFromSelectedMapLayers(i);var r,a,o=[],l=0,u=0;for(r=0;t>l;r++)u++,a=this._selectedLayers[r],a.getId()+""!=i+""?(o.push(a),l++):s=r;for(o.push(n),r=u;r<this._selectedLayers.length;r++)a=this._selectedLayers[r],a.getId()+""!=i+""?o.push(a):s=r;delete this._selectedLayers,this._selectedLayers=o}var h=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(n,s,t);this.copyObjectCreatorToFrom(h,e),this.dispatch(h)},_handleChangeMapLayerOpacityRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(t){t.setOpacity(e.getOpacity());var i=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)}},_handleChangeMapLayerStyleRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(t&&"!default!"!==e.getStyle()){t.selectStyle(e.getStyle());var i=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)}},_removeHighLightedMapLayer:function(e){var t,i,n,s=this.getAllHighlightedMapLayers();for(t=0;t<s.length;t++)if(i=s[t],!e||i.getId()+""==e+"")return s.splice(t),n=this.getEventBuilder("AfterDimMapLayerEvent")(i),this.dispatch(n),void 0},_handleHighlightMapLayerRequest:function(e){var t=(this.getObjectCreator(e),e.getMapLayerId());if(this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+t+"'"),this.isMapLayerAlreadyHighlighted(t))return this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+t+"'"),void 0;1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(t):this._removeHighLightedMapLayer();var i=this.findMapLayerFromSelectedMapLayers(t);if(i){this._mapLayersHighlighted.push(i),this.printDebug("[core-map-layer-methods] Adding "+i+" ("+i.getId()+") to highlighted list.");var n=this.getEventBuilder("AfterHighlightMapLayerEvent")(i);this.copyObjectCreatorToFrom(n,e),this.dispatch(n)}},_handleDimMapLayerRequest:function(e){1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(e):this._removeHighLightedMapLayer();var t=this.findMapLayerFromAllAvailable(e);if(t){var i=this.getEventBuilder("AfterDimMapLayerEvent")(t);this.dispatch(i)}}}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{_handleHideMapMarkerRequest:function(e){this._map.setMarkerVisible(!1);var t=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(t,e),this.dispatch(t)}}),Oskari.clazz.define("Oskari.mapframework.request.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/add-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/remove-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/map-move-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-layer-info-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/hide-map-marker-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-down-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-up-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map","Bundle-Name":"mapframework.request.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-map","Oskari.mapframework.request.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(e,t,i,n){this._creator=null,this._mapLayerId=e,this._keepLayersOrder=1==t,this._isExternal=1==n,this._isBasemap=1==i},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(e,t,i,n,s){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=n,this._projectionCode=s},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getSrsName:function(){return this._projectionCode}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.sandbox.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-key-listener-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-state-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-base","Bundle-Name":"mapframework.sandbox.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("sandbox-base","Oskari.mapframework.sandbox.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(e){this._core=e,this._listeners=[],this._modules=[],this._modulesByName={},this._statefuls={},this.debugRequests=!1,this.debugEvents=!1,this.requestEventLog=[],this.requestEventStack=[],this.gatherDebugRequests=!1,this.maxGatheredRequestsAndEvents=4096,this.requestAndEventGather=[],this._eventLoopGuard=0,this._user=null,this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=!1,this.debugEvents=!1,this.gatherDebugRequests=!1,this._core&&this._core.disableDebug()},enableDebug:function(){this.debugRequests=!0,this.debugEvents=!0,this.gatherDebugRequests=!0,this._core&&this._core.enableDebug()},printDebug:function(e){this._core.printDebug(e)},printWarn:function(e){this._core.printWarn(e)},setUser:function(e){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",e)},getUser:function(){return this._user||this.setUser(),this._user},setAjaxUrl:function(e){this._ajaxUrl=e},getAjaxUrl:function(){return this._ajaxUrl},registerService:function(e){this._core.registerService(e)},getService:function(e){return this._core.getService(e)},registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},register:function(e){return this._modules.push(e),this._modulesByName[e.getName()]=e,e.init(this)},unregister:function(e){var t,i=this,n=[];for(t=0;t<i._modules.length;t++)e!==i._modules[t]&&n.push(i._modules[t]);i._modules=n,i._modulesByName[e.getName()]=void 0,delete i._modulesByName[e.getName()]},registerForEventByName:function(e,t){this._core.printDebug("#*#*#* Sandbox is registering module '"+e.getName()+"' to event '"+t+"'");var i=this._listeners[t];(null===i||void 0===i)&&(i=[],this._listeners[t]=i),i.push(e),this._core.printDebug("There are currently "+i.length+" listeners for event '"+t+"'")},unregisterFromEventByName:function(e,t){this._core.printDebug("Sandbox is unregistering module '"+e.getName()+"' from event '"+t+"'");var i,n=this._listeners[t],s=-1;if(null===n||void 0===n)return this._core.printDebug("Module does not listen to that event, skipping."),void 0;for(i=0;i<n.length;i++)if(n[i]===e){s=i;break}s>-1?(n.splice(s,1),this._core.printDebug("Module unregistered successfully from event")):this._core.printDebug("Module does not listen to that event, skipping.")},getRequestBuilder:function(e){return this._core.getRequestBuilder(e)},getEventBuilder:function(e){return this._core.getEventBuilder(e)},request:function(e,t){var i,n=null,s=null;if(n=null!==e.getName&&void 0!==e.getName?e.getName():e,i=this.findRegisteredModuleInstance(n),null===i||void 0===i)throw"Attempt to create request with unknown component '"+e+"' as creator";return this._core.setObjectCreator(t,n),this.printDebug("Module '"+n+"' is requesting for '"+this.getObjectName(t)+"'..."),this.gatherDebugRequests&&this._pushRequestAndEventGather(n+"->Sandbox: ",this.getObjectName(t)),this._debugPushRequest(n,t),s=this._core.processRequest(t),this._debugPopRequest(),s},requestByName:function(e,t,i){this.printDebug("#!#!#! --------------> requestByName "+t);var n=this.getRequestBuilder(t),s=n.apply(this,i||[]);return this.request(e,s)},postMasterComponent:"postmaster",postRequestByName:function(e,t){var i=this,n=i.getRequestBuilder(e);n&&window.setTimeout(function(){var e=n.apply(i,t||[]),s=this.postMasterComponent,r=null;i._core.setObjectCreator(e,s),i.gatherDebugRequests&&i._pushRequestAndEventGather(s+"->Sandbox: ",i.getObjectName(e)),this.debugRequests&&i._debugPushRequest(s,e),r=i._core.processRequest(e),this.debugRequests&&i._debugPopRequest()},0)},_findModulesInterestedIn:function(e){var t=e.getName(),i=this._listeners[t];return i?i:[]},notifyAll:function(e,t){var i;t||(i=e.getName(),this._core.printDebug("Sandbox received notifyall for event '"+i+"'"));var n,s,r=this._findModulesInterestedIn(e);for(t||this._core.printDebug("Found "+r.length+" interested modules"),n=0;n<r.length;n++)s=r[n],t||(this._core.printDebug("Notifying module '"+s.getName()+"'."),this.gatherDebugRequests&&this._pushRequestAndEventGather("Sandbox->"+s.getName()+":",i)),this._debugPushEvent(this.getObjectCreator(e),s,e),s.onEvent(e),this._debugPopEvent();t||delete e},findRegisteredModuleInstance:function(e){return this._modulesByName[e]},getRequestParameter:function(e){return this._core.getRequestParameter(e)},getBrowserWindowSize:function(){jQuery.browser.opera&&null!==window.innerHeight&&void 0!==window.innerHeight&&window.innerHeight;var e=jQuery(window).width(),t={};return t.height=jQuery(window).height(),t.width=e,this.printDebug("Got browser window size is: width: "+t.width+" px, height:"+t.height+" px."),t},getObjectName:function(e){return this._core.getObjectName(e)},getObjectCreator:function(e){return this._core.getObjectCreator(e)},setObjectCreator:function(e,t){return this._core.setObjectCreator(e,t)},copyObjectCreatorToFrom:function(e,t){return this._core.copyObjectCreatorToFrom(e,t)},addRequestHandler:function(e,t){return this._core.addRequestHandler(e,t)},removeRequestHandler:function(e,t){return this._core.removeRequestHandler(e,t)},_debugPushRequest:function(e,t){if(this.debugRequests){var i={from:e,reqName:t.getName()};this.requestEventStack.push(i),this.requestEventLog.push(i),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopRequest:function(){this.debugRequests&&this.requestEventStack.pop()},_debugPushEvent:function(e,t,i){if(this.debugEvents){if(this._eventLoopGuard++,this._eventLoopGuard>64)throw"Events Looped?";var n={from:e,to:t.getName(),evtName:i.getName()};this.requestEventStack.push(n),this.requestEventLog.push(n),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopEvent:function(){this.debugEvents&&(this._eventLoopGuard--,this.requestEventStack.pop())},_pushRequestAndEventGather:function(e,t){var i={};i.name=e,i.request=t,this.requestAndEventGather.push(i),this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents&&this.requestAndEventGather.shift()},popUpSeqDiagram:function(){var e,t,i='<html><head></head><body><div class="wsd" wsd_style="modern-blue"><pre>',n="";for(t in this.requestAndEventGather)this.requestAndEventGather.hasOwnProperty(t)&&(n+=this.requestAndEventGather[t].name+this.requestAndEventGather[t].request+"\n");""!==n?(i+=n+'</pre></div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"></script></body></html>',e=window.open(),e.document.write(i),this.requestAndEventGather=[]):alert("No requests in queue")},getLocalizedProperty:function(e){var t,i,n;if(null===e||void 0===e)return null;if("object"==typeof e){if(t=e[Oskari.getLang()],null===t)for(i=Oskari.getSupportedLocales(),n=0;n<i.length&&!(t=e[i[n]]);n+=1);return t}return e}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","state-methods",{registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},resetState:function(){var e,t,i,n=Oskari.app.getConfiguration(),s=this.getStatefulComponents();for(i in s)s.hasOwnProperty(i)&&(t=s[i],e=n[i].state,t.setState&&(jQuery.isEmptyObject(e)?t.setState():t.setState(e)))}}),Oskari.clazz.define("Oskari.mapframework.service.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/map-layer-service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-map","Bundle-Name":"mapframework.service.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("service-map","Oskari.mapframework.service.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(e,t){this._mapLayerUrl=e,this._sandbox=t,this._allLayersAjaxLoaded=!1,this._loadedLayersList=[],this._reservedLayerIds={},this._stickyLayerIds={},this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"},this.modelBuilderMapping={}},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(e,t){if(-1!=e.getParentId())return this.addSubLayer(e.getParentId(),e,t),void 0;if(this.checkForDuplicateId(e.getId(),e.getName()),this._reservedLayerIds[e.getId()]=!0,this._loadedLayersList.push(e),t!==!0){var i=this._sandbox.getEventBuilder("MapLayerEvent")(e.getId(),"add");this._sandbox.notifyAll(i)}},addSubLayer:function(e,t,i){var n,s=this.findMapLayer(e);if(s&&(s.isBaseLayer()||s.isGroupLayer())){if(t.setParentId(e),n=s.getSubLayers(),!s.addSubLayer(t))return;if(i!==!0){var r=this._sandbox.getEventBuilder("MapLayerEvent")(t.getId(),"update");this._sandbox.notifyAll(r)}}},removeLayer:function(e,t){var i=this.findMapLayer(e),n=null,s=null;if(i){var r=this._loadedLayersList;if(-1!=i.getParentId()){var n=this.findMapLayer(i.getParentId());if(!n)return;r=n.getSubLayers()}for(var a=0;a<r.length;a++)if(r[a].getId()+""==e+""){r.splice(a,1);break}i&&t!==!0&&(n?s=this._sandbox.getEventBuilder("MapLayerEvent")(n.getId(),"update"):(s=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"remove"),this._reservedLayerIds[e]=!1),this._sandbox.notifyAll(s))}},updateLayer:function(e,t){var i=this.findMapLayer(e);if(i){t.dataUrl&&i.setDataUrl(t.dataUrl),t.legendImage&&i.setLegendImage(t.legendImage),t.minScale&&i.setMinScale(t.minScale),t.maxScale&&i.setMaxScale(t.maxScale),t.name&&i.setName(t.name),t.subtitle&&i.setDescription(t.subtitle),t.orgName&&i.setOrganizationName(t.orgName),t.inspire&&i.setInspireName(t.inspire),t.version&&i.setVersion&&i.setVersion(t.version),t.style&&i.selectStyle(t.style),t.wmsName&&i.setWmsName(t.wmsName),t.wmsUrl&&i.setWmsUrls(t.wmsUrl.split(","));for(var n in t.admin)t.admin.hasOwnProperty(n)&&t.admin[n]&&(i.admin[n]=t.admin[n]);var s=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"update");this._sandbox.notifyAll(s)}},makeLayerSticky:function(e,t){var i=this.findMapLayer(e);if(this._stickyLayerIds[e]=t===!0,i){i.setSticky(t);var n=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"sticky");this._sandbox.notifyAll(n)}},loadAllLayersAjax:function(e,t){var i=this,n=(new Date).getTime();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this._mapLayerUrl+"&timestamp="+n+"&",success:function(t){i._loadAllLayersAjaxCallBack(t,e)},error:function(e){t&&0!==e.status&&t()}})},_loadAllLayersAjaxCallBack:function(e,t){var i,n,s,r,a,o,l,u=e.layers;for(i=0;i<u.length;i++)if(n=this.createMapLayer(u[i]),this._reservedLayerIds[n.getId()]!==!0)this.addLayer(n,!0);else if(s=this.findMapLayer(n.getId()),null!==u[i].admin&&void 0!==u[i].admin&&(s.admin=u[i].admin),u[i].names&&(s.names=u[i].names),null!==s.getSubLayers()&&void 0!==s.getSubLayers())for(r=s.getSubLayers(),a=n.getSubLayers(),o=0;o<r.length;o++)l=r[o],null!==r[o].admin&&void 0!==r[o].admin&&(l.admin=a[o].admin),r[o].names&&(l.names=a[o].names);this._allLayersAjaxLoaded=!0;var h=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(h),t&&t()},isAllLayersLoaded:function(){return this._allLayersAjaxLoaded},getAllLayers:function(){return this._loadedLayersList},getAllLayersByMetaType:function(e){var t,i,n=[];for(t=0;t<this._loadedLayersList.length;++t)i=this._loadedLayersList[t],i.getMetaType&&i.getMetaType()===e&&n.push(i);return n},getLayersOfType:function(e){var t,i,n=[];for(t=0;t<this._loadedLayersList.length;++t)i=this._loadedLayersList[t],i.isLayerOfType(e)&&n.push(i);return n},registerLayerModel:function(e,t){this.typeMapping[e]=t},unregisterLayerModel:function(e){this.typeMapping[e]=void 0},registerLayerModelBuilder:function(e,t){this._sandbox.printDebug("[MapLayerService] registering handler for type "+e),this.modelBuilderMapping[e]=t},unregisterLayerModelBuilder:function(e){this.modelBuilderMapping[e]=void 0},createMapLayer:function(e){var t=null;return t="base"===e.type?this._createGroupMapLayer(e,!0):"groupMap"===e.type?this._createGroupMapLayer(e,!1):this._createActualMapLayer(e),t&&null!==e.admin&&void 0!==e.admin&&(t.admin=e.admin),t&&null!==e.names&&void 0!==e.names&&(t.names=e.names),this._stickyLayerIds[t.getId()]&&t.setSticky(!0),t},_createGroupMapLayer:function(e,t){var i,n,s,r,a,o=this.createLayerTypeInstance("wmslayer");if(t?o.setAsBaseLayer():o.setAsGroupLayer(),o.setVisible(!0),o.setId(e.id),o.setName(e.name),o.setMaxScale(e.maxScale),o.setMinScale(e.minScale),o.setDataUrl(e.dataUrl),o.setMetadataIdentifier(e.dataUrl_uuid),!o.getMetadataIdentifier()&&o.getDataUrl()&&(i=o.getDataUrl().split("uuid="),2===i.length&&o.setMetadataIdentifier(i[1])),e.orgName?o.setOrganizationName(e.orgName):o.setOrganizationName(""),e.inspire?o.setInspireName(e.inspire):o.setInspireName(""),o.setLegendImage(e.legendImage),o.setDescription(e.info),o.setQueryable(!1),e.permissions)for(n in e.permissions)e.permissions.hasOwnProperty(n)&&o.addPermission(n,e.permissions[n]);if(e.subLayer)for(s=0;s<e.subLayer.length;s++)r=this._createActualMapLayer(e.subLayer[s]),r.setParentId(e.id),r.admin=e.subLayer[s].admin||{},o.getSubLayers().push(r);return null!==e.opacity&&void 0!==e.opacity?o.setOpacity(e.opacity):o.getSubLayers().length>0?(a=o.getSubLayers()[0].getOpacity(),null!==a&&void 0!==a?o.setOpacity(a):o.setOpacity(100)):o.setOpacity(100),o},createLayerTypeInstance:function(e,t,i){var n=this.typeMapping[e];return n?Oskari.clazz.create(n,t,i):null},_createActualMapLayer:function(e){if(!e)return null;var t=this.createLayerTypeInstance(e.type,e.params,e.options);if(!t)throw"Unknown layer type '"+e.type+"'";if("wmslayer"===e.type?this._populateWmsMapLayerAdditionalData(t,e):"vectorlayer"===e.type&&t.setStyledLayerDescriptor(e.styledLayerDescriptor),e.metaType&&t.setMetaType&&t.setMetaType(e.metaType),t.setAsNormalLayer(),t.setId(e.id),t.setName(e.name),null!==e.opacity&&void 0!==e.opacity?t.setOpacity(e.opacity):t.setOpacity(100),t.setMaxScale(e.maxScale),t.setMinScale(e.minScale),t.setDescription(e.subtitle),t.setQueryable("true"===e.isQueryable||e.isQueryable===!0),t.setDataUrl(e.dataUrl),t.setMetadataIdentifier(e.dataUrl_uuid),!t.getMetadataIdentifier()&&t.getDataUrl()){var i=t.getDataUrl().split("uuid=");2===i.length&&t.setMetadataIdentifier(i[1])}if(e.backendStatus&&t.setBackendStatus&&t.setBackendStatus(e.backendStatus),e.orgName?t.setOrganizationName(e.orgName):t.setOrganizationName(""),e.inspire?t.setInspireName(e.inspire):t.setInspireName(""),t.setVisible(!0),e.geom&&t.setGeometryWKT&&t.setGeometryWKT(e.geom),e.permissions)for(var n in e.permissions)e.permissions.hasOwnProperty(n)&&t.addPermission(n,e.permissions[n]);e.url&&t.addLayerUrl(e.url),t.setLegendImage(e.legendImage),e.localization&&t.setLocalization(e.localization);var s=this.modelBuilderMapping[e.type];return s&&s.parseLayerData(t,e,this),t},_populateWmsMapLayerAdditionalData:function(e,t){var i,n;
if(e.setWmsName(t.wmsName),t.wmsUrl)for(i=t.wmsUrl.split(","),n=0;n<i.length;n++)e.addWmsUrl(i[n]);return e.setFeatureInfoEnabled("disabled"!==t.gfi),e.setVersion(t.version),t.formats&&t.formats.value&&e.setQueryFormat(t.formats.value),this.populateStyles(e,t)},populateStyles:function(e,t,i){var n,s,r,a,o=Oskari.clazz.builder("Oskari.mapframework.domain.Style");if(t.styles){for(n=0;n<t.styles.length&&(s=t.styles,r=!isNaN(n),r&&(s=t.styles[n]),a=o(),a.setName(s.name),a.setTitle(s.title),a.setLegend(s.legend),e.addStyle(a),r);n++);e.selectStyle(t.style)}return i?(e.addStyle(i),e.selectStyle(i.getName())):(a=o(),a.setName(""),a.setTitle(""),a.setLegend(""),e.addStyle(a),e.selectStyle("")),e},checkForDuplicateId:function(e,t){if(this._reservedLayerIds[e]===!0){var i=this.findMapLayer(e);throw"Trying to add map layer with id '"+e+" ("+t+")' but that id is already reserved for '"+i.getName()+"'"}},findMapLayer:function(e,t){var i,n,s,r;for(t||(t=this._loadedLayersList),i=0;i<t.length;i++)if(n=t[i],n.getId()+""==e+"")return n;for(i=0;i<t.length;i++)if(n=t[i],s=n.getSubLayers(),r=this.findMapLayer(e,s),null!==r&&void 0!==r)return r;return null}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.sandbox.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-abstraction-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-map","Bundle-Name":"mapframework.sandbox.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("sandbox-map","Oskari.mapframework.sandbox.map.Bundle"),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(e){var t=this._core.findMapLayerFromAllAvailable(e);return t},findAllSelectedMapLayers:function(){var e=this._core.getAllSelectedLayers();return e.slice(0)},findMapLayerFromSelectedMapLayers:function(e){var t=this._core.findMapLayerFromSelectedMapLayers(e);return t},isLayerAlreadySelected:function(e){return this._core.isLayerAlreadySelected(e)},findAllHighlightedLayers:function(){var e=this._core.getAllHighlightedMapLayers();return e},isMapLayerHighLighted:function(e){var t,i=this.findAllHighlightedLayers();for(t=0;t<i.length;t++)if(i[t].getId()+""==e+"")return!0;return!1},allowMultipleHighlightLayers:function(e){this._core.allowMultipleHighlightLayers(e)}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(e){var t=this._core.getMap(),i=t.getZoom(),n=t.isMarkerVisible();e===!0&&12==i&&this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),0,!1)),this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),i,n)),e===!0&&this._core.processRequest(this._core.getRequestBuilder("ClearHistoryRequest")())},generateMapLinkParameters:function(e){var t=this.getStatefulComponents(),i=null,n=null,s=[],r=[];for(i in t)t.hasOwnProperty(i)&&(n=t[i],n.getStateParameters&&"function"==typeof n.getStateParameters&&r.push(n.getStateParameters()));e=e||{showMarker:!1,forceCache:!1,noSavedState:!1};for(i in e)e.hasOwnProperty(i)&&s.push(i+"="+(e[i]!==!1));return r.concat(s).join("&")||null}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","abstraction-methods",{domSelector:function(e){return jQuery(e)},ajax:function(e,t,i,n){if(jQuery&&jQuery.ajax){var s="GET";n&&(s="POST"),jQuery.ajax({type:s,url:e,beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:n,success:t,error:i})}else i()},getDefer:function(){var e;return e=window.Q&&window.Q.defer?window.Q.defer():void 0}}),Oskari.clazz.define("Oskari.mapframework.event.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/features-available-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-add-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-remove-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-start-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-show-map-layer-info-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-hide-map-marker-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/mouse-hover-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/MapLayerEvent.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map","Bundle-Name":"mapframework.event.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-map","Oskari.mapframework.event.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(e,t,i,n,s){this._creator=null,this._features=t,this._op=s,this._mapLayer=e,this._mimeType=i,this._projCode=n},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(e,t,i){this._creator=null,this._mapLayer=e,this._keepLayersOrder=t,this._isBasemap=i?i:!1},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(e,t,i,n,s){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=n,this._scale=s},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(e,t){this._creator=null,this._x=e,this._y=t},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(e,t,i){this._creator=null,this._lon=e,this._lat=t,this._paused=i},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(e,t,i,n,s){this._lon=e,this._lat=t,this._paused=i,this._pageX=n,this._pageY=s},isPaused:function(){return this._paused},getPageX:function(){return this._pageX},getPageY:function(){return this._pageY}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(e,t){if(this._creator=null,this._layerId=e,!this.operations[t])throw"Unknown operation '"+t+"'";this._operation=t},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",sticky:"sticky",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/event/ExtensionUpdatedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Accordion.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/AccordionPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabDropdownContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Badge.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Alert.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popup.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Overlay.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Button.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Form.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/UIHelper.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/FormInput.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popover.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Grid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/GridModel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/ProgressSpinner.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/VisualizationForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/AreaForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/LineForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/visualization-form/DotForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultTile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultFlyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultExtension.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/extension/DefaultLayout.js"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/divman.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/accordion.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/tab.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/modal.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/badge.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/alert.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/forminput.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/grid.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popup.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/button.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/overlay.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/visualizationform.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popover.css"},{type:"text/javascript",src:"../../../../libraries/raphaeljs/raphael.min.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery-placeholder/jquery.placeholder.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"ui","Bundle-Name":"ui","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" kpI",Title:" kpI"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("divmanazer","Oskari.userinterface.bundle.ui.UserInterfaceBundle"),Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null,this.requestHandlers={},this.extensions=[],this.extensionsByName={},this.compiledTemplates={},this.flyoutContainer=null,this.tileContainer=null,this.flyoutZIndexBase=1100,this.menubarContainerId="#menubar"},{getName:function(){return"userinterface.DivManazer"},init:function(){},getExtensionByName:function(e){return this.extensionsByName[e]},getSandbox:function(){return this.sandbox},start:function(){this.compileTemplates();var e,t,i,n,s,r=this.conf,a=(r?r.sandbox:null)||"sandbox",o=Oskari.getSandbox(a);if(this.sandbox=o,this.flyoutContainer=jQuery(document.body),this.tileContainer=jQuery(this.menubarContainerId),this.tileContainer.addClass("oskari-tile-container"),this.sandbox.register(this),this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this),this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this),this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this),o.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),o.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),o.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),this.requestHandlers.modal=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",this),o.addRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),jQuery.browser.msie&&jQuery.browser.version<"9.0")for(e=this.compiledTemplates["Oskari.userinterface.Flyout"].children(".oskari-flyoutcontentcontainer"),t=this.flyoutContainer.height(),i=this.ieFixClasses,n=0;n<i.length;n+=1)if(s=i[n],t>=s.min&&t<=s.max){e.addClass(s.cls);break}},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),sandbox.removeRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),this.sandbox.unregister(this),this.started=!1},templates:{"Oskari.userinterface.Tile":'<div class="oskari-tile oskari-tile-closed"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div></div>',"Oskari.userinterface.Flyout":'<div class="oskari-flyout oskari-closed"><div class="oskari-flyouttoolbar"><div class="oskari-flyoutheading"></div><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttools"><div class="oskari-flyouttool-help"></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close icon-close icon-close:hover"></div></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>',"Oskari.userinterface.View":'<div class="oskari-view"></div>'},compileTemplates:function(){var e,t=this;t.compiledTemplates["Oskari.userinterface.Tile"]=jQuery(this.templates["Oskari.userinterface.Tile"]),e=jQuery(t.templates["Oskari.userinterface.Flyout"]),e.css("left",t.defaults.attach.left),e.css("top",t.defaults.attach.top),t.compiledTemplates["Oskari.userinterface.Flyout"]=e,t.compiledTemplates["Oskari.userinterface.View"]=jQuery(this.templates["Oskari.userinterface.View"])},addExtension:function(e){var t,i,n,s,r,a,o,l,u,h,c,p,d,m,f=this;return e.startExtension(),t=e.getPlugins(),i=f.extensions,n=f.extensionsByName,s={state:"close",extension:e,draggable:null,draggableTarget:null,draggableHandle:null,viewState:{},extensionUpdatedEvent:null},s.extensionUpdatedEvent=f.sandbox.getEventBuilder("userinterface.ExtensionUpdatedEvent")(e,s.state),r=i.length,a=e.getName(),o=t["Oskari.userinterface.Flyout"],l=null,u=null,null!==o&&void 0!==o&&(l=f.createFlyout(e,o,r,s),f._applyDraggableToFlyout(l,s,".oskari-flyouttoolbar"),h=l.children(".oskari-flyoutcontentcontainer"),u=h.children(".oskari-flyoutcontent"),o.setEl(u.get()),f.flyoutContainer.append(l),o.startPlugin()),c=t["Oskari.userinterface.Tile"],p=null,null!==c&&void 0!==c&&(p=f.createTile(e,c,r,s),c.startPlugin(),p.fadeIn(200),f.tileContainer.append(p)),d=t["Oskari.userinterface.View"],m=null,null!==d&&void 0!==d&&(m=f.createView(e,d,r,s),u=m,d.setEl(u.get()),d.startPlugin()),s.plugins={},c&&(s.plugins["Oskari.userinterface.Tile"]={plugin:c,el:p}),o&&(s.plugins["Oskari.userinterface.Flyout"]={plugin:o,el:l}),d&&(s.plugins["Oskari.userinterface.View"]={plugin:d,el:m}),i.push(s),n[a]=s,s},_applyDraggableToFlyout:function(e,t,i){var n,s=this,r=e.children(i).get()[0],a=e.get()[0],o=!1;t.draggableHandle=r,t.draggableTarget=a,t.draggable=$(e).draggable({handle:jQuery(r),helper:o?function(){return n=jQuery("<div />"),n.css("width",e.css("width")),n.css("height",e.css("height")),n.css("border","2px solid rgba(0,0,0,.5)"),n.css("z-index",e.css("z-index")),n}:null,scroll:!1,stack:".oskari-flyout",create:function(){jQuery.browser.msie&&"9"===jQuery.browser.version[0]&&e.css("width",e.width()+"px")},start:function(){o&&e.css("display","none")},drag:function(){},stop:function(i,n){var r;o&&(e.css("top",n.helper.css("top")),e.css("left",n.helper.css("left"))),s.shuffleZIndices(e),o&&e.css("display",""),r=s.getFlyoutViewState(e,"detach"),t.viewState=r,s.notifyExtensionViewStateChange(t)}})},createTile:function(e,t){var i=this,n=this.compiledTemplates["Oskari.userinterface.Tile"].clone(!0,!0),s=n.children(".oskari-tile-title");return s.append(t.getTitle()),n.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"toggle"])}),t.setEl(n.get()),n},createFlyout:function(e,t){var i,n,s=this,r=this.compiledTemplates["Oskari.userinterface.Flyout"].clone(!0,!0);return r.find(".oskari-flyout-title p").append(t.getTitle()),i=r.children(".oskari-flyouttoolbar").children(".oskari-flyouttools"),n={attach:i.children(".oskari-flyouttool-attach"),detach:i.children(".oskari-flyouttool-detach"),minimize:i.children(".oskari-flyouttool-minimize"),restore:i.children(".oskari-flyouttool-restore"),close:i.children(".oskari-flyouttool-close"),help:i.children(".oskari-flyouttool-help")},n.detach.click(function(){s.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"detach"])}),n.attach.click(function(){s.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"attach"])}),n.minimize.click(function(){s.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"minimize"])}),n.restore.click(function(){s.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"restore"])}),n.close.click(function(){s.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"close"])}),n.help.click(function(){s.getSandbox().postRequestByName("userguide.ShowUserGuideRequest",[{placement:"bottom",el:n.help,extension:e.getName(),toggle:!0}])}),r},createView:function(){var e=this,t=e.compiledTemplates["Oskari.userinterface.View"].clone(!0,!0);return t},removeExtension:function(e){var t,i,n,s,r,a,o,l,u,h=this,c=h.extensions,p=this.extensionsByName,d=p[e.getName()],m=d.plugins["Oskari.userinterface.Flyout"];for(m&&(t=m.plugin,i=m.el,n=this.flyoutOps,s=n.close,s.apply(this,[i,t,d]),i.remove()),r=d.plugins["Oskari.userinterface.Tile"],r&&(a=r.el,a.remove()),p[e.getName()]=null,o=[],l=0,u=c.length;u>l;l+=1)c[l]!==d&&o.push(c[l]);h.extensions=o,e.stopExtension()},updateExtension:function(e,t){var i,n,s,r,a,o,l,u,h,c,p,d,m,f,y,g,v,b,L,O,w,_,x,S,C,k,M=this,P=M.extensions;if(e){if(n=this.extensionsByName,s=n[e.getName()],r=s.state,a=t.getState(),"toggle"===a&&("close"===r?a="attach":"attach"===r?a="close":"detach"===r?a="minimize":"minimize"===r?a="restore":"restore"===r&&(a="minimize")),u=s.plugins["Oskari.userinterface.Flyout"],"attach"===a&&u){(t.getExtensionLocation().top||t.getExtensionLocation().left)&&(M.origExtensionLocation={});var E=function(e,t,i){t.origExtensionLocation&&(e.getExtensionLocation()[i]?(t.origExtensionLocation[i]=jQuery(u.el).css(i),jQuery(u.el).css(i,e.getExtensionLocation()[i]+"px")):t.origExtensionLocation[i]&&jQuery(u.el).css(i,t.origExtensionLocation[i]))};for(E(t,M,"top"),E(t,M,"left"),o=M.flyoutOps,h=o.close,c=0,k=P.length;k>c;c+=1)p=P[c],p!==s&&"attach"===p.state&&(d="close",m=p.plugins,f=m["Oskari.userinterface.Flyout"],f&&(y=f.plugin,g=f.el,p.state=d,h.apply(this,[g,y,p]),M.notifyExtensionViewStateChange(p),v=m["Oskari.userinterface.Tile"],v&&(b=v.el,M.applyTransition(b,d,M.tileTransitions))))}u&&(L=u.plugin,O=u.el,"attach"===a&&L.lazyRender&&L.lazyRender(),o=M.flyoutOps,l=o[a],l.apply(this,[O,L,s,P])),w=s.plugins["Oskari.userinterface.Tile"],w&&(_=w.el,M.applyTransition(_,a,M.tileTransitions)),x=s.plugins["Oskari.userinterface.View"],x&&(S=x.plugin,C=x.el,o=M.viewOps,l=o[a],l&&l.apply(this,[C,S,s,P])),s.state=a,M.notifyExtensionViewStateChange(s)}else for(i=0;i<P.length;i+=1)this.updateExtension(P[i].extension,t)},notifyExtensionViewStateChange:function(e){var t=e.extensionUpdatedEvent;t.setViewState(e.state),t.setViewInfo(e.viewState),this.sandbox.notifyAll(t,!0)},validStates:{attach:{attach:!0,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},detach:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!1},minimize:{attach:!0,detach:!0,close:!1,minimize:!0,restore:!1,drawer:!1,sidebar:!1},restore:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!0,drawer:!1,sidebar:!1},close:{attach:!1,detach:!1,close:!0,minimize:!1,restore:!1,drawer:!1,sidebar:!1},drawer:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!0,sidebar:!1},sidebar:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,sidebar:!0}},defaults:{detach:{left:"212px",top:"50px"},attach:{left:"192px",top:"30px"}},tileTransitions:{attach:{"oskari-tile-attached":!0,"oskari-tile-detached":!1,"oskari-tile-closed":!1},detach:{"oskari-tile-attached":!1,"oskari-tile-detached":!0,"oskari-tile-minimized":!1,"oskari-tile-closed":!1},minimize:{"oskari-tile-minimized":!0,"oskari-tile-closed":!1,"oskari-tile-detached":!1},restore:{"oskari-tile-minimized":!1,"oskari-tile-detached":!0},close:{"oskari-tile-closed":!0,"oskari-tile-attached":!1,"oskari-tile-detached":!1}},flyoutTransitions:{attach:{"oskari-attached":!0,"oskari-detached":!1,"oskari-closed":!1},detach:{"oskari-attached":!1,"oskari-detached":!0,"oskari-closed":!1},minimize:{"oskari-minimized":!0,"oskari-closed":!1,"oskari-detached":!1},restore:{"oskari-minimized":!1,"oskari-closed":!1,"oskari-detached":!0,"oskari-attached":!1},close:{"oskari-closed":!0,"oskari-minimized":!1,"oskari-detached":!1,"oskari-attached":!1}},applyTransition:function(e,t,i){var n,s=i[t];if(s)for(n in s)s.hasOwnProperty(n)&&(s[n]?e.addClass(n):e.removeClass(n))},getFlyoutViewState:function(e,t){var i={left:e.css("left"),top:e.css("top"),width:e.width(),height:e.height(),"z-index":e.css("z-index"),viewState:t};return i},flyoutOps:{detach:function(e,t,i){var n,s=this;(!i.viewState.left||!i.viewState.top||i.viewState.left===s.defaults.attach.left&&i.viewState.top===s.defaults.attach.top)&&(i.viewState.left=s.defaults.detach.left,i.viewState.top=s.defaults.detach.top),s.shuffleZIndices(e),s.applyTransition(e,"detach",s.flyoutTransitions),n=s.getFlyoutViewState(e,"detach"),i.viewState=n},attach:function(e,t,i){var n,s=this;s.shuffleZIndices(e),s.applyTransition(e,"attach",s.flyoutTransitions),n=s.getFlyoutViewState(e,"attach"),i.viewState=n},minimize:function(e,t,i){var n=this,s=n.getFlyoutViewState(e,"minimize");n.applyTransition(e,"minimize",n.flyoutTransitions),i.viewState=s},restore:function(e){var t=this;t.applyTransition(e,"restore",t.flyoutTransitions)},close:function(e,t,i){var n=this;i.viewState={viewState:"close"},n.applyTransition(e,"close",n.flyoutTransitions)}},viewOps:{view:function(){},close:function(){}},setState:function(e){var t,i,n,s=this,r=e;if(r)for(t in s.extensionsByName)s.extensionsByName.hasOwnProperty(t)&&(i=s.extensionsByName[t],n=r.extensionStatesByName[t],n&&(i.state=n.state,i.viewState=n.viewState||{}))},getState:function(){var e,t,i,n=this;n.refreshExtensionViewStates(),e={extensionStatesByName:{}};for(t in n.extensionsByName)n.extensionsByName.hasOwnProperty(t)&&(i=n.extensionsByName[t],e.extensionStatesByName[t]={state:i.state,viewState:i.viewState});return e},applyState:function(){var e=this;e.restoreExtensionViewStates()},refreshExtensionViewStates:function(){var e,t,i,n,s,r=this;for(e in r.extensionsByName)r.extensionsByName.hasOwnProperty(e)&&(t=r.extensionsByName[e],i=t.plugins["Oskari.userinterface.Flyout"],i&&(n=i.el,s=r.getFlyoutViewState(n,t.state),t.viewState=s))},restoreExtensionViewStates:function(){var e,t,i,n,s,r,a,o,l,u=this,h=u.flyoutOps,c=u.extensions;for(e in u.extensionsByName)u.extensionsByName.hasOwnProperty(e)&&(t=u.extensionsByName[e],i=t.plugins["Oskari.userinterface.Flyout"],i&&(n=i.plugin,s=i.el,r=t.viewState,s.removeAttr("style"),s.css("left",r.left),s.css("top",r.top),s.width(r.width),s.height(r.height),s.css("z-index",r["z-index"]),a=h[t.state],a.apply(u,[s,n,t,c])),o=t.plugins["Oskari.userinterface.Tile"],o&&(l=o.el,u.applyTransition(l,t.state,u.tileTransitions)))},_toggleMapWindowFullScreen:function(){var e=this,t=e.sandbox.getRequestBuilder("MapFull.MapWindowFullScreenRequest");t&&e.sandbox.request(e.getName(),t())},shuffleZIndices:function(e){var t,i,n,s,r,a,o,l=this,u=[],h={},c={},p={},d=1100;for(i in l.extensionsByName)l.extensionsByName.hasOwnProperty(i)&&(n=l.extensionsByName[i],s=n.plugins["Oskari.userinterface.Flyout"],s&&(r=s.el,a=r.css("z-index"),u.push(a),t=String(a),h[t]=a,p[t]=r,c[t]=n));for(u.sort(),o=0;o<u.length;o+=1)t=u[o],h[t]=d+o,p[t].css("z-index",h[u[o]]);e.css("z-index",d+u.length+2)},ieFixClasses:[{min:400,max:599,cls:"oskari-flyoutcontentcontainer_IE_400_599"},{min:600,max:799,cls:"oskari-flyoutcontentcontainer_IE_600_799"},{min:800,max:999,cls:"oskari-flyoutcontentcontainer_IE_800_999"},{min:1e3,max:1199,cls:"oskari-flyoutcontentcontainer_IE_1000_1199"},{min:1200,max:1399,cls:"oskari-flyoutcontentcontainer_IE_1200_1399"},{min:1400,max:9999,cls:"oskari-flyoutcontentcontainer_IE_1400"}]},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Stateful"]}),Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(e){this._extension=e},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.addExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(e){this._extension=e},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.removeExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(e,t,i,n,s){this._extension=e,this._state=t,this._extensionName=i,this._location={},this._location.top=n,this._location.left=s
},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state},getExtensionName:function(){return this._extensionName},getExtensionLocation:function(){return this._location}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension(),n=t.getExtensionName();if(!i&&n&&"*"!=n){var s=this.ui.getExtensionByName(n);if(!s)return;i=s.extension}this.ui.updateExtension(i,t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.ModalDialogRequest",function(e,t,i,n){this._title=e?e:"Untitled",this._message=t?t:"Lorem ipsum",this._buttons=i?i:{},this._parent=parent?parent:jQuery("#mapdiv"),this._onshow=n?n:null},{__name:"userinterface.ModalDialogRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getMessage:function(){return this._message},getButtons:function(){return this._buttons},getGeom:function(){return this._geom},getParent:function(){return this._parent},getOnShow:function(){return this._onshow}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",function(e){this._ui=e,this._tpl={},this._tpl.modal=jQuery('<div id="modaldialog" class="modaldialog">  <div class="modaltitle"></div>  <div class="modalmessage"></div>  <div class="modalbuttons"></div> </div>'),this._tpl.button=jQuery('<div class="modalbutton"><input type="button" /></input></div>'),this._buttons={},this._args={closeClass:"modalclose",overlayId:"modaloverlay",overlayCss:{"background-color":"lightgrey",cursor:"wait"},containerId:"modalcontainer",containerCss:{"background-color":"white"},onClose:function(){this.close()},zIndex:80130}},{handleRequest:function(e,t){var i=this._tpl.modal.clone();i.find(".modaltitle").append(t.getTitle()),i.find(".modalmessage").append(t.getMessage());var n=t.getButtons(),s=i.find(".modalbuttons");for(var r in n)if(n[r].name){var a=n[r],o=this._tpl.button.clone(),l=o.find("input");l.attr("name",a.name),l.attr("text",a.text),l.attr("value",a.text),l.bind("click",a.onclick),a.close!==!1&&l.addClass(this._args.closeClass),s.append(o)}t.onshow&&(this._args.onShow=onshow),$.modal=i.modal(this._args)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.event.ExtensionUpdatedEvent",function(e,t,i){this._creator=null,this._extension=e,this.viewstate=t,this.viewinfo=i},{__name:"userinterface.ExtensionUpdatedEvent",getName:function(){return this.__name},getExtension:function(){return this._extension},getViewState:function(){return this.viewstate},setViewState:function(e){this.viewstate=e},getViewInfo:function(){return this.viewinfo},setViewInfo:function(e){this.viewinfo=e}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.userinterface.component.Accordion",function(){this.template=jQuery('<div class="accordion"></div>'),this.templateMsg=jQuery('<div class="accordionmsg"></div>'),this.panels=[],this.ui=this.template.clone()},{addPanel:function(e){this.removeMessage(),this.panels.push(e),e.insertTo(this.ui)},removePanel:function(e){var t,i=null;for(t=0;t<this.panels.length;t+=1)if(this.panels[t]===e){i=this.panels[t],this.panels.splice(t,1);break}return i?(i.destroy(),!0):!1},removeAllPanels:function(){this.ui.empty(),this.panels=[]},removeMessage:function(){var e=this.ui.find("div.accordionmsg");e.length>0&&e.remove()},showMessage:function(e){this.removeMessage();var t=this.templateMsg.clone();t.append(e),this.ui.append(t)},showPanels:function(){var e=0;for(e=0;e<this.panels.length;e+=1)this.panels[e].setVisible(!0)},hidePanels:function(){var e=0;for(e=0;e<this.panels.length;e+=1)this.panels[e].setVisible(!1)},insertTo:function(e){e.append(this.ui)},getContainer:function(){return this.ui}}),Oskari.clazz.define("Oskari.userinterface.component.AccordionPanel",function(){this.template=jQuery('<div class="accordion_panel"><div class="header"><div class="headerIcon icon-arrow-right"></div><div class="headerText"></div></div><div class="content"></div></div>'),this.title=null,this.content=null,this.html=this.template.clone();var e=this,t=e.html.find("div.header");t.click(function(){e.isOpen()?e.close():e.open()}),this.html.find("div.content").hide()},{setVisible:function(e){e===!0?this.html.show():this.html.hide()},isVisible:function(){return this.html.is(":visible")},isOpen:function(){return this.html.hasClass("open")},open:function(){this.html.addClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-right"),e.addClass("icon-arrow-down"),this.html.find("div.content").show()},close:function(){this.html.removeClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-down"),e.addClass("icon-arrow-right"),this.html.find("div.content").hide()},setTitle:function(e){this.title=e;var t=this.html.find("div.header div.headerText");t.html(this.title)},getTitle:function(){return this.title},setContent:function(e){this.content=e;var t=this.html.find("div.content");t.append(this.content)},destroy:function(){this.html.remove()},getContainer:function(){return this.html.find("div.content")},insertTo:function(e){e.append(this.html)}}),Oskari.clazz.define("Oskari.userinterface.component.TabContainer",function(e){this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabs=jQuery('<div class="tabsHeader"><ul class="tabsItem"></ul></div><br clear="all"/><div class="tabsContent tabsContentItem"></div>'),this.ui=this.template.clone()},{addPanel:function(e,t){var i,n,s,r,a=this;0===this.panels.length&&(i=this.templateTabs.clone(),this.ui.html(i)),n=this.ui.find("ul.tabsItem"),s=e.getHeader(),t?(n.prepend(s),this.select(e)):n.append(s),e.insertTo(this.ui.find("div.tabsContentItem")),this.panels.push(e),1===this.panels.length&&this.select(e),r=s.find("a"),r.bind("click",function(){return a.select(e),!1})},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){var t,i,n,s=null;for(t=0;t<this.panels.length;t+=1)if(this.isSelected(this.panels[t])){s=this.panels[t],s.handleSelection(!1);break}for(i=this.ui.find("ul"),i.find("li").removeClass("active"),n=this.ui.children().children("div.tab-content"),n.hide(),e.getHeader().addClass("active"),e.getContainer().show(),e.handleSelection(!0),t=0;t<this.tabChangeListeners.length;t+=1)this.tabChangeListeners[t](s,e)},isSelected:function(e){return e.getHeader().hasClass("active")},removePanel:function(e){var t,i=null;for(t=0;t<this.panels.length;t+=1)if(this.panels[t]===e){i=this.panels[t],this.panels.splice(t,1);break}if(0===this.panels.length)for(this.ui.html(this.emptyMsg),t=0;t<this.tabChangeListeners.length;t+=1)this.tabChangeListeners[t](e);else this.select(this.panels[0]);return i?(i.destroy(),!0):!1},insertTo:function(e){e.append(this.ui)}}),Oskari.clazz.define("Oskari.userinterface.component.TabDropdownContainer",function(e,t){this.button=t,this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabOption=jQuery("<option></option>"),this.templateTabs=jQuery('<div class="tabsHeader"><ul><li><select name="tabs"></select></li></ul></div><br clear="all"/><div class="tabsContent"></div>'),this.ui=this.template.clone()},{addPanel:function(e){var t=this;if(0===this.panels.length){var i=this.templateTabs.clone();t.ui.html(i),t.button&&t.button.insertTo&&t.button.insertTo(t.ui.find("li"))}var n=this.ui.find("ul li select"),s=this.templateTabOption.clone();s.attr("id","layer-id-"+e.getId()),s.append(e.getTitle()),n.append(s),e.setHeader(s),e.insertTo(this.ui.find("div.tabsContent")),this.panels.push(e),1===this.panels.length&&(this.select(e),n.bind("change",function(){t.select(t.panels[this.selectedIndex])}))},updatePanel:function(e){var t,i,n=this,s=n.ui.find("ul li select");for(t=0;t<s.find("option").length;t++)i=jQuery(s.find("option")[t]),i.attr("id")==="layer-id-"+e.getId()&&i.html(e.getTitle())},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){var t,i=null;if(this.tabChangeListeners.length>0)for(t=0;t<this.panels.length;t++)if(this.isSelected(this.panels[t])){i=this.panels[t];break}var n=this.ui.children().children("div.tab-content");n.hide();var s=this.ui.find("ul li select"),r=s.find("option");r.removeAttr("selected");var a=this._getPanelIndex(e);for(jQuery(r[a]).attr("selected","selected"),e.getContainer().show(),t=0;t<this.tabChangeListeners.length;t++)this.tabChangeListeners[t](i,e)},isSelected:function(e){var t=this.ui.find("ul li select :selected");return t.index()===this._getPanelIndex(e)},_getPanelIndex:function(e){var t;for(t=0;t<this.panels.length;t++)if(this.panels[t].getId()===e.getId())return t;return-1},removePanel:function(e){var t,i,n=null;for(t=0;t<this.panels.length;t++)if(this.panels[t].getId()===e.getId()){n=this.panels[t],this.panels.splice(t,1);break}var s=this.ui.find("ul li select :selected");for(t=0;t<s.length;t++)i=jQuery(s[t]),i.attr("id")==="layer-id-"+n.getId()&&i.remove();if(0===this.panels.length)for(this.ui.html(this.emptyMsg),t=0;t<this.tabChangeListeners.length;t++)this.tabChangeListeners[t](e);else this.select(this.panels[0]);return n?(n.destroy(),!0):!1},insertTo:function(e){e.append(this.ui)}}),Oskari.clazz.define("Oskari.userinterface.component.TabPanel",function(){this.template=jQuery('<div class="tab-content"></div>'),this.templateTabHeader=jQuery('<li><a href="JavaScript:void(0);"></a></li>'),this.id=null,this.title=null,this.content=null,this.header=null,this.selectionHandler=null,this.html=this.template.clone(),this.html.hide()},{setId:function(e){this.id=e},getId:function(){return this.id},setTitle:function(e){var t,i;this.title=e,t=this.templateTabHeader.clone(),this.header=t,i=t.find("a"),i.html(this.getTitle())},getTitle:function(){return this.title},setHeader:function(e){this.header=e},getHeader:function(){return this.header},setContent:function(e){this.content=e,this.html.html(this.content)},destroy:function(){this.header.remove(),this.html.remove()},getContainer:function(){return this.html},setSelectionHandler:function(e){this.selectionHandler=e},handleSelection:function(e){this.selectionHandler&&this.selectionHandler(e===!0)},insertTo:function(e){e.append(this.html)}}),Oskari.clazz.define("Oskari.userinterface.component.Badge",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<span class="oskari-badge"></span>',success:'<span class="oskari-badge oskari-badge-success"></span>',warning:'<span class="oskari-badge oskari-badge-warning"></span>',important:'<span class="oskari-badge oskari-badge-important"></span>',info:'<span class="oskari-badge oskari-badge-info"></span>',inverse:'<span class="oskari-badge oskari-badge-inverse"></span>'},compileTemplates:function(){var e;for(e in this.templates)this.templates.hasOwnProperty(e)&&(this.compiledTemplates[e]=jQuery(this.templates[e]))},insertTo:function(e){this.container=e},setContent:function(e,t){this.ui&&(this.ui.remove(),this.ui=null);var i=this.compiledTemplates[t||"default"].clone();i.append(e),this.container.append(i),this.ui=i},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),Oskari.clazz.define("Oskari.userinterface.component.Alert",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<div class="oskari-alert"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',success:'<div class="oskari-alert oskari-alert-success"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',error:'<div class="oskari-alert oskari-alert-error"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>',info:'<div class="oskari-alert oskari-alert-info"><div class="oskari-alert-icon-close"><div class="icon-close"></div></div></div>'},compileTemplates:function(){var e;for(e in this.templates)this.templates.hasOwnProperty(e)&&(this.compiledTemplates[e]=jQuery(this.templates[e]))},insertTo:function(e){this.container=e},setContent:function(e,t,i){this.ui&&(this.ui.remove(),this.ui=null);var n=this,s=n.compiledTemplates[t||"default"].clone(),r=!i;s.append(e),n.container.prepend(s),n.ui=s,r?s.children(".oskari-alert-icon-close").click(function(){n.hide()}):s.children(".oskari-alert-icon-close").remove()},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),Oskari.clazz.define("Oskari.userinterface.component.Popup",function(){this.template=jQuery('<div class="divmanazerpopup"><h3 class="popupHeader"></h3><div class="content"></div><div class="actions"></div></div>'),this.templateButton=jQuery('<div class="button"><a href="JavaScript:void(0);"></a></div>'),this.dialog=this.template.clone(),this.overlay=null},{show:function(e,t,i){var n,s,r,a,o=this,l=this.dialog.find("div.content");if(this.dialog.find("h3").html(e),l.html(t),i&&i.length>0)for(n=this.dialog.find("div.actions"),n.empty(),s=0;s<i.length;s+=1)i[s].insertTo(n);else this.dialog.bind("click",function(){o.close(!0)});jQuery("body").append(this.dialog),r=l.height(),a=.6*jQuery(document).height(),r>a&&(l.height(a),l.css("overflow-y","auto")),this.dialog.css("margin-left",-(this.dialog.width()/2)+"px"),this.dialog.css("margin-top",-(this.dialog.height()/2)+"px")},fadeout:function(e){var t=this,i=3e3;e&&(i=e),setTimeout(function(){t.close()},i)},addClass:function(e){this.dialog.addClass(e)},createCloseButton:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Button");return i.setTitle(e),i.setHandler(function(){t.close(!0)}),i},close:function(e){var t=this;this.overlay&&this.overlay.close(),this.hasKeydownListener&&jQuery(this.dialog).off("keydown",this._stopKeydownPropagation),e?t.dialog.remove():(t.dialog.animate({opacity:0},500),setTimeout(function(){t.dialog.remove()},500))},alignment:["left","right","top","bottom"],moveTo:function(e,t){var i=this,n="right",s=jQuery(e),r=s.offset();if(s&&0!==s.length&&r){var a=s.outerWidth(),o=s.outerHeight(),l=i.dialog.outerWidth(),u=i.dialog.outerHeight(),h=r.left,c=r.top;t&&-1!==jQuery.inArray(t,this.alignment)&&(n=t),"right"===n?(h=h+a+5,c=c+o/2-u/2):"left"===n?(h=h-l-5,c=c+o/2-u/2):"top"===n?(c=c-u-5,h=h+a/2-l/2):"bottom"===n&&(c=c+o+5,h=h+a/2-l/2),0>h&&(h=0),0>c&&(c=0),i.dialog.addClass("arrow"),i.dialog.addClass(t),i.dialog.css({left:h+"px",top:c+"px","margin-left":0,"margin-top":0})}},resetPosition:function(){var e;for(this.dialog.removeClass("arrow"),e=0;e<this.alignment.length;e+=1)this.dialog.removeClass(this.alignment[e]);this.dialog.removeAttr("style")},makeModal:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.Overlay");e.overlay("body"),this.overlay=e,e.followResizing(!0)},stopKeydownPropagation:function(){jQuery(this.dialog).keydown(this._stopKeydownPropagation),this.hasKeydownListener=!0},_stopKeydownPropagation:function(e){e.stopPropagation()},setContent:function(e){var t=this.dialog.find("div.content");t.empty(),t.append(e)},getContent:function(){return this.dialog.find("div.content")[0].textContent},getJqueryContent:function(){return this.dialog.find("div.content")},makeDraggable:function(){var e=this;e.dialog.css("position","absolute"),e.dialog.draggable({scroll:!1})}}),Oskari.clazz.define("Oskari.userinterface.component.Overlay",function(){this.template=jQuery('<div class="oskarioverlay transparent"></div>'),this._overlay=null,this._targetSelector=null,this._resizingWorkaround=null},{overlay:function(e){var t,i=this;i._overlay=this.template.clone(),i._targetSelector=e,this._targetSelector||(this._targetSelector="body"),t=jQuery(this._targetSelector),t.append(this._overlay),i._setupSizeAndLocation(),i._overlay.bind("click",function(e){e.preventDefault()})},_setupSizeAndLocation:function(){var e=this,t=jQuery(this._targetSelector);e._overlay.css({left:"0px",top:"0px",width:t.width()+"px",height:t.height()+"px"})},resize:function(){var e=jQuery(this._targetSelector);this._overlay.height(e.height()),this._overlay.width(e.width())},followResizing:function(e){var t=this;e?jQuery(window).resize(function(){t.resize()}):this._resizingWorkaround=setTimeout(function(){t.resize(),t.followResizing()},500)},close:function(){this._overlay.remove(),this._resizingWorkaround&&clearTimeout(this._resizingWorkaround)},bindClickToClose:function(){var e=this;e._overlay.bind("click",function(){e.close()})}}),Oskari.clazz.define("Oskari.userinterface.component.Button",function(){this.template=jQuery('<input type="button"/>'),this.title=null,this.ui=this.template.clone(),this.handler=null},{setTitle:function(e){this.title=e,this.ui&&this.ui.attr("value",e)},addClass:function(e){this.ui.addClass(e)},setEnabled:function(e){e===!0?this.ui.removeAttr("disabled"):this.ui.attr("disabled","disabled")},getTitle:function(){return this.title},setHandler:function(e){this.handler&&this.ui.unbind("click",this.handler),this.handler=e,this.ui.bind("click",this.handler)},destroy:function(){this.ui.remove()},insertTo:function(e){e.append(this.ui)},getButton:function(){return this.ui}}),Oskari.clazz.define("Oskari.userinterface.component.Form",function(){this.template=jQuery('<div class="oskariform"></div>'),this._form=this.template.clone(),this.fields=[]},{addField:function(e){this.fields.push(e)},getForm:function(){var e;for(this._form=this.template.clone(),e=0;e<this.fields.length;e+=1)this._form.append(this.fields[e].getField());return this._form},validate:function(){var e,t=[];for(e=0;e<this.fields.length;e+=1)t=t.concat(this.fields[e].validate());return t},showErrors:function(){var e,t;for(e=0;e<this.fields.length;e+=1)t=this.fields[e].validate(),this.fields[e].showErrors(t)},clearErrors:function(){var e;for(e=0;e<this.fields.length;e+=1)this.fields[e].clearErrors()}}),Oskari.clazz.define("Oskari.userinterface.component.UIHelper",function(e){this.sandbox=e},{processHelpLinks:function(e,t,i,n){if(t){var s,r=this;s=function(t){return function(s,r){var a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=a.createCloseButton("OK");o.addClass("primary"),s?(a.show(e,r.static,[o]),a.moveTo(t,"bottom")):a.show(i,n,[o])}},t.find("[helptags]").each(function(e,t){var i=jQuery(t),n=i.attr("helptags");i.bind("click",function(){r.getHelpArticle(n,s(i))})})}},getHelpArticle:function(e,t){var i=this;jQuery.ajax({url:i.sandbox.getAjaxUrl()+"action_route=GetArticlesByTag",data:{tags:e},type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){e&&e.articles[0]&&e.articles[0].content?t(!0,e.articles[0].content):t(!1)},error:function(){t(!1)}})}}),Oskari.clazz.define("Oskari.userinterface.component.FormInput",function(e,t){var i,n,s=t||Oskari.getSandbox();this.sandbox=s,this.template=jQuery('<div class="oskarifield"><label></label><input type="text" autofocus/></div>'),this.templateErrors=jQuery('<div class="error"></div>'),this.templateTooltip=jQuery('<div class="icon-info"></div>'),this.templateClearButton=jQuery('<div class="icon-close"></div>'),this._field=this.template.clone(),i=this._field.find("label"),i.attr("for",e),n=this._field.find("input").focus(),n.attr("name",e),this._name=e,this._validator=null,this._required=!1,this._requiredMsg="required",this._contentCheck=!1,this._contentCheckMsg="illegal characters",this._bindFocusAndBlur(),this._regExp=/[\s\w\d\.\,\?\!\-äöåÄÖÅ]*/,this._colorRegExp=/^([A-Fa-f0-9]{6})$/},{setLabel:function(e){var t=this._field.find("label");t.html(e)},setTooltip:function(e,t){var i,n=this.templateTooltip.clone();n.attr("title",e),t&&(n.addClass("help"),n.attr("helptags",t)),i=this._field.find("label"),i.before(n)},setPlaceholder:function(e){var t=this._field.find("input");t.attr("placeholder",e)},setRequired:function(e,t){this._required=e===!0,t&&(this._requiredMsg=t)},setContentCheck:function(e,t,i){this._contentCheck=e===!0,i&&(this._regExp=i),t&&(this._contentCheckMsg=t)},showErrors:function(e){this.clearErrors();var t,i=this.templateErrors.clone();for(t=0;t<e.length;t+=1)i.append(e[t].error+"<br/>");this._field.append(i)},clearErrors:function(){var e=this._field.find("div.error");e.remove()},getField:function(){return this._field},getValue:function(e){var t=this._field.find("input").val();return e&&(t=t.match(this._regExp)),String(t)},setValue:function(e){this._field.find("input").attr("value",e)},getName:function(){return this._name},setEnabled:function(e){e===!0?this._field.find("input").removeAttr("disabled"):this._field.find("input").attr("disabled","disabled")},setRegExp:function(e){this._regExp=e},setValidator:function(e){this._validator=e},validate:function(){var e,t=[];return this._validator&&(t=this._validator(this)),e=this.getValue(),this._required&&(this.checkLength(e,1)||t.push({field:this.getName(),error:this._requiredMsg})),this._contentCheck&&(this.checkValue()||t.push({field:this.getName(),error:this._contentCheckMsg})),t},checkLength:function(e,t,i){if(e){var n=jQuery.trim(e.toString());return t&&n.length<t?!1:i&&n.length>i?!1:!0}return!1},checkValue:function(){var e=this.getValue(),t=this.getValue(!0);return e===t},validateNumberRange:function(e,t,i){return isNaN(parseInt(e,10))?!1:isFinite(e)?t>e||e>i?!1:!0:!1},validateHexColor:function(e){return this._colorRegExp.test(e)},bindEnterKey:function(e){var t=this,i=this._field.find("input");i.keypress(function(i){t._isEnterPress(i)&&e(i)})},bindUpKey:function(e){"use strict";var t=this,i=this._field.find("input");i.keydown(function(i){t._isUpPress(i)&&(i.preventDefault(),e(i))})},bindDownKey:function(e){"use strict";var t=this,i=this._field.find("input");i.keydown(function(i){t._isDownPress(i)&&(i.preventDefault(),e(i))})},bindOnBlur:function(e){"use strict";var t=this._field.find("input");t.blur(function(){e()})},bindChange:function(e,t){var i=this._field.find("input");t?i.keyup(e):i.on("change",e)},addClearButton:function(){var e=this.templateClearButton.clone(),t=this._field.find("input");e.bind("click",function(){t.val(""),t.trigger("change"),t.trigger("keyup")}),t.after(e)},_bindFocusAndBlur:function(){var e,t,i,n=this.sandbox;n&&(e=n.getRequestBuilder("EnableMapKeyboardMovementRequest"),t=n.getRequestBuilder("DisableMapKeyboardMovementRequest"),e&&t&&(i=this._field.find("input"),i.focus(function(){n.postRequestByName("DisableMapKeyboardMovementRequest")}),i.blur(function(){n.postRequestByName("EnableMapKeyboardMovementRequest")})))},_isEnterPress:function(e){var t=e.which;return 13===t},_isDownPress:function(e){var t=e.which;return 40===t},_isUpPress:function(e){var t=e.which;return 38===t}}),!function(e){var t=function(e,t){this.init("oskariTooltip",e,t)},i=function(e,t){this.init("oskariPopover",e,t)};t.prototype={constructor:t,init:function(t,i,n){var s,r;this.type=t,this.$element=e(i),this.options=this.getOptions(n),this.enabled=!0,"manual"!==this.options.trigger&&(s="hover"===this.options.trigger?"mouseenter":"focus",r="hover"===this.options.trigger?"mouseleave":"blur",this.$element.on(s,this.options.selector,e.proxy(this.enter,this)),this.$element.on(r,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.show?(clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){"in"===i.hoverState&&i.show()},i.options.delay.show),void 0):i.show()},leave:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.hide?(clearTimeout(this.timeout),i.hoverState="out",this.timeout=setTimeout(function(){"out"===i.hoverState&&i.hide()},i.options.delay.hide),void 0):i.hide()},show:function(){var e,t,i,n,s,r,a;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),r=this.options.placement.apply(this.options.scope),t=/in/.test(r),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),i=this.getPosition(t),n=e[0].offsetWidth,s=e[0].offsetHeight,t?r.split(" ")[1]:r){case"bottom":a={top:i.top+i.height,left:i.left+i.width/2-n/2};break;case"top":a={top:i.top-s,left:i.left+i.width/2-n/2};break;case"left":a={top:i.top+i.height/2-s/2,left:i.left-n};break;case"right":a={top:i.top+i.height/2-s/2,left:i.left+i.width}}e.css(a).addClass(r).addClass("in")}},isHTML:function(e){return"string"!=typeof e||"<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(e)},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".oskari-tooltip-inner")[this.isHTML(t)?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){i.off(e.support.transition.end).remove()},500);i.one(e.support.transition.end,function(){clearTimeout(t),i.remove()})}var i=this.tip();i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():i.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){return this.options.title.apply(this.options.scope)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},attach:function(e){this.$element=e}},e.fn.oskariTooltip=function(i){return this.each(function(){var n=e(this),s=n.data("oskariTooltip"),r="object"==typeof i&&i;s||n.data("oskariTooltip",s=new t(this,r)),"string"==typeof i&&s[i]()})},e.fn.oskariTooltip.Constructor=t,e.fn.oskariTooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="oskari-tooltip"><div class="oskari-tooltip-arrow"></div><div class="oskari-tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0},i.prototype=e.extend({},e.fn.oskariTooltip.Constructor.prototype,{constructor:i,setContent:function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();e.find(".oskari-popover-title")[this.isHTML(t)?"html":"text"](t),e.find(".oskari-popover-content > *")[this.isHTML(i)?"html":"text"](i),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){return this.options.content.apply(this.options.scope)},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.oskariPopover=function(t){return this.each(function(){var n=e(this),s=n.data("oskariPopover"),r="object"==typeof t&&t;s||n.data("oskariPopover",s=new i(this,r)),"string"==typeof t&&s[t]()})},e.fn.oskariPopover.Constructor=i,e.fn.oskariPopover.defaults=e.extend({},e.fn.oskariTooltip.defaults,{placement:"right",content:"",template:'<div class="oskari-popover"><div class="oskari-arrow"></div><div class="oskari-popover-inner"><h3 class="oskari-popover-title"></h3><div class="oskari-popover-content"><p></p></div></div></div>'}),Oskari.clazz.define("Oskari.userinterface.component.Popover",function(e,t){this.title=e,this.content=t,this.$container=null,this.data=null,this.shown=!1,this.placement="bottom"},{templates:{container:'<div class="oskari-popover-container"/>'},hide:function(){this.shown&&(this.shown=!1,this.data&&this.data.hide())},show:function(){this.shown||this.data&&(this.data.show(),this.shown=!0)},attachTo:function(t){var n=this;n.$container=e(t),n.data?n.data.attach(n.$container):n.data=new i(t,{scope:n,title:n.getTitle,content:n.getContent,trigger:"manual",placement:n.getPlacement}),n.$container.data("oskariPopover",n.data)},getTitle:function(){return this.title},getContent:function(){return this.content},setContent:function(e,t){var i=this;i.hide(),i.content=e,t&&(i.title=t),i.show()},setTitle:function(e,t){var i=this;i.hide(),i.title=e,t&&(i.content=t),i.show()},setPlacement:function(e){this.placement=e},getPlacement:function(){return this.placement}})}(window.jQuery),Oskari.clazz.define("Oskari.userinterface.component.Grid",function(e){this.model=null;var t="";null!==e&&void 0!==e&&(t=e),this.template=jQuery('<table class="oskari-grid"><thead><tr></tr></thead><tbody></tbody></table>'),this.templateTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateDiv=jQuery("<div></div>"),this.templateRow=jQuery("<tr></tr>"),this.templateCell=jQuery("<td></td>"),this.templatePopupLink=jQuery('<a href="JavaScript: void(0);"></a>'),this.templateColumnSelectorButtonWrapper=jQuery("<div/>",{}),this.templateColumnSelectorButton=jQuery("<div/>",{title:t}),this.templateColumnSelector=jQuery("<div/>",{}),this.templateColumnSelectorList=jQuery("<ul/>",{}),this.templateColumnSelectorListItem=jQuery('<li><div><input type="checkbox"/><label></label></div></li>'),this.templateColumnSelectorClose=jQuery('<div class="icon-close close-selector-button"></div>'),this.table=null,this.fieldNames=[],this.selectionListeners=[],this.additionalDataHandler=null,this.visibleColumnSelector=null,this.showColumnSelector=!1,this.resizableColumns=!1,this.uiNames={},this.valueRenderer={},this.lastSort=null},{setDataModel:function(e){this.model=e},getDataModel:function(){return this.model},setColumnSelector:function(e){this.showColumnSelector=e},setResizableColumns:function(e){this.resizableColumns=e},setColumnUIName:function(e,t){this.uiNames[e]=t},setColumnValueRenderer:function(e,t){this.valueRenderer[e]=t},setVisibleFields:function(e){this.fieldNames=e},addSelectionListener:function(e){this.selectionListeners.push(e)},setAdditionalDataHandler:function(e,t){this.additionalDataHandler={title:e,handler:t}},_createAdditionalDataField:function(e){var t,i=this,n=this._renderAdditionalData(e);return!e.size&&this.additionalDataHandler?(t=this.templatePopupLink.clone(),t.append(this.additionalDataHandler.title),t.bind("click",function(){return i.additionalDataHandler.handler(t,n),!1}),t):n},_renderAdditionalData:function(e){var t,i,n,s,r,a,o,l,u=this.template.clone(),h=u.find("tbody");if(e.size){for(t="",o=0;o<e.size();o+=1)0!==o&&(t+=", "),t+=e[o];return t}if(jQuery.isArray(e)){var c=this.templateDiv.clone();for(o=0;o<e.length;++o)a=this._renderAdditionalData(e[o]),c.append(a);return c}for(l in e)if(e.hasOwnProperty(l)){i=this.templateRow.clone(),n=this.templateCell.clone(),s=this.templateCell.clone(),t=e[l],n.append(l),i.append(n);try{r=typeof t,"object"===r?(a=this._renderAdditionalData(t),s.append(a)):"function"!==r&&s.append(t),i.append(s)}catch(p){}h.append(i)}return u},_renderHeader:function(e,t){var i,n,s,r,a,o,l=this,u=e.find("thead tr"),h=e.find("tbody");for(o=function(i){return function(){var n,s,r=jQuery(this),a=l.getSelection(),o=!1;for(h.empty(),l.lastSort&&l.lastSort.attr===i&&(o=!l.lastSort.descending),l._sortBy(i,o),l._renderBody(e,t),u.find("th").removeClass("asc"),u.find("th").removeClass("desc"),o?r.parent().addClass("desc"):r.parent().addClass("asc"),n=l.model.getIdField(),s=0;s<a.length;s+=1)l.select(a[s][n],!0);return!1}},i=0;i<t.length;i+=1)n=this.templateTableHeader.clone(),s=n.find("a"),r=t[i],a=this.uiNames[r],a||(a=r),s.append(a),l.lastSort&&r===l.lastSort.attr&&(l.lastSort.descending?n.addClass("desc"):n.addClass("asc")),s.bind("click",o(t[i])),u.append(n)
},_renderBody:function(e,t){var i,n,s,r,a,o,l,u,h,c,p=this,d=e.find("tbody"),m=this.model.getData();for(i=0;i<m.length;i+=1){for(n=this.templateRow.clone(),s=m[i],n.attr("data-id",s[this.model.getIdField()]),r=0;r<t.length;r+=1)a=t[r],o=s[a],l=this.templateCell.clone(),"object"==typeof o?l.append(this._createAdditionalDataField(o)):(u=this.valueRenderer[a],u&&(o=u(o,s)),l.append(o)),n.append(l);d.append(n)}h=e.find("tbody tr"),c=function(){p._dataSelected(jQuery(this).attr("data-id"))},h.bind("click",c),h.find("a").hover(function(){jQuery(this).parents("tr").unbind("click")},function(){jQuery(this).parents("tr").bind("click",c)})},_renderColumnSelector:function(e,t){this.visibleColumnSelector=this.templateColumnSelectorButtonWrapper.clone();var i,n,s,r,a,o,l=this,u=this.templateColumnSelectorButton.clone(),h=this.templateColumnSelector.clone(),c=this.templateColumnSelectorList.clone(),p=this.templateColumnSelectorClose.clone();for(this.visibleColumnSelector.addClass("column-selector-placeholder"),u.addClass("icon-menu"),h.addClass("column-selector"),this.visibleColumnSelector.append(u),this.visibleColumnSelector.append(h),jQuery("input.column-selector-list-item").remove(),u.click(function(){"hidden"!==h.css("visibility")?h.css("visibility","hidden"):h.css("visibility","visible")}),p.click(function(e){e.stopPropagation(),h.css("visibility","hidden")}),i=this.model.getFields(),s=0;s<i.length;s+=1){for(n=!1,r=0;r<t.length;r+=1)if(i[s]===t[r]){n=!0;break}a=this.templateColumnSelectorListItem.clone(),a.addClass("column-selector-list-item"),o=a.find("input"),o.attr("checked",n),o.addClass("column-selector-list-item"),o.attr("id",i[s]),a.find("label").attr({"for":i[s],"class":"column-label"}).html(i[s]),a.css({margin:"5px"}),o.change(function(){var e,t,i=jQuery("input.column-selector-list-item"),n=l.model.getFields(),s=[];for(e=0;e<n.length;e+=1)for(t=0;t<i.length;t+=1)if(n[e]===i[t].id){i[t].checked&&s.push(n[e]);break}s.length>0&&l.setVisibleFields(s),l.renderTo(l.visibleColumnSelector.parent(),{columnSelector:"open"})}),c.append(a)}c.attr("class","column-selector-list"),h.append(c,p),p.click(function(e){e.stopPropagation(),h.css("visibility","hidden")})},_enableColumnResizer:function(){var e,t,i,n=!1,s=jQuery("table.oskari-grid th");s.css("cursor","e-resize"),s.mousedown(function(s){e=jQuery(this),n=!0,t=s.pageX,i=jQuery(this).width(),jQuery(e).addClass("resizing"),jQuery(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1)}),jQuery(document).mousemove(function(s){n&&jQuery(e).width(i+(s.pageX-t))}),jQuery(document).mouseup(function(){n&&(jQuery(e).removeClass("resizing"),n=!1)})},renderTo:function(e,t){e.empty();var i=this.fieldNames,n=this.template.clone();0===i.length&&(i=this.model.getFields()),this.table=n,this._renderHeader(n,i),this.lastSort&&this._sortBy(this.lastSort.attr,this.lastSort.descending),this._renderBody(n,i),this.showColumnSelector&&(this._renderColumnSelector(n,i),e.append(this.visibleColumnSelector),null!==t&&void 0!==t&&"open"===t.columnSelector&&this.visibleColumnSelector.find(".column-selector").css("visibility","visible")),e.append(n),this.resizableColumns&&this._enableColumnResizer()},_dataSelected:function(e){var t;for(t=0;t<this.selectionListeners.length;t+=1)this.selectionListeners[t](this,e)},select:function(e,t){var i,n,s,r=this.model.getIdField(),a=this.model.getData();for(i=0;i<a.length&&(s=a[i],s[r]!==e);i+=1);n=this.table.find("tbody tr"),t!==!0&&n.removeClass("selected"),jQuery(n[i]).addClass("selected")},removeSelections:function(){var e=this.table.find("tbody tr");e.removeClass("selected")},getSelection:function(){var e,t,i=this.model.getData(),n=[],s=this.table.find("tbody tr");for(e=0;e<s.length;e+=1)t=jQuery(s[e]),t.hasClass("selected")&&n.push(i[e]);return n},getTable:function(){return this.table},_sortBy:function(e,t){var i=this,n=i.model.getData();0!==n.length&&(this.lastSort={attr:e,descending:t},n.sort(function(n,s){return i._sortComparator(n,s,e,t)}))},_sortComparator:function(e,t,i,n){var s,r,a;return"object"==typeof e[i]||"object"==typeof t[i]?0:(s=e[i],s?s.toLowerCase&&(s=s.toLowerCase()):s="",r=t[i],r?r.toLowerCase&&(r=r.toLowerCase()):r="",a=0,r>s?a=-1:s>r&&(a=1),n&&(a=-1*a),a)}}),Oskari.clazz.define("Oskari.userinterface.component.GridModel",function(){this.fields=[],this.data=[],this.idField=null},{_addField:function(e){this.idField||(this.idField=e),this.fields.push(e)},getFields:function(){return this.fields},setIdField:function(e){this.idField=e},getIdField:function(){return this.idField},addData:function(e){var t;if(0===this.fields.length)for(t in e)e.hasOwnProperty(t)&&this._addField(t);this.data.push(e)},getData:function(){return this.data}}),Oskari.clazz.define("Oskari.userinterface.component.ProgressSpinner",function(){this.container=void 0,this.opts=void 0},{__opts:{lines:15,length:0,width:5,radius:16,corners:0,rotate:0,color:"#000",speed:.6,trail:59,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},insertTo:function(e,t){this.container=e,this.opts=t||this.__opts},start:function(){var e=this.container,t=$(e),i=t.data(),n=this._Spinner,s=this.opts;i.spinner&&(i.spinner.stop(),delete i.spinner),s!==!1&&(i.spinner=new n($.extend({color:t.css("color")},s)).spin(t.get()[0]))},stop:function(){var e,t,i=this.container;i&&(e=$(i),t=e.data(),t.spinner&&(t.spinner.stop(),delete t.spinner))},_Spinner:function(e,t){function i(e,i){var n,s=t.createElement(e||"div");for(n in i)i.hasOwnProperty(n)&&(s[n]=i[n]);return s}function n(e){var t,i;for(t=1,i=arguments.length;i>t;t+=1)e.appendChild(arguments[t]);return e}function s(e,t,i,n){var s=["opacity",t,~~(100*e),i,n].join("-"),r=.01+100*(i/n),a=Math.max(1-(1-e)/t*(100-r),e),o=h.substring(0,h.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return d[s]||(c.insertRule("@"+l+"keyframes "+s+"{"+"0%{opacity:"+a+"}"+r+"%{opacity:"+e+"}"+(r+.01)+"%{opacity:1}"+(r+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+a+"}"+"}",c.cssRules.length),d[s]=1),s}function r(e,t){var i,n,s=e.style;if(void 0!==s[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<p.length;n+=1)if(i=p[n]+t,void 0!==s[i])return i}function a(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e.style[r(e,i)||i]=t[i]);return e}function o(e){var t,i,n;for(n=1;n<arguments.length;n+=1){t=arguments[n];for(i in t)t.hasOwnProperty(i)&&void 0===e[i]&&(e[i]=t[i])}return e}function l(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function u(e){return this.spin?(this.opts=o(e||{},u.defaults,m),void 0):new u(e)}var h,c,p=["webkit","Moz","ms","O"],d={},m={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};return c=function(){var e=i("style",{type:"text/css"});return n(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),u.defaults={},o(u.prototype,{spin:function(e){this.stop();var t,n,s,r,o,u,c,p=this,d=p.opts,m=p.el=a(i(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex}),f=d.radius+d.length+d.width;return e&&(e.insertBefore(m,e.firstChild||null),n=l(e),t=l(m),a(m,{left:("auto"===d.left?n.x-t.x+(e.offsetWidth>>1):parseInt(d.left,10)+f)+"px",top:("auto"===d.top?n.y-t.y+(e.offsetHeight>>1):parseInt(d.top,10)+f)+"px"})),m.setAttribute("aria-role","progressbar"),p.lines(m,p.opts),h||(s=0,r=d.fps,o=r/d.speed,u=(1-d.opacity)/(o*d.trail/100),c=o/d.lines,function y(){var e,t;for(s+=1,e=d.lines;e;e-=1)t=Math.max(1-(s+e*c)%o*u,d.opacity),p.opacity(m,d.lines-e,t,d);p.timeout=p.el&&setTimeout(y,~~(1e3/r))}()),p},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(e,t){function r(e,n){return a(i(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*o+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var o,l;for(o=0;o<t.lines;o+=1)l=a(i(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:h&&s(t.opacity,t.trail,o,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&n(l,a(r("#000","0 0 4px #000"),{top:"2px"})),n(e,n(l,r(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),function(){function e(e,t){return i("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=a(i("group"),{behavior:"url(#default#VML)"});!r(t,"transform")&&t.adj?(c.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(t,i){function s(){return a(e("group",{coordsize:c+" "+c,coordorigin:-h+" "+-h}),{width:c,height:c})}function r(t,r,o){n(l,n(a(s(),{rotation:360/i.lines*t+"deg",left:~~r}),n(a(e("roundrect",{arcsize:i.corners}),{width:h,height:i.width,left:i.radius,top:-i.width>>1,filter:o}),e("fill",{color:i.color,opacity:i.opacity}),e("stroke",{opacity:0}))))}var o,l,u,h=i.length+i.width,c=2*h;if(o=2*-(i.width+i.length)+"px",l=a(s(),{position:"absolute",top:o,left:o}),i.shadow)for(u=1;u<=i.lines;u+=1)r(u,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(u=1;u<=i.lines;u+=1)r(u);return n(t,l)},u.prototype.opacity=function(e,t,i,n){var s=e.firstChild;n=n.shadow&&n.lines||0,s&&t+n<s.childNodes.length&&(s=s.childNodes[t+n],s=s&&s.firstChild,s=s&&s.firstChild,s&&(s.opacity=i))}):h=r(t,"animation")}(),u}(window,document)}),Oskari.clazz.define("Oskari.userinterface.component.VisualizationForm",function(e){this._clazzPrefix="Oskari.userinterface.component.visualization-form.",this._clazzSuffix="Form",this._iconClsPrefix="icon-",this._defaultLocKey="VisualizationForm",this._loc=this._getLocalization("DivManazer"),this.lineCapMap=["butt","round"],this.lineCornerMap=["mitre","round","bevel"],this.lineStyleMap=["","5 2",""],this.dialog=null;var t={forms:["dot","line","area"],formValues:{dot:{shape:1,color:"000000",size:3},line:{style:0,cap:0,corner:0,width:1,color:"3233ff"},area:{line:{width:1,corner:0,style:0,color:"000000"},fill:{style:-1,color:"ffde00"}}}};e=e||{},this._options=jQuery.extend({},t,e),this._formClazzes=this._createFormClazzes(this._options.forms,this._options.formValues),this.template=jQuery('<div id="visualization-form"></div>'),this.templateRenderButton=jQuery('<div class="renderButton"></div>')},{getForm:function(){var e,t,i=this,n=this.template.clone(),s=this._getFormClazz();for(t in s)s.hasOwnProperty(t)&&(e=this.templateRenderButton.clone(),e.attr("title",this._loc.tooltips[t]),e.addClass(this._iconClsPrefix+("dot"===t?"point":t)),e.click(i._bindRenderButton(s[t])),n.append(e));return n},getValues:function(){var e,t,i={},n=this._getFormClazz();for(e in n)n.hasOwnProperty(e)&&(t=n[e],i[e]=t.getValues());return i},setValues:function(e){if(null!==e&&void 0!==e&&"object"==typeof e){var t,i,n=this._getFormClazz();for(t in n)n.hasOwnProperty(t)&&(i=n[t],i.setValues(e[t]))}},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgbToHex:function(e){if("#"===e.charAt(0))return e.substring(1);var t,i=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);for(delete i[0],t=1;3>=t;++t)i[t]=parseInt(i[t],10).toString(16),1===i[t].length&&(i[t]="0"+i[t]);return i.join("")},_bindRenderButton:function(e){var t=this;return function(i){e&&e.showForm&&"function"==typeof e.showForm&&(t.dialog&&t.dialog.close(!0),t.dialog=e.showForm(i.target))}},_getFormClazz:function(e){var t;return t=null!==e&&void 0!==e?this._formClazzes[e]:this._formClazzes},_getLocalization:function(e){var t=Oskari.getLocalization(e),i=null;return t&&(i=t[this._defaultLocKey]),i},_createFormClazzes:function(e,t){var i,n,s,r,a=e?e.length:0,o={};for(i=0;a>i;++i)n=e[i],s=t[n],r=this._createFormClazz(n,s),o[n]=r;return o},_createFormClazz:function(e,t){var i=this._capitalize(e),n=this._clazzPrefix+i+this._clazzSuffix,s=this._loc[e];return Oskari.clazz.create(n,this,s,t)},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.AreaForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.first=!0,this.values={lineWidth:this.defaultValues.line.width,lineCorner:this.defaultValues.line.corner,lineStyle:this.defaultValues.line.style,lineColor:this.defaultValues.line.color,fillColor:this.defaultValues.fill.color,fillStyle:this.defaultValues.fill.style},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.colorTypes=["line","fill"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=[-1,-1];var n,s;for(n=0;n<this.basicColors.length;n++)for(s=0;s<this.basicColors.length;s++)if(this.basicColors[s]==="#"+this.values.fillColor[n]){this.activeColorCell[n]=s;break}this.fillButtonNames=["icon-line-thin-diagonal","icon-line-wide-diagonal","icon-line-thin-horizontal","icon-line-wide-horizontal"],this.templateAreaStyleDialogContent=jQuery('<div class="areaform"><div class="container"><div class="column1"><label>'+this.loc.linestyle.label+"</label>"+'<div class="style icon-buttons"></div>'+"<label>"+this.loc.linecorner.label+"</label>"+'<div class="corner icon-buttons"></div>'+"<label>"+this.loc.linewidth.label+"</label><br>"+'<div class="width"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.linecolor.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle line"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.linecolor.labelOr+"</label>"+"</div>"+'<div class="color-source-selector-line">'+"<label>"+this.loc.linecolor.labelCustom+"</label>"+"</div>"+'<div class="custom-colors-line"></div>'+"</div>"+'<div class="column22">'+'<div class="column221">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle fill"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector-fill">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors-fill"></div>'+"<label>"+this.loc.fill.label+"</label>"+'<div class="fill icon-buttons"></div>'+"</div>"+'<div class="column222">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=5,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.lineWidth+'">'),this.previewSize=50,this.selectColor="#dddddd"},{getValues:function(){var e=this.values.lineCorner,t=this.values.lineStyle;return"number"==typeof e&&(e=this.creator.lineCornerMap[e]),"number"==typeof t&&(t=this.creator.lineStyleMap[t]),{lineWidth:this.values.lineWidth,lineCorner:e,lineStyle:t,lineColor:this.values.lineColor,fillColor:this.values.fillColor,fillStyle:this.values.fillStyle}},setValues:function(e){var t;if(null!==e&&void 0!==e){for(t=0;t<this.creator.lineCornerMap.length;t++)e.lineCorner===this.creator.lineCornerMap[t]&&(e.lineCorner=t);for(t=0;t<this.creator.lineStyleMap.length;t++)e.lineStyle===this.creator.lineStyleMap[t]&&(e.lineStyle=t);jQuery.extend(!0,this.values,e)}},showForm:function(e,t){var i=this;null!==t&&void 0!==t&&jQuery.extend(!0,i.values,t.area);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.addClass("renderdialog"),n.addClass("areavisualization");var s,r,a,o,l=i.loc.title,u=i.templateAreaStyleDialogContent.clone(),h=u.find("div.style");for(0===i.values.lineStyle.length&&(i.values.lineStyle=0),s=0;s<i.styleButtonNames.length;s++)r=i.templateButton.clone(),r.addClass(i.styleButtonNames[s]),r.attr("id",s+"linestyle"),s===i.values.lineStyle&&this._styleSelectedButton(r),r.click(function(){a=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("lineStyle",a),i.values.lineStyle=a,i._updatePreview(u)}),h.append(r);for(h=u.find("div.corner"),s=0;s<i.cornerButtonNames.length;s++)o=i.templateButton.clone(),o.addClass(i.cornerButtonNames[s]),o.attr("id",s+"linecorner"),s===i.values.lineCorner&&this._styleSelectedButton(o),o.click(function(){a=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("lineCorner",a),i.values.lineCorner=a,i._updatePreview(u)}),h.append(o);h=u.find("div.width");var c=i.templateWidthValue.clone();c.val(null!==i.values.lineWidth&&void 0!==i.values.lineWidth?i.values.lineWidth:1),c.change(function(){var e=parseInt(c.val(),10);isNaN(e)||(i.values.lineWidth=e,i._updatePreview())}),h.append(c);var p,d,m,f,y,g,v,b,L,O,w,_;for(p=0;2>p;p++){for(d=!1,m=0===p?"lineColor":"fillColor",h=u.find(".color-rectangle."+i.colorTypes[p]),s=0;s<i.basicColors.length;s++)f=i.templateColorCell.clone(),f.css("background-color",i.basicColors[s]),y="ColorCell",g=s.toString()+p.toString()+y,g.length===y.length+2&&(g="0"+g),f.attr("id",g),f.click(function(){var e=parseInt(this.id.substring(0,2),10),t=parseInt(this.id.substring(2,3),10);if(!jQuery("#"+t+"color-checkbox").prop("checked")&&e!==i.activeColorCell[t]){if(i.activeColorCell[t]>-1){var n=i.activeColorCell[t].toString();i.activeColorCell[t]<10&&(n="0"+n),jQuery("#"+n+t+"ColorCell").css("border","1px solid #000000")}i.values[0===t?"lineColor":"fillColor"]=i.creator.rgbToHex(this.style.backgroundColor),i.activeColorCell[t]=e,10>e&&(e="0"+e.toString()),jQuery("#"+e+t+"ColorCell").css("border","3px solid #ffffff"),i._updatePreview(u)}}),"#"+i.values[m]===i.basicColors[s]&&(f.css("border","3px solid #ffffff"),i.activeColorCell[p]=s,d=!0),h.append(f);h=u.find(".color-source-selector-"+i.colorTypes[p]),v=i.templateColorSource.clone(),v.attr("id",p+"color-checkbox"),-1===i.activeColorCell[p]&&v.attr("checked",!0),v.change(function(){var e=this.id.substring(0,1),t="0"===e?"lineColor":"fillColor";jQuery("input.custom-color."+i.colorTypes[e]).prop("disabled",!this.checked);var n=i.activeColorCell[e].toString();i.activeColorCell[e]<10&&(n="0"+n);var s=jQuery("#"+n+e+"ColorCell");this.checked&&(s.css("border","1px solid #000000"),jQuery(".custom-red-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(0,2),16)),jQuery(".custom-green-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(2,4),16)),jQuery(".custom-blue-value."+i.colorTypes[e]).val(parseInt(i.values[t].substring(4),16)),i.activeColorCell[e]=-1),i._updatePreview(u)}),h.prepend(v),d||(v.checked=!0,h.find("input.color-source").prop("disabled",!1).attr("checked","checked")),h=u.find(".custom-colors-"+i.colorTypes[p]),b=this.templateCustomColor.clone(),b.addClass(i.colorTypes[p]),h.append(b),L=i.templateColorValue.clone(),L.addClass("custom-red-value"),L.addClass(i.colorTypes[p]),-1===i.activeColorCell[p]&&(L.val(parseInt(i.values.lineColor.substring(0,2),16)),L.prop("disabled",!1)),h.find(".colorcolumn1").append(L),h.find("label.custom-red-value").text("R"),h.find("input.custom-red-value").attr("id",p+"red-value"),O=i.templateColorValue.clone(),O.addClass("custom-green-value"),O.addClass(i.colorTypes[p]),-1===i.activeColorCell[p]&&(O.val(parseInt(i.values[m].substring(2,4),16)),O.prop("disabled",!1)),h.find(".colorcolumn21").append(O),h.find("label.custom-green-value").text("G"),h.find("input.custom-green-value").attr("id",p+"green-value"),w=i.templateColorValue.clone(),w.addClass("custom-blue-value"),w.addClass(i.colorTypes[p]),-1===i.activeColorCell[p]&&(w.val(parseInt(i.values[m].substring(4),16)),w.prop("disabled",!1)),h.find(".colorcolumn22").append(w),h.find("label.custom-blue-value").text("B"),h.find("input.custom-blue-value").attr("id",p+"blue-value"),d||(_=i.creator.hexToRgb(i.values[m]),h.find("input.custom-color.custom-red-value").val(_.r),h.find("input.custom-color.custom-green-value").val(_.g),h.find("input.custom-color.custom-blue-value").val(_.b),u.find("input#"+p.toString()+"red-value.custom-color").prop("disabled",!1),u.find("input#"+p.toString()+"green-value.custom-color").prop("disabled",!1),u.find("input#"+p.toString()+"blue-value.custom-color").prop("disabled",!1)),h.find(".custom-color").change(function(){var e,t,n=this.id.substring(0,1),s=[];for(s[0]=jQuery("input#"+n+"red-value").val(),s[1]=jQuery("input#"+n+"green-value").val(),s[2]=jQuery("input#"+n+"blue-value").val(),e=0;3>e;e++){if(t=parseInt(s[e],10),0>t||t>255)return;s[e]=t.toString(16),1===s[e].length&&(s[e]="0"+s[e])}i.values["0"===n?"lineColor":"fillColor"]=s.join(""),i._updatePreview()})}for(h=u.find("div.fill.icon-buttons"),s=0;s<i.fillButtonNames.length;s++){var x=i.templateButton.clone();x.addClass(i.fillButtonNames[s]),x.attr("id",s+"fillstyle"),s===i.values.fillStyle&&this._styleSelectedButton(x),x.click(function(){var e=parseInt(jQuery(this).attr("id").charAt(0),10);i.values.fillStyle===e?(i.values.fillStyle=-1,i._styleUnselectedButton(jQuery("div#"+e+"fillstyle.icon-button"))):(-1!==i.values.fillStyle&&i._styleUnselectedButton(jQuery("div#"+i.values.fillStyle+"fillstyle.icon-button")),i._styleSelectedButton(jQuery("div#"+e+"fillstyle.icon-button")),i.values.fillStyle=e),i._updatePreview(u)}),h.append(x)}this._updatePreview(u);var S=Oskari.clazz.create("Oskari.userinterface.component.Button");S.setTitle(i.loc.buttons.save),S.addClass("primary showSelection"),S.setHandler(function(){n.close()});var C=Oskari.clazz.create("Oskari.userinterface.component.Button");return C.setTitle(i.loc.buttons.cancel),C.setHandler(function(){i.values.lineWidth=i.defaultValues.line.width,i.values.lineCorner=i.defaultValues.line.corner,i.values.lineStyle=i.defaultValues.line.style,i.values.lineColor=i.defaultValues.line.color,i.values.fillColor=i.defaultValues.fill.color,i.values.fillStyle=i.defaultValues.fill.style,n.close()}),n.show(l,u,[S,C]),n.moveTo(e,"top"),n},_selectButton:function(e,t){var i=e.substring(4).toLowerCase();this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+i+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+i+".icon-button"))},_updatePreview:function(e){this.first&&(this.first=!1,this.values.fillStyle=this.defaultValues.fill.style);var t,i=this,n=void 0===e||null===e?jQuery(".areaform"):e,s=n.find(".preview");if(s.length>0){t=s.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r=parseInt(i.values.fillStyle,10)<0?"#"+i.values.fillColor:"none",a={stroke:"#"+i.values.lineColor,fill:r,"stroke-width":i.values.lineWidth,"stroke-linejoin":0===i.values.lineCorner?"miter":"round","stroke-linecap":"butt","stroke-dasharray":1===i.values.lineStyle?"- ":""},o={};if(this.paper.clear(),i.values.fillStyle>=0)switch(i.values.fillStyle){case 0:var l=[10.5,17.5],u=[12.3,19.7],h=[14.1,21.9],c=[15.9,24.1],p=[17.7,26.3],d=[19.5,28.5],m=[21.4,30.6],f=[23.2,32.8],y=[25,35],g=[26.8,37.2],v=[28.6,39.4],b=[11.2,16.8],L=[16,16],O=[20.8,15.2],w=[25.6,14.4],_=[30.4,13.6],x=[35.2,12.8],S=[40,12],C=[37.4,18.6],k=[34.8,25.2],M=[32.2,31.8],P=[29.6,38.4];o={"stroke-width":1,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+l+"L"+b+"M"+u+"L"+L+"M"+h+"L"+O+"M"+c+"L"+w+"M"+p+"L"+_+"M"+d+"L"+x+"M"+m+"L"+S+"M"+f+"L"+C+"M"+y+"L"+k+"M"+g+"L"+M+"M"+v+"L"+P).attr(o),this.paper.circle(0,0,0);break;case 1:var E=[14.8,16.2],N=[23.2,14.8],T=[31.6,13.4],z=[39.8,12.2],I=[35.4,23.6],R=[30.9,35.1],j=[11.9,19.1],F=[15,23],A=[18.2,26.8],B=[21.4,30.6],D=[24.5,34.5],q=[27.7,38.3];o={"stroke-width":2,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+E+"L"+j+"M"+N+"L"+F+"M"+T+"L"+A+"M"+z+"L"+B+"M"+I+"L"+D+"M"+R+"L"+q).attr(o),this.paper.circle(0,0,0);break;case 2:var H=[19,15.5],U=[12.1,19.5],G=[15.4,23.5],V=[18.7,27.5],W=[22,31.5],Q=[25.3,35.5],X=[28.6,39.5],Z=[38.6,15.5],Y=[37,19.5],K=[35.4,23.5],$=[33.9,27.5],J=[32.3,31.5],et=[30.7,35.5],tt=[29.1,39.5];o={"stroke-width":1,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+H+"L"+Z+"M"+U+"L"+Y+"M"+G+"L"+K+"M"+V+"L"+$+"M"+W+"L"+J+"M"+Q+"L"+et+"M"+X+"L"+tt).attr(o),this.paper.circle(0,0,0);break;case 3:var it=[16.1,16],nt=[13.4,21],st=[17.5,26],rt=[21.6,31],at=[25.7,36],ot=[38.4,16],lt=[36.4,21],ut=[35.5,26],ht=[32.5,31],ct=[30.5,36];o={"stroke-width":2,stroke:"#"+i.values.fillColor,fill:"none"},this.paper.path("M"+it+"L"+ot+"M"+nt+"L"+lt+"M"+st+"L"+ut+"M"+rt+"L"+ht+"M"+at+"L"+ct).attr(o),this.paper.circle(0,0,0)}var pt=[10,17],dt=[40,12],mt=[29,40];if(this.paper.path("M"+pt+"L"+dt+","+mt+"Z").attr(a),this.paper.circle(0,0,0),2===i.values.lineStyle){var ft=2*(2+parseInt(i.values.lineWidth,10)),yt=Math.atan(Math.abs((dt[1]-pt[1])/(dt[0]-pt[0]))),gt=[pt[0]+ft*Math.sin(Math.PI/3+yt),pt[1]+ft*Math.cos(Math.PI/3+yt)],vt=Math.atan(Math.abs((mt[1]-dt[1])/(mt[0]-dt[0]))),bt=[dt[0]-ft*Math.sin(Math.PI/3+vt),dt[1]-ft*Math.cos(Math.PI/3+vt)],Lt=Math.atan(Math.abs((pt[1]-mt[1])/(pt[0]-mt[0]))),Ot=[mt[0]-ft*Math.cos(Math.PI/6+Lt),mt[1]-ft*Math.sin(Math.PI/6+Lt)];this.paper.path("M"+gt+"L"+bt+","+Ot+"Z").attr(a)}}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")}}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.LineForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.values={style:this.defaultValues.style,cap:this.defaultValues.cap,corner:this.defaultValues.corner,width:this.defaultValues.width,color:this.defaultValues.color},this.styleButtonNames=["icon-line-basic","icon-line-dashed","icon-double-line"],this.capButtonNames=["icon-line-flat_cap","icon-line-round_cap"],this.cornerButtonNames=["icon-corner-sharp","icon-corner-round"],this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=-1;var n;for(n=0;n<this.basicColors.length;n++)if(this.basicColors[n]==="#"+this.values.color){this.activeColorCell=n;break}this.templateLineStyleDialogContent=jQuery('<div class="lineform"><div class="container"><div class="column1"><label>'+this.loc.style.label+"</label>"+'<div class="style icon-buttons"></div>'+"<label>"+this.loc.cap.label+"</label>"+'<div class="cap icon-buttons"></div>'+"<label>"+this.loc.corner.label+"</label>"+'<div class="corner icon-buttons"></div>'+"<label>"+this.loc.width.label+"</label><br>"+'<div class="width"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors"></div>'+"</div>"+'<div class="column22">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"),this.templateButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.minWidth=1,this.maxWidth=10,this.templateWidthValue=jQuery('<input type="number" name="width" class="linewidth" min="'+this.minWidth+'" max="'+this.maxWidth+'" step=1 value="'+this.values.width+'">'),this.previewSize=50,this.selectColor="#dddddd"},{getValues:function(){var e=this.values.cap,t=this.values.corner,i=this.values.style;return"number"==typeof e&&(e=this.creator.lineCapMap[e]),"number"==typeof t&&(t=this.creator.lineCornerMap[t]),"number"==typeof i&&(i=this.creator.lineStyleMap[i]),{width:this.values.width,color:this.values.color,cap:e,corner:t,style:i}},setValues:function(e){var t;if(null!==e&&void 0!==e){for(t=0;t<this.creator.lineCapMap.length;t++)e.cap===this.creator.lineCapMap[t]&&(e.cap=t);for(t=0;t<this.creator.lineCornerMap.length;t++)e.corner===this.creator.lineCornerMap[t]&&(e.corner=t);for(t=0;t<this.creator.lineStyleMap.length;t++)e.style===this.creator.lineStyleMap[t]&&(e.style=t);jQuery.extend(!0,this.values,e)}},showForm:function(e,t){var i=this;null!==t&&void 0!==t&&jQuery.extend(!0,i.values,t.line);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.addClass("renderdialog"),n.addClass("linevisualization");var s,r,a,o,l,u=i.loc.title,h=i.templateLineStyleDialogContent.clone(),c=h.find("div.style");for(0===i.values.style.length&&(i.values.style=0),s=0;s<i.styleButtonNames.length;s++)a=i.templateButton.clone(),a.addClass(i.styleButtonNames[s]),a.attr("id",s+"linestyle"),s===i.values.style&&this._styleSelectedButton(a),a.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton("style",l),i.values.style=l,i._updatePreview(h)}),c.append(a);for(c=h.find("div.cap"),s=0;s<i.capButtonNames.length;s++)o=i.templateButton.clone(),o.addClass(i.capButtonNames[s]),o.attr("id",s+"linecap"),s===i.values.cap&&this._styleSelectedButton(o),o.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0)),i._selectButton("cap",l),i.values.cap=l,i._updatePreview(h)}),c.append(o);for(c=h.find("div.corner"),s=0;s<i.cornerButtonNames.length;s++)r=i.templateButton.clone(),r.addClass(i.cornerButtonNames[s]),r.attr("id",s+"linecorner"),s===i.values.corner&&this._styleSelectedButton(r),r.click(function(){l=parseInt(jQuery(this).attr("id").charAt(0)),i._selectButton("corner",l),i.values.corner=l,i._updatePreview(h)}),c.append(r);c=h.find("div.width");var p=i.templateWidthValue.clone();p.change(function(){var e=parseInt(p.val(),10);isNaN(e)||(i.values.width=e,i._updatePreview())}),p.val(null!==i.values.width&&void 0!==i.values.width?i.values.width:1),c.append(p);var d,m,f,y,g,v=!1;for(c=h.find(".color-rectangle"),s=0;s<i.basicColors.length;s++)d=i.templateColorCell.clone(),d.css("background-color",i.basicColors[s]),m="ColorCell",f=s+m,f.length===m.length+1&&(f="0"+f),d.attr("id",f),d.click(function(){jQuery(".color-source").prop("checked")||(y=parseInt(this.id.substring(0,2),10),y!==i.activeColorCell&&(i.activeColorCell>-1&&(g=i.activeColorCell.toString(),i.activeColorCell<10&&(g="0"+g),jQuery("#"+g+"ColorCell").css("border","1px solid #000000")),i.values.color=i.creator.rgbToHex(this.style.backgroundColor),i.activeColorCell=y,10>y&&(y="0"+y.toString()),jQuery("#"+y+"ColorCell").css("border","3px solid #ffffff"),i._updatePreview(h)))}),"#"+i.values.color===i.basicColors[s]&&(d.css("border","3px solid #ffffff"),i.activeColorCell=s,v=!0),c.append(d);c=h.find(".color-source-selector");var b=i.templateColorSource.clone();
-1===i.activeColorCell&&b.attr("checked",!0),b.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=i.activeColorCell.toString();i.activeColorCell<10&&(e="0"+e);var t=jQuery("#"+e+"ColorCell");this.checked&&(t.css("border","1px solid #000000"),jQuery(".custom-red-value").val(parseInt(i.values.color.substring(0,2),16)),jQuery(".custom-green-value").val(parseInt(i.values.color.substring(2,4),16)),jQuery(".custom-blue-value").val(parseInt(i.values.color.substring(4),16)),i.activeColorCell=-1),i._updatePreview(h)}),c.prepend(b),v||(b.checked=!0,c.find("input.color-source").prop("disabled",!1).attr("checked","checked")),c=h.find(".custom-colors");var L=this.templateCustomColor.clone();c.append(L);var O=i.templateColorValue.clone();O.addClass("custom-red-value"),-1===i.activeColorCell&&(O.val(parseInt(i.values.color.substring(0,2),16)),O.prop("disabled",!1)),h.find(".colorcolumn1").append(O),h.find("label.custom-red-value").text("R");var w=i.templateColorValue.clone();w.addClass("custom-green-value"),-1===i.activeColorCell&&(w.val(parseInt(i.values.color.substring(2,4),16)),w.prop("disabled",!1)),h.find(".colorcolumn21").append(w),h.find("label.custom-green-value").text("G");var _=i.templateColorValue.clone();if(_.addClass("custom-blue-value"),-1===i.activeColorCell&&(_.val(parseInt(i.values.color.substring(4),16)),_.prop("disabled",!1)),h.find(".colorcolumn22").append(_),h.find("label.custom-blue-value").text("B"),!v){var x=i.creator.hexToRgb(i.values.color);h.find("input.custom-color.custom-red-value").val(x.r),h.find("input.custom-color.custom-green-value").val(x.g),h.find("input.custom-color.custom-blue-value").val(x.b),h.find("input.custom-color").prop("disabled",!1)}h.find(".custom-color").change(function(){var e,t,n=[];for(n[0]=jQuery("input.custom-color.custom-red-value").val(),n[1]=jQuery("input.custom-color.custom-green-value").val(),n[2]=jQuery("input.custom-color.custom-blue-value").val(),e=0;3>e;e++){if(t=parseInt(n[e],10),0>t||t>255)return;n[e]=t.toString(16),1===n[e].length&&(n[e]="0"+n[e])}i.values.color=n.join(""),i._updatePreview()}),this._updatePreview(h);var S=Oskari.clazz.create("Oskari.userinterface.component.Button");S.setTitle(i.loc.buttons.save),S.addClass("primary showSelection"),S.setHandler(function(){n.close()});var C=Oskari.clazz.create("Oskari.userinterface.component.Button");return C.setTitle(i.loc.buttons.cancel),C.setHandler(function(){i.values.size=i.defaultValues.size,i.values.color=i.defaultValues.color,i.values.shape=i.defaultValues.shape,n.close()}),n.show(u,h,[S,C]),n.moveTo(e,"top"),i._updatePreview(),n},_selectButton:function(e,t){this._styleUnselectedButton(jQuery("div#"+this.values[e]+"line"+e+".icon-button")),this._styleSelectedButton(jQuery("div#"+t+"line"+e+".icon-button"))},_updatePreview:function(e){var t,i=this,n=void 0===e||null===e?jQuery(".lineform"):e,s=n.find(".preview");if(s.length>0){t=s.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r={stroke:"#"+i.values.color,fill:"none","stroke-width":i.values.width,"stroke-linejoin":0===i.values.corner?"miter":"round","stroke-linecap":0===i.values.cap?"butt":"round","stroke-dasharray":1===i.values.style?"- ":""},a=[10,15],o=[20,35],l=[40,25];if(this.paper.clear(),2!==i.values.style)this.paper.path("M"+a[0]+","+a[1]+"L"+o+","+l).attr(r);else{var u=1.5+.5*i.values.width,h=[a[0]+2*u/Math.sqrt(5),a[1]-u/Math.sqrt(5)],c=[a[0]-2*u/Math.sqrt(5),a[1]+u/Math.sqrt(5)],p=[];p[0]=o[0]+.5*u*(Math.sqrt(3)-1),p[1]=o[1]-.5*u*(Math.sqrt(3)+1);var d=[];d[0]=o[0]-.5*u*(Math.sqrt(3)-1),d[1]=o[1]+.5*u*(Math.sqrt(3)+1);var m=[l[0]-u/Math.sqrt(5),l[1]-2*u/Math.sqrt(5)],f=[l[0]+u/Math.sqrt(5),l[1]+2*u/Math.sqrt(5)];this.paper.path("M"+h[0]+","+h[1]+"L"+p+","+m+"M"+c[0]+","+c[1]+"L"+d+","+f).attr(r),this.paper.circle(0,0,0)}}},_getOnScreenForm:function(){return jQuery("div.renderdialog")},_styleSelectedButton:function(e){e.css("border","2px solid"),e.css("background-color",this.selectColor)},_styleUnselectedButton:function(e){e.css("border","1px solid"),e.css("background-color","transparent")}}),Oskari.clazz.define("Oskari.userinterface.component.visualization-form.DotForm",function(e,t,i){this.creator=e,this.loc=t,this.defaultValues=i,this.values={size:this.defaultValues.size,color:this.defaultValues.color,shape:this.defaultValues.shape},this.minSize=null!==this.defaultValues.dotMinSize&&void 0!==this.defaultValues.dotMinSize?this.defaultValues.dotMinSize:1,this.maxSize=this.defaultValues.dotMaxSize?this.defaultValues.dotMaxSize:5,this.basicColors=["#ffffff","#666666","#ffde00","#f8931f","#ff3334","#bf2652","#000000","#cccccc","#652d90","#3233ff","#26bf4b","#00ff01"],this.paper=null,this.activeColorCell=6,this.symbolButtons={square:{iconCls:"marker-square",iconId:1,offset:[5,36],scale:2},dot:{iconCls:"marker-dot",iconId:5,offset:[5,30],scale:0},arrow:{iconCls:"marker-arrow",iconId:6,offset:[5,35],scale:2},pin:{iconCls:"marker-pin",iconId:3,offset:[2,35],scale:2},pin2:{iconCls:"marker-pin2",iconId:2,offset:[5,35],scale:2},stud:{iconCls:"marker-stud",iconId:0,offset:[2,35],scale:2},flag:{iconCls:"marker-flag",iconId:4,offset:[9,35],scale:2}},this.templateSymbolDialogContent=jQuery('<div class="pointform"><div class="container"><div class="column1"><label>'+this.loc.symbol.label+"</label>"+'<div class="symbols icon-buttons"></div>'+"<label>"+this.loc.size.label+"</label><br>"+'<div class="sizer-values"></div>'+'<div class="sizer"></div>'+"</div>"+'<div class="column2">'+'<div class="column21">'+"<label>"+this.loc.color.label+"</label>"+'<div class="color-grid">'+'<div class="color-rectangle"></div>'+"</div>"+'<div class="color-label">'+"<label>"+this.loc.color.labelOr+"</label>"+"</div>"+'<div class="color-source-selector">'+"<label>"+this.loc.color.labelCustom+"</label>"+"</div>"+'<div class="custom-colors"></div>'+"</div>"+'<div class="column22">'+"<label>"+this.loc.preview.label+"</label>"+'<div class="preview"></div>'+"</div>"+"</div>"+"</div>"+"</div>"),this.templateSymbolButton=jQuery('<div class="icon-button"></div>'),this.templateColorCell=jQuery('<div class="color-cell"></div>'),this.templateCustomColor=jQuery('<div class="custom-color-editor"><div class="colorcontainer"><div class="colorcolumn1"></div><div class="colorcolumn2"><div class="colorcolumn21"></div><div class="colorcolumn22"></div></div></div>'),this.templateColorSource=jQuery('<input type="checkbox" name="colorInput" value = "custom" class="color-source">'),this.templateColorValue=jQuery('<label class="color-label"></label><br><input type="text" name="color-input" value="0" disabled="disabled" class="custom-color">'),this.templateSizerValue=jQuery('<div class="sizer-value"></div>'),this.previewSize=50},{getValues:function(){return{size:this.values.size,color:this.values.color,shape:this.values.shape}},setValues:function(e){null!==e&&void 0!==e&&jQuery.extend(!0,this.values,e)},showForm:function(e,t){var i=this;null!==t&&void 0!==t&&jQuery.extend(!0,i.values,t.dot);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.addClass("renderdialog"),n.addClass("pointvisualization");var s,r,a,o=i.loc.title,l=i.templateSymbolDialogContent.clone(),u=l.find("div.symbols");for(s in this.symbolButtons)this.symbolButtons.hasOwnProperty(s)&&(r=this.templateSymbolButton.clone(),a=this.symbolButtons[s],r.addClass(a.iconCls),r.attr("id",a.iconId+"marker"),a.iconId===parseInt(i.values.shape,10)&&r.css("border","2px solid"),r.click(function(){i.values.shape=parseInt(jQuery(this).attr("id").charAt(0),10),i._selectButton(i.values.shape),i._updatePreview(l)}),u.append(r));var h,c,p,d=10,m=110,f=i.maxSize-i.minSize,y=m/f,g=0;for(u=l.find(".sizer-values"),h=1;d>=h;h++)c=i.templateSizerValue.clone(),c.html(h),c.addClass("value"+h),h<i.minSize||h>i.maxSize?c.hide():(p=g*y.toString()+"px",c.css("left",p),c.show(),g+=1),u.append(c);u=l.find(".sizer"),u.slider({range:"min",min:i.minSize,max:i.maxSize,value:this.values.size,slide:function(e,t){i.values.size=t.value,i._updatePreview(l)}});var v,b,L,O,w,_=!1;for(u=l.find(".color-rectangle"),h=0;h<i.basicColors.length;h++)v=i.templateColorCell.clone(),v.css("background-color",i.basicColors[h]),b="ColorCell",L=h+b,L.length===b.length+1&&(L="0"+L),v.attr("id",L),v.click(function(){jQuery(".color-source").prop("checked")||(O=parseInt(this.id.substring(0,2),10),O!==i.activeColorCell&&(i.activeColorCell>-1&&(w=i.activeColorCell.toString(),i.activeColorCell<10&&(w="0"+w),jQuery("#"+w+"ColorCell").css("border","1px solid #000000")),i.values.color=i.creator.rgbToHex(this.style.backgroundColor),i.activeColorCell=O,10>O&&(O="0"+O.toString()),jQuery("#"+O+"ColorCell").css("border","3px solid #ffffff"),i._updatePreview(l)))}),"#"+i.values.color===i.basicColors[h]&&(v.css("border","3px solid #ffffff"),i.activeColorCell=h,_=!0),u.append(v);u=l.find(".color-source-selector");var x=i.templateColorSource.clone();x.change(function(){jQuery("input.custom-color").prop("disabled",!this.checked);var e=jQuery("#"+i.activeColorCell+"ColorCell");this.checked?e.css("border","1px solid #000000"):e.css("border","3px solid #ffffff"),i._updatePreview(l)}),u.prepend(x),_||(x.checked=!0,u.find("input.color-source").prop("disabled",!1).attr("checked","checked")),u=l.find(".custom-colors");var S=this.templateCustomColor.clone();u.append(S);var C=i.templateColorValue.clone();C.addClass("custom-red-value"),l.find(".colorcolumn1").append(C),l.find("label.custom-red-value").text("R");var k=i.templateColorValue.clone();k.addClass("custom-green-value"),l.find(".colorcolumn21").append(k),l.find("label.custom-green-value").text("G");var M=i.templateColorValue.clone();if(M.addClass("custom-blue-value"),l.find(".colorcolumn22").append(M),l.find("label.custom-blue-value").text("B"),!_){var P=i.creator.hexToRgb(i.values.color);l.find("input.custom-color.custom-red-value").val(P.r),l.find("input.custom-color.custom-green-value").val(P.g),l.find("input.custom-color.custom-blue-value").val(P.b),l.find("input.custom-color").prop("disabled",!1)}l.find(".custom-color").change(function(){var e,t,n=[];for(n[0]=jQuery("input.custom-color.custom-red-value").val(),n[1]=jQuery("input.custom-color.custom-green-value").val(),n[2]=jQuery("input.custom-color.custom-blue-value").val(),e=0;3>e;e++){if(t=parseInt(n[e]),0>t||t>255)return;n[e]=t.toString(16),1===n[e].length&&(n[e]="0"+n[e])}i.values.color=n.join(""),i._updatePreview()}),this._updatePreview(l);var E=Oskari.clazz.create("Oskari.userinterface.component.Button");E.setTitle(i.loc.buttons.save),E.addClass("primary showSelection"),E.setHandler(function(){n.close()});var N=Oskari.clazz.create("Oskari.userinterface.component.Button");return N.setTitle(i.loc.buttons.cancel),N.setHandler(function(){i.values.size=i.defaultValues.size,i.values.color=i.defaultValues.color,i.values.shape=i.defaultValues.shape,n.close()}),n.show(o,l,[E,N]),n.moveTo(e,"top"),n},_selectButton:function(e){var t,i,n;for(t in this.symbolButtons)this.symbolButtons.hasOwnProperty(t)&&(i=this.symbolButtons[t],n=jQuery("div#"+i.iconId+"marker.icon-button"),i.iconId.toString()===e.toString()?n.css("border","2px solid"):n.css("border","1px solid"))},_updatePreview:function(e){var t,i=this,n=void 0===e||null===e?jQuery(".pointform"):e,s=n.find(".preview");if(s.length>0){t=s.get(0),0===t.children.length&&(this.paper=Raphael(t,50,50));var r=0,a=[0,0],o=0;for(var l in i.symbolButtons)if(i.symbolButtons.hasOwnProperty(l)){var u=i.symbolButtons[l];if(u.iconId.toString()===i.values.shape.toString()){r=u.iconId,a=u.offset,o=u.scale;break}}Raphael.registerFont({w:512,face:{"font-family":"dot-markers","font-weight":400,"font-stretch":"normal","units-per-em":"512","panose-1":"2 0 5 3 0 0 0 0 0 0",ascent:"480",descent:"-32",bbox:"0 -480 512 32","underline-thickness":"0","underline-position":"0","unicode-range":"U+E000-U+F000"},glyphs:{" ":{},"":{d:"288,-426v-21,-4,-35,-2,-42,5v-2,2,-2,4,-1,7v2,5,5,10,9,18v4,8,6,13,7,15v-3,3,-9,9,-18,17v-13,12,-13,12,-19,18v-7,7,-1,15,18,24v8,4,17,7,26,8v23,5,39,3,49,-5v3,-3,4,-6,3,-9r-9,-18v-4,-9,-4,-10,-8,-18v-3,-6,-4,-9,-5,-11v2,-2,2,-3,11,-11v9,-8,9,-8,15,-14v6,-5,1,-12,-15,-20v-7,-3,-14,-5,-21,-6xm262,-256r9,-48r-12,-2r-9,50r12,0"},"":{d:"320,-427r-127,0r0,126r35,0r28,45r28,-45r36,0r0,-126"},"":{d:"256,-429v-17,0,-30,5,-42,17v-12,12,-18,26,-18,43v0,10,5,24,15,43v10,19,20,35,30,48r15,21v40,-53,60,-90,60,-112v0,-17,-6,-31,-18,-43v-12,-12,-25,-17,-42,-17xm256,-344v-7,0,-12,-2,-17,-7v-5,-5,-7,-10,-7,-17v0,-7,2,-13,7,-18v5,-5,10,-7,17,-7v7,0,13,2,18,7v5,5,7,11,7,18v0,7,-2,12,-7,17v-5,5,-11,7,-18,7"},"":{d:"262,-257r17,-71r-12,-2r-17,73r12,0xm240,-380v0,12,4,22,12,31v8,9,19,13,31,13v12,0,22,-4,31,-13v9,-9,13,-19,13,-31v0,-12,-4,-22,-13,-30v-9,-8,-19,-13,-31,-13v-12,0,-23,5,-31,13v-8,8,-12,18,-12,30"},"":{d:"262,-257r41,-169r-13,0r-40,169r12,0xm164,-427r18,45r-38,44r115,0r21,-89r-116,0"},"":{d:"196,-256v0,17,6,30,18,42v12,12,25,18,42,18v17,0,30,-6,42,-18v12,-12,18,-25,18,-42v0,-17,-6,-30,-18,-42v-12,-12,-25,-18,-42,-18v-17,0,-30,6,-42,18v-12,12,-18,25,-18,42"},"":{d:"284,-331r0,-93r-56,0r0,93r-39,0r67,75r67,-75r-39,0"},"":{d:"0,-480r512,512r-512,0r0,-512",w:0}," ":{}}});var h=this.paper.getFont("dot-markers"),c=57344;this.paper.clear();var p=a[0]-5*this.values.size,d=a[1]+this.values.size*o,m=40+10*this.values.size;this.paper.print(p,d,String.fromCharCode(r+c),h,m).attr({"stroke-width":1,fill:"#"+i.values.color,stroke:"#b4b4b4"}),this.paper.circle(0,0,0)}},_getOnScreenForm:function(){return jQuery("div.renderdialog")}}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultTile",function(e,t){this.locale=t,this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.userinterface.extension.DefaultTile"},setEl:function(e){this.container=$(e)},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultFlyout",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultFlyout"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultExtension",function(e,t,i,n){this.sandbox=null,this.plugins={},this._localization=null,this.conf={name:e,tileClazz:i||"Oskari.userinterface.extension.DefaultTile",flyoutClazz:t||"Oskari.userinterface.extension.DefaultFlyout",viewClazz:n}},{getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e,t=this,i=this.conf,n=(i?i.sandbox:null)||"sandbox",s=Oskari.getSandbox(n);t.sandbox=s,s.register(this),i&&i.stateful===!0&&s.registerAsStateful(this.mediator.bundleId,this),e=s.getRequestBuilder("userinterface.AddExtensionRequest")(this),s.request(this,e)},stop:function(){var e=this.sandbox,t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),e.unregisterStateful(this.mediator.bundleId),e.unregister(this),this.sandbox=null,this.started=!1},startExtension:function(){var e,t,i,n,s=this,r=s.sandbox;for(e in s.eventHandlers)s.eventHandlers.hasOwnProperty(e)&&r.registerForEventByName(s,e);t=s.getLocalization("flyout"),t&&s.conf.flyoutClazz&&(s.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create(s.conf.flyoutClazz,s,t)),i=s.getLocalization("tile"),i&&s.conf.tileClazz&&(s.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create(s.conf.tileClazz,s,i)),n=s.getLocalization("view"),n&&s.conf.viewClazz&&(s.plugins["Oskari.userinterface.View"]=Oskari.clazz.create(s.conf.viewClazz,s,n))},stopExtension:function(){var e,t,i=this,n=i.sandbox;for(e in i.eventHandlers)i.eventHandlers.hasOwnProperty(e)&&n.unregisterFromEventByName(i,e);for(t in i.plugins)i.plugins.hasOwnProperty(t)&&t&&(i.plugins[t]=null)},getPlugins:function(){return this.plugins},init:function(){return null},getName:function(){return this.conf.name},getConfiguration:function(){return this.conf},eventHandlers:{},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];if(i)return i.apply(this,[e])},getLang:function(){return Oskari.getLang()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultView",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultView"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.View"]}),Oskari.clazz.define("Oskari.userinterface.extension.DefaultLayout",function(e,t){this.instance=e,this.locale=t,this.container=null},{getName:function(){return"Oskari.userinterface.extension.DefaultLayout"},setEl:function(e){this.container=jQuery(e)},getEl:function(){return this.container},startPlugin:function(){},stopPlugin:function(){},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.description},setState:function(e){this.state=e},getState:function(){return this.state},getLocalization:function(){return this.locale}},{protocol:["Oskari.userinterface.Layout"]}),!function(e){var t,i,n="0.4.2",s="hasOwnProperty",r=/[\.\/]/,a="*",o=function(){},l=function(e,t){return e-t},u={n:{}},h=function(e,n){e=String(e);var s,r=i,a=Array.prototype.slice.call(arguments,2),o=h.listeners(e),u=0,c=[],p={},d=[],m=t;t=e,i=0;for(var f=0,y=o.length;y>f;f++)"zIndex"in o[f]&&(c.push(o[f].zIndex),o[f].zIndex<0&&(p[o[f].zIndex]=o[f]));for(c.sort(l);c[u]<0;)if(s=p[c[u++]],d.push(s.apply(n,a)),i)return i=r,d;for(f=0;y>f;f++)if(s=o[f],"zIndex"in s)if(s.zIndex==c[u]){if(d.push(s.apply(n,a)),i)break;do if(u++,s=p[c[u]],s&&d.push(s.apply(n,a)),i)break;while(s)}else p[s.zIndex]=s;else if(d.push(s.apply(n,a)),i)break;return i=r,t=m,d.length?d:null};h._events=u,h.listeners=function(e){var t,i,n,s,o,l,h,c,p=e.split(r),d=u,m=[d],f=[];for(s=0,o=p.length;o>s;s++){for(c=[],l=0,h=m.length;h>l;l++)for(d=m[l].n,i=[d[p[s]],d[a]],n=2;n--;)t=i[n],t&&(c.push(t),f=f.concat(t.f||[]));m=c}return f},h.on=function(e,t){if(e=String(e),"function"!=typeof t)return function(){};for(var i=e.split(r),n=u,s=0,a=i.length;a>s;s++)n=n.n,n=n.hasOwnProperty(i[s])&&n[i[s]]||(n[i[s]]={n:{}});for(n.f=n.f||[],s=0,a=n.f.length;a>s;s++)if(n.f[s]==t)return o;return n.f.push(t),function(e){+e==+e&&(t.zIndex=+e)}},h.f=function(e){var t=[].slice.call(arguments,1);return function(){h.apply(null,[e,null].concat(t).concat([].slice.call(arguments,0)))}},h.stop=function(){i=1},h.nt=function(e){return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},h.nts=function(){return t.split(r)},h.off=h.unbind=function(e,t){if(!e)return h._events=u={n:{}},void 0;var i,n,o,l,c,p,d,m=e.split(r),f=[u];for(l=0,c=m.length;c>l;l++)for(p=0;p<f.length;p+=o.length-2){if(o=[p,1],i=f[p].n,m[l]!=a)i[m[l]]&&o.push(i[m[l]]);else for(n in i)i[s](n)&&o.push(i[n]);f.splice.apply(f,o)}for(l=0,c=f.length;c>l;l++)for(i=f[l];i.n;){if(t){if(i.f){for(p=0,d=i.f.length;d>p;p++)if(i.f[p]==t){i.f.splice(p,1);break}!i.f.length&&delete i.f}for(n in i.n)if(i.n[s](n)&&i.n[n].f){var y=i.n[n].f;for(p=0,d=y.length;d>p;p++)if(y[p]==t){y.splice(p,1);break}!y.length&&delete i.n[n].f}}else{delete i.f;for(n in i.n)i.n[s](n)&&i.n[n].f&&delete i.n[n].f}i=i.n}},h.once=function(e,t){var i=function(){return h.unbind(e,i),t.apply(this,arguments)};return h.on(e,i)},h.version=n,h.toString=function(){return"You are running Eve "+n},"undefined"!=typeof module&&module.exports?module.exports=h:"undefined"!=typeof define?define("eve",[],function(){return h}):e.eve=h}(this),function(e,t){"function"==typeof define&&define.amd?define(["eve"],function(i){return t(e,i)}):t(e,e.eve)}(this,function(e,t){function i(e){if(i.is(e,"function"))return L?e():t.on("raphael.DOMload",e);if(i.is(e,Q))return i._engine.create[P](i,e.splice(0,3+i.is(e[0],V))).add(e);var n=Array.prototype.slice.call(arguments,0);if(i.is(n[n.length-1],"function")){var s=n.pop();return L?s.call(i._engine.create[P](i,n)):t.on("raphael.DOMload",function(){s.call(i._engine.create[P](i,n))})}return i._engine.create[P](i,arguments)}function n(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var i in e)e[S](i)&&(t[i]=n(e[i]));return t}function s(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return e.push(e.splice(i,1)[0])}function r(e,t,i){function n(){var r=Array.prototype.slice.call(arguments,0),a=r.join("␀"),o=n.cache=n.cache||{},l=n.count=n.count||[];return o[S](a)?(s(l,a),i?i(o[a]):o[a]):(l.length>=1e3&&delete o[l.shift()],l.push(a),o[a]=e[P](t,r),i?i(o[a]):o[a])}return n}function a(){return this.hex}function o(e,t){for(var i=[],n=0,s=e.length;s-2*!t>n;n+=2){var r=[{x:+e[n-2],y:+e[n-1]},{x:+e[n],y:+e[n+1]},{x:+e[n+2],y:+e[n+3]},{x:+e[n+4],y:+e[n+5]}];t?n?s-4==n?r[3]={x:+e[0],y:+e[1]}:s-2==n&&(r[2]={x:+e[0],y:+e[1]},r[3]={x:+e[2],y:+e[3]}):r[0]={x:+e[s-2],y:+e[s-1]}:s-4==n?r[3]=r[2]:n||(r[0]={x:+e[n],y:+e[n+1]}),i.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return i}function l(e,t,i,n,s){var r=-3*t+9*i-9*n+3*s,a=e*r+6*t-12*i+6*n;return e*a-3*t+3*i}function u(e,t,i,n,s,r,a,o,u){null==u&&(u=1),u=u>1?1:0>u?0:u;for(var h=u/2,c=12,p=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],d=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],m=0,f=0;c>f;f++){var y=h*p[f]+h,g=l(y,e,i,s,a),v=l(y,t,n,r,o),b=g*g+v*v;m+=d[f]*B.sqrt(b)}return h*m}function h(e,t,i,n,s,r,a,o,l){if(!(0>l||u(e,t,i,n,s,r,a,o)<l)){var h,c=1,p=c/2,d=c-p,m=.01;for(h=u(e,t,i,n,s,r,a,o,d);H(h-l)>m;)p/=2,d+=(l>h?1:-1)*p,h=u(e,t,i,n,s,r,a,o,d);return d}}function c(e,t,i,n,s,r,a,o){if(!(D(e,i)<q(s,a)||q(e,i)>D(s,a)||D(t,n)<q(r,o)||q(t,n)>D(r,o))){var l=(e*n-t*i)*(s-a)-(e-i)*(s*o-r*a),u=(e*n-t*i)*(r-o)-(t-n)*(s*o-r*a),h=(e-i)*(r-o)-(t-n)*(s-a);if(h){var c=l/h,p=u/h,d=+c.toFixed(2),m=+p.toFixed(2);if(!(d<+q(e,i).toFixed(2)||d>+D(e,i).toFixed(2)||d<+q(s,a).toFixed(2)||d>+D(s,a).toFixed(2)||m<+q(t,n).toFixed(2)||m>+D(t,n).toFixed(2)||m<+q(r,o).toFixed(2)||m>+D(r,o).toFixed(2)))return{x:c,y:p}}}}function p(e,t,n){var s=i.bezierBBox(e),r=i.bezierBBox(t);if(!i.isBBoxIntersect(s,r))return n?0:[];for(var a=u.apply(0,e),o=u.apply(0,t),l=D(~~(a/5),1),h=D(~~(o/5),1),p=[],d=[],m={},f=n?0:[],y=0;l+1>y;y++){var g=i.findDotsAtSegment.apply(i,e.concat(y/l));p.push({x:g.x,y:g.y,t:y/l})}for(y=0;h+1>y;y++)g=i.findDotsAtSegment.apply(i,t.concat(y/h)),d.push({x:g.x,y:g.y,t:y/h});for(y=0;l>y;y++)for(var v=0;h>v;v++){var b=p[y],L=p[y+1],O=d[v],w=d[v+1],_=H(L.x-b.x)<.001?"y":"x",x=H(w.x-O.x)<.001?"y":"x",S=c(b.x,b.y,L.x,L.y,O.x,O.y,w.x,w.y);if(S){if(m[S.x.toFixed(4)]==S.y.toFixed(4))continue;m[S.x.toFixed(4)]=S.y.toFixed(4);var C=b.t+H((S[_]-b[_])/(L[_]-b[_]))*(L.t-b.t),k=O.t+H((S[x]-O[x])/(w[x]-O[x]))*(w.t-O.t);C>=0&&1.001>=C&&k>=0&&1.001>=k&&(n?f++:f.push({x:S.x,y:S.y,t1:q(C,1),t2:q(k,1)}))}}return f}function d(e,t,n){e=i._path2curve(e),t=i._path2curve(t);for(var s,r,a,o,l,u,h,c,d,m,f=n?0:[],y=0,g=e.length;g>y;y++){var v=e[y];if("M"==v[0])s=l=v[1],r=u=v[2];else{"C"==v[0]?(d=[s,r].concat(v.slice(1)),s=d[6],r=d[7]):(d=[s,r,s,r,l,u,l,u],s=l,r=u);for(var b=0,L=t.length;L>b;b++){var O=t[b];if("M"==O[0])a=h=O[1],o=c=O[2];else{"C"==O[0]?(m=[a,o].concat(O.slice(1)),a=m[6],o=m[7]):(m=[a,o,a,o,h,c,h,c],a=h,o=c);var w=p(d,m,n);if(n)f+=w;else{for(var _=0,x=w.length;x>_;_++)w[_].segment1=y,w[_].segment2=b,w[_].bez1=d,w[_].bez2=m;f=f.concat(w)}}}}}return f}function m(e,t,i,n,s,r){null!=e?(this.a=+e,this.b=+t,this.c=+i,this.d=+n,this.e=+s,this.f=+r):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(){return this.x+z+this.y+z+this.width+" × "+this.height}function y(e,t,i,n,s,r){function a(e){return((c*e+h)*e+u)*e}function o(e,t){var i=l(e,t);return((m*i+d)*i+p)*i}function l(e,t){var i,n,s,r,o,l;for(s=e,l=0;8>l;l++){if(r=a(s)-e,H(r)<t)return s;if(o=(3*c*s+2*h)*s+u,H(o)<1e-6)break;s-=r/o}if(i=0,n=1,s=e,i>s)return i;if(s>n)return n;for(;n>i;){if(r=a(s),H(r-e)<t)return s;e>r?i=s:n=s,s=(n-i)/2+i}return s}var u=3*t,h=3*(n-t)-u,c=1-u-h,p=3*i,d=3*(s-i)-p,m=1-p-d;return o(e,1/(200*r))}function g(e,t){var i=[],n={};if(this.ms=t,this.times=1,e){for(var s in e)e[S](s)&&(n[J(s)]=e[s],i.push(J(s)));i.sort(ct)}this.anim=n,this.top=i[i.length-1],this.percents=i}function v(e,n,s,r,a,o){s=J(s);var l,u,h,c,p,d,f=e.ms,g={},v={},b={};if(r)for(O=0,_=li.length;_>O;O++){var L=li[O];if(L.el.id==n.id&&L.anim==e){L.percent!=s?(li.splice(O,1),h=1):u=L,n.attr(L.totalOrigin);break}}else r=+v;for(var O=0,_=e.percents.length;_>O;O++){if(e.percents[O]==s||e.percents[O]>r*e.top){s=e.percents[O],p=e.percents[O-1]||0,f=f/e.top*(s-p),c=e.percents[O+1],l=e.anim[s];break}r&&n.attr(e.anim[e.percents[O]])}if(l){if(u)u.initstatus=r,u.start=new Date-u.ms*r;else{for(var x in l)if(l[S](x)&&(nt[S](x)||n.paper.customAttributes[S](x)))switch(g[x]=n.attr(x),null==g[x]&&(g[x]=it[x]),v[x]=l[x],nt[x]){case V:b[x]=(v[x]-g[x])/f;break;case"colour":g[x]=i.getRGB(g[x]);var C=i.getRGB(v[x]);b[x]={r:(C.r-g[x].r)/f,g:(C.g-g[x].g)/f,b:(C.b-g[x].b)/f};break;case"path":var k=jt(g[x],v[x]),M=k[1];for(g[x]=k[0],b[x]=[],O=0,_=g[x].length;_>O;O++){b[x][O]=[0];for(var P=1,N=g[x][O].length;N>P;P++)b[x][O][P]=(M[O][P]-g[x][O][P])/f}break;case"transform":var T=n._,z=qt(T[x],v[x]);if(z)for(g[x]=z.from,v[x]=z.to,b[x]=[],b[x].real=!0,O=0,_=g[x].length;_>O;O++)for(b[x][O]=[g[x][O][0]],P=1,N=g[x][O].length;N>P;P++)b[x][O][P]=(v[x][O][P]-g[x][O][P])/f;else{var j=n.matrix||new m,F={_:{transform:T.transform},getBBox:function(){return n.getBBox(1)}};g[x]=[j.a,j.b,j.c,j.d,j.e,j.f],Bt(F,v[x]),v[x]=F._.transform,b[x]=[(F.matrix.a-j.a)/f,(F.matrix.b-j.b)/f,(F.matrix.c-j.c)/f,(F.matrix.d-j.d)/f,(F.matrix.e-j.e)/f,(F.matrix.f-j.f)/f]}break;case"csv":var A=I(l[x])[R](w),B=I(g[x])[R](w);if("clip-rect"==x)for(g[x]=B,b[x]=[],O=B.length;O--;)b[x][O]=(A[O]-g[x][O])/f;v[x]=A;break;default:for(A=[][E](l[x]),B=[][E](g[x]),b[x]=[],O=n.paper.customAttributes[x].length;O--;)b[x][O]=((A[O]||0)-(B[O]||0))/f}var D=l.easing,q=i.easing_formulas[D];if(!q)if(q=I(D).match(K),q&&5==q.length){var H=q;q=function(e){return y(e,+H[1],+H[2],+H[3],+H[4],f)}}else q=dt;if(d=l.start||e.start||+new Date,L={anim:e,percent:s,timestamp:d,start:d+(e.del||0),status:0,initstatus:r||0,stop:!1,ms:f,easing:q,from:g,diff:b,to:v,el:n,callback:l.callback,prev:p,next:c,repeat:o||e.times,origin:n.attr(),totalOrigin:a},li.push(L),r&&!u&&!h&&(L.stop=!0,L.start=new Date-f*r,1==li.length))return hi();h&&(L.start=new Date-L.ms*r),1==li.length&&ui(hi)}t("raphael.anim.start."+n.id,n,e)}}function b(e){for(var t=0;t<li.length;t++)li[t].el.paper==e&&li.splice(t--,1)}i.version="2.1.2",i.eve=t;var L,O,w=/[, ]+/,_={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},x=/\{(\d+)\}/g,S="hasOwnProperty",C={doc:document,win:e},k={was:Object.prototype[S].call(C.win,"Raphael"),is:C.win.Raphael},M=function(){this.ca=this.customAttributes={}},P="apply",E="concat",N="ontouchstart"in C.win||C.win.DocumentTouch&&C.doc instanceof DocumentTouch,T="",z=" ",I=String,R="split",j="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[R](z),F={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},A=I.prototype.toLowerCase,B=Math,D=B.max,q=B.min,H=B.abs,U=B.pow,G=B.PI,V="number",W="string",Q="array",X=Object.prototype.toString,Z=(i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},K=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=B.round,J=parseFloat,et=parseInt,tt=I.prototype.toUpperCase,it=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},nt=i._availableAnimAttrs={blur:V,"clip-rect":"csv",cx:V,cy:V,fill:"colour","fill-opacity":V,"font-size":V,height:V,opacity:V,path:"path",r:V,rx:V,ry:V,stroke:"colour","stroke-opacity":V,"stroke-width":V,transform:"transform",width:V,x:V,y:V},st=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,rt={hs:1,rg:1},at=/,?([achlmqrstvxz]),?/gi,ot=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,lt=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ut=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,ht=(i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ct=function(e,t){return J(e)-J(t)},pt=function(){},dt=function(e){return e},mt=i._rectPath=function(e,t,i,n,s){return s?[["M",e+s,t],["l",i-2*s,0],["a",s,s,0,0,1,s,s],["l",0,n-2*s],["a",s,s,0,0,1,-s,s],["l",2*s-i,0],["a",s,s,0,0,1,-s,-s],["l",0,2*s-n],["a",s,s,0,0,1,s,-s],["z"]]:[["M",e,t],["l",i,0],["l",0,n],["l",-i,0],["z"]]},ft=function(e,t,i,n){return null==n&&(n=i),[["M",e,t],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]]
},yt=i._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return ft(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return ft(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return mt(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return mt(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return mt(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return mt(t.x,t.y,t.width,t.height)}},gt=i.mapPath=function(e,t){if(!t)return e;var i,n,s,r,a,o,l;for(e=jt(e),s=0,a=e.length;a>s;s++)for(l=e[s],r=1,o=l.length;o>r;r+=2)i=t.x(l[r],l[r+1]),n=t.y(l[r],l[r+1]),l[r]=i,l[r+1]=n;return e};if(i._g=C,i.type=C.win.SVGAngle||C.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==i.type){var vt,bt=C.doc.createElement("div");if(bt.innerHTML='<v:shape adj="1"/>',vt=bt.firstChild,vt.style.behavior="url(#default#VML)",!vt||"object"!=typeof vt.adj)return i.type=T;bt=null}i.svg=!(i.vml="VML"==i.type),i._Paper=M,i.fn=O=M.prototype=i.prototype,i._id=0,i._oid=0,i.is=function(e,t){return t=A.call(t),"finite"==t?!Y[S](+e):"array"==t?e instanceof Array:"null"==t&&null===e||t==typeof e&&null!==e||"object"==t&&e===Object(e)||"array"==t&&Array.isArray&&Array.isArray(e)||X.call(e).slice(8,-1).toLowerCase()==t},i.angle=function(e,t,n,s,r,a){if(null==r){var o=e-n,l=t-s;return o||l?(180+180*B.atan2(-l,-o)/G+360)%360:0}return i.angle(e,t,r,a)-i.angle(n,s,r,a)},i.rad=function(e){return e%360*G/180},i.deg=function(e){return 180*e/G%360},i.snapTo=function(e,t,n){if(n=i.is(n,"finite")?n:10,i.is(e,Q)){for(var s=e.length;s--;)if(H(e[s]-t)<=n)return e[s]}else{e=+e;var r=t%e;if(n>r)return t-r;if(r>e-n)return t-r+e}return t},i.createUUID=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=0|16*B.random(),i="x"==e?t:8|3&t;return i.toString(16)}),i.setWindow=function(e){t("raphael.setWindow",i,C.win,e),C.win=e,C.doc=C.win.document,i._engine.initWin&&i._engine.initWin(C.win)};var Lt=function(e){if(i.vml){var t,n=/^\s+|\s+$/g;try{var s=new ActiveXObject("htmlfile");s.write("<body>"),s.close(),t=s.body}catch(a){t=createPopup().document.body}var o=t.createTextRange();Lt=r(function(e){try{t.style.color=I(e).replace(n,T);var i=o.queryCommandValue("ForeColor");return i=(255&i)<<16|65280&i|(16711680&i)>>>16,"#"+("000000"+i.toString(16)).slice(-6)}catch(s){return"none"}})}else{var l=C.doc.createElement("i");l.title="Raphaël Colour Picker",l.style.display="none",C.doc.body.appendChild(l),Lt=r(function(e){return l.style.color=e,C.doc.defaultView.getComputedStyle(l,T).getPropertyValue("color")})}return Lt(e)},Ot=function(){return"hsb("+[this.h,this.s,this.b]+")"},wt=function(){return"hsl("+[this.h,this.s,this.l]+")"},_t=function(){return this.hex},xt=function(e,t,n){if(null==t&&i.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(n=e.b,t=e.g,e=e.r),null==t&&i.is(e,W)){var s=i.getRGB(e);e=s.r,t=s.g,n=s.b}return(e>1||t>1||n>1)&&(e/=255,t/=255,n/=255),[e,t,n]},St=function(e,t,n,s){e*=255,t*=255,n*=255;var r={r:e,g:t,b:n,hex:i.rgb(e,t,n),toString:_t};return i.is(s,"finite")&&(r.opacity=s),r};i.color=function(e){var t;return i.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=i.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):i.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=i.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(i.is(e,"string")&&(e=i.getRGB(e)),i.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=i.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=i.rgb2hsb(e),e.v=t.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1)),e.toString=_t,e},i.hsb2rgb=function(e,t,i,n){this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(i=e.b,t=e.s,e=e.h,n=e.o),e*=360;var s,r,a,o,l;return e=e%360/60,l=i*t,o=l*(1-H(e%2-1)),s=r=a=i-l,e=~~e,s+=[l,o,0,0,o,l][e],r+=[o,l,l,o,0,0][e],a+=[0,0,o,l,l,o][e],St(s,r,a,n)},i.hsl2rgb=function(e,t,i,n){this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(i=e.l,t=e.s,e=e.h),(e>1||t>1||i>1)&&(e/=360,t/=100,i/=100),e*=360;var s,r,a,o,l;return e=e%360/60,l=2*t*(.5>i?i:1-i),o=l*(1-H(e%2-1)),s=r=a=i-l/2,e=~~e,s+=[l,o,0,0,o,l][e],r+=[o,l,l,o,0,0][e],a+=[0,0,o,l,l,o][e],St(s,r,a,n)},i.rgb2hsb=function(e,t,i){i=xt(e,t,i),e=i[0],t=i[1],i=i[2];var n,s,r,a;return r=D(e,t,i),a=r-q(e,t,i),n=0==a?null:r==e?(t-i)/a:r==t?(i-e)/a+2:(e-t)/a+4,n=60*((n+360)%6)/360,s=0==a?0:a/r,{h:n,s:s,b:r,toString:Ot}},i.rgb2hsl=function(e,t,i){i=xt(e,t,i),e=i[0],t=i[1],i=i[2];var n,s,r,a,o,l;return a=D(e,t,i),o=q(e,t,i),l=a-o,n=0==l?null:a==e?(t-i)/l:a==t?(i-e)/l+2:(e-t)/l+4,n=60*((n+360)%6)/360,r=(a+o)/2,s=0==l?0:.5>r?l/(2*r):l/(2-2*r),{h:n,s:s,l:r,toString:wt}},i._path2string=function(){return this.join(",").replace(at,"$1")},i._preload=function(e,t){var i=C.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){t.call(this),this.onload=null,C.doc.body.removeChild(this)},i.onerror=function(){C.doc.body.removeChild(this)},C.doc.body.appendChild(i),i.src=e},i.getRGB=r(function(e){if(!e||(e=I(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:a};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:a};!(rt[S](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=Lt(e));var t,n,s,r,o,l,u=e.match(Z);return u?(u[2]&&(s=et(u[2].substring(5),16),n=et(u[2].substring(3,5),16),t=et(u[2].substring(1,3),16)),u[3]&&(s=et((o=u[3].charAt(3))+o,16),n=et((o=u[3].charAt(2))+o,16),t=et((o=u[3].charAt(1))+o,16)),u[4]&&(l=u[4][R](st),t=J(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=J(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),s=J(l[2]),"%"==l[2].slice(-1)&&(s*=2.55),"rgba"==u[1].toLowerCase().slice(0,4)&&(r=J(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100)),u[5]?(l=u[5][R](st),t=J(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=J(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),s=J(l[2]),"%"==l[2].slice(-1)&&(s*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(t/=360),"hsba"==u[1].toLowerCase().slice(0,4)&&(r=J(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100),i.hsb2rgb(t,n,s,r)):u[6]?(l=u[6][R](st),t=J(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=J(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),s=J(l[2]),"%"==l[2].slice(-1)&&(s*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(t/=360),"hsla"==u[1].toLowerCase().slice(0,4)&&(r=J(l[3])),l[3]&&"%"==l[3].slice(-1)&&(r/=100),i.hsl2rgb(t,n,s,r)):(u={r:t,g:n,b:s,toString:a},u.hex="#"+(16777216|s|n<<8|t<<16).toString(16).slice(1),i.is(r,"finite")&&(u.opacity=r),u)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:a}},i),i.hsb=r(function(e,t,n){return i.hsb2rgb(e,t,n).hex}),i.hsl=r(function(e,t,n){return i.hsl2rgb(e,t,n).hex}),i.rgb=r(function(e,t,i){return"#"+(16777216|i|t<<8|e<<16).toString(16).slice(1)}),i.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},i=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),i.hex},i.getColor.reset=function(){delete this.start},i.parsePathString=function(e){if(!e)return null;var t=Ct(e);if(t.arr)return Mt(t.arr);var n={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},s=[];return i.is(e,Q)&&i.is(e[0],Q)&&(s=Mt(e)),s.length||I(e).replace(ot,function(e,t,i){var r=[],a=t.toLowerCase();if(i.replace(ut,function(e,t){t&&r.push(+t)}),"m"==a&&r.length>2&&(s.push([t][E](r.splice(0,2))),a="l",t="m"==t?"l":"L"),"r"==a)s.push([t][E](r));else for(;r.length>=n[a]&&(s.push([t][E](r.splice(0,n[a]))),n[a]););}),s.toString=i._path2string,t.arr=Mt(s),s},i.parseTransformString=r(function(e){if(!e)return null;var t=[];return i.is(e,Q)&&i.is(e[0],Q)&&(t=Mt(e)),t.length||I(e).replace(lt,function(e,i,n){var s=[];A.call(i),n.replace(ut,function(e,t){t&&s.push(+t)}),t.push([i][E](s))}),t.toString=i._path2string,t});var Ct=function(e){var t=Ct.ps=Ct.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var i in t)t[S](i)&&i!=e&&(t[i].sleep--,!t[i].sleep&&delete t[i])}),t[e]};i.findDotsAtSegment=function(e,t,i,n,s,r,a,o,l){var u=1-l,h=U(u,3),c=U(u,2),p=l*l,d=p*l,m=h*e+3*c*l*i+3*u*l*l*s+d*a,f=h*t+3*c*l*n+3*u*l*l*r+d*o,y=e+2*l*(i-e)+p*(s-2*i+e),g=t+2*l*(n-t)+p*(r-2*n+t),v=i+2*l*(s-i)+p*(a-2*s+i),b=n+2*l*(r-n)+p*(o-2*r+n),L=u*e+l*i,O=u*t+l*n,w=u*s+l*a,_=u*r+l*o,x=90-180*B.atan2(y-v,g-b)/G;return(y>v||b>g)&&(x+=180),{x:m,y:f,m:{x:y,y:g},n:{x:v,y:b},start:{x:L,y:O},end:{x:w,y:_},alpha:x}},i.bezierBBox=function(e,t,n,s,r,a,o,l){i.is(e,"array")||(e=[e,t,n,s,r,a,o,l]);var u=Rt.apply(null,e);return{x:u.min.x,y:u.min.y,x2:u.max.x,y2:u.max.y,width:u.max.x-u.min.x,height:u.max.y-u.min.y}},i.isPointInsideBBox=function(e,t,i){return t>=e.x&&t<=e.x2&&i>=e.y&&i<=e.y2},i.isBBoxIntersect=function(e,t){var n=i.isPointInsideBBox;return n(t,e.x,e.y)||n(t,e.x2,e.y)||n(t,e.x,e.y2)||n(t,e.x2,e.y2)||n(e,t.x,t.y)||n(e,t.x2,t.y)||n(e,t.x,t.y2)||n(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},i.pathIntersection=function(e,t){return d(e,t)},i.pathIntersectionNumber=function(e,t){return d(e,t,1)},i.isPointInsidePath=function(e,t,n){var s=i.pathBBox(e);return i.isPointInsideBBox(s,t,n)&&1==d(e,[["M",t,n],["H",s.x2+10]],1)%2},i._removedFactory=function(e){return function(){t("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var kt=i.pathBBox=function(e){var t=Ct(e);if(t.bbox)return n(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};e=jt(e);for(var i,s=0,r=0,a=[],o=[],l=0,u=e.length;u>l;l++)if(i=e[l],"M"==i[0])s=i[1],r=i[2],a.push(s),o.push(r);else{var h=Rt(s,r,i[1],i[2],i[3],i[4],i[5],i[6]);a=a[E](h.min.x,h.max.x),o=o[E](h.min.y,h.max.y),s=i[5],r=i[6]}var c=q[P](0,a),p=q[P](0,o),d=D[P](0,a),m=D[P](0,o),f=d-c,y=m-p,g={x:c,y:p,x2:d,y2:m,width:f,height:y,cx:c+f/2,cy:p+y/2};return t.bbox=n(g),g},Mt=function(e){var t=n(e);return t.toString=i._path2string,t},Pt=i._pathToRelative=function(e){var t=Ct(e);if(t.rel)return Mt(t.rel);i.is(e,Q)&&i.is(e&&e[0],Q)||(e=i.parsePathString(e));var n=[],s=0,r=0,a=0,o=0,l=0;"M"==e[0][0]&&(s=e[0][1],r=e[0][2],a=s,o=r,l++,n.push(["M",s,r]));for(var u=l,h=e.length;h>u;u++){var c=n[u]=[],p=e[u];if(p[0]!=A.call(p[0]))switch(c[0]=A.call(p[0]),c[0]){case"a":c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=+(p[6]-s).toFixed(3),c[7]=+(p[7]-r).toFixed(3);break;case"v":c[1]=+(p[1]-r).toFixed(3);break;case"m":a=p[1],o=p[2];default:for(var d=1,m=p.length;m>d;d++)c[d]=+(p[d]-(d%2?s:r)).toFixed(3)}else{c=n[u]=[],"m"==p[0]&&(a=p[1]+s,o=p[2]+r);for(var f=0,y=p.length;y>f;f++)n[u][f]=p[f]}var g=n[u].length;switch(n[u][0]){case"z":s=a,r=o;break;case"h":s+=+n[u][g-1];break;case"v":r+=+n[u][g-1];break;default:s+=+n[u][g-2],r+=+n[u][g-1]}}return n.toString=i._path2string,t.rel=Mt(n),n},Et=i._pathToAbsolute=function(e){var t=Ct(e);if(t.abs)return Mt(t.abs);if(i.is(e,Q)&&i.is(e&&e[0],Q)||(e=i.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n=[],s=0,r=0,a=0,l=0,u=0;"M"==e[0][0]&&(s=+e[0][1],r=+e[0][2],a=s,l=r,u++,n[0]=["M",s,r]);for(var h,c,p=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),d=u,m=e.length;m>d;d++){if(n.push(h=[]),c=e[d],c[0]!=tt.call(c[0]))switch(h[0]=tt.call(c[0]),h[0]){case"A":h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=+(c[6]+s),h[7]=+(c[7]+r);break;case"V":h[1]=+c[1]+r;break;case"H":h[1]=+c[1]+s;break;case"R":for(var f=[s,r][E](c.slice(1)),y=2,g=f.length;g>y;y++)f[y]=+f[y]+s,f[++y]=+f[y]+r;n.pop(),n=n[E](o(f,p));break;case"M":a=+c[1]+s,l=+c[2]+r;default:for(y=1,g=c.length;g>y;y++)h[y]=+c[y]+(y%2?s:r)}else if("R"==c[0])f=[s,r][E](c.slice(1)),n.pop(),n=n[E](o(f,p)),h=["R"][E](c.slice(-2));else for(var v=0,b=c.length;b>v;v++)h[v]=c[v];switch(h[0]){case"Z":s=a,r=l;break;case"H":s=h[1];break;case"V":r=h[1];break;case"M":a=h[h.length-2],l=h[h.length-1];default:s=h[h.length-2],r=h[h.length-1]}}return n.toString=i._path2string,t.abs=Mt(n),n},Nt=function(e,t,i,n){return[e,t,i,n,i,n]},Tt=function(e,t,i,n,s,r){var a=1/3,o=2/3;return[a*e+o*i,a*t+o*n,a*s+o*i,a*r+o*n,s,r]},zt=function(e,t,i,n,s,a,o,l,u,h){var c,p=120*G/180,d=G/180*(+s||0),m=[],f=r(function(e,t,i){var n=e*B.cos(i)-t*B.sin(i),s=e*B.sin(i)+t*B.cos(i);return{x:n,y:s}});if(h)x=h[0],S=h[1],w=h[2],_=h[3];else{c=f(e,t,-d),e=c.x,t=c.y,c=f(l,u,-d),l=c.x,u=c.y;var y=(B.cos(G/180*s),B.sin(G/180*s),(e-l)/2),g=(t-u)/2,v=y*y/(i*i)+g*g/(n*n);v>1&&(v=B.sqrt(v),i=v*i,n=v*n);var b=i*i,L=n*n,O=(a==o?-1:1)*B.sqrt(H((b*L-b*g*g-L*y*y)/(b*g*g+L*y*y))),w=O*i*g/n+(e+l)/2,_=O*-n*y/i+(t+u)/2,x=B.asin(((t-_)/n).toFixed(9)),S=B.asin(((u-_)/n).toFixed(9));x=w>e?G-x:x,S=w>l?G-S:S,0>x&&(x=2*G+x),0>S&&(S=2*G+S),o&&x>S&&(x-=2*G),!o&&S>x&&(S-=2*G)}var C=S-x;if(H(C)>p){var k=S,M=l,P=u;S=x+p*(o&&S>x?1:-1),l=w+i*B.cos(S),u=_+n*B.sin(S),m=zt(l,u,i,n,s,0,o,M,P,[S,k,w,_])}C=S-x;var N=B.cos(x),T=B.sin(x),z=B.cos(S),I=B.sin(S),j=B.tan(C/4),F=4/3*i*j,A=4/3*n*j,D=[e,t],q=[e+F*T,t-A*N],U=[l+F*I,u-A*z],V=[l,u];if(q[0]=2*D[0]-q[0],q[1]=2*D[1]-q[1],h)return[q,U,V][E](m);m=[q,U,V][E](m).join()[R](",");for(var W=[],Q=0,X=m.length;X>Q;Q++)W[Q]=Q%2?f(m[Q-1],m[Q],d).y:f(m[Q],m[Q+1],d).x;return W},It=function(e,t,i,n,s,r,a,o,l){var u=1-l;return{x:U(u,3)*e+3*U(u,2)*l*i+3*u*l*l*s+U(l,3)*a,y:U(u,3)*t+3*U(u,2)*l*n+3*u*l*l*r+U(l,3)*o}},Rt=r(function(e,t,i,n,s,r,a,o){var l,u=s-2*i+e-(a-2*s+i),h=2*(i-e)-2*(s-i),c=e-i,p=(-h+B.sqrt(h*h-4*u*c))/2/u,d=(-h-B.sqrt(h*h-4*u*c))/2/u,m=[t,o],f=[e,a];return H(p)>"1e12"&&(p=.5),H(d)>"1e12"&&(d=.5),p>0&&1>p&&(l=It(e,t,i,n,s,r,a,o,p),f.push(l.x),m.push(l.y)),d>0&&1>d&&(l=It(e,t,i,n,s,r,a,o,d),f.push(l.x),m.push(l.y)),u=r-2*n+t-(o-2*r+n),h=2*(n-t)-2*(r-n),c=t-n,p=(-h+B.sqrt(h*h-4*u*c))/2/u,d=(-h-B.sqrt(h*h-4*u*c))/2/u,H(p)>"1e12"&&(p=.5),H(d)>"1e12"&&(d=.5),p>0&&1>p&&(l=It(e,t,i,n,s,r,a,o,p),f.push(l.x),m.push(l.y)),d>0&&1>d&&(l=It(e,t,i,n,s,r,a,o,d),f.push(l.x),m.push(l.y)),{min:{x:q[P](0,f),y:q[P](0,m)},max:{x:D[P](0,f),y:D[P](0,m)}}}),jt=i._path2curve=r(function(e,t){var i=!t&&Ct(e);if(!t&&i.curve)return Mt(i.curve);for(var n=Et(e),s=t&&Et(t),r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=(function(e,t,i){var n,s;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][E](zt[P](0,[t.x,t.y][E](e.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*t.x-t.bx,s=2*t.y-t.by):(n=t.x,s=t.y),e=["C",n,s][E](e.slice(1));break;case"T":"Q"==i||"T"==i?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"][E](Tt(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][E](Tt(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][E](Nt(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][E](Nt(t.x,t.y,e[1],t.y));break;case"V":e=["C"][E](Nt(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][E](Nt(t.x,t.y,t.X,t.Y))}return e}),l=function(e,t){if(e[t].length>7){e[t].shift();for(var i=e[t];i.length;)e.splice(t++,0,["C"][E](i.splice(0,6)));e.splice(t,1),c=D(n.length,s&&s.length||0)}},u=function(e,t,i,r,a){e&&t&&"M"==e[a][0]&&"M"!=t[a][0]&&(t.splice(a,0,["M",r.x,r.y]),i.bx=0,i.by=0,i.x=e[a][1],i.y=e[a][2],c=D(n.length,s&&s.length||0))},h=0,c=D(n.length,s&&s.length||0);c>h;h++){n[h]=o(n[h],r),l(n,h),s&&(s[h]=o(s[h],a)),s&&l(s,h),u(n,s,r,a,h),u(s,n,a,r,h);var p=n[h],d=s&&s[h],m=p.length,f=s&&d.length;r.x=p[m-2],r.y=p[m-1],r.bx=J(p[m-4])||r.x,r.by=J(p[m-3])||r.y,a.bx=s&&(J(d[f-4])||a.x),a.by=s&&(J(d[f-3])||a.y),a.x=s&&d[f-2],a.y=s&&d[f-1]}return s||(i.curve=Mt(n)),s?[n,s]:n},null,Mt),Ft=(i._parseDots=r(function(e){for(var t=[],n=0,s=e.length;s>n;n++){var r={},a=e[n].match(/^([^:]*):?([\d\.]*)/);if(r.color=i.getRGB(a[1]),r.color.error)return null;r.color=r.color.hex,a[2]&&(r.offset=a[2]+"%"),t.push(r)}for(n=1,s=t.length-1;s>n;n++)if(!t[n].offset){for(var o=J(t[n-1].offset||0),l=0,u=n+1;s>u;u++)if(t[u].offset){l=t[u].offset;break}l||(l=100,u=s),l=J(l);for(var h=(l-o)/(u-n+1);u>n;n++)o+=h,t[n].offset=o+"%"}return t}),i._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),At=(i._tofront=function(e,t){t.top!==e&&(Ft(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},i._toback=function(e,t){t.bottom!==e&&(Ft(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},i._insertafter=function(e,t,i){Ft(e,i),t==i.top&&(i.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},i._insertbefore=function(e,t,i){Ft(e,i),t==i.bottom&&(i.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},i.toMatrix=function(e,t){var i=kt(e),n={_:{transform:T},getBBox:function(){return i}};return Bt(n,t),n.matrix}),Bt=(i.transformPath=function(e,t){return gt(e,At(e,t))},i._extractTransform=function(e,t){if(null==t)return e._.transform;t=I(t).replace(/\.{3}|\u2026/g,e._.transform||T);var n=i.parseTransformString(t),s=0,r=0,a=0,o=1,l=1,u=e._,h=new m;if(u.transform=n||[],n)for(var c=0,p=n.length;p>c;c++){var d,f,y,g,v,b=n[c],L=b.length,O=I(b[0]).toLowerCase(),w=b[0]!=O,_=w?h.invert():0;"t"==O&&3==L?w?(d=_.x(0,0),f=_.y(0,0),y=_.x(b[1],b[2]),g=_.y(b[1],b[2]),h.translate(y-d,g-f)):h.translate(b[1],b[2]):"r"==O?2==L?(v=v||e.getBBox(1),h.rotate(b[1],v.x+v.width/2,v.y+v.height/2),s+=b[1]):4==L&&(w?(y=_.x(b[2],b[3]),g=_.y(b[2],b[3]),h.rotate(b[1],y,g)):h.rotate(b[1],b[2],b[3]),s+=b[1]):"s"==O?2==L||3==L?(v=v||e.getBBox(1),h.scale(b[1],b[L-1],v.x+v.width/2,v.y+v.height/2),o*=b[1],l*=b[L-1]):5==L&&(w?(y=_.x(b[3],b[4]),g=_.y(b[3],b[4]),h.scale(b[1],b[2],y,g)):h.scale(b[1],b[2],b[3],b[4]),o*=b[1],l*=b[2]):"m"==O&&7==L&&h.add(b[1],b[2],b[3],b[4],b[5],b[6]),u.dirtyT=1,e.matrix=h}e.matrix=h,u.sx=o,u.sy=l,u.deg=s,u.dx=r=h.e,u.dy=a=h.f,1==o&&1==l&&!s&&u.bbox?(u.bbox.x+=+r,u.bbox.y+=+a):u.dirtyT=1}),Dt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}},qt=i._equaliseTransform=function(e,t){t=I(t).replace(/\.{3}|\u2026/g,e),e=i.parseTransformString(e)||[],t=i.parseTransformString(t)||[];for(var n,s,r,a,o=D(e.length,t.length),l=[],u=[],h=0;o>h;h++){if(r=e[h]||Dt(t[h]),a=t[h]||Dt(r),r[0]!=a[0]||"r"==r[0].toLowerCase()&&(r[2]!=a[2]||r[3]!=a[3])||"s"==r[0].toLowerCase()&&(r[3]!=a[3]||r[4]!=a[4]))return;for(l[h]=[],u[h]=[],n=0,s=D(r.length,a.length);s>n;n++)n in r&&(l[h][n]=r[n]),n in a&&(u[h][n]=a[n])}return{from:l,to:u}};i._getContainer=function(e,t,n,s){var r;return r=null!=s||i.is(e,"object")?e:C.doc.getElementById(e),null!=r?r.tagName?null==t?{container:r,width:r.style.pixelWidth||r.offsetWidth,height:r.style.pixelHeight||r.offsetHeight}:{container:r,width:t,height:n}:{container:1,x:e,y:t,width:n,height:s}:void 0},i.pathToRelative=Pt,i._engine={},i.path2curve=jt,i.matrix=function(e,t,i,n,s,r){return new m(e,t,i,n,s,r)},function(e){function t(e){return e[0]*e[0]+e[1]*e[1]}function n(e){var i=B.sqrt(t(e));e[0]&&(e[0]/=i),e[1]&&(e[1]/=i)}e.add=function(e,t,i,n,s,r){var a,o,l,u,h=[[],[],[]],c=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],p=[[e,i,s],[t,n,r],[0,0,1]];for(e&&e instanceof m&&(p=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),a=0;3>a;a++)for(o=0;3>o;o++){for(u=0,l=0;3>l;l++)u+=c[a][l]*p[l][o];h[a][o]=u}this.a=h[0][0],this.b=h[1][0],this.c=h[0][1],this.d=h[1][1],this.e=h[0][2],this.f=h[1][2]},e.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new m(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},e.clone=function(){return new m(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(e,t){this.add(1,0,0,1,e,t)},e.scale=function(e,t,i,n){null==t&&(t=e),(i||n)&&this.add(1,0,0,1,i,n),this.add(e,0,0,t,0,0),(i||n)&&this.add(1,0,0,1,-i,-n)},e.rotate=function(e,t,n){e=i.rad(e),t=t||0,n=n||0;var s=+B.cos(e).toFixed(9),r=+B.sin(e).toFixed(9);this.add(s,r,-r,s,t,n),this.add(1,0,0,1,-t,-n)},e.x=function(e,t){return e*this.a+t*this.c+this.e},e.y=function(e,t){return e*this.b+t*this.d+this.f},e.get=function(e){return+this[I.fromCharCode(97+e)].toFixed(4)},e.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var s=[[this.a,this.c],[this.b,this.d]];e.scalex=B.sqrt(t(s[0])),n(s[0]),e.shear=s[0][0]*s[1][0]+s[0][1]*s[1][1],s[1]=[s[1][0]-s[0][0]*e.shear,s[1][1]-s[0][1]*e.shear],e.scaley=B.sqrt(t(s[1])),n(s[1]),e.shear/=e.scaley;var r=-s[0][1],a=s[1][1];return 0>a?(e.rotate=i.deg(B.acos(a)),0>r&&(e.rotate=360-e.rotate)):e.rotate=i.deg(B.asin(r)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(e){var t=e||this[R]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:T)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:T)+(t.rotate?"r"+[t.rotate,0,0]:T)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(m.prototype);var Ht=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);O.safari="Apple Computer, Inc."==navigator.vendor&&(Ht&&Ht[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Ht&&Ht[1]<8?function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){e.remove()})}:pt;for(var Ut=function(){this.returnValue=!1},Gt=function(){return this.originalEvent.preventDefault()},Vt=function(){this.cancelBubble=!0},Wt=function(){return this.originalEvent.stopPropagation()},Qt=function(e){var t=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,i=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft;return{x:e.clientX+i,y:e.clientY+t}},Xt=function(){return C.doc.addEventListener?function(e,t,i,n){var s=function(e){var t=Qt(e);return i.call(n,e,t.x,t.y)};if(e.addEventListener(t,s,!1),N&&F[t]){var r=function(t){for(var s=Qt(t),r=t,a=0,o=t.targetTouches&&t.targetTouches.length;o>a;a++)if(t.targetTouches[a].target==e){t=t.targetTouches[a],t.originalEvent=r,t.preventDefault=Gt,t.stopPropagation=Wt;break}return i.call(n,t,s.x,s.y)};e.addEventListener(F[t],r,!1)}return function(){return e.removeEventListener(t,s,!1),N&&F[t]&&e.removeEventListener(F[t],s,!1),!0}}:C.doc.attachEvent?function(e,t,i,n){var s=function(e){e=e||C.win.event;var t=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,s=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,r=e.clientX+s,a=e.clientY+t;return e.preventDefault=e.preventDefault||Ut,e.stopPropagation=e.stopPropagation||Vt,i.call(n,e,r,a)};e.attachEvent("on"+t,s);var r=function(){return e.detachEvent("on"+t,s),!0};return r}:void 0}(),Zt=[],Yt=function(e){for(var i,n=e.clientX,s=e.clientY,r=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,a=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,o=Zt.length;o--;){if(i=Zt[o],N&&e.touches){for(var l,u=e.touches.length;u--;)if(l=e.touches[u],l.identifier==i.el._drag.id){n=l.clientX,s=l.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var h,c=i.el.node,p=c.nextSibling,d=c.parentNode,m=c.style.display;C.win.opera&&d.removeChild(c),c.style.display="none",h=i.el.paper.getElementByPoint(n,s),c.style.display=m,C.win.opera&&(p?d.insertBefore(c,p):d.appendChild(c)),h&&t("raphael.drag.over."+i.el.id,i.el,h),n+=a,s+=r,t("raphael.drag.move."+i.el.id,i.move_scope||i.el,n-i.el._drag.x,s-i.el._drag.y,n,s,e)}},Kt=function(e){i.unmousemove(Yt).unmouseup(Kt);for(var n,s=Zt.length;s--;)n=Zt[s],n.el._drag={},t("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,e);Zt=[]},$t=i.el={},Jt=j.length;Jt--;)!function(e){i[e]=$t[e]=function(t,n){return i.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Xt(this.shape||this.node||C.doc,e,t,n||this)})),this},i["un"+e]=$t["un"+e]=function(t){for(var n=this.events||[],s=n.length;s--;)n[s].name!=e||!i.is(t,"undefined")&&n[s].f!=t||(n[s].unbind(),n.splice(s,1),!n.length&&delete this.events);return this}}(j[Jt]);$t.data=function(e,n){var s=ht[this.id]=ht[this.id]||{};if(0==arguments.length)return s;if(1==arguments.length){if(i.is(e,"object")){for(var r in e)e[S](r)&&this.data(r,e[r]);return this}return t("raphael.data.get."+this.id,this,s[e],e),s[e]}return s[e]=n,t("raphael.data.set."+this.id,this,n,e),this},$t.removeData=function(e){return null==e?ht[this.id]={}:ht[this.id]&&delete ht[this.id][e],this},$t.getData=function(){return n(ht[this.id]||{})},$t.hover=function(e,t,i,n){return this.mouseover(e,i).mouseout(t,n||i)},$t.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var ei=[];$t.drag=function(e,n,s,r,a,o){function l(l){(l.originalEvent||l).preventDefault();var u=l.clientX,h=l.clientY,c=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,p=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft;if(this._drag.id=l.identifier,N&&l.touches)for(var d,m=l.touches.length;m--;)if(d=l.touches[m],this._drag.id=d.identifier,d.identifier==this._drag.id){u=d.clientX,h=d.clientY;break}this._drag.x=u+p,this._drag.y=h+c,!Zt.length&&i.mousemove(Yt).mouseup(Kt),Zt.push({el:this,move_scope:r,start_scope:a,end_scope:o}),n&&t.on("raphael.drag.start."+this.id,n),e&&t.on("raphael.drag.move."+this.id,e),s&&t.on("raphael.drag.end."+this.id,s),t("raphael.drag.start."+this.id,a||r||this,l.clientX+p,l.clientY+c,l)}return this._drag={},ei.push({el:this,start:l}),this.mousedown(l),this},$t.onDragOver=function(e){e?t.on("raphael.drag.over."+this.id,e):t.unbind("raphael.drag.over."+this.id)},$t.undrag=function(){for(var e=ei.length;e--;)ei[e].el==this&&(this.unmousedown(ei[e].start),ei.splice(e,1),t.unbind("raphael.drag.*."+this.id));!ei.length&&i.unmousemove(Yt).unmouseup(Kt),Zt=[]},O.circle=function(e,t,n){var s=i._engine.circle(this,e||0,t||0,n||0);return this.__set__&&this.__set__.push(s),s},O.rect=function(e,t,n,s,r){var a=i._engine.rect(this,e||0,t||0,n||0,s||0,r||0);return this.__set__&&this.__set__.push(a),a},O.ellipse=function(e,t,n,s){var r=i._engine.ellipse(this,e||0,t||0,n||0,s||0);return this.__set__&&this.__set__.push(r),r},O.path=function(e){e&&!i.is(e,W)&&!i.is(e[0],Q)&&(e+=T);var t=i._engine.path(i.format[P](i,arguments),this);return this.__set__&&this.__set__.push(t),t},O.image=function(e,t,n,s,r){var a=i._engine.image(this,e||"about:blank",t||0,n||0,s||0,r||0);return this.__set__&&this.__set__.push(a),a},O.text=function(e,t,n){var s=i._engine.text(this,e||0,t||0,I(n));return this.__set__&&this.__set__.push(s),s},O.set=function(e){!i.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new pi(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},O.setStart=function(e){this.__set__=e||this.set()},O.setFinish=function(){var e=this.__set__;return delete this.__set__,e},O.setSize=function(e,t){return i._engine.setSize.call(this,e,t)},O.setViewBox=function(e,t,n,s,r){return i._engine.setViewBox.call(this,e,t,n,s,r)},O.top=O.bottom=null,O.raphael=i;var ti=function(e){var t=e.getBoundingClientRect(),i=e.ownerDocument,n=i.body,s=i.documentElement,r=s.clientTop||n.clientTop||0,a=s.clientLeft||n.clientLeft||0,o=t.top+(C.win.pageYOffset||s.scrollTop||n.scrollTop)-r,l=t.left+(C.win.pageXOffset||s.scrollLeft||n.scrollLeft)-a;return{y:o,x:l}};O.getElementByPoint=function(e,t){var i=this,n=i.canvas,s=C.doc.elementFromPoint(e,t);if(C.win.opera&&"svg"==s.tagName){var r=ti(n),a=n.createSVGRect();a.x=e-r.x,a.y=t-r.y,a.width=a.height=1;var o=n.getIntersectionList(a,null);o.length&&(s=o[o.length-1])}if(!s)return null;for(;s.parentNode&&s!=n.parentNode&&!s.raphael;)s=s.parentNode;return s==i.canvas.parentNode&&(s=n),s=s&&s.raphael?i.getById(s.raphaelid):null},O.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(n){i.isBBoxIntersect(n.getBBox(),e)&&t.push(n)}),t},O.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},O.forEach=function(e,t){for(var i=this.bottom;i;){if(e.call(t,i)===!1)return this;i=i.next}return this},O.getElementsByPoint=function(e,t){var i=this.set();return this.forEach(function(n){n.isPointInside(e,t)&&i.push(n)}),i},$t.isPointInside=function(e,t){var n=this.realPath=yt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(n=i.transformPath(n,this.attr("transform"))),i.isPointInsidePath(n,e,t)},$t.getBBox=function(e){if(this.removed)return{};var t=this._;return e?((t.dirty||!t.bboxwt)&&(this.realPath=yt[this.type](this),t.bboxwt=kt(this.realPath),t.bboxwt.toString=f,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=yt[this.type](this)),t.bbox=kt(gt(this.realPath,this.matrix)),t.bbox.toString=f,t.dirty=t.dirtyT=0),t.bbox)},$t.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},$t.glow=function(e){if("text"==this.type)return null;e=e||{};var t={width:(e.width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity||.5,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},i=t.width/2,n=this.paper,s=n.set(),r=this.realPath||yt[this.type](this);r=this.matrix?gt(r,this.matrix):r;for(var a=1;i+1>a;a++)s.push(n.path(r).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/i*a).toFixed(3),opacity:+(t.opacity/i).toFixed(3)}));return s.insertBefore(this).translate(t.offsetx,t.offsety)};var ii=function(e,t,n,s,r,a,o,l,c){return null==c?u(e,t,n,s,r,a,o,l):i.findDotsAtSegment(e,t,n,s,r,a,o,l,h(e,t,n,s,r,a,o,l,c))},ni=function(e,t){return function(n,s,r){n=jt(n);for(var a,o,l,u,h,c="",p={},d=0,m=0,f=n.length;f>m;m++){if(l=n[m],"M"==l[0])a=+l[1],o=+l[2];else{if(u=ii(a,o,l[1],l[2],l[3],l[4],l[5],l[6]),d+u>s){if(t&&!p.start){if(h=ii(a,o,l[1],l[2],l[3],l[4],l[5],l[6],s-d),c+=["C"+h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y],r)return c;p.start=c,c=["M"+h.x,h.y+"C"+h.n.x,h.n.y,h.end.x,h.end.y,l[5],l[6]].join(),d+=u,a=+l[5],o=+l[6];continue}if(!e&&!t)return h=ii(a,o,l[1],l[2],l[3],l[4],l[5],l[6],s-d),{x:h.x,y:h.y,alpha:h.alpha}}d+=u,a=+l[5],o=+l[6]}c+=l.shift()+l}return p.end=c,h=e?d:t?p:i.findDotsAtSegment(a,o,l[0],l[1],l[2],l[3],l[4],l[5],1),h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha}),h}},si=ni(1),ri=ni(),ai=ni(0,1);i.getTotalLength=si,i.getPointAtLength=ri,i.getSubpath=function(e,t,i){if(this.getTotalLength(e)-i<1e-6)return ai(e,t).end;var n=ai(e,i,1);return t?ai(n,t).end:n},$t.getTotalLength=function(){var e=this.getPath();return e?this.node.getTotalLength?this.node.getTotalLength():si(e):void 0},$t.getPointAtLength=function(e){var t=this.getPath();return t?ri(t,e):void 0},$t.getPath=function(){var e,t=i._getPath[this.type];return"text"!=this.type&&"set"!=this.type?(t&&(e=t(this)),e):void 0},$t.getSubpath=function(e,t){var n=this.getPath();return n?i.getSubpath(n,e,t):void 0};var oi=i.easing_formulas={linear:function(e){return e},"<":function(e){return U(e,1.7)},">":function(e){return U(e,.48)},"<>":function(e){var t=.48-e/1.04,i=B.sqrt(.1734+t*t),n=i-t,s=U(H(n),1/3)*(0>n?-1:1),r=-i-t,a=U(H(r),1/3)*(0>r?-1:1),o=s+a+.5;return 3*(1-o)*o*o+o*o*o},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:U(2,-10*e)*B.sin(2*(e-.075)*G/.3)+1},bounce:function(e){var t,i=7.5625,n=2.75;return 1/n>e?t=i*e*e:2/n>e?(e-=1.5/n,t=i*e*e+.75):2.5/n>e?(e-=2.25/n,t=i*e*e+.9375):(e-=2.625/n,t=i*e*e+.984375),t}};oi.easeIn=oi["ease-in"]=oi["<"],oi.easeOut=oi["ease-out"]=oi[">"],oi.easeInOut=oi["ease-in-out"]=oi["<>"],oi["back-in"]=oi.backIn,oi["back-out"]=oi.backOut;var li=[],ui=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,16)
},hi=function(){for(var e=+new Date,n=0;n<li.length;n++){var s=li[n];if(!s.el.removed&&!s.paused){var r,a,o=e-s.start,l=s.ms,u=s.easing,h=s.from,c=s.diff,p=s.to,d=(s.t,s.el),m={},f={};if(s.initstatus?(o=(s.initstatus*s.anim.top-s.prev)/(s.percent-s.prev)*l,s.status=s.initstatus,delete s.initstatus,s.stop&&li.splice(n--,1)):s.status=(s.prev+(s.percent-s.prev)*(o/l))/s.anim.top,!(0>o))if(l>o){var y=u(o/l);for(var g in h)if(h[S](g)){switch(nt[g]){case V:r=+h[g]+y*l*c[g];break;case"colour":r="rgb("+[ci($(h[g].r+y*l*c[g].r)),ci($(h[g].g+y*l*c[g].g)),ci($(h[g].b+y*l*c[g].b))].join(",")+")";break;case"path":r=[];for(var b=0,L=h[g].length;L>b;b++){r[b]=[h[g][b][0]];for(var O=1,w=h[g][b].length;w>O;O++)r[b][O]=+h[g][b][O]+y*l*c[g][b][O];r[b]=r[b].join(z)}r=r.join(z);break;case"transform":if(c[g].real)for(r=[],b=0,L=h[g].length;L>b;b++)for(r[b]=[h[g][b][0]],O=1,w=h[g][b].length;w>O;O++)r[b][O]=h[g][b][O]+y*l*c[g][b][O];else{var _=function(e){return+h[g][e]+y*l*c[g][e]};r=[["m",_(0),_(1),_(2),_(3),_(4),_(5)]]}break;case"csv":if("clip-rect"==g)for(r=[],b=4;b--;)r[b]=+h[g][b]+y*l*c[g][b];break;default:var x=[][E](h[g]);for(r=[],b=d.paper.customAttributes[g].length;b--;)r[b]=+x[b]+y*l*c[g][b]}m[g]=r}d.attr(m),function(e,i,n){setTimeout(function(){t("raphael.anim.frame."+e,i,n)})}(d.id,d,s.anim)}else{if(function(e,n,s){setTimeout(function(){t("raphael.anim.frame."+n.id,n,s),t("raphael.anim.finish."+n.id,n,s),i.is(e,"function")&&e.call(n)})}(s.callback,d,s.anim),d.attr(p),li.splice(n--,1),s.repeat>1&&!s.next){for(a in p)p[S](a)&&(f[a]=s.totalOrigin[a]);s.el.attr(f),v(s.anim,s.el,s.anim.percents[0],null,s.totalOrigin,s.repeat-1)}s.next&&!s.stop&&v(s.anim,s.el,s.next,null,s.totalOrigin,s.repeat)}}}i.svg&&d&&d.paper&&d.paper.safari(),li.length&&ui(hi)},ci=function(e){return e>255?255:0>e?0:e};$t.animateWith=function(e,t,n,s,r,a){var o=this;if(o.removed)return a&&a.call(o),o;var l=n instanceof g?n:i.animation(n,s,r,a);v(l,o,l.percents[0],null,o.attr());for(var u=0,h=li.length;h>u;u++)if(li[u].anim==t&&li[u].el==e){li[h-1].start=li[u].start;break}return o},$t.onAnimation=function(e){return e?t.on("raphael.anim.frame."+this.id,e):t.unbind("raphael.anim.frame."+this.id),this},g.prototype.delay=function(e){var t=new g(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},g.prototype.repeat=function(e){var t=new g(this.anim,this.ms);return t.del=this.del,t.times=B.floor(D(e,0))||1,t},i.animation=function(e,t,n,s){if(e instanceof g)return e;(i.is(n,"function")||!n)&&(s=s||n||null,n=null),e=Object(e),t=+t||0;var r,a,o={};for(a in e)e[S](a)&&J(a)!=a&&J(a)+"%"!=a&&(r=!0,o[a]=e[a]);return r?(n&&(o.easing=n),s&&(o.callback=s),new g({100:o},t)):new g(e,t)},$t.animate=function(e,t,n,s){var r=this;if(r.removed)return s&&s.call(r),r;var a=e instanceof g?e:i.animation(e,t,n,s);return v(a,r,a.percents[0],null,r.attr()),r},$t.setTime=function(e,t){return e&&null!=t&&this.status(e,q(t,e.ms)/e.ms),this},$t.status=function(e,t){var i,n,s=[],r=0;if(null!=t)return v(e,this,-1,q(t,1)),this;for(i=li.length;i>r;r++)if(n=li[r],n.el.id==this.id&&(!e||n.anim==e)){if(e)return n.status;s.push({anim:n.anim,status:n.status})}return e?0:s},$t.pause=function(e){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||e&&li[i].anim!=e||t("raphael.anim.pause."+this.id,this,li[i].anim)!==!1&&(li[i].paused=!0);return this},$t.resume=function(e){for(var i=0;i<li.length;i++)if(li[i].el.id==this.id&&(!e||li[i].anim==e)){var n=li[i];t("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},$t.stop=function(e){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||e&&li[i].anim!=e||t("raphael.anim.stop."+this.id,this,li[i].anim)!==!1&&li.splice(i--,1);return this},t.on("raphael.remove",b),t.on("raphael.clear",b),$t.toString=function(){return"Raphaël’s object"};var pi=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,i=e.length;i>t;t++)!e[t]||e[t].constructor!=$t.constructor&&e[t].constructor!=pi||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},di=pi.prototype;di.push=function(){for(var e,t,i=0,n=arguments.length;n>i;i++)e=arguments[i],!e||e.constructor!=$t.constructor&&e.constructor!=pi||(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},di.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},di.forEach=function(e,t){for(var i=0,n=this.items.length;n>i;i++)if(e.call(t,this.items[i],i)===!1)return this;return this};for(var mi in $t)$t[S](mi)&&(di[mi]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e][P](i,t)})}}(mi));return di.attr=function(e,t){if(e&&i.is(e,Q)&&i.is(e[0],"object"))for(var n=0,s=e.length;s>n;n++)this.items[n].attr(e[n]);else for(var r=0,a=this.items.length;a>r;r++)this.items[r].attr(e,t);return this},di.clear=function(){for(;this.length;)this.pop()},di.splice=function(e,t){e=0>e?D(this.length+e,0):e,t=D(0,q(this.length-e,t));var i,n=[],s=[],r=[];for(i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=0;t>i;i++)s.push(this[e+i]);for(;i<this.length-e;i++)n.push(this[e+i]);var a=r.length;for(i=0;i<a+n.length;i++)this.items[e+i]=this[e+i]=a>i?r[i]:n[i-a];for(i=this.items.length=this.length-=t-a;this[i];)delete this[i++];return new pi(s)},di.exclude=function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]==e)return this.splice(t,1),!0},di.animate=function(e,t,n,s){(i.is(n,"function")||!n)&&(s=n||null);var r,a,o=this.items.length,l=o,u=this;if(!o)return this;s&&(a=function(){!--o&&s.call(u)}),n=i.is(n,W)?n:a;var h=i.animation(e,t,n,a);for(r=this.items[--l].animate(h);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(r,h,h),this.items[l]&&!this.items[l].removed||o--;return this},di.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},di.getBBox=function(){for(var e=[],t=[],i=[],n=[],s=this.items.length;s--;)if(!this.items[s].removed){var r=this.items[s].getBBox();e.push(r.x),t.push(r.y),i.push(r.x+r.width),n.push(r.y+r.height)}return e=q[P](0,e),t=q[P](0,t),i=D[P](0,i),n=D[P](0,n),{x:e,y:t,x2:i,y2:n,width:i-e,height:n-t}},di.clone=function(e){e=this.paper.set();for(var t=0,i=this.items.length;i>t;t++)e.push(this.items[t].clone());return e},di.toString=function(){return"Raphaël‘s set"},di.glow=function(e){var t=this.paper.set();return this.forEach(function(i){var n=i.glow(e);null!=n&&n.forEach(function(e){t.push(e)})}),t},di.isPointInside=function(e,t){var i=!1;return this.forEach(function(n){return n.isPointInside(e,t)?(console.log("runned"),i=!0,!1):void 0}),i},i.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},i=e.face["font-family"];for(var n in e.face)e.face[S](n)&&(t.face[n]=e.face[n]);if(this.fonts[i]?this.fonts[i].push(t):this.fonts[i]=[t],!e.svg){t.face["units-per-em"]=et(e.face["units-per-em"],10);for(var s in e.glyphs)if(e.glyphs[S](s)){var r=e.glyphs[s];if(t.glyphs[s]={w:r.w,k:{},d:r.d&&"M"+r.d.replace(/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"},r.k)for(var a in r.k)r[S](a)&&(t.glyphs[s].k[a]=r.k[a])}}return e},O.getFont=function(e,t,n,s){if(s=s||"normal",n=n||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,i.fonts){var r=i.fonts[e];if(!r){var a=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,T)+"(\\s|$)","i");for(var o in i.fonts)if(i.fonts[S](o)&&a.test(o)){r=i.fonts[o];break}}var l;if(r)for(var u=0,h=r.length;h>u&&(l=r[u],l.face["font-weight"]!=t||l.face["font-style"]!=n&&l.face["font-style"]||l.face["font-stretch"]!=s);u++);return l}},O.print=function(e,t,n,s,r,a,o,l){a=a||"middle",o=D(q(o||0,1),-1),l=D(q(l||1,3),1);var u,h=I(n)[R](T),c=0,p=0,d=T;if(i.is(s,"string")&&(s=this.getFont(s)),s){u=(r||16)/s.face["units-per-em"];for(var m=s.face.bbox[R](w),f=+m[0],y=m[3]-m[1],g=0,v=+m[1]+("baseline"==a?y+ +s.face.descent:y/2),b=0,L=h.length;L>b;b++){if("\n"==h[b])c=0,_=0,p=0,g+=y*l;else{var O=p&&s.glyphs[h[b-1]]||{},_=s.glyphs[h[b]];c+=p?(O.w||s.w)+(O.k&&O.k[h[b]]||0)+s.w*o:0,p=1}_&&_.d&&(d+=i.transformPath(_.d,["t",c*u,g*u,"s",u,u,f,v,"t",(e-f)/u,(t-v)/u]))}}return this.path(d).attr({fill:"#000",stroke:"none"})},O.add=function(e){if(i.is(e,"array"))for(var t,n=this.set(),s=0,r=e.length;r>s;s++)t=e[s]||{},_[S](t.type)&&n.push(this[t.type]().attr(t));return n},i.format=function(e,t){var n=i.is(t,Q)?[0][E](t):arguments;return e&&i.is(e,W)&&n.length-1&&(e=e.replace(x,function(e,t){return null==n[++t]?T:n[t]})),e||T},i.fullfill=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(e,i,n){var s=n;return i.replace(t,function(e,t,i,n,r){t=t||n,s&&(t in s&&(s=s[t]),"function"==typeof s&&r&&(s=s()))}),s=(null==s||s==n?e:s)+""};return function(t,n){return String(t).replace(e,function(e,t){return i(e,t,n)})}}(),i.ninja=function(){return k.was?C.win.Raphael=k.is:delete Raphael,i},i.st=di,function(e,t,n){function s(){/in/.test(e.readyState)?setTimeout(s,9):i.eve("raphael.DOMload")}null==e.readyState&&e.addEventListener&&(e.addEventListener(t,n=function(){e.removeEventListener(t,n,!1),e.readyState="complete"},!1),e.readyState="loading"),s()}(document,"DOMContentLoaded"),t.on("raphael.DOMload",function(){L=!0}),function(){if(i.svg){var e="hasOwnProperty",t=String,n=parseFloat,s=parseInt,r=Math,a=r.max,o=r.abs,l=r.pow,u=/[, ]+/,h=i.eve,c="",p=" ",d="http://www.w3.org/1999/xlink",m={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},f={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var y=function(n,s){if(s){"string"==typeof n&&(n=y(n));for(var r in s)s[e](r)&&("xlink:"==r.substring(0,6)?n.setAttributeNS(d,r.substring(6),t(s[r])):n.setAttribute(r,t(s[r])))}else n=i._g.doc.createElementNS("http://www.w3.org/2000/svg",n),n.style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},g=function(e,s){var u="linear",h=e.id+s,p=.5,d=.5,m=e.node,f=e.paper,g=m.style,v=i._g.doc.getElementById(h);if(!v){if(s=t(s).replace(i._radial_gradient,function(e,t,i){if(u="radial",t&&i){p=n(t),d=n(i);var s=2*(d>.5)-1;l(p-.5,2)+l(d-.5,2)>.25&&(d=r.sqrt(.25-l(p-.5,2))*s+.5)&&.5!=d&&(d=d.toFixed(5)-1e-5*s)}return c}),s=s.split(/\s*\-\s*/),"linear"==u){var b=s.shift();if(b=-n(b),isNaN(b))return null;var L=[0,0,r.cos(i.rad(b)),r.sin(i.rad(b))],O=1/(a(o(L[2]),o(L[3]))||1);L[2]*=O,L[3]*=O,L[2]<0&&(L[0]=-L[2],L[2]=0),L[3]<0&&(L[1]=-L[3],L[3]=0)}var w=i._parseDots(s);if(!w)return null;if(h=h.replace(/[\(\)\s,\xb0#]/g,"_"),e.gradient&&h!=e.gradient.id&&(f.defs.removeChild(e.gradient),delete e.gradient),!e.gradient){v=y(u+"Gradient",{id:h}),e.gradient=v,y(v,"radial"==u?{fx:p,fy:d}:{x1:L[0],y1:L[1],x2:L[2],y2:L[3],gradientTransform:e.matrix.invert()}),f.defs.appendChild(v);for(var _=0,x=w.length;x>_;_++)v.appendChild(y("stop",{offset:w[_].offset?w[_].offset:_?"100%":"0%","stop-color":w[_].color||"#fff"}))}}return y(m,{fill:"url(#"+h+")",opacity:1,"fill-opacity":1}),g.fill=c,g.opacity=1,g.fillOpacity=1,1},v=function(e){var t=e.getBBox(1);y(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},b=function(n,s,r){if("path"==n.type){for(var a,o,l,u,h,p=t(s).toLowerCase().split("-"),d=n.paper,g=r?"end":"start",v=n.node,b=n.attrs,L=b["stroke-width"],O=p.length,w="classic",_=3,x=3,S=5;O--;)switch(p[O]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=p[O];break;case"wide":x=5;break;case"narrow":x=2;break;case"long":_=5;break;case"short":_=2}if("open"==w?(_+=2,x+=2,S+=2,l=1,u=r?4:1,h={fill:"none",stroke:b.stroke}):(u=l=_/2,h={fill:b.stroke,stroke:"none"}),n._.arrows?r?(n._.arrows.endPath&&f[n._.arrows.endPath]--,n._.arrows.endMarker&&f[n._.arrows.endMarker]--):(n._.arrows.startPath&&f[n._.arrows.startPath]--,n._.arrows.startMarker&&f[n._.arrows.startMarker]--):n._.arrows={},"none"!=w){var C="raphael-marker-"+w,k="raphael-marker-"+g+w+_+x;i._g.doc.getElementById(C)?f[C]++:(d.defs.appendChild(y(y("path"),{"stroke-linecap":"round",d:m[w],id:C})),f[C]=1);var M,P=i._g.doc.getElementById(k);P?(f[k]++,M=P.getElementsByTagName("use")[0]):(P=y(y("marker"),{id:k,markerHeight:x,markerWidth:_,orient:"auto",refX:u,refY:x/2}),M=y(y("use"),{"xlink:href":"#"+C,transform:(r?"rotate(180 "+_/2+" "+x/2+") ":c)+"scale("+_/S+","+x/S+")","stroke-width":(1/((_/S+x/S)/2)).toFixed(4)}),P.appendChild(M),d.defs.appendChild(P),f[k]=1),y(M,h);var E=l*("diamond"!=w&&"oval"!=w);r?(a=n._.arrows.startdx*L||0,o=i.getTotalLength(b.path)-E*L):(a=E*L,o=i.getTotalLength(b.path)-(n._.arrows.enddx*L||0)),h={},h["marker-"+g]="url(#"+k+")",(o||a)&&(h.d=i.getSubpath(b.path,a,o)),y(v,h),n._.arrows[g+"Path"]=C,n._.arrows[g+"Marker"]=k,n._.arrows[g+"dx"]=E,n._.arrows[g+"Type"]=w,n._.arrows[g+"String"]=s}else r?(a=n._.arrows.startdx*L||0,o=i.getTotalLength(b.path)-a):(a=0,o=i.getTotalLength(b.path)-(n._.arrows.enddx*L||0)),n._.arrows[g+"Path"]&&y(v,{d:i.getSubpath(b.path,a,o)}),delete n._.arrows[g+"Path"],delete n._.arrows[g+"Marker"],delete n._.arrows[g+"dx"],delete n._.arrows[g+"Type"],delete n._.arrows[g+"String"];for(h in f)if(f[e](h)&&!f[h]){var N=i._g.doc.getElementById(h);N&&N.parentNode.removeChild(N)}}},L={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},O=function(e,i,n){if(i=L[t(i).toLowerCase()]){for(var s=e.attrs["stroke-width"]||"1",r={round:s,square:s,butt:0}[e.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,a=[],o=i.length;o--;)a[o]=i[o]*s+(o%2?1:-1)*r;y(e.node,{"stroke-dasharray":a.join(",")})}},w=function(n,r){var l=n.node,h=n.attrs,p=l.style.visibility;l.style.visibility="hidden";for(var m in r)if(r[e](m)){if(!i._availableAttrs[e](m))continue;var f=r[m];switch(h[m]=f,m){case"blur":n.blur(f);break;case"href":case"title":var L=y("title"),w=i._g.doc.createTextNode(f);L.appendChild(w),l.appendChild(L);break;case"target":var _=l.parentNode;if("a"!=_.tagName.toLowerCase()){var L=y("a");_.insertBefore(L,l),L.appendChild(l),_=L}"target"==m?_.setAttributeNS(d,"show","blank"==f?"new":f):_.setAttributeNS(d,m,f);break;case"cursor":l.style.cursor=f;break;case"transform":n.transform(f);break;case"arrow-start":b(n,f);break;case"arrow-end":b(n,f,1);break;case"clip-rect":var S=t(f).split(u);if(4==S.length){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var C=y("clipPath"),k=y("rect");C.id=i.createUUID(),y(k,{x:S[0],y:S[1],width:S[2],height:S[3]}),C.appendChild(k),n.paper.defs.appendChild(C),y(l,{"clip-path":"url(#"+C.id+")"}),n.clip=k}if(!f){var M=l.getAttribute("clip-path");if(M){var P=i._g.doc.getElementById(M.replace(/(^url\(#|\)$)/g,c));P&&P.parentNode.removeChild(P),y(l,{"clip-path":c}),delete n.clip}}break;case"path":"path"==n.type&&(y(l,{d:f?h.path=i._pathToAbsolute(f):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&b(n,n._.arrows.startString),"endString"in n._.arrows&&b(n,n._.arrows.endString,1)));break;case"width":if(l.setAttribute(m,f),n._.dirty=1,!h.fx)break;m="x",f=h.x;case"x":h.fx&&(f=-h.x-(h.width||0));case"rx":if("rx"==m&&"rect"==n.type)break;case"cx":l.setAttribute(m,f),n.pattern&&v(n),n._.dirty=1;break;case"height":if(l.setAttribute(m,f),n._.dirty=1,!h.fy)break;m="y",f=h.y;case"y":h.fy&&(f=-h.y-(h.height||0));case"ry":if("ry"==m&&"rect"==n.type)break;case"cy":l.setAttribute(m,f),n.pattern&&v(n),n._.dirty=1;break;case"r":"rect"==n.type?y(l,{rx:f,ry:f}):l.setAttribute(m,f),n._.dirty=1;break;case"src":"image"==n.type&&l.setAttributeNS(d,"href",f);break;case"stroke-width":(1!=n._.sx||1!=n._.sy)&&(f/=a(o(n._.sx),o(n._.sy))||1),n.paper._vbSize&&(f*=n.paper._vbSize),l.setAttribute(m,f),h["stroke-dasharray"]&&O(n,h["stroke-dasharray"],r),n._.arrows&&("startString"in n._.arrows&&b(n,n._.arrows.startString),"endString"in n._.arrows&&b(n,n._.arrows.endString,1));break;case"stroke-dasharray":O(n,f,r);break;case"fill":var E=t(f).match(i._ISURL);if(E){C=y("pattern");var N=y("image");C.id=i.createUUID(),y(C,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),y(N,{x:0,y:0,"xlink:href":E[1]}),C.appendChild(N),function(e){i._preload(E[1],function(){var t=this.offsetWidth,i=this.offsetHeight;y(e,{width:t,height:i}),y(N,{width:t,height:i}),n.paper.safari()})}(C),n.paper.defs.appendChild(C),y(l,{fill:"url(#"+C.id+")"}),n.pattern=C,n.pattern&&v(n);break}var T=i.getRGB(f);if(T.error){if(("circle"==n.type||"ellipse"==n.type||"r"!=t(f).charAt())&&g(n,f)){if("opacity"in h||"fill-opacity"in h){var z=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,c));if(z){var I=z.getElementsByTagName("stop");y(I[I.length-1],{"stop-opacity":("opacity"in h?h.opacity:1)*("fill-opacity"in h?h["fill-opacity"]:1)})}}h.gradient=f,h.fill="none";break}}else delete r.gradient,delete h.gradient,!i.is(h.opacity,"undefined")&&i.is(r.opacity,"undefined")&&y(l,{opacity:h.opacity}),!i.is(h["fill-opacity"],"undefined")&&i.is(r["fill-opacity"],"undefined")&&y(l,{"fill-opacity":h["fill-opacity"]});T[e]("opacity")&&y(l,{"fill-opacity":T.opacity>1?T.opacity/100:T.opacity});case"stroke":T=i.getRGB(f),l.setAttribute(m,T.hex),"stroke"==m&&T[e]("opacity")&&y(l,{"stroke-opacity":T.opacity>1?T.opacity/100:T.opacity}),"stroke"==m&&n._.arrows&&("startString"in n._.arrows&&b(n,n._.arrows.startString),"endString"in n._.arrows&&b(n,n._.arrows.endString,1));break;case"gradient":("circle"==n.type||"ellipse"==n.type||"r"!=t(f).charAt())&&g(n,f);break;case"opacity":h.gradient&&!h[e]("stroke-opacity")&&y(l,{"stroke-opacity":f>1?f/100:f});case"fill-opacity":if(h.gradient){z=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,c)),z&&(I=z.getElementsByTagName("stop"),y(I[I.length-1],{"stop-opacity":f}));break}default:"font-size"==m&&(f=s(f,10)+"px");var R=m.replace(/(\-.)/g,function(e){return e.substring(1).toUpperCase()});l.style[R]=f,n._.dirty=1,l.setAttribute(m,f)}}x(n,r),l.style.visibility=p},_=1.2,x=function(n,r){if("text"==n.type&&(r[e]("text")||r[e]("font")||r[e]("font-size")||r[e]("x")||r[e]("y"))){var a=n.attrs,o=n.node,l=o.firstChild?s(i._g.doc.defaultView.getComputedStyle(o.firstChild,c).getPropertyValue("font-size"),10):10;if(r[e]("text")){for(a.text=r.text;o.firstChild;)o.removeChild(o.firstChild);for(var u,h=t(r.text).split("\n"),p=[],d=0,m=h.length;m>d;d++)u=y("tspan"),d&&y(u,{dy:l*_,x:a.x}),u.appendChild(i._g.doc.createTextNode(h[d])),o.appendChild(u),p[d]=u}else for(p=o.getElementsByTagName("tspan"),d=0,m=p.length;m>d;d++)d?y(p[d],{dy:l*_,x:a.x}):y(p[0],{dy:0});y(o,{x:a.x,y:a.y}),n._.dirty=1;var f=n._getBBox(),g=a.y-(f.y+f.height/2);g&&i.is(g,"finite")&&y(p[0],{dy:g})}},S=function(e,t){this[0]=this.node=e,e.raphael=!0,this.id=i._oid++,e.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=t,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},C=i.el;S.prototype=C,C.constructor=S,i._engine.path=function(e,t){var i=y("path");t.canvas&&t.canvas.appendChild(i);var n=new S(i,t);return n.type="path",w(n,{fill:"none",stroke:"#000",path:e}),n},C.rotate=function(e,i,s){if(this.removed)return this;if(e=t(e).split(u),e.length-1&&(i=n(e[1]),s=n(e[2])),e=n(e[0]),null==s&&(i=s),null==i||null==s){var r=this.getBBox(1);i=r.x+r.width/2,s=r.y+r.height/2}return this.transform(this._.transform.concat([["r",e,i,s]])),this},C.scale=function(e,i,s,r){if(this.removed)return this;if(e=t(e).split(u),e.length-1&&(i=n(e[1]),s=n(e[2]),r=n(e[3])),e=n(e[0]),null==i&&(i=e),null==r&&(s=r),null==s||null==r)var a=this.getBBox(1);return s=null==s?a.x+a.width/2:s,r=null==r?a.y+a.height/2:r,this.transform(this._.transform.concat([["s",e,i,s,r]])),this},C.translate=function(e,i){return this.removed?this:(e=t(e).split(u),e.length-1&&(i=n(e[1])),e=n(e[0])||0,i=+i||0,this.transform(this._.transform.concat([["t",e,i]])),this)},C.transform=function(t){var n=this._;if(null==t)return n.transform;if(i._extractTransform(this,t),this.clip&&y(this.clip,{transform:this.matrix.invert()}),this.pattern&&v(this),this.node&&y(this.node,{transform:this.matrix}),1!=n.sx||1!=n.sy){var s=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":s})}return this},C.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},C.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},C.remove=function(){if(!this.removed&&this.node.parentNode){var e=this.paper;e.__set__&&e.__set__.exclude(this),h.unbind("raphael.*.*."+this.id),this.gradient&&e.defs.removeChild(this.gradient),i._tear(this,e),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;this.removed=!0}},C._getBBox=function(){if("none"==this.node.style.display){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(i){}finally{t=t||{}}return e&&this.hide(),t},C.attr=function(t,n){if(this.removed)return this;if(null==t){var s={};for(var r in this.attrs)this.attrs[e](r)&&(s[r]=this.attrs[r]);return s.gradient&&"none"==s.fill&&(s.fill=s.gradient)&&delete s.gradient,s.transform=this._.transform,s}if(null==n&&i.is(t,"string")){if("fill"==t&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==t)return this._.transform;for(var a=t.split(u),o={},l=0,c=a.length;c>l;l++)t=a[l],o[t]=t in this.attrs?this.attrs[t]:i.is(this.paper.customAttributes[t],"function")?this.paper.customAttributes[t].def:i._availableAttrs[t];return c-1?o:o[a[0]]}if(null==n&&i.is(t,"array")){for(o={},l=0,c=t.length;c>l;l++)o[t[l]]=this.attr(t[l]);return o}if(null!=n){var p={};p[t]=n}else null!=t&&i.is(t,"object")&&(p=t);for(var d in p)h("raphael.attr."+d+"."+this.id,this,p[d]);for(d in this.paper.customAttributes)if(this.paper.customAttributes[e](d)&&p[e](d)&&i.is(this.paper.customAttributes[d],"function")){var m=this.paper.customAttributes[d].apply(this,[].concat(p[d]));this.attrs[d]=p[d];for(var f in m)m[e](f)&&(p[f]=m[f])}return w(this,p),this},C.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var e=this.paper;return e.top!=this&&i._tofront(this,e),this},C.toBack=function(){if(this.removed)return this;var e=this.node.parentNode;return"a"==e.tagName.toLowerCase()?e.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):e.firstChild!=this.node&&e.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper),this.paper,this},C.insertAfter=function(e){if(this.removed)return this;var t=e.node||e[e.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode.appendChild(this.node),i._insertafter(this,e,this.paper),this},C.insertBefore=function(e){if(this.removed)return this;var t=e.node||e[0].node;return t.parentNode.insertBefore(this.node,t),i._insertbefore(this,e,this.paper),this},C.blur=function(e){var t=this;if(0!==+e){var n=y("filter"),s=y("feGaussianBlur");t.attrs.blur=e,n.id=i.createUUID(),y(s,{stdDeviation:+e||1.5}),n.appendChild(s),t.paper.defs.appendChild(n),t._blur=n,y(t.node,{filter:"url(#"+n.id+")"})}else t._blur&&(t._blur.parentNode.removeChild(t._blur),delete t._blur,delete t.attrs.blur),t.node.removeAttribute("filter");return t},i._engine.circle=function(e,t,i,n){var s=y("circle");e.canvas&&e.canvas.appendChild(s);var r=new S(s,e);return r.attrs={cx:t,cy:i,r:n,fill:"none",stroke:"#000"},r.type="circle",y(s,r.attrs),r},i._engine.rect=function(e,t,i,n,s,r){var a=y("rect");e.canvas&&e.canvas.appendChild(a);var o=new S(a,e);return o.attrs={x:t,y:i,width:n,height:s,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"},o.type="rect",y(a,o.attrs),o},i._engine.ellipse=function(e,t,i,n,s){var r=y("ellipse");e.canvas&&e.canvas.appendChild(r);var a=new S(r,e);return a.attrs={cx:t,cy:i,rx:n,ry:s,fill:"none",stroke:"#000"},a.type="ellipse",y(r,a.attrs),a},i._engine.image=function(e,t,i,n,s,r){var a=y("image");y(a,{x:i,y:n,width:s,height:r,preserveAspectRatio:"none"}),a.setAttributeNS(d,"href",t),e.canvas&&e.canvas.appendChild(a);var o=new S(a,e);return o.attrs={x:i,y:n,width:s,height:r,src:t},o.type="image",o},i._engine.text=function(e,t,n,s){var r=y("text");e.canvas&&e.canvas.appendChild(r);var a=new S(r,e);return a.attrs={x:t,y:n,"text-anchor":"middle",text:s,font:i._availableAttrs.font,stroke:"none",fill:"#000"},a.type="text",w(a,a.attrs),a},i._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var e=i._getContainer.apply(0,arguments),t=e&&e.container,n=e.x,s=e.y,r=e.width,a=e.height;if(!t)throw new Error("SVG container not found.");var o,l=y("svg"),u="overflow:hidden;";return n=n||0,s=s||0,r=r||512,a=a||342,y(l,{height:a,version:1.1,width:r,xmlns:"http://www.w3.org/2000/svg"}),1==t?(l.style.cssText=u+"position:absolute;left:"+n+"px;top:"+s+"px",i._g.doc.body.appendChild(l),o=1):(l.style.cssText=u+"position:relative",t.firstChild?t.insertBefore(l,t.firstChild):t.appendChild(l)),t=new i._Paper,t.width=r,t.height=a,t.canvas=l,t.clear(),t._left=t._top=0,o&&(t.renderfix=function(){}),t.renderfix(),t},i._engine.setViewBox=function(e,t,i,n,s){h("raphael.setViewBox",this,this._viewBox,[e,t,i,n,s]);var r,o,l=a(i/this.width,n/this.height),u=this.top,c=s?"meet":"xMinYMin";for(null==e?(this._vbSize&&(l=1),delete this._vbSize,r="0 0 "+this.width+p+this.height):(this._vbSize=l,r=e+p+t+p+i+p+n),y(this.canvas,{viewBox:r,preserveAspectRatio:c});l&&u;)o="stroke-width"in u.attrs?u.attrs["stroke-width"]:1,u.attr({"stroke-width":o}),u._.dirty=1,u._.dirtyT=1,u=u.prev;return this._viewBox=[e,t,i,n,!!s],this},i.prototype.renderfix=function(){var e,t=this.canvas,i=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(n){e=t.createSVGMatrix()}var s=-e.e%1,r=-e.f%1;(s||r)&&(s&&(this._left=(this._left+s)%1,i.left=this._left+"px"),r&&(this._top=(this._top+r)%1,i.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var e=this.canvas;e.firstChild;)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=y("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version)),e.appendChild(this.desc),e.appendChild(this.defs=y("defs"))},i.prototype.remove=function(){h("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null};var k=i.st;for(var M in C)C[e](M)&&!k[e](M)&&(k[M]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e].apply(i,t)})}}(M))}}(),function(){if(i.vml){var e="hasOwnProperty",t=String,n=parseFloat,s=Math,r=s.round,a=s.max,o=s.min,l=s.abs,u="fill",h=/[, ]+/,c=i.eve,p=" progid:DXImageTransform.Microsoft",d=" ",m="",f={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},y=/([clmz]),?([^clmz]*)/gi,g=/ progid:\S+Blur\([^\)]+\)/g,v=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",L=21600,O={path:1,rect:1,image:1},w={circle:1,ellipse:1},_=function(e){var n=/[ahqstv]/gi,s=i._pathToAbsolute;if(t(e).match(n)&&(s=i._path2curve),n=/[clmz]/g,s==i._pathToAbsolute&&!t(e).match(n)){var a=t(e).replace(y,function(e,t,i){var n=[],s="m"==t.toLowerCase(),a=f[t];return i.replace(v,function(e){s&&2==n.length&&(a+=n+f["m"==t?"l":"L"],n=[]),n.push(r(e*L))}),a+n});return a}var o,l,u=s(e);a=[];for(var h=0,c=u.length;c>h;h++){o=u[h],l=u[h][0].toLowerCase(),"z"==l&&(l="x");for(var p=1,g=o.length;g>p;p++)l+=r(o[p]*L)+(p!=g-1?",":m);a.push(l)}return a.join(d)},x=function(e,t,n){var s=i.matrix();return s.rotate(-e,.5,.5),{dx:s.x(t,n),dy:s.y(t,n)}},S=function(e,t,i,n,s,r){var a=e._,o=e.matrix,h=a.fillpos,c=e.node,p=c.style,m=1,f="",y=L/t,g=L/i;if(p.visibility="hidden",t&&i){if(c.coordsize=l(y)+d+l(g),p.rotation=r*(0>t*i?-1:1),r){var v=x(r,n,s);n=v.dx,s=v.dy}if(0>t&&(f+="x"),0>i&&(f+=" y")&&(m=-1),p.flip=f,c.coordorigin=n*-y+d+s*-g,h||a.fillsize){var b=c.getElementsByTagName(u);b=b&&b[0],c.removeChild(b),h&&(v=x(r,o.x(h[0],h[1]),o.y(h[0],h[1])),b.position=v.dx*m+d+v.dy*m),a.fillsize&&(b.size=a.fillsize[0]*l(t)+d+a.fillsize[1]*l(i)),c.appendChild(b)}p.visibility="visible"}};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var C=function(e,i,n){for(var s=t(i).toLowerCase().split("-"),r=n?"end":"start",a=s.length,o="classic",l="medium",u="medium";a--;)switch(s[a]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":o=s[a];break;case"wide":case"narrow":u=s[a];break;case"long":case"short":l=s[a]}var h=e.node.getElementsByTagName("stroke")[0];h[r+"arrow"]=o,h[r+"arrowlength"]=l,h[r+"arrowwidth"]=u},k=function(s,l){s.attrs=s.attrs||{};var c=s.node,p=s.attrs,f=c.style,y=O[s.type]&&(l.x!=p.x||l.y!=p.y||l.width!=p.width||l.height!=p.height||l.cx!=p.cx||l.cy!=p.cy||l.rx!=p.rx||l.ry!=p.ry||l.r!=p.r),g=w[s.type]&&(p.cx!=l.cx||p.cy!=l.cy||p.r!=l.r||p.rx!=l.rx||p.ry!=l.ry),v=s;for(var b in l)l[e](b)&&(p[b]=l[b]);if(y&&(p.path=i._getPath[s.type](s),s._.dirty=1),l.href&&(c.href=l.href),l.title&&(c.title=l.title),l.target&&(c.target=l.target),l.cursor&&(f.cursor=l.cursor),"blur"in l&&s.blur(l.blur),(l.path&&"path"==s.type||y)&&(c.path=_(~t(p.path).toLowerCase().indexOf("r")?i._pathToAbsolute(p.path):p.path),"image"==s.type&&(s._.fillpos=[p.x,p.y],s._.fillsize=[p.width,p.height],S(s,1,1,0,0,0))),"transform"in l&&s.transform(l.transform),g){var x=+p.cx,k=+p.cy,P=+p.rx||+p.r||0,E=+p.ry||+p.r||0;c.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",r((x-P)*L),r((k-E)*L),r((x+P)*L),r((k+E)*L),r(x*L)),s._.dirty=1}if("clip-rect"in l){var T=t(l["clip-rect"]).split(h);if(4==T.length){T[2]=+T[2]+ +T[0],T[3]=+T[3]+ +T[1];var z=c.clipRect||i._g.doc.createElement("div"),I=z.style;I.clip=i.format("rect({1}px {2}px {3}px {0}px)",T),c.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=s.paper.width+"px",I.height=s.paper.height+"px",c.parentNode.insertBefore(z,c),z.appendChild(c),c.clipRect=z)}l["clip-rect"]||c.clipRect&&(c.clipRect.style.clip="auto")}if(s.textpath){var R=s.textpath.style;l.font&&(R.font=l.font),l["font-family"]&&(R.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,m)+'"'),l["font-size"]&&(R.fontSize=l["font-size"]),l["font-weight"]&&(R.fontWeight=l["font-weight"]),l["font-style"]&&(R.fontStyle=l["font-style"])}if("arrow-start"in l&&C(v,l["arrow-start"]),"arrow-end"in l&&C(v,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var j=c.getElementsByTagName(u),F=!1;if(j=j&&j[0],!j&&(F=j=N(u)),"image"==s.type&&l.src&&(j.src=l.src),l.fill&&(j.on=!0),(null==j.on||"none"==l.fill||null===l.fill)&&(j.on=!1),j.on&&l.fill){var A=t(l.fill).match(i._ISURL);if(A){j.parentNode==c&&c.removeChild(j),j.rotate=!0,j.src=A[1],j.type="tile";var B=s.getBBox(1);j.position=B.x+d+B.y,s._.fillpos=[B.x,B.y],i._preload(A[1],function(){s._.fillsize=[this.offsetWidth,this.offsetHeight]})}else j.color=i.getRGB(l.fill).hex,j.src=m,j.type="solid",i.getRGB(l.fill).error&&(v.type in{circle:1,ellipse:1}||"r"!=t(l.fill).charAt())&&M(v,l.fill,j)&&(p.fill="none",p.gradient=l.fill,j.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var D=((+p["fill-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+i.getRGB(l.fill).o+1||2)-1);D=o(a(D,0),1),j.opacity=D,j.src&&(j.color="none")}c.appendChild(j);var q=c.getElementsByTagName("stroke")&&c.getElementsByTagName("stroke")[0],H=!1;
!q&&(H=q=N("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(q.on=!0),("none"==l.stroke||null===l.stroke||null==q.on||0==l.stroke||0==l["stroke-width"])&&(q.on=!1);var U=i.getRGB(l.stroke);q.on&&l.stroke&&(q.color=U.hex),D=((+p["stroke-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+U.o+1||2)-1);var G=.75*(n(l["stroke-width"])||1);if(D=o(a(D,0),1),null==l["stroke-width"]&&(G=p["stroke-width"]),l["stroke-width"]&&(q.weight=G),G&&1>G&&(D*=G)&&(q.weight=1),q.opacity=D,l["stroke-linejoin"]&&(q.joinstyle=l["stroke-linejoin"]||"miter"),q.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(q.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var V={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};q.dashstyle=V[e](l["stroke-dasharray"])?V[l["stroke-dasharray"]]:m}H&&c.appendChild(q)}if("text"==v.type){v.paper.canvas.style.display=m;var W=v.paper.span,Q=100,X=p.font&&p.font.match(/\d+(?:\.\d*)?(?=px)/);f=W.style,p.font&&(f.font=p.font),p["font-family"]&&(f.fontFamily=p["font-family"]),p["font-weight"]&&(f.fontWeight=p["font-weight"]),p["font-style"]&&(f.fontStyle=p["font-style"]),X=n(p["font-size"]||X&&X[0])||10,f.fontSize=X*Q+"px",v.textpath.string&&(W.innerHTML=t(v.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var Z=W.getBoundingClientRect();v.W=p.w=(Z.right-Z.left)/Q,v.H=p.h=(Z.bottom-Z.top)/Q,v.X=p.x,v.Y=p.y+v.H/2,("x"in l||"y"in l)&&(v.path.v=i.format("m{0},{1}l{2},{1}",r(p.x*L),r(p.y*L),r(p.x*L)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],K=0,$=Y.length;$>K;K++)if(Y[K]in l){v._.dirty=1;break}switch(p["text-anchor"]){case"start":v.textpath.style["v-text-align"]="left",v.bbx=v.W/2;break;case"end":v.textpath.style["v-text-align"]="right",v.bbx=-v.W/2;break;default:v.textpath.style["v-text-align"]="center",v.bbx=0}v.textpath.style["v-text-kern"]=!0}},M=function(e,r,a){e.attrs=e.attrs||{};var o=(e.attrs,Math.pow),l="linear",u=".5 .5";if(e.attrs.gradient=r,r=t(r).replace(i._radial_gradient,function(e,t,i){return l="radial",t&&i&&(t=n(t),i=n(i),o(t-.5,2)+o(i-.5,2)>.25&&(i=s.sqrt(.25-o(t-.5,2))*(2*(i>.5)-1)+.5),u=t+d+i),m}),r=r.split(/\s*\-\s*/),"linear"==l){var h=r.shift();if(h=-n(h),isNaN(h))return null}var c=i._parseDots(r);if(!c)return null;if(e=e.shape||e.node,c.length){e.removeChild(a),a.on=!0,a.method="none",a.color=c[0].color,a.color2=c[c.length-1].color;for(var p=[],f=0,y=c.length;y>f;f++)c[f].offset&&p.push(c[f].offset+d+c[f].color);a.colors=p.length?p.join():"0% "+a.color,"radial"==l?(a.type="gradientTitle",a.focus="100%",a.focussize="0 0",a.focusposition=u,a.angle=0):(a.type="gradient",a.angle=(270-h)%360),e.appendChild(a)}return 1},P=function(e,t){this[0]=this.node=e,e.raphael=!0,this.id=i._oid++,e.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=t,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},E=i.el;P.prototype=E,E.constructor=P,E.transform=function(e){if(null==e)return this._.transform;var n,s=this.paper._viewBoxShift,r=s?"s"+[s.scale,s.scale]+"-1-1t"+[s.dx,s.dy]:m;s&&(n=e=t(e).replace(/\.{3}|\u2026/g,this._.transform||m)),i._extractTransform(this,r+e);var a,o=this.matrix.clone(),l=this.skew,u=this.node,h=~t(this.attrs.fill).indexOf("-"),c=!t(this.attrs.fill).indexOf("url(");if(o.translate(1,1),c||h||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",a=o.split(),h&&a.noRotation||!a.isSimple){u.style.filter=o.toFilter();var p=this.getBBox(),f=this.getBBox(1),y=p.x-f.x,g=p.y-f.y;u.coordorigin=y*-L+d+g*-L,S(this,1,1,y,g,0)}else u.style.filter=m,S(this,a.scalex,a.scaley,a.dx,a.dy,a.rotate);else u.style.filter=m,l.matrix=t(o),l.offset=o.offset();return n&&(this._.transform=n),this},E.rotate=function(e,i,s){if(this.removed)return this;if(null!=e){if(e=t(e).split(h),e.length-1&&(i=n(e[1]),s=n(e[2])),e=n(e[0]),null==s&&(i=s),null==i||null==s){var r=this.getBBox(1);i=r.x+r.width/2,s=r.y+r.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,i,s]])),this}},E.translate=function(e,i){return this.removed?this:(e=t(e).split(h),e.length-1&&(i=n(e[1])),e=n(e[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",e,i]])),this)},E.scale=function(e,i,s,r){if(this.removed)return this;if(e=t(e).split(h),e.length-1&&(i=n(e[1]),s=n(e[2]),r=n(e[3]),isNaN(s)&&(s=null),isNaN(r)&&(r=null)),e=n(e[0]),null==i&&(i=e),null==r&&(s=r),null==s||null==r)var a=this.getBBox(1);return s=null==s?a.x+a.width/2:s,r=null==r?a.y+a.height/2:r,this.transform(this._.transform.concat([["s",e,i,s,r]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=m),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;this.removed=!0}},E.attr=function(t,n){if(this.removed)return this;if(null==t){var s={};for(var r in this.attrs)this.attrs[e](r)&&(s[r]=this.attrs[r]);return s.gradient&&"none"==s.fill&&(s.fill=s.gradient)&&delete s.gradient,s.transform=this._.transform,s}if(null==n&&i.is(t,"string")){if(t==u&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var a=t.split(h),o={},l=0,p=a.length;p>l;l++)t=a[l],o[t]=t in this.attrs?this.attrs[t]:i.is(this.paper.customAttributes[t],"function")?this.paper.customAttributes[t].def:i._availableAttrs[t];return p-1?o:o[a[0]]}if(this.attrs&&null==n&&i.is(t,"array")){for(o={},l=0,p=t.length;p>l;l++)o[t[l]]=this.attr(t[l]);return o}var d;null!=n&&(d={},d[t]=n),null==n&&i.is(t,"object")&&(d=t);for(var m in d)c("raphael.attr."+m+"."+this.id,this,d[m]);if(d){for(m in this.paper.customAttributes)if(this.paper.customAttributes[e](m)&&d[e](m)&&i.is(this.paper.customAttributes[m],"function")){var f=this.paper.customAttributes[m].apply(this,[].concat(d[m]));this.attrs[m]=d[m];for(var y in f)f[e](y)&&(d[y]=f[y])}d.text&&"text"==this.type&&(this.textpath.string=d.text),k(this,d)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},E.insertAfter=function(e){return this.removed?this:(e.constructor==i.st.constructor&&(e=e[e.length-1]),e.node.nextSibling?e.node.parentNode.insertBefore(this.node,e.node.nextSibling):e.node.parentNode.appendChild(this.node),i._insertafter(this,e,this.paper),this)},E.insertBefore=function(e){return this.removed?this:(e.constructor==i.st.constructor&&(e=e[0]),e.node.parentNode.insertBefore(this.node,e.node),i._insertbefore(this,e,this.paper),this)},E.blur=function(e){var t=this.node.runtimeStyle,n=t.filter;return n=n.replace(g,m),0!==+e?(this.attrs.blur=e,t.filter=n+d+p+".Blur(pixelradius="+(+e||1.5)+")",t.margin=i.format("-{0}px 0 0 -{0}px",r(+e||1.5))):(t.filter=n,t.margin=0,delete this.attrs.blur),this},i._engine.path=function(e,t){var i=N("shape");i.style.cssText=b,i.coordsize=L+d+L,i.coordorigin=t.coordorigin;var n=new P(i,t),s={fill:"none",stroke:"#000"};e&&(s.path=e),n.type="path",n.path=[],n.Path=m,k(n,s),t.canvas.appendChild(i);var r=N("skew");return r.on=!0,i.appendChild(r),n.skew=r,n.transform(m),n},i._engine.rect=function(e,t,n,s,r,a){var o=i._rectPath(t,n,s,r,a),l=e.path(o),u=l.attrs;return l.X=u.x=t,l.Y=u.y=n,l.W=u.width=s,l.H=u.height=r,u.r=a,u.path=o,l.type="rect",l},i._engine.ellipse=function(e,t,i,n,s){var r=e.path();return r.attrs,r.X=t-n,r.Y=i-s,r.W=2*n,r.H=2*s,r.type="ellipse",k(r,{cx:t,cy:i,rx:n,ry:s}),r},i._engine.circle=function(e,t,i,n){var s=e.path();return s.attrs,s.X=t-n,s.Y=i-n,s.W=s.H=2*n,s.type="circle",k(s,{cx:t,cy:i,r:n}),s},i._engine.image=function(e,t,n,s,r,a){var o=i._rectPath(n,s,r,a),l=e.path(o).attr({stroke:"none"}),h=l.attrs,c=l.node,p=c.getElementsByTagName(u)[0];return h.src=t,l.X=h.x=n,l.Y=h.y=s,l.W=h.width=r,l.H=h.height=a,h.path=o,l.type="image",p.parentNode==c&&c.removeChild(p),p.rotate=!0,p.src=t,p.type="tile",l._.fillpos=[n,s],l._.fillsize=[r,a],c.appendChild(p),S(l,1,1,0,0,0),l},i._engine.text=function(e,n,s,a){var o=N("shape"),l=N("path"),u=N("textpath");n=n||0,s=s||0,a=a||"",l.v=i.format("m{0},{1}l{2},{1}",r(n*L),r(s*L),r(n*L)+1),l.textpathok=!0,u.string=t(a),u.on=!0,o.style.cssText=b,o.coordsize=L+d+L,o.coordorigin="0 0";var h=new P(o,e),c={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:a};h.shape=o,h.path=l,h.textpath=u,h.type="text",h.attrs.text=t(a),h.attrs.x=n,h.attrs.y=s,h.attrs.w=1,h.attrs.h=1,k(h,c),o.appendChild(u),o.appendChild(l),e.canvas.appendChild(o);var p=N("skew");return p.on=!0,o.appendChild(p),h.skew=p,h.transform(m),h},i._engine.setSize=function(e,t){var n=this.canvas.style;return this.width=e,this.height=t,e==+e&&(e+="px"),t==+t&&(t+="px"),n.width=e,n.height=t,n.clip="rect(0 "+e+" "+t+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(e,t,n,s,r){i.eve("raphael.setViewBox",this,this._viewBox,[e,t,n,s,r]);var o,l,u=this.width,h=this.height,c=1/a(n/u,s/h);return r&&(o=h/s,l=u/n,u>n*o&&(e-=(u-n*o)/2/o),h>s*l&&(t-=(h-s*l)/2/l)),this._viewBox=[e,t,n,s,!!r],this._viewBoxShift={dx:-e,dy:-t,scale:c},this.forEach(function(e){e.transform("...")}),this};var N;i._engine.initWin=function(e){var t=e.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),N=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(i){N=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var e=i._getContainer.apply(0,arguments),t=e.container,n=e.height,s=e.width,r=e.x,a=e.y;if(!t)throw new Error("VML container not found.");var o=new i._Paper,l=o.canvas=i._g.doc.createElement("div"),u=l.style;return r=r||0,a=a||0,s=s||512,n=n||342,o.width=s,o.height=n,s==+s&&(s+="px"),n==+n&&(n+="px"),o.coordsize=1e3*L+d+1e3*L,o.coordorigin="0 0",o.span=i._g.doc.createElement("span"),o.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(o.span),u.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",s,n),1==t?(i._g.doc.body.appendChild(l),u.left=r+"px",u.top=a+"px",u.position="absolute"):t.firstChild?t.insertBefore(l,t.firstChild):t.appendChild(l),o.renderfix=function(){},o},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=m,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;return!0};var T=i.st;for(var z in E)E[e](z)&&!T[e](z)&&(T[z]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e].apply(i,t)})}}(z))}}(),k.was?C.win.Raphael=i:Raphael=i,i}),function(e,t,i){function n(e){var t={},n=/^jQuery\d+$/;return i.each(e.attributes,function(e,i){i.specified&&!n.test(i.name)&&(t[i.name]=i.value)}),t}function s(e,t){var n=this,s=i(n);if(n.value==s.attr("placeholder")&&s.hasClass("placeholder"))if(s.data("placeholder-password")){if(s=s.hide().next().show().attr("id",s.removeAttr("id").data("placeholder-id")),e===!0)return s[0].value=t;s.focus()}else n.value="",s.removeClass("placeholder"),n==a()&&n.select()}function r(){var e,t=this,r=i(t),a=this.id;if(""==t.value){if("password"==t.type){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(o){e=i("<input>").attr(i.extend(n(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":r,"placeholder-id":a}).bind("focus.placeholder",s),r.data({"placeholder-textinput":e,"placeholder-id":a}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",a).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}function a(){try{return t.activeElement}catch(e){}}var o,l,u="placeholder"in t.createElement("input"),h="placeholder"in t.createElement("textarea"),c=i.fn,p=i.valHooks,d=i.propHooks;u&&h?(l=c.placeholder=function(){return this},l.input=l.textarea=!0):(l=c.placeholder=function(){var e=this;return e.filter((u?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":s,"blur.placeholder":r}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},l.input=u,l.textarea=h,o={get:function(e){var t=i(e),n=t.data("placeholder-password");return n?n[0].value:t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,t){var n=i(e),o=n.data("placeholder-password");return o?o[0].value=t:n.data("placeholder-enabled")?(""==t?(e.value=t,e!=a()&&r.call(e)):n.hasClass("placeholder")?s.call(e,!0,t)||(e.value=t):e.value=t,n):e.value=t}},u||(p.input=o,d.value=o),h||(p.textarea=o,d.value=o),i(function(){i(t).delegate("form","submit.placeholder",function(){var e=i(".placeholder",this).each(s);setTimeout(function(){e.each(r)},10)})}),i(e).bind("beforeunload.placeholder",function(){i(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/button-methods.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/default-buttons.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/AddToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/RemoveToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/SelectToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ShowMapMeasurementRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/event/ToolSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolbarRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolbarRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/toolbar/css/toolbar.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"toolbar","Bundle-Name":"toolbar","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Toolbar",Title:"Toolbar"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("toolbar","Oskari.mapframework.bundle.toolbar.ToolbarBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null,this.started=!1,this.buttons={},this.selectedButton=null,this.defaultButton=null,this.container=null,this.menutoolbarcontainer=null,this.containers={},this.toolbars={},this.groupsToToolbars={}},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);n.register(e),e.setSandbox(n);var s=(t?t.defaultToolbarContainer:null)||"#toolbar";this.container=jQuery(s),this.containers["default"]=this.container,this.toolbars["default"]=this.container;var r,a=(t?t.defaultMenuToolbarContainer:null)||"#menutoolbar";this.menutoolbarcontainer=jQuery(a);for(r in e.eventHandlers)e.eventHandlers.hasOwnProperty(r)&&r&&n.registerForEventByName(e,r);n.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),n.addRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler),n.addRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),n.registerAsStateful(this.mediator.bundleId,this),this._addDefaultButtons&&this._addDefaultButtons()}},templates:{group:'<div class="toolrow"></div>',tool:'<div class="tool"></div>',menutoolbar:'<div class="oskari-closed oskariui-menutoolbar"><div class="oskariui-menutoolbar-modetitle"><div class="oskariui-menutoolbar-title"><p></p></div></div><div class="oskariui-menutoolbar-container"><div class="oskariui-menutoolbarbuttongroup"></div></div><div class="oskariui-menutoolbar-closebox"><div class="icon-close-white"></div></div></div>',addedToolbar:'<div class="oskariui-toolbar-title"><p></p></div><div class="oskariui-toolbar-container"><div class="oskariui-toolbarbuttongroup"></div></div>'},init:function(){var e=this;this.templateGroup=jQuery(this.templates.group),this.templateTool=jQuery(this.templates.tool),this.templateMenutoolbar=jQuery(this.templates.menutoolbar),this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",e),toolbarRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",e),showMapMeasurementRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",e)}},createMenuToolbarContainer:function(e,t){var i=t||{},n=this.templateMenutoolbar.clone();this.menutoolbarcontainer.append(n),this.toolbars[e]=n;var s=n.find(".oskariui-menutoolbarbuttongroup");return this.containers[e]=s,i.title&&n.find(".oskariui-menutoolbar-title p").append(i.title),i.show&&n.removeClass("oskari-closed"),i.closeBoxCallback&&n.find(".oskariui-menutoolbar-closebox div").click(i.closeBoxCallback),s},addToolbarContainer:function(e,t){var i=t.toolbarContainer;i.append(jQuery(this.templates.addedToolbar)),this.toolbars[e]=i;var n=i.find(".oskariui-toolbarbuttongroup");return this.containers[e]=n,t.title&&i.find(".oskariui-toolbar-title p").append(t.title),n},changeMenuToolbarTitle:function(e){e&&this.menutoolbarcontainer.find(".oskariui-menutoolbar-title p").html(e)},getToolbarContainer:function(e,t){var i=e||"default",n=this.containers[i];return void 0===n&&this.menutoolbarcontainer&&!t.toolbarContainer?n=this.createMenuToolbarContainer(i,t):(void 0===n||0===n.parents("body").length)&&t&&t.toolbarContainer&&(n=this.addToolbarContainer(i,t)),n},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},measureTools:{basictools:{measureline:!0,measurearea:!0}},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){var t=this,i=this.getSandbox();if(t.measureTools[e.getGroupId()]&&t.measureTools[e.getGroupId()][e.getToolId()]){var n=t.getLocalization("measure").guidance[e.getToolId()];i.request(t,i.getRequestBuilder("ShowMapMeasurementRequest")(n||"",!1,null,null))}}},stop:function(){var e,t=this,i=t.sandbox();for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&e&&i.unregisterFromEventByName(t,e);i.removeRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),i.removeRequestHandler("Toolbar.ToolbarRequest",this.requestHandlers.toolbarRequestHandler),i.removeRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),i.removeRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),this.sandbox.unregisterStateful(this.mediator.bundleId),t.sandbox.unregister(t),t.started=!1},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},setState:function(e){if(e)if(e.selected){this.selectedButton=e.selected;var t=e.selected.id,i=e.selected.group,n=i.split("-");n.length<2&&(i="default-"+i);var s=this.getToolbarContainer();this._removeToolSelections();var r=s.find("div.toolrow[tbgroup="+i+"]");if(r.length>0){var a=r.find("div.tool[tool="+t+"]");a.length>0&&(a.addClass("selected"),this.buttons[i][t].callback())}}else this.selectedButton=null},getState:function(){var e={};return this.selectedButton&&(e.selected=this.selectedButton),e},_removeToolbar:function(e){var t=this.toolbars[e];t&&t.remove(),this.toolbars[e]=void 0,delete this.toolbars[e]},_showToolbar:function(e){this.toolbars[e].show()},_hideToolbar:function(e){this.toolbars[e].hide()},_addToolbar:function(e,t){this.getToolbarContainer(e,t)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(e,t,i){if(e&&t&&i&&i.callback){var n=this,s=n.getToolbarContainer(i?i.toolbarid:null,i),r=null,a=(i?i.toolbarid?i.toolbarid:"default":"default")+"-"+t;if(n.buttons[a]?r=s.find("div.toolrow[tbgroup="+a+"]"):(n.buttons[a]={},r=n.templateGroup.clone(),r.attr("tbgroup",a),s.append(r),n.groupsToToolbars[a]=i?i.toolbarid:null),!n.buttons[a][e]){n.buttons[a][e]=i;var o=n.templateTool.clone();o.attr("tool",e),o.attr("title",i.tooltip),n.conf.classes&&n.conf.classes[t]&&n.conf.classes[t][e]?o.addClass(n.conf.classes[t][e].iconCls):o.addClass(i.iconCls),n.selectedButton?n.selectedButton.id===e&&n.selectedButton.group===a&&(o.addClass("selected"),i.callback()):i.selected&&(o.addClass("selected"),n.selectedButton={id:e,group:a}),i.selected&&(n.defaultButton={id:e,group:a}),o.bind("click",function(){n._clickButton(e,a)}),i.prepend?r.prepend(o):r.append(o),i.disabled===!0&&o.addClass("disabled")}}},_clickButton:function(e,t){if(!e){if(!this.defaultButton){var i=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(e,t);return this.sandbox.notifyAll(i),this.container.find(".tool.selected").removeClass("selected"),void 0}e=this.defaultButton.id,t=this.defaultButton.group}var n,s,r,a=this.buttons[t][e];if(0!=a.enabled){if(1==a.sticky){var i=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(e,t);this.sandbox.notifyAll(i),this._removeToolSelections(t),n=this.getToolbarContainer(this.groupsToToolbars[t]),s=n.find("div.toolrow[tbgroup="+t+"]"),r=s.find("div.tool[tool="+e+"]"),r.addClass("selected"),this.selectedButton={id:e,group:t}}a.toggleSelection&&(n=this.getToolbarContainer(this.groupsToToolbars[t]),s=n.find("div.toolrow[tbgroup="+t+"]"),r=s.find("div.tool[tool="+e+"]"),r.hasClass("selected")?r.removeClass("selected"):r.addClass("selected")),a.callback()}},_removeToolSelections:function(e){var t=this.getToolbarContainer(this.groupsToToolbars[e]),i=t.find("div.tool");i.removeClass("selected")},removeToolButton:function(e,t,i){if(t){var n=t;if(n=i?i+"-"+n:"default-"+n,this.buttons[n]){var s=this.getToolbarContainer(this.groupsToToolbars[n]),r=s.find("div.toolrow[tbgroup="+n+"]");if(e){var a=r.find("div.tool[tool="+e+"]");a.remove(),this.buttons[n][e]=null,delete this.buttons[n][e];var o,l=0;for(o in this.buttons[n])this.buttons[n].hasOwnProperty(o)&&l++;0===l&&(r.remove(),this.buttons[n]=null,delete this.buttons[n])}else r.remove(),this.buttons[n]=null,delete this.buttons[n]}}},changeToolButtonState:function(e,t,i){if(t&&this.buttons[t]){var n,s,r,a=this.getToolbarContainer(this.groupsToToolbars[t]),o=a.find("div.toolrow[tbgroup="+t+"]");if(e)n=o.find("div.tool[tool="+e+"]"),this.buttons[t][e].enabled=i,i?n.removeClass("disabled"):n.addClass("disabled");else{s=o.find("div.tool"),i?s.removeClass("disabled"):s.addClass("disabled");for(r in this.buttons[t])this.buttons[t].hasOwnProperty(r)&&(this.buttons[t][r].enabled=i)}}}}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_isButtonConfigured:function(e,t){return this.conf&&(this.conf[t]===!1||this.conf[t]&&this.conf[t][e]===!1)?!1:!0},_addDefaultButtons:function(){var e,t,i,n,s,r,a,o,l,u,h,c=this,p=this.getLocalization("buttons"),d=this.getSandbox().getRequestBuilder("ToolSelectionRequest"),m="MapModulePlugin.GetFeatureInfoActivationRequest",f=this.getSandbox().getRequestBuilder(m),y=c.conf?c.getSandbox().getLocalizedProperty(c.conf.mapUrlPrefix):null,g=[{name:"history",buttons:{reset:{iconCls:"tool-reset",tooltip:p.history.reset,sticky:!1,callback:function(){e=c.getSandbox().getRequestBuilder("StateHandler.SetStateRequest"),e&&c.getSandbox().request(c,e()),i=c.getSandbox().getRequestBuilder("ClearHistoryRequest")(),c.getSandbox().request(c,i)}},history_back:{iconCls:"tool-history-back",tooltip:p.history.back,sticky:!1,callback:function(){c.getSandbox().request(c,d("map_control_tool_prev"))}},history_forward:{iconCls:"tool-history-forward",tooltip:p.history.next,sticky:!1,callback:function(){c.getSandbox().request(c,d("map_control_tool_next"))}}}},{name:"basictools",buttons:{zoombox:{iconCls:"tool-zoombox",tooltip:p.zoom,sticky:!0,callback:function(){t="map_control_zoom_tool",c.getSandbox().request(c,f(!1)),c.getSandbox().request(c,d(t))}},select:{iconCls:"tool-pan",tooltip:p.pan,selected:!0,sticky:!0,callback:function(){t="map_control_navigate_tool",c.getSandbox().request(c,f(!0)),c.getSandbox().request(c,d(t))}},measureline:{iconCls:"tool-measure-line",tooltip:p.measure.line,sticky:!0,callback:function(){t="map_control_measure_tool",c.getSandbox().request(c,f(!1)),c.getSandbox().request(c,d(t))}},measurearea:{iconCls:"tool-measure-area",tooltip:p.measure.area,sticky:!0,callback:function(){t="map_control_measure_area_tool",c.getSandbox().request(c,f(!1)),c.getSandbox().request(c,d(t))}}}},{name:"viewtools",buttons:{link:{iconCls:"tool-link",tooltip:p.link.tooltip,sticky:!1,callback:function(){n=c.getSandbox().generateMapLinkParameters({showMarker:!0}),s="Oskari.userinterface.component.Popup",r="Oskari.userinterface.component.Button",a=Oskari.clazz.create(s),a.addClass("no_resize"),o=Oskari.clazz.create(r),o.setTitle(p.link.ok),o.addClass("primary"),o.setHandler(function(){t="EnableMapKeyboardMovementRequest",a.close(),c.getSandbox().postRequestByName(t)}),l='<textarea rows="3" cols="80">'+y+n+"</textarea>",t="DisableMapKeyboardMovementRequest",c.getSandbox().postRequestByName(t),a.show(p.link.title,l,[o])}},print:{iconCls:"tool-print",tooltip:p.print.tooltip,sticky:!1,callback:function(){u="location=1,status=1,scrollbars=1,width=850,height=1200",h=window.location.pathname+"?"+c.getSandbox().generateMapLinkParameters()+"&p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive"+"&showMarker=false&forceCache=true&mapmode=print&viewId=2",window.open(h,"Print",u)}}}}];for(group in g){var v=g[group];for(tool in v.buttons)("link"!==tool||y)&&this._isButtonConfigured(tool,v.name)&&this.addToolButton(tool,v.name,v.buttons[tool])}}}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(e,t,i){this._id=e,this._group=t,this._config=i},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(e,t,i){this._id=e,this._group=t,this._toolbarId=i},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getToolbarId:function(){return this._toolbarId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(e,t,i){this._id=e,this._group=t,this._state=1==i},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.SelectToolButtonRequest",function(e,t){this._id=e,this._group=t},{__name:"Toolbar.SelectToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){var i=e.getSandbox();"Toolbar.AddToolButtonRequest"==t.getName()?this._handleAdd(i,t):"Toolbar.RemoveToolButtonRequest"==t.getName()?this._handleRemove(i,t):"Toolbar.ToolButtonStateRequest"==t.getName()?this._handleState(i,t):"Toolbar.SelectToolButtonRequest"==t.getName()&&this._handleClick(i,t)},_handleAdd:function(e,t){this._toolbar.addToolButton(t.getId(),t.getGroup(),t.getConfig())},_handleRemove:function(e,t){this._toolbar.removeToolButton(t.getId(),t.getGroup(),t.getToolbarId())},_handleState:function(e,t){this._toolbar.changeToolButtonState(t.getId(),t.getGroup(),t.getState())},_handleClick:function(e,t){this._toolbar._clickButton(t.getId(),t.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",function(e){var t=this;t._toolbar=e;var i=this._toolbar.getLocalization("measure"),n=i.title;
t._title=n,t._dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),t._dialog.addClass("oskari-measurement");var s=[],r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(i.close),s.push(r),t._buttons=s,t._dialogShown=!1,t._content=null},{handleRequest:function(e,t){e.getSandbox(),this._showMeasurementResults(t.getValue())},getValue:function(){return this._value},_showMeasurementResults:function(e){var t=this,i=t._dialog;if(t._toolbar.conf.hasContentContainer)t._showResultsInPlugin(e);else{if(!t._dialogShown){i.show(t._title,"",t._buttons);var n=t._buttons[0];n.setHandler(function(){t._dialogShown=!1;var e=t._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();t._toolbar.getSandbox().request(t._toolbar,e),t._dialog.close(!0)}),i.moveTo("#toolbar div.toolrow[tbgroup=default-basictools]","top"),t._content=jQuery("<div></div>"),i.setContent(t._content),t._dialogShown=!0}t._content.html(e)}},_showResultsInPlugin:function(e){var t,i=this;if(!i.toolContentDivData){var n=i._buttons[0];n.setHandler(function(){var e=i._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();i._toolbar.getSandbox().request(i._toolbar,e),i._hideResultsInPlugin(!0)}),i.toolContentDivData={className:"measureline",title:i._title,content:jQuery("<div></div>"),buttons:i._buttons},t=i._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("set",i.toolContentDivData),i._toolbar.getSandbox().request(i._toolbar,t)}i.toolContentDivData.content.html(e)},_hideResultsInPlugin:function(){var e=this,t=e._toolbar.getSandbox().getRequestBuilder("Toolbar.ToolContainerRequest")("reset",e.toolContentDivData);e._toolbar.getSandbox().request(e._toolbar,t),e.toolContentDivData=null}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.event.ToolSelectedEvent",function(e,t){this._toolId=e,this._groupId=t},{__name:"Toolbar.ToolSelectedEvent",getName:function(){return this.__name},getToolId:function(){return this._toolId},getGroupId:function(){return this._groupId}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequest",function(e,t,i){this._id=e,this._op=t,this._data=i},{__name:"Toolbar.ToolbarRequest",getName:function(){return this.__name},getId:function(){return this._id},getOp:function(){return this._op},getData:function(){return this._data}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolbarRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){e.getSandbox(),"add"===t.getOp()?this._toolbar._addToolbar(t.getId(),t.getData()):"show"===t.getOp()?this._toolbar._showToolbar(t.getId()):"hide"===t.getOp()?this._toolbar._hideToolbar(t.getId()):"remove"===t.getOp()?this._toolbar._removeToolbar(t.getId()):"changeName"===t.getOp()&&this._toolbar.changeMenuToolbarTitle(t.getData())},_handleAdd:function(e,t){this._toolbar.addToolButton(t.getId(),t.getGroup(),t.getConfig())},_handleRemove:function(e,t){this._toolbar.removeToolButton(t.getId(),t.getGroup())},_handleState:function(e,t){this._toolbar.changeToolButtonState(t.getId(),t.getGroup(),t.getState())},_handleClick:function(e,t){this._toolbar._clickButton(t.getId(),t.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/instance.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery.cookie.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/state-methods.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/plugin/Plugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/plugin/SaveViewPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SetStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SetStateRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/event/StateSavedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SaveStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SaveStateRequestHandler.js"}]},bundle:{manifest:{"Bundle-Identifier":"statehandler","Bundle-Name":"statehandler","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"statehandler",Title:"statehandler"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("statehandler","Oskari.mapframework.bundle.statehandler.StateHandlerBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance",function(){this._localization=null,this._pluginInstances={},this._startupState=null,this._historyPollingInterval=1500,this._historyTimer=null,this._historyPrevious=[],this._historyNext=[],this._historyEnabled=!0,this._defaultViewId=1,this._currentViewId="undefined"!=typeof window.viewId?window.viewId:this._defaultViewId},{__name:"StateHandler",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",s=Oskari.getSandbox(n);e.sandbox=s,s.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&s.registerForEventByName(e,t);var r=s.getAjaxUrl(),a=Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",r);this.registerPlugin(a),this.startPlugin(a),s.addRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),s.addRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler)}},update:function(){},stop:function(){var e,t=this.sandbox();t.removeRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),t.removeRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler);var i=t.getRequestBuilder("MapControls.ToolButtonRequest");i&&t.request(this,i(this.toolbar.config,"remove"));for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);this.sandbox.unregister(this),this.started=!1},init:function(){var e=this.sandbox;return this.requestHandlers={setStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",e,this),saveStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",e,this)},null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapMoveEvent:function(){var e=this;e._pushState()},AfterMapLayerAddEvent:function(){var e=this;e._pushState()},AfterMapLayerRemoveEvent:function(){var e=this;e._pushState()},AfterChangeMapLayerStyleEvent:function(){var e=this;e._pushState()},MapLayerVisibilityChangedEvent:function(){var e=this;e._pushState()}},registerPlugin:function(e){e.setHandler(this);var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Registering "+t),this._pluginInstances[t]=e},unregisterPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Unregistering "+t),this._pluginInstances[t]=void 0,e.setHandler(null)},startPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Starting "+t),e.startPlugin(this.sandbox)},stopPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Starting "+t),e.stopPlugin(this.sandbox)},setCurrentViewId:function(e){this._currentViewId=e},getCurrentViewId:function(){return this._currentViewId},_stateComparators:[{rule:"nohistory",cmp:function(e){return e?void 0:!0}},{rule:"location",cmp:function(e,t){return e.east!=t.east||e.north!=t.north?!0:e.zoom!=t.zoom?!0:void 0}},{rule:"layers",cmp:function(e,t){var i,n,s,r=this,a=e.selectedLayers,o=t.selectedLayers;if(a.length!==o.length)return!0;for(i=0;i<o.length;i+=1){if(n=a[i],s=o[i],r.sandbox.printDebug("[StateHandler] comparing layer state "+n.id+" vs "+s.id),n.id!==s.id)return!0;if(n.opacity!==s.opacity)return!0;if(n.hidden!==s.hidden)return!0;if(n.style!==s.style)return!0}return!1}}],_compareState:function(e,t,i){var n,s,r={result:!1,rule:null,rulesMatched:{}},a=this;for(n=0;n<a._stateComparators.length;n+=1)if(s=a._stateComparators[n],a.sandbox.printDebug("[StateHandler] comparing state "+s.rule),s.cmp.apply(this,[e,t])&&(a.sandbox.printDebug("[StateHandler] comparing state MATCH "+s.rule),r.result=!0,r.rule=s.rule,r.rulesMatched[s.rule]=s.rule,i))return r;return r},_logState:function(){var e=this,t=e.conf.logUrl+"?"+e.sandbox.generateMapLinkParameters();jQuery.ajax({type:"GET",url:t})},_pushState:function(){var e=this;if(e._historyEnabled){var t=e._historyPrevious,i=this._getMapState(),n=0===t.length?null:t[t.length-1],s=e._compareState(n,i,!0);s.result&&(e.sandbox.printDebug("[StateHandler] PUSHING state"),i.rule=s.rule,e._historyPrevious.push(i),e._historyNext=[],e.conf&&e.conf.logUrl&&e._logState())}},historyMoveNext:function(){var e=this.getSandbox();if(this._historyNext.length>0){var t=this._historyNext.pop();this._historyPrevious.push(t);var i=e.findRegisteredModuleInstance("MainMapModule");this._historyEnabled=!1;var n=this._getMapState();this._setMapState(i,t,n),this._historyEnabled=!0}},historyMovePrevious:function(){var e=this.getSandbox();switch(this._historyPrevious.length){case 0:break;case 1:var t=this._historyNext;this.resetState(),this._historyNext=t;break;default:var i=this._historyPrevious.pop();this._historyNext.push(i);var n=this._historyPrevious[this._historyPrevious.length-1],s=e.findRegisteredModuleInstance("MainMapModule"),r=this._getMapState();this._historyEnabled=!1,this._setMapState(s,n,r),this._historyEnabled=!0}},_getMapState:function(){var e,t,i,n=this.getSandbox(),s=n.getMap(),r=n.findAllSelectedMapLayers(),a=(s.getZoom(),s.getX()),o=s.getY(),l={north:o,east:a,zoom:s.getZoom(),selectedLayers:[]};for(e=0;e<r.length;e+=1)t=r[e],i={id:t.getId(),opacity:t.getOpacity()},t.isVisible()||(i.hidden=!0),t.getCurrentStyle&&t.getCurrentStyle()&&t.getCurrentStyle().getName()&&"!default!"!==t.getCurrentStyle().getName()&&(i.style=t.getCurrentStyle().getName()),l.selectedLayers.push(i);return l},_setMapState:function(e,t,i){var n=this.getSandbox(),s=this._compareState(i,t,!1);if(t.selectedLayers&&s.rulesMatched.layers){n.printDebug("[StateHandler] restoring LAYER state"),this._teardownState(e);var r,a,o=n.getRequestBuilder("AddMapLayerRequest"),l=n.getRequestBuilder("ChangeMapLayerOpacityRequest"),u=n.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),h=n.getRequestBuilder("ChangeMapLayerStyleRequest"),c=t.selectedLayers.length;for(r=0;c>r;r+=1)a=t.selectedLayers[r],n.request(e.getName(),o(a.id,!0)),a.hidden?n.request(e.getName(),u(a.id,!1)):n.request(e.getName(),u(a.id,!0)),a.style&&n.request(e.getName(),h(a.id,a.style)),a.opacity&&n.request(e.getName(),l(a.id,a.opacity))}t.east&&(n.printDebug("[StateHandler] restoring LOCATION state"),this.getSandbox().getMap().moveTo(t.east,t.north,t.zoom)),n.syncMapState(!0)},_teardownState:function(e){var t,i=this.getSandbox(),n=i.findAllSelectedMapLayers(),s=i.getRequestBuilder("RemoveMapLayerRequest");for(t=0;t<n.length;t+=1)i.request(e.getName(),s(n[t].getId()))}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),function(e,t,i){function n(e){return e}function s(e){return decodeURIComponent(e.replace(r," "))}var r=/\+/g,a=e.cookie=function(r,o,l){if(o!==i){if(l=e.extend({},a.defaults,l),null===o&&(l.expires=-1),"number"==typeof l.expires){var u=l.expires,h=l.expires=new Date;h.setDate(h.getDate()+u)}return o=a.json?JSON.stringify(o):String(o),t.cookie=[encodeURIComponent(r),"=",a.raw?o:encodeURIComponent(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var c,p=a.raw?n:s,d=t.cookie.split("; "),m=0;c=d[m]&&d[m].split("=");m++)if(p(c.shift())===r){var f=p(c.join("="));return a.json?JSON.parse(f):f}return null};a.defaults={},e.removeCookie=function(t,i){return null!==e.cookie(t)?(e.cookie(t,null,i),!0):!1}}(jQuery,document),Oskari.clazz.category("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance","state-methods",{useState:function(e){if(!e)return[];var t,i=this.sandbox.getStatefulComponents(),n=[];for(t in e)e.hasOwnProperty(t)&&(i[t]&&i[t].setState&&i[t].setState(e[t].state),n.push(t));return n},resetState:function(){var e,t=this;t._historyEnabled=!1,t._historyPrevious=[],t._historyNext=[];for(e in this._pluginInstances)this._pluginInstances.hasOwnProperty(e)&&(t.sandbox.printDebug("["+t.getName()+"]"+" resetting state on "+e),t._pluginInstances[e].resetState());t._currentViewId=this._defaultViewId,t._startupState?t._resetComponentsWithNoStateData(t.useState(this._startupState)):jQuery.ajax({dataType:"json",type:"GET",url:t.sandbox.getAjaxUrl()+"action_route=GetAppSetup&noSavedState=true",success:function(e){e&&e.configuration?(t._startupState=e.configuration,t._resetComponentsWithNoStateData(t.useState(e.configuration)),t._historyEnabled=!0):alert("error in getting configuration")},error:function(){alert("error loading conf"),t._historyEnabled=!0},complete:function(){t._historyEnabled=!0}}),t._historyEnabled=!0},_resetComponentsWithNoStateData:function(e){var t,i,n,s=this.sandbox.getStatefulComponents();for(t in s)if(s.hasOwnProperty(t)){for(i=!1,n=0;n<e.length;n+=1)if(t==e[n]){i=!0;break}i||s[t].setState()}},saveState:function(e,t){var i;if(t)this.sandbox.printDebug("["+this.getName()+"]"+" saving state with "+t),this._pluginInstances[t].saveState(e);else for(i in this._pluginInstances)this._pluginInstances.hasOwnProperty(i)&&this.saveState(e,i)},getCurrentState:function(){var e,t={},i=this.sandbox.getStatefulComponents();for(e in i)i.hasOwnProperty(e)&&(i[e].getState?t[e]={state:i[e].getState()}:this.sandbox.printWarn("Stateful component "+e+" doesnt have getState()"));return t},getSavedState:function(e){return this._pluginInstances[e].getState()}}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.Plugin",function(){throw"Oskari.mapframework.bundle.statehandler.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setHandler:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},getState:function(){throw"Implement your own"},resetState:function(){throw"Implement your own"},saveState:function(){throw"Implement your own"}}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",function(e){this.handler=null,this.pluginName=null,this._sandbox=null,this._ajaxUrl=e},{__name:"statehandler.SaveViewPlugin",getName:function(){return this.pluginName},getHandler:function(){return this.handler},setHandler:function(e){this.handler=e,this.pluginName=e.getName()+this.__name},getState:function(){},resetState:function(){},saveState:function(e,t){var i=t,n=this;i||(i=this.handler.getCurrentState());var s={currentViewId:n.handler.getCurrentViewId(),viewData:i};e&&(s.viewName=e.name,s.viewDescription=e.description);var r=n._sandbox.getEventBuilder("StateSavedEvent"),a=r(s.viewName,i);jQuery.cookie.json=!0;var o=7;jQuery.cookie("oskaristate",s,{expires:o}),s.viewData=JSON.stringify(s.viewData),jQuery.ajax({type:"POST",url:this._ajaxUrl+"action_route=AddView",data:s,success:function(e){n._sandbox.notifyAll(a),n.handler.setCurrentViewId(e.id)},error:function(){s.viewName&&(a.setError(!0),n._sandbox.notifyAll(a))}})},serializeJSON:function(e){var t=this,i=typeof e;if("object"!==i||null===e)return"string"===i&&(e='"'+e+'"'),String(e);var n=[],s=e&&e.constructor==Array;return jQuery.each(e,function(e,r){i=typeof r,"string"===i?r='"'+r+'"':"object"===i&&null!==r&&(r=t.serializeJSON(r)),n.push((s?"":'"'+e+'":')+String(r))}),(s?"[":"{")+String(n)+(s?"]":"}")},startPlugin:function(e){this._sandbox=e;var t=this;jQuery(document).ready(function(){window.onbeforeunload=function(){t.saveState()}})},stopPlugin:function(){this._sandbox=null}},{protocol:["Oskari.mapframework.bundle.statehandler.plugin.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequest",function(e){this._creator=null,this._state=e,this._currentViewId=1},{__name:"StateHandler.SetStateRequest",getName:function(){return this.__name},getState:function(){return this._state},getCurrentViewId:function(){return this._currentViewId},setCurrentViewId:function(e){this.currentViewId=e}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){t.getState()?(this.statehandler.setCurrentViewId(t.getCurrentViewId()),this.statehandler.useState(t.getState())):this.statehandler.resetState()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.event.StateSavedEvent",function(e,t){this._name=e,this._state=t,this._error=!1},{__name:"StateSavedEvent",getName:function(){return this.__name},getViewName:function(){return this._name},getState:function(){return this._state},isError:function(){return this._error},setError:function(e){this._error=1==e}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequest",function(e,t){this._viewName=e,this._viewDescription=t},{__name:"StateHandler.SaveStateRequest",getName:function(){return this.__name},getViewName:function(){return this._viewName},getViewDescription:function(){return this._viewDescription}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){this.statehandler.saveState({name:t.getViewName(),description:t.getViewDescription()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/plugin/openlayerspopup/OpenlayersPopupPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/infobox/css/infobox.css"}]},bundle:{manifest:{"Bundle-Identifier":"infobox","Bundle-Name":"infobox","Bundle-Author":[{Name:"ev",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("infobox","Oskari.mapframework.bundle.infobox.InfoBoxBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance",function(){this.sandbox=null,this.started=!1,this.mediator=null},{__name:"Infobox",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");t.register(e),e.setSandbox(t);for(var i in e.eventHandlers)i&&t.registerForEventByName(e,i);var n=t.findRegisteredModuleInstance("MainMapModule");n.registerPlugin(this.popupPlugin),n.startPlugin(this.popupPlugin),t.addRequestHandler("InfoBox.ShowInfoBoxRequest",this.requestHandlers.showInfoHandler),t.addRequestHandler("InfoBox.HideInfoBoxRequest",this.requestHandlers.hideInfoHandler)}},init:function(){var e=this.conf&&this.conf.adaptable===!0;return this.popupPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin"),this.popupPlugin.setAdaptable(e),this.requestHandlers={showInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",this.popupPlugin),hideInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",this.popupPlugin)},null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},eventHandlers:{},stop:function(){var e=this,t=this.sandbox;for(var i in e.eventHandlers)i&&t.unregisterFromEventByName(e,i);e.sandbox.unregister(e),e.started=!1},setState:function(e){if(e&&e.popups){this.popupPlugin.close();for(var t=0;t<e.popups.length;++t){var i=e.popups[t];this.popupPlugin.popup(i.id,i.title,i.data,i.lonlat)}}},getState:function(){var e={popups:[]},t=this.popupPlugin.getPopups();for(var i in t){var n=t[i],s={id:i,title:n.title,data:n.contentData,lonlat:n.lonlat};e.popups.push(s)}return e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),jQuery.fn.outerHTML=function(e){var t;return this.length?e?(jQuery.each(this,function(t,i){var n,s=i,r=i.outerHTML?"outerHTML":"innerHTML";i.outerHTML||(i=jQuery(i).wrap("<div>").parent()[0]),jQuery.isFunction(e)?(n=e.call(s,t,i[r]))!==!1&&(i[r]=n):i[r]=e,i.outerHTML||jQuery(i).children().unwrap()}),this):this[0].outerHTML||(t=this.wrap("<div>").parent().html(),this.unwrap(),t):void 0===val||null===val?this:null},Oskari.clazz.define("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._popups={}},{__name:"OpenLayersPopupPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(){this._arrow=jQuery('<div class="popupHeaderArrow"></div>'),this._header=jQuery("<div></div>"),this._headerWrapper=jQuery('<div class="popupHeader"></div>'),this._headerCloseButton=jQuery('<div class="olPopupCloseBox icon-close-white" style="position: absolute; top: 12px;"></div>'),this._contentDiv=jQuery('<div class="popupContent"></div>'),this._contentWrapper=jQuery('<div class="contentWrapper"></div>'),this._actionLink=jQuery('<span class="infoboxActionLinks"><a href="#"></a></span>'),this._actionButton=jQuery('<span class="infoboxActionLinks"><input type="button" /></span>'),this._contentSeparator=jQuery('<div class="infoboxLine">separator</div>')},popup:function(e,t,i,n,s,r){var a=this,o=this._arrow.clone(),l=this._header.clone(),u=this._headerWrapper.clone(),h=this._contentDiv.clone(),c=this._headerCloseButton.clone();l.append(t),u.append(l),u.append(c);for(var p=0;p<i.length;p++){0!==p&&h.append(this._contentSeparator.clone());var d=i[p].html,m=this._contentWrapper.clone();m.append(d);var f=i[p].actions,y=1==i[p].useButtons,g=i[p].primaryButton;for(var v in f){var b=v;f[v];var L=null;if(y){L=this._actionButton.clone();var O=L.find("input");O.attr("contentdata",p),O.attr("value",b),b==g&&O.addClass("primary")}else{L=this._actionLink.clone();var w=L.find("a");w.attr("contentdata",p),w.append(b)}m.append(L)}h.append(m)}var _=this.getMapModule().getMap(),x=new OpenLayers.Popup(e,new OpenLayers.LonLat(n.lon,n.lat),new OpenLayers.Size(400,300),o.outerHTML()+u.outerHTML()+h.outerHTML(),!1);x.moveTo=function(e){if(null!==e&&void 0!==e&&null!==this.div&&void 0!==this.div){this.div.style.left=e.x+"px";var t=e.y-20;this.div.style.top=t+"px"}},x.setBackgroundColor("transparent"),this._popups[e]={title:t,contentData:i,lonlat:n,popup:x},jQuery(x.div).css("overflow","visible"),jQuery(x.groupDiv).css("overflow","visible"),x.events.un({click:x.onclick,scope:x}),x.events.on({click:function(t){var n=jQuery(t.target||t.srcElement);if(n.hasClass("olPopupCloseBox"))a.close(e);else{var s=n.attr("contentdata"),r=n.attr("value");r||(r=n.html()),i[s]&&i[s].actions&&i[s].actions[r]&&i[s].actions[r]()}},scope:x}),_.addPopup(x),this.adaptable&&jQuery(this._adaptPopupSize(e)),this._panMapToShowPopup(n),s&&this._changeColourScheme(s),r&&this._changeFont(r);var S=jQuery(".contentWrapper input, .contentWrapper textarea");"function"==typeof S.placeholder&&S.placeholder()},setAdaptable:function(e){this.adaptable=e},_adaptPopupSize:function(e){var t=jQuery(this.getMapModule().getMapViewPortDiv()),i=jQuery("#"+e),n=parseFloat(i.css("left"))+10;i.find(".popupHeaderArrow").css({"margin-left":"-10px"}),i.find(".popupHeader").css("width","100%");var s=i.find(".popupContent").css({"margin-left":"0",padding:"5px 20px 5px 20px"});i.find(".olPopupContent").css({width:"100%",height:"100%"});var r=.7*t.width(),a=.7*t.height(),o=s.find(".contentWrapper");if(i.css({height:"auto",width:"auto","min-width":"256px","max-width":r+"px","min-height":"200px","max-height":a+"px",left:n+"px","z-index":"16000"}),jQuery.browser.msie)o.css({"padding-bottom":"5px"});else{var l=o.height();l=l>a?a+30+"px":"auto",s.css({height:l})}},_panMapToShowPopup:function(e){var t=this._map.getViewPortPxFromLonLat(e),i=this._map.getCurrentSize(),n=i.w,s=i.h,r=0,a=0,o=jQuery(".olPopup"),l=o.width()+50,u=o.height()+90;t.x+l>n&&(r=n-(t.x+l)),t.y+u>s?a=s-(t.y+u):t.y<25&&(a=25),(0!==r||0!==a)&&this.getMapModule().panMapByPixels(-r,-a)},_changeColourScheme:function(e,t){if(t=t||jQuery("div#getinforesult"),e&&t){var i=t.find("div.popupHeaderArrow"),n=t.find("div.popupHeader"),s=t.find("div.popupTitle"),r=t.find("div.getinforesult_header"),a=t.find("h3.myplaces_header"),o=t.find("div.olPopupCloseBox");i.css({"border-right-color":e.bgColour}),n.css({"background-color":e.bgColour,color:e.titleColour}),s.css({color:e.titleColour}),r.css({"background-color":e.bgColour}),r.find("div.getinforesult_header_title").css({color:e.titleColour}),a.css({color:e.headerColour}),o.removeClass("icon-close-white"),o.removeClass("icon-close"),o.addClass(e.iconCls)}},_changeFont:function(e,t){if(t=t||jQuery("div#getinforesult"),t&&e){var i=[];i.push(t),i.push(t.find("table.getinforesult_table"));for(var n=0;n<i.length;n++){var s=i[n];s.removeClass(function(){for(var e="",t=this.className.split(" "),i=0;i<t.length;++i)/oskari-publisher-font-/.test(t[i])&&(e+=t[i]+" ");return e}),s.addClass("oskari-publisher-font-"+e)}}},close:function(e){if(e)this._popups[e]&&(this._popups[e].popup&&this._popups[e].popup.destroy(),delete this._popups[e]);else for(var t in this._popups)this._popups[t].popup.destroy(),delete this._popups[t]},getPopups:function(){return this._popups},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequest",function(e,t,i,n,s,r,a){this._creator=null,this._id=e,this._title=t,this._content=i,this._position=n,this._hidePrevious=1==s,this._colourScheme=r,this._font=a},{__name:"InfoBox.ShowInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getTitle:function(){return this._title},getContent:function(){return this._content},getPosition:function(){return this._position},getHidePrevious:function(){return this._hidePrevious},getColourScheme:function(){return this._colourScheme},getFont:function(){return this._font}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){t.getHidePrevious()&&this.popupPlugin.close(),this.popupPlugin.popup(t.getId(),t.getTitle(),t.getContent(),t.getPosition(),t.getColourScheme(),t.getFont())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequest",function(e){this._creator=null,this._id=e},{__name:"InfoBox.HideInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){this.popupPlugin.close(t.getId())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.search.SearchBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/service/searchservice.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/search/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"search","Bundle-Name":"search","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("search","Oskari.mapframework.bundle.search.SearchBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.service=null
},{__name:"Search",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e&&this._localization[e]?this._localization[e]:this.localization?this._localization:{}},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,this.localization=Oskari.getLocalization(this.getName());var s=null;s=this.conf&&this.conf.url?this.conf.url:n.getAjaxUrl()+"action_route=GetSearchResult";var r="Oskari.mapframework.bundle.search.service.SearchService";this.service=Oskari.clazz.create(r,s),n.register(e);var a;for(a in e.eventHandlers)e.eventHandlers.hasOwnProperty(a)&&n.registerForEventByName(e,a);var o="userinterface.AddExtensionRequest",l=n.getRequestBuilder(o),u=l(this);n.request(this,u),n.registerAsStateful(this.mediator.bundleId,this),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i="userinterface.RemoveExtensionRequest",n=t.getRequestBuilder(i),s=n(this);t.request(this,s),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateResultTable=null,this.templateResultTableHeader=null,this.templateResultTableRow=null,this.resultHeaders=[],this.lastResult=null,this.lastSort=null,this._searchContainer=null},{getName:function(){return"Oskari.mapframework.bundle.search.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("search")||jQuery(this.container).addClass("search")},startPlugin:function(){this.template=jQuery('<div class="searchContainer"><div class="searchDescription"></div><div class="controls"></div><div><br></div><div class="info"></div><div><br></div><div class="resultList"></div></div>'),this.templateResultTable=jQuery('<table class="search_result"><thead><tr></tr></thead><tbody></tbody></table>'),this.templateResultTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateResultTableRow=jQuery('<tr><td><a href="JavaScript:void(0);"></a></td><td></td><td></td></tr>'),this.resultHeaders=[{title:this.instance.getLocalization("grid").name,prop:"name"},{title:this.instance.getLocalization("grid").village,prop:"village"},{title:this.instance.getLocalization("grid").type,prop:"type"}]},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},createUi:function(){var e=this,t=e.instance.getSandbox(),i=jQuery(this.container);i.empty();var n=this.template.clone();this._searchContainer=n;var s=n.find("div.searchDescription");s.html(this.instance.getLocalization("searchDescription"));var r=Oskari.clazz.create("Oskari.userinterface.component.FormInput"),a=/[\s\w\d\.\,\?\!\-äöåÄÖÅ]*\*?$/;r.setContentCheck(!0,this.instance.getLocalization("contentErrorMsg"),a),r.bindChange(function(){null===e.state&&(e.state={});var i=r.getValue();if(e.state.searchtext=i,!i){var s=n.find("div.info");s.empty();var a=n.find("div.resultList");a.empty();var o=t.getRequestBuilder("MapModulePlugin.RemoveMarkerRequest");o&&t.request(e.instance.getName(),o())}}),r.addClearButton();var o=Oskari.clazz.create("Oskari.userinterface.component.Button");o.setTitle(this.instance.getLocalization("searchButton"));var l=function(){r.setEnabled(!1),o.setEnabled(!1);var t=n.find("div.resultList");t.empty();var i=n.find("div.info");i.empty();var s=r.getValue(!0);e.instance.service.doSearch(s,function(t){r.setEnabled(!0),o.setEnabled(!0),e._renderResults(t,s)},function(){r.setEnabled(!0),o.setEnabled(!0);var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton("OK"),n=e.instance.getLocalization("searchservice_search_alert_title");t.show(n,n,[i])})};o.setHandler(l),r.bindEnterKey(l);var u=n.find("div.controls");u.append(r.getField()),u.append(o.getButton()),i.append(n)},_renderResults:function(e,t){if(e&&"number"==typeof e.totalCount){var i=this._searchContainer.find("div.resultList");i.empty(),this.lastResult=e;var n=this,s=this._searchContainer.find("div.info");s.empty();var r=this.instance;if(-1===e.totalCount)return i.append(this.instance.getLocalization("searchservice_search_alert_title")+this.instance.getLocalization(e.errorText)),void 0;if(0===e.totalCount){var a="searchservice_search_alert_title",o=r.getLocalization(a),l="searchservice_search_not_found_anything_text",u=r.getLocalization(l);return i.append(o+":"+u),void 0}s.append(this.instance.getLocalization("searchResultCount")+e.totalCount+this.instance.getLocalization("searchResultCount2")),s.append("<br/>"),e.hasMore&&(s.append(this.instance.getLocalization("searchResultDescriptionMoreResults")),s.append("<br/>")),s.append(this.instance.getLocalization("searchResultDescriptionOrdering")),1===e.totalCount&&(n._resultClicked(e.locations[0]),r.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[n.instance,"close"]));var h,c,p,d=this.templateResultTable.clone(),m=d.find("thead tr"),f=d.find("tbody"),y=function(e){return function(){f.empty();var t=!1;n.lastSort&&n.lastSort.attr===e.prop&&(t=!n.lastSort.descending),n._sortResults(e.prop,t),n._populateResultTable(f);var i=m.find("a:contains("+e.title+")");return m.find("th").removeClass("asc"),m.find("th").removeClass("desc"),t?i.parent().addClass("desc"):i.parent().addClass("asc"),!1}};for(h=0;h<this.resultHeaders.length;++h)c=this.templateResultTableHeader.clone(),p=c.find("a"),p.append(this.resultHeaders[h].title),p.bind("click",y(this.resultHeaders[h])),m.append(c);this._populateResultTable(f),i.append("<div><h3>"+this.instance.getLocalization("searchResults")+e.totalCount+this.instance.getLocalization("searchResultsDescription")+t+"</h3></div>"),i.append(d)}},_populateResultTable:function(e){var t,i,n,s,r,a,o=this,l=function(e){return function(){return o._resultClicked(e),!1}},u=this.lastResult.locations;for(t=0;t<u.length;++t)i=u[t],n=this.templateResultTableRow.clone(),s=n.find("td"),r=jQuery(s[0]),a=r.find("a"),a.append(i.name),a.bind("click",l(i)),jQuery(s[1]).append(i.village),jQuery(s[2]).append(i.type),e.append(n)},_resultClicked:function(e){var t=this,i="searchResultPopup",n=this.instance,s=n.sandbox,r=s.getRequestBuilder("MapMoveRequest");s.request(t.instance.getName(),r(e.lon,e.lat,e.zoomLevel,!1));var a=this.instance.getLocalization("resultBox"),o={html:"<h3>"+e.name+"</h3>"+"<p>"+e.village+"<br/>"+e.type+"</p>",actions:{}},l=[o];o.actions[a.close]=function(){var e="InfoBox.HideInfoBoxRequest",n=s.getRequestBuilder(e),r=n(i);s.request(t.instance.getName(),r)};var u="InfoBox.ShowInfoBoxRequest",h=s.getRequestBuilder(u),c=h(i,a.title,l,new OpenLayers.LonLat(e.lon,e.lat),!0);s.request(this.instance.getName(),c)},_sortResults:function(e,t){var i=this;this.lastResult&&(this.lastSort={attr:e,descending:t},this.lastResult.locations.sort(function(n,s){return i._searchResultComparator(n,s,e,t)}))},_searchResultComparator:function(e,t,i,n){var s=e[i].toLowerCase(),r=t[i].toLowerCase(),a=0;return(s===r||"name"===i)&&(s=e.id,r=t.id),r>s?a=-1:s>r&&(a=1),n&&(a=-1*a),a}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.search.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){var e=this,t=e.instance,i=this.container;this.template,t.getSandbox(),i.children(".oskari-tile-status")}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/model/LayerGroup.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/Layer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/LayersTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/PublishedLayersTab.js"},{type:"text/css",src:"../../../../resources/framework/bundle/layerselector2/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"layerselector2","Bundle-Name":"layerselector2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("layerselector2","Oskari.mapframework.bundle.layerselector2.LayerSelectorBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"LayerSelector",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e,t,i,n,s,r=this,a=r.conf,o=a?a.sandbox:"sandbox",l=Oskari.getSandbox(o);if(!r.started){r.started=!0,r.sandbox=l,l.register(r);for(s in r.eventHandlers)r.eventHandlers.hasOwnProperty(s)&&l.registerForEventByName(r,s);e=l.getRequestBuilder("userinterface.AddExtensionRequest")(r),l.request(r,e),r.createUi(),t=r.sandbox.getService("Oskari.mapframework.service.MapLayerService"),l.registerAsStateful(r.mediator.bundleId,r),i=function(){},n=function(){alert(r.getLocalization("errors").loadFailed)},t.loadAllLayersAjax(i,n)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0)},MapLayerEvent:function(e){var t,i=this,n=i.sandbox.getService("Oskari.mapframework.service.MapLayerService"),s=e.getLayerId();"update"===e.getOperation()?(t=n.findMapLayer(s),i.plugins["Oskari.userinterface.Flyout"].handleLayerModified(t)):"add"===e.getOperation()?(t=n.findMapLayer(s),i.plugins["Oskari.userinterface.Flyout"].handleLayerAdded(t),i.plugins["Oskari.userinterface.Tile"].refresh()):"remove"===e.getOperation()?(i.plugins["Oskari.userinterface.Flyout"].handleLayerRemoved(s),i.plugins["Oskari.userinterface.Tile"].refresh()):"sticky"===e.getOperation()&&(t=n.findMapLayer(s),i.plugins["Oskari.userinterface.Flyout"].handleLayerSticky(t),i.plugins["Oskari.userinterface.Tile"].refresh())}},stop:function(){var e,t,i=this,n=i.sandbox();for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&n.unregisterFromEventByName(i,t);e=n.getRequestBuilder("userinterface.RemoveExtensionRequest")(this),n.request(i,e),i.sandbox.unregisterStateful(i.mediator.bundleId),i.sandbox.unregister(i),i.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var e=this;e.plugins["Oskari.userinterface.Flyout"].createUi(),e.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Flyout",function(e){this.instance=e,this.container=null,this.template=null,this.state=null,this.layerTabs=[]},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselector2")||jQuery(this.container).addClass("layerselector2")},startPlugin:function(){var e,t=this,i=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",t.instance,t.instance.getLocalization("filter").inspire),n=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",t.instance,t.instance.getLocalization("filter").organization);t.template=jQuery('<div class="allLayersTabContent"></div>'),i.groupingMethod="getInspireName",n.groupingMethod="getOrganizationName",t.layerTabs.push(i),t.layerTabs.push(n),t.instance.conf&&t.instance.conf.showPublishedTab===!0&&(e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",t.instance,t.instance.getLocalization("filter").published),this.layerTabs.push(e))},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setContentState:function(e){var t,i;for(e||(e={}),t=0;t<this.layerTabs.length;t+=1)i=this.layerTabs[t],i.getTitle()===e.tab&&(this.tabContainer.select(i.getTabPanel()),i.setState(e))},getContentState:function(){var e,t,i={};for(e=0;e<this.layerTabs.length;e+=1)if(t=this.layerTabs[e],this.tabContainer.isSelected(t.getTabPanel())){i=t.getState();break}return i},createUi:function(){var e,t,i=this,n=jQuery(this.container);for(n.empty(),i.tabContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer"),i.tabContainer.insertTo(n),e=0;e<i.layerTabs.length;e+=1)t=i.layerTabs[e],i.tabContainer.addPanel(t.getTabPanel());i.populateLayers()},populateLayers:function(){var e,t,i,n,s=this.instance.getSandbox(),r=s.getService("Oskari.mapframework.service.MapLayerService"),a=r.getAllLayers();for(e=0;e<this.layerTabs.length;e+=1)t=this.layerTabs[e],t.groupingMethod&&(i=a.slice(0),n=this._getLayerGroups(i,t.groupingMethod),t.showLayerGroups(n))},_getLayerGroups:function(e,t){var i,n,s,r=this,a=[],o=null;for(e.sort(function(e,i){return r._layerListComparator(e,i,t)}),i=0;i<e.length;i+=1)n=e[i],n.getMetaType&&"published"===n.getMetaType()||(s=n[t](),o&&o.getTitle()===s||(o=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",s),a.push(o)),o.addLayer(n));return a},_layerListComparator:function(e,t,i){var n=e[i]().toLowerCase(),s=t[i]().toLowerCase();return n===s&&e.getName()&&t.getName()&&(n=e.getName().toLowerCase(),s=t.getName().toLowerCase()),s>n?-1:n>s?1:0},handleLayerSelectionChanged:function(e,t){var i,n;for(i=0;i<this.layerTabs.length;i+=1)n=this.layerTabs[i],n.setLayerSelected(e.getId(),t)},handleLayerModified:function(e){var t,i,n=this;for(t=0;t<n.layerTabs.length;t+=1)i=n.layerTabs[t],i.updateLayerContent(e.getId(),e)},handleLayerSticky:function(e){var t,i,n=this;for(t=0;t<n.layerTabs.length;t+=1)i=n.layerTabs[t],i.updateLayerContent(e.getId(),e)},handleLayerAdded:function(){var e=this;e.populateLayers()},handleLayerRemoved:function(){var e=this;e.populateLayers()}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",function(e){this.name=e,this.layers=[],this.searchIndex={}},{setTitle:function(e){this.name=e},getTitle:function(){return this.name},addLayer:function(e){this.layers.push(e),this.searchIndex[e.getId()]=this._getSearchIndex(e)},getLayers:function(){return this.layers},_getSearchIndex:function(e){var t=e.getName()+" "+e.getInspireName()+" "+e.getOrganizationName();return t.toLowerCase()},matchesKeyword:function(e,t){var i=this.searchIndex[e];return-1!==i.indexOf(t.toLowerCase())}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.Layer",function(e,t,i){this.sandbox=t,this.localization=i,this.layer=e,this.backendStatus="OK",this.ui=this._createLayerContainer(e)},{__template:'<div class="layer"><input type="checkbox" /> <div class="layer-tools"><div class="layer-backendstatus-icon backendstatus-ok"></div><div class="layer-icon"></div><div class="layer-info"></div></div><div class="layer-title"></div></div>',getId:function(){return this.layer.getId()},setVisible:function(e){1==e?this.ui.show():this.ui.hide()},setSelected:function(e){this.ui.find("input").attr("checked",1==e)},updateLayerContent:function(e){var t=e.getName(),i=this.backendStatus,n=e.getBackendStatus(),s=this.localization.backendStatus,r=i?s.prevBackendStatus:null,a=n?s.currBackendStatus:null,o=r?r.iconClass:null,l=a?a.iconClass:null,u=r?r.tooltip:null,h=a?a.tooltip:null,c=this.ui.find(".layer-backendstatus-icon");this.ui.find(".layer-title").html(t),e.isSticky()&&this.ui.find("input").attr("disabled","disabled"),o&&o!==l&&c.removeClass(o),l&&o!==l&&c.addClass(l),h?u!==h&&c.attr("title",h):u&&c.attr("title",""),this.backendStatus=n},getContainer:function(){return this.ui},_createLayerContainer:function(e){var t,i,n,s,r,a,o,l,u,h,c=this,p=c.sandbox,d=jQuery(this.__template),m=this.localization.tooltip,f=jQuery(d).find("div.layer-tools"),y=f.find("div.layer-icon");if(y.addClass(e.getIconClassname()),e.isBaseLayer()?y.attr("title",m["type-base"]):e.isLayerOfType("WMS")?y.attr("title",m["type-wms"]):e.isLayerOfType("WMTS")?y.attr("title",m["type-wms"]):e.isLayerOfType("WFS")?y.attr("title",m["type-wfs"]):e.isLayerOfType("VECTOR")&&y.attr("title",m["type-wms"]),!e.getMetadataIdentifier()&&(r=e.getSubLayers(),subLmeta=!1,r&&r.length>0))for(subLmeta=!0,a=0;a<r.length;a+=1)if(o=r[a].getMetadataIdentifier(),!o||""==o){subLmeta=!1;break}return(e.getMetadataIdentifier()||subLmeta)&&(f.find("div.layer-info").addClass("icon-info"),f.find("div.layer-info").click(function(){if(t="catalogue.ShowMetadataRequest",i=e.getMetadataIdentifier(),n=[],s={},s[i]=!0,r=e.getSubLayers(),r&&r.length>0)for(a=0;a<r.length;a+=1)o=r[a].getMetadataIdentifier(),o&&""!==o&&!s[o]&&(s[o]=!0,n.push({uuid:o}));p.postRequestByName(t,[{uuid:i},n])})),jQuery(d).attr("layer_id",e.getId()),jQuery(d).find(".layer-title").append(e.getName()),jQuery(d).find("input").change(function(){l=jQuery(this),l.is(":checked")?p.postRequestByName("AddMapLayerRequest",[e.getId(),!1,e.isBaseLayer()]):p.postRequestByName("RemoveMapLayerRequest",[e.getId()])}),e.isSticky()&&jQuery(d).find("input").attr("disabled","disabled"),u=f.find(".layer-backendstatus-icon"),u.click(function(){h=e.getId(),p.postRequestByName("ShowMapLayerInfoRequest",[h])}),d}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.LayersTab",function(e,t){this.instance=e,this.title=t,this.showSearchSuggestions=e.conf&&e.conf.showSearchSuggestions===!0,this.layerGroups=[],this.layerContainers={},this.templates={spinner:'<span class="spinner-text"></span>',shortDescription:'<div class="field-description"></div>',description:'<div><h4 class="indicator-msg-popup"></h4><p></p></div>',relatedKeywords:'<div class="related-keywords"></div>',keywordsTitle:'<div class="keywords-title"></div>',keywordContainer:'<a href="#"class="keyword-cont"><span class="keyword"></span></a>',keywordType:'<div class="type"></div>'},this._createUI()},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)))},_createInfoIcon:function(e){var t=this,i=jQuery('<div class="icon-info"></div>'),n=e.find(".field-description");n.find(".icon-info").remove(),n.append(i),i.click(function(){var e=jQuery(t.templates.description),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button");e.find("p").text(t._locale.filter.description),n.setTitle(t._locale.buttons.ok),n.addClass("primary"),n.setHandler(function(){i.close(!0)}),i.show(t._locale.filter.text,e,[n])})},_createUI:function(){var e,t=this;t._locale=t.instance._localization,t.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),t.tabPanel.setTitle(t.title),e=t.getFilterField().getField(),t.showSearchSuggestions&&(e.append(jQuery(t.templates.spinner).text(t._locale.loading)),e.append(jQuery(t.templates.relatedKeywords))),e.append(jQuery(t.templates.shortDescription).text(t._locale.filter.shortDescription)),t._createInfoIcon(e),t.tabPanel.getContainer().append(e),e.find(".spinner-text").hide(),t.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),t.accordion.insertTo(t.tabPanel.getContainer())},getFilterField:function(){var e,t=this,i=0;return t.filterField?t.filterField:(e=Oskari.clazz.create("Oskari.userinterface.component.FormInput"),e.setPlaceholder(t.instance.getLocalization("filter").text),e.addClearButton(),e.bindChange(function(n){n.stopPropagation();var s=n;i&&clearTimeout(i),i=setTimeout(function(){t._fireFiltering(e.getValue(),s,t),i=null},300)},!0),t.filterField=e,e)},_fireFiltering:function(e,t,i){i.filterLayers(e),i.showSearchSuggestions&&(i.clearRelatedKeywordsPopup(e,jQuery(t.currentTarget).parents(".oskarifield")),i._relatedKeywordsPopup(e,t,i))},showLayerGroups:function(e){var t,i,n,s,r,a,o,l,u,h,c=this;for(c.accordion.removeAllPanels(),c.layerContainers=void 0,c.layerContainers={},c.layerGroups=e,t=0;t<e.length;t+=1){for(i=e[t],n=i.getLayers(),s=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),s.setTitle(i.getTitle()+" ("+n.length+")"),i.layerListPanel=s,r=s.getContainer(),a=0;a<n.length;a+=1)o=n[a],l=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",o,c.instance.sandbox,c.instance.getLocalization()),u=l.getContainer(),r.append(u),c.layerContainers[o.getId()]=l;c.accordion.addPanel(s)}for(h=c.instance.sandbox.findAllSelectedMapLayers(),t=0;t<h.length;t+=1)c.setLayerSelected(h[t].getId(),!0);c.filterLayers(c.filterField.getValue())},filterLayers:function(e,t){var i,n,s,r,a,o,l,u,h,c,p=this,d=0;if(t||p.sentKeyword!==e||(t=p.ontologyLayers),p.accordion.showPanels(),!e||0===e.length)return p._showAllLayers(),void 0;for(n=0;n<p.layerGroups.length;n+=1){for(r=p.layerGroups[n],o=r.getLayers(),i=0,s=0;s<o.length;s+=1)a=o[s],l=a.getId(),u=p.layerContainers[l],h=r.matchesKeyword(l,e)||p.showSearchSuggestions&&t&&p._arrayContains(t,l),u.setVisible(h),h&&(i+=1,1===i%2?u.getContainer().addClass("odd"):u.getContainer().removeClass("odd"),r.layerListPanel.open());r.layerListPanel.setVisible(i>0),r.layerListPanel.isVisible()&&(d+=1),r.layerListPanel.setTitle(r.getTitle()+" ("+i+"/"+o.length+")")}0===d?(c=p.instance.getLocalization("errors"),p.accordion.showMessage(c.noResults)):p.accordion.removeMessage()},clearRelatedKeywordsPopup:function(e,t){this.sentKeyword&&this.sentKeyword!==e&&t.find(".related-keywords").html("").hide()},_relatedKeywordsPopup:function(e,t,i){var n,s,r=jQuery(t.currentTarget).parents(".oskarifield");return e&&0!==e.length?e.length<4?(r.find(".related-keywords").hide(),void 0):(n=r.find(".spinner-text").show(),i.sentKeyword=e,s=this.instance.sandbox.getAjaxUrl(),jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:s+"action_route=SearchKeywords&keyword="+encodeURIComponent(e)+"&lang="+Oskari.getLang(),success:function(t){i.relatedKeywords=t,i._showRelatedKeywords(e,t,r),n.hide()},error:function(){var e=i.instance.getLocalization("errors");i.accordion.showMessage(e.generic),n.hide()}}),void 0):(this._showAllLayers(),void 0)},_arrayContains:function(e,t){var i;if(e.indexOf)return e.indexOf(t)>-1;for(i=0;i<e.length;i+=1)if(e[i]===t)return!0;return!1},_concatNew:function(e,t){var i,n=this;for(i=t.length-1;i>=0;i-=1)n._arrayContains(e,t[i])||e.push(t[i])},_isDefined:function(e){return"undefined"!=typeof e&&null!==e&&""!==e},_containsIgnoreCase:function(e,t){var i=this;return i._isDefined(e)&&i._isDefined(t)&&e.toLowerCase().indexOf(t.toLowerCase())>-1},_matchesIgnoreCase:function(e,t){var i=this;return i._isDefined(e)&&i._isDefined(t)&&e.toLowerCase()===t.toLowerCase()},_showRelatedKeywords:function(e,t,i){var n,s,r,a=this,o=a.getFilterField().getField().find(".related-keywords"),l=[],u=[];if(a.clearRelatedKeywordsPopup(null,i),t.length>0)for(n=0;n<t.length;n+=1)s=t[n],s.layers.length>0&&(a._matchesIgnoreCase(s.type,"syn")||!a._isDefined(s.type)&&a._containsIgnoreCase(s.keyword,e)?0===u.size?u.concat(s.layers):a._concatNew(u,s.layers):l.push({idx:n,count:s.layers.length}));for(l.length>0&&o.prepend(jQuery(a.templates.keywordsTitle).text(a._locale.filter.didYouMean)),l.sort(function(e,t){return e.count<t.count}),n=0;n<l.length&&3>n;n+=1)s=t[l[n].idx],r=jQuery(a.templates.keywordContainer),r.attr("data-id",s.id).attr("data-keyword",s.keyword).find(".keyword").text(s.keyword.toLowerCase()+" ("+s.layers.length+")"),o.append(r);l.length&&o.show(),a.ontologyLayers=u,a.filterLayers(e,u),o.find(".keyword-cont").on("click",function(e){var t=jQuery(e.currentTarget).attr("data-keyword");a.getFilterField().setValue(t),a._fireFiltering(t,e,a)})},_showAllLayers:function(){var e,t,i,n,s,r,a;for(e=0;e<this.layerGroups.length;e+=1){for(t=this.layerGroups[e],i=t.getLayers(),n=0;n<i.length;n+=1)s=i[n],r=s.getId(),a=this.layerContainers[r],a.setVisible(!0),1===n%2?a.getContainer().addClass("odd"):a.getContainer().removeClass("odd");t.layerListPanel.setVisible(!0),t.layerListPanel.close(),t.layerListPanel.setTitle(t.getTitle()+" ("+i.length+")")}},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(e,t){var i=this.layerContainers[e];i&&i.updateLayerContent(t)}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",function(e,t){this.instance=e,this.title=t,this.layerGroups=[],this.layerContainers={},this._createUI()},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)))},_createUI:function(){var e=this;e.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),e.tabPanel.setTitle(this.title),e.tabPanel.setSelectionHandler(function(t){t?e.tabSelected():e.tabUnselected()}),e.tabPanel.getContainer().append(this.getFilterField().getField()),e.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),e.accordion.insertTo(this.tabPanel.getContainer())},getFilterField:function(){if(this.filterField)return this.filterField;var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.FormInput");return t.setPlaceholder(e.instance.getLocalization("filter").text),t.addClearButton(),t.bindChange(function(){e._searchTrigger(t.getValue())},!0),t.bindEnterKey(function(){e._relatedSearchTrigger(t.getValue())}),this.filterField=t,t},_searchTrigger:function(e){var t=this;t.searchTimer&&clearTimeout(t.searchTimer),e&&0!==e.length?t.searchTimer=setTimeout(function(){t._search(e),t.searchTimer=void 0},500):t._search(e)},_relatedSearchTrigger:function(){var e=this;e.searchTimer&&clearTimeout(e.searchTimer)},tabSelected:function(){if(0===this.layerGroups.length){this.accordion.showMessage(this.instance.getLocalization("loading"));var e=this,t=this.instance.sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:t+"action_route=GetPublishedMyPlaceLayers",success:function(t){e._populateLayerGroups(t),e.showLayerGroups(e.layerGroups)},error:function(){var t=e.instance.getLocalization("errors");e.accordion.showMessage(t.generic)}})}},tabUnselected:function(){},_populateLayerGroups:function(e){var t,i,n,s,r,a=this,o=a.instance.getSandbox(),l=o.getService("Oskari.mapframework.service.MapLayerService"),u=o.getUser().getUuid(),h=null;for(this.layerGroups=[],t=0;t<e.length;t+=1)for(i=e[t],h&&h.getTitle()===i.name||(h=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",i.name),this.layerGroups.push(h)),n=0;n<i.layers.length;n+=1)s=i.layers[n],r=this._getPublishedLayer(s,l,u===i.id),r.setDescription(i.name),h.addLayer(r)
},_getPublishedLayer:function(e,t,i){var n,s=this._getMapLayerJsonBase();if(s.wmsUrl="/karttatiili/myplaces?myCat="+e.id+"&",s.name=e.name,s.id="myplaces_"+e.id,s.permissions=i?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"},n=t.createMapLayer(s),!i)try{t.addLayer(n)}catch(r){}return n},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("published"),t={wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:50,metaType:"published",orgName:e.organization,inspire:e.inspire};return t},showLayerGroups:function(e){var t,i,n,s,r,a,o,l,u,h,c,p=this;for(p.accordion.removeAllPanels(),p.layerContainers=void 0,p.layerContainers={},p.layerGroups=e,t=0;t<e.length;t+=1){for(i=e[t],n=i.getLayers(),r=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),r.setTitle(i.getTitle()+" ("+n.length+")"),i.layerListPanel=r,s=r.getContainer(),a=0;a<n.length;a+=1)o=n[a],l=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",o,p.instance.sandbox,p.instance.getLocalization()),u=l.getContainer(),s.append(u),p.layerContainers[o.getId()]=l;p.accordion.addPanel(r)}if(0===p.layerGroups.length)h=p.instance.getLocalization("errors"),p.accordion.showMessage(h.noResults);else for(c=p.instance.sandbox.findAllSelectedMapLayers(),t=0;t<c.length;t+=1)p.setLayerSelected(c[t].getId(),!0)},_search:function(e){var t=this;return e&&0!==e.length?(t.showLayerGroups([]),t.accordion.showMessage(this.instance.getLocalization("loading")),jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{searchKey:e},url:ajaxUrl+"action_route=FreeFindFromMyPlaceLayers",success:function(e){t._populateLayerGroups(e),t.showLayerGroups(t.layerGroups)},error:function(){var e=t.instance.getLocalization("errors");t.accordion.showMessage(e.generic)}}),void 0):(t.updateLayerContent(),void 0)},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(){this.showLayerGroups([]),this.tabSelected()}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/layerselection2/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"layerselection2","Bundle-Name":"layerselection2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("layerselection2","Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"LayerSelection",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,this.localization=Oskari.getLocalization(this.getName()),n.register(e);for(p in e.eventHandlers)n.registerForEventByName(e,p);var s=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,s),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0,e.getKeepLayersOrder())},MapLayerEvent:function(e){var t=this.sandbox.getService("Oskari.mapframework.service.MapLayerService"),i=e.getLayerId();if("update"===e.getOperation()){var n=t.findMapLayer(i);this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(n)}else if("sticky"===e.getOperation()){var n=t.findMapLayer(i);this.plugins["Oskari.userinterface.Flyout"].handleLayerSticky(n)}},MapLayerVisibilityChangedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerVisibilityChanged(e.getMapLayer(),e.isInScale(),e.isGeometryMatch())},AfterChangeMapLayerOpacityEvent:function(e){e._creator!=this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerOpacityChanged(e.getMapLayer())},AfterChangeMapLayerStyleEvent:function(e){e._creator!=this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerStyleChanged(e.getMapLayer())},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;e.getExtension().getName()==t.getName()&&"close"!=e.getViewState()}},stop:function(){var e=this.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateLayer=null,this.templateLayerTools=null,this.templateLayerOutOfScale=null,this.templateLayerOutOfContentArea=null,this.sortableBinded=!1,this._sliders={}},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselection2")||jQuery(this.container).addClass("layerselection2")},startPlugin:function(){var e=this.instance.getLocalization("layer");this.template=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'></ul>'),this.templateLayer=jQuery('<li class="layerselection2 layer selected"><div class="layer-info"><div class="layer-icon"></div><div class="layer-tool-remove"></div><div class="layer-title"><h4></h4></div></div><div class="stylesel"><label for="style">'+e.style+"</label>"+'<select name="style"></select></div>'+'<div class="layer-tools volatile">'+"</div>"+"</li>"),this.templateLayerFooterTools=jQuery('<div class="right-tools"><div class="layer-rights"></div><div class="object-data"></div><div class="layer-description"><div class="icon-info"></div></div></div><div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+e.hide+"</a>"+"&nbsp;"+'<span class="temphidden" '+'style="display: none;">'+e.hidden+"</span>"+"</div>"+'<div class="oskariui layer-opacity">'+'<div class="layout-slider" id="layout-slider">'+"</div> "+'<div class="opacity-slider" style="display:inline-block">'+'<input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%</div>'+"</div>"+"</div>"),this.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+e.show+"</a> "+e.hidden+"</p>"),this.templateLayerFooterOutOfScale=jQuery('<p class="layer-msg">'+e["out-of-scale"]+' <a href="JavaScript:void(0);">'+e["move-to-scale"]+"</a></p>"),this.templateLayerFooterOutOfContentArea=jQuery('<p class="layer-msg">'+e["out-of-content-area"]+' <a href="JavaScript:void(0);">'+e["move-to-content-area"]+"</a></p>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.template.clone();t.append(i);var n,s,r,a=e.instance.getSandbox(),o=a.findAllSelectedMapLayers(),l=a.getMap().getScale();for(n=o.length-1;n>=0;--n)s=o[n],r=this._createLayerContainer(s),i.append(r),this._appendLayerFooter(r,s,s.isInScale(l),!0);i.sortable({stop:function(t,i){var n=i.item;e._layerOrderChanged(n)}}),this.sortableBinded||(this.sortableBinded=!0)},_appendLayerFooter:function(e,t,i,n){var s=e.find("div.layer-tools"),r=this._createLayerFooter(t,e);if(t.isVisible())if(i)if(n)r.css("display","");else{var a=this._createLayerFooterOutOfContentArea(t);s.addClass("out-of-content"),r.css("display","none"),s.append(a)}else{var o=this._createLayerFooterOutOfScale(t);s.addClass("out-of-scale"),r.css("display","none"),s.append(o)}else s.addClass("hidden-layer"),r.css("display","none"),s.append(this._createLayerFooterHidden(t));s.append(r);var l=e.find("div.layer-opacity input.opacity");this._addSlider(t,e,l)},_addSlider:function(e,t,i){var n=this,s=e.getId(),r=e.getOpacity(),a=t.find(".layout-slider"),o=a.slider({min:0,max:100,value:r,slide:function(t,i){n._layerOpacityChanged(e,i.value)},stop:function(t,i){n._layerOpacityChanged(e,i.value)}});return n._sliders[s]=o,i&&(i.attr("value",e.getOpacity()),i.on("change paste keyup",function(){n._layerOpacityChanged(e,jQuery(this).val())})),o},_layerOrderChanged:function(e){var t=jQuery(this.container).find(".selectedLayersList li.layerselection2"),i=e.attr("layer_id"),n=-1;if(t.each(function(e){return $(this).attr("layer_id")==i?(n=e,!1):!0}),n>-1){n=t.length-1-n;var s=this.instance.getSandbox(),r="RearrangeSelectedMapLayerRequest",a=s.getRequestBuilder(r),o=a(i,n);s.request(this.instance.getName(),o)}},_updateStyles:function(e,t){var i=this,n=i.instance.getSandbox(),s=t.find("div.stylesel");if(s.hide(),e.getStyles&&e.getStyles().length>1){var r,a,o=!1,l=e.getStyles(),u=s.find("select");for(u.empty(),r=0;r<l.length;r++)l[r].getName()&&(a=jQuery('<option value="'+l[r].getName()+'">'+l[r].getTitle()+"</option>"),u.append(a),o=!0);u.hasClass("binded")||(u.change(function(){var t=u.find("option:selected").val();e.selectStyle(t);var s=n.getRequestBuilder("ChangeMapLayerStyleRequest"),r=s(e.getId(),t);n.request(i.instance.getName(),r)}),u.addClass("binded")),o&&(e.getCurrentStyle()&&u.val(e.getCurrentStyle().getName()),u.trigger("change"),s.show())}},_createLayerContainer:function(e){var t=this,i=t.instance.getSandbox(),n="ChangeMapLayerOpacityRequest",s=(i.getRequestBuilder(n),e.getId()),r=(e.getOpacity(),this.templateLayer.clone());r.attr("layer_id",s),r.find("div.layer-title h4").append(e.getName()),r.find("div.layer-title").append(e.getDescription()),this._updateStyles(e,r);var a=this.instance.getLocalization("layer").tooltip,o=r.find("div.layer-icon");return o.addClass(e.getIconClassname()),e.isBaseLayer()?o.attr("title",a["type-base"]):e.isLayerOfType("WMS")?o.attr("title",a["type-wms"]):e.isLayerOfType("WMTS")?o.attr("title",a["type-wms"]):e.isLayerOfType("WFS")?o.attr("title",a["type-wfs"]):e.isLayerOfType("VECTOR")&&o.attr("title",a["type-wms"]),e.isSticky()||(r.find("div.layer-tool-remove").addClass("icon-close"),r.find("div.layer-tool-remove").bind("click",function(){var n="RemoveMapLayerRequest",s=i.getRequestBuilder(n),r=s(e.getId());i.request(t.instance.getName(),r)})),r},handleLayerVisibilityChanged:function(e,t,i){var n=this,s=(n.instance.getSandbox(),"li.layerselection2.layer.selected[layer_id="+e.getId()+"]"),r=jQuery(this.container).find(s),a=(this.instance.getLocalization("layer"),r.find("div.layer-tools"));a.empty(),r.removeClass("hidden-layer"),r.removeClass("out-of-scale"),r.removeClass("out-of-content"),this._sliders[e.getId()]=null,this._appendLayerFooter(r,e,t,i)},_layerOpacityChanged:function(e,t){var i=this.instance.getSandbox(),n="ChangeMapLayerOpacityRequest",s=i.getRequestBuilder(n),r=s(e.getId(),t);i.request(this.instance.getName(),r),this._changeOpacityInput(e)},_changeOpacityInput:function(e){var t="li.layerselection2.layer.selected[layer_id="+e.getId()+"]",i=jQuery(this.container).find(t),n=i.find("div.layer-opacity input.opacity"),s=i.find(".layout-slider");n.attr("value",e.getOpacity()),s.slider("value",e.getOpacity())},handleLayerOpacityChanged:function(e){this._sliders[e.getId()]&&(this._sliders[e.getId()].slider("value",e.getOpacity()),this._changeOpacityInput(e))},handleLayerStyleChanged:function(e){var t="li.layer.selected[layer_id="+e.getId()+"]",i=jQuery(this.container).find(t),n=i.find("div.stylesel select");n.val(e.getCurrentStyle().getName())},_createLayerFooterOutOfScale:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterOutOfScale.clone();n.addClass("layer-msg-for-outofscale");var s="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(s);return n.find("a").bind("click",function(){var n=r(e.getId());return i.request(t.instance.getName(),n),!1}),n},_createLayerFooterHidden:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterHidden.clone();n.addClass("layer-msg-for-hidden");var s="MapModulePlugin.MapLayerVisibilityRequest",r=i.getRequestBuilder(s);return n.find("a").bind("click",function(){var n=r(e.getId(),!0);return i.request(t.instance.getName(),n),!1}),n},_createLayerFooterOutOfContentArea:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterOutOfContentArea.clone();n.addClass("layer-msg-for-outofcontentarea");var s="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(s);return n.find("a").bind("click",function(){var n=r(e.getId());return i.request(t.instance.getName(),n),!1}),n},_createLayerFooter:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterTools.clone(),s=(this.instance.getLocalization("layer"),"MapModulePlugin.MapLayerVisibilityRequest"),r=i.getRequestBuilder(s);if(n.find("div.layer-visibility a").bind("click",function(){var n=r(e.getId(),!1);return i.request(t.instance.getName(),n),!1}),subLmeta=!1,!e.getMetadataIdentifier()){if(subLayers=e.getSubLayers(),subLayers&&subLayers.length>0)for(subLmeta=!0,a=0;a<subLayers.length;a+=1)if(subUuid=subLayers[a].getMetadataIdentifier(),!subUuid||""===subUuid){subLmeta=!1;break}subLmeta||n.find("div.layer-description").hide()}(e.getMetadataIdentifier()||subLmeta)&&n.find("div.icon-info").bind("click",function(){var t="catalogue.ShowMetadataRequest",n=e.getMetadataIdentifier(),s=[],r={};r[n]=!0;var a,o,l=e.getSubLayers();if(l&&l.length>0)for(a=0;a<l.length;a++)o=l[a].getMetadataIdentifier(),o&&""!==o&&!r[o]&&(r[o]=!0,s.push({uuid:o}));i.postRequestByName(t,[{uuid:n},s])});var a,o,l,u=function(e){return function(){return e.getCallback()(),!1}},h=e.getTools();for(a=0;a<h.length;a++)o=h[a],o&&(o.getIconCls()?(l=jQuery("<div></div>"),l.addClass(o.getIconCls()),l.attr("title",o.getTooltip()),n.find("div.object-data").append(l),l.bind("click",u(o))):(l=jQuery('<a href="JavaScript:void(0);"></a>'),l.append(o.getTitle()),n.find("div.object-data").append(l),l.bind("click",u(o))));return this._updatePublishPermissionText(e,n),n},_updatePublishPermissionText:function(e,t){var i=this.instance.getSandbox(),n=this.instance.getLocalization("layer"),s=e.getPermission("publish");"publication_permission_ok"==s&&i.getUser().isLoggedIn()&&(t.find("div.layer-rights").html(n.rights.can_be_published_map_user.label),t.find("div.layer-rights").attr("title",n.rights.can_be_published_map_user.tooltip))},handleLayerSelectionChanged:function(e,t,i){if(t){var n=this,s=n.instance.getSandbox(),r=s.getMap().getScale(),a=jQuery("ul.selectedLayersList"),o=this._createLayerContainer(e),l=(o.find("div.layer-tools"),[]);l=e.isBaseLayer()&&!i?a.find("li.layerselection2[layer_id^=base_]"):a.find(".layerselection2.layer.selected"),l.length>0?e.isBaseLayer()&&!i?l.last().after(o):l.first().before(o):a.append(o),this._appendLayerFooter(o,e,e.isInScale(r),!0)}else{var u=jQuery(this.container).find("li.layerselection2[layer_id="+e.getId()+"]");u&&(this._sliders[e.getId()]=null,u.remove())}},handleLayerModified:function(e){var t=this,i=jQuery(t.container).find("li.layerselection2[layer_id="+e.getId()+"]");jQuery(i).find(".layer-title h4").html(e.getName()),t._updateStyles(e,i);var n=i.find("div.layer-tools");t._updatePublishPermissionText(e,n)},handleLayerSticky:function(e){var t=this,i=jQuery(t.container).find("li.layerselection2[layer_id="+e.getId()+"]");i.find("div.layer-tool-remove").removeClass("icon-close")},refresh:function(){var e,t,i=this,n=i.instance.getSandbox(),s=n.findAllSelectedMapLayers();for(e=s.length-1;e>=0;--e)t=s[e],this.handleLayerOpacityChanged(t)}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Tile",function(e){this.instance=e,this.container=null,this.template=null,this.shownLayerCount=null},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},notifyUser:function(){var e=this.container.children(".oskari-tile-status");e.stop(),this._blink(e,2)},_blink:function(e,t){var i=this;e&&(t||(t=1),e.animate({opacity:.25},500,function(){e.animate({opacity:1},500,function(){t>1&&i._blink(e,--t)})}))},refresh:function(){var e=this,t=e.instance;this.container,this.template;var i=t.getSandbox(),n=i.findAllSelectedMapLayers(),s=n.length,r=this.container.children(".oskari-tile-status");r.addClass("icon-bubble-right"),r.html(s),this.notifyUser()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/MyViewsTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/service/ViewService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/PublishedMapsTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/AccountTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/request/AddTabRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/request/AddTabRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/personaldata/css/personaldata.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/MyPlacesTab.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"personaldata","Bundle-Name":"personaldata","Bundle-Author":[{Name:"ejv",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("personaldata","Oskari.mapframework.bundle.personaldata.PersonalDataBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance",function(){this.core=null,this.sandbox=null,this.started=!1,this.template=null,this.plugins={},this.viewService=null},{__name:"PersonalData",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getViewService:function(){return this.viewService},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t,i=this.conf,n=(i?i.sandbox:null)||"sandbox",s=Oskari.getSandbox(n);e.sandbox=s,this.viewService=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.service.ViewService",s.getAjaxUrl()),s.register(e);for(t in e.eventHandlers)e.eventHandlers.hasOwnProperty(t)&&s.registerForEventByName(e,t);var r=s.getRequestBuilder("userinterface.AddExtensionRequest")(this);s.request(this,r),e.createUi(),this.requestHandlers={addTabRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",s,this.plugins["Oskari.userinterface.Flyout"])},s.addRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);t.removeRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateTabHeader=null,this.templateTabContent=null,this.tabsData=[]},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("personaldata")||jQuery(this.container).addClass("personaldata")},startPlugin:function(){var e=this,t=e.instance.getLocalization("tabs");this.tabsData={myViews:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.MyViewsTab",e.instance,t.myviews),publishedMaps:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",e.instance,t.publishedmaps),account:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.AccountTab",e.instance,t.account)}},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e,t,i,n=this,s=n.instance.getSandbox(),r=jQuery(this.container);if(r.empty(),this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("notLoggedIn")),this.tabsContainer.insertTo(r),s.getUser().isLoggedIn())for(e in this.tabsData)this.tabsData.hasOwnProperty(e)&&(t=this.tabsData[e],i=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),i.setTitle(t.getTitle()),t.addTabContent(i.getContainer()),t.bindEvents&&t.bindEvents(),this.tabsContainer.addPanel(i))},addTab:function(e){var t,i=this.instance.getSandbox();i.getUser().isLoggedIn()&&(t=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),t.setTitle(e.title),t.setContent(e.content),this.tabsContainer.addPanel(t,e.first))}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyViewsTab",function(e,t){this.instance=e,this.loc=t,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.templateDesc=jQuery('<div class="oskarifield"><label for="description"></label><textarea id="view_description" name="description" placeholder="'+this.loc.popup.description_placeholder+'"></textarea></div>'),this.container=null;var i,n=e.sandbox,s=this,r=n.getRequestBuilder("StateHandler.SaveStateRequest");if(r){i=n.getRequestBuilder("Toolbar.AddToolButtonRequest");var a="localization.button.toolbarsave";t&&t.button&&t.button.toolbarsave&&(a=t.button.toolbarsave),n.request(e,i("save_view","viewtools",{iconCls:"tool-save-view",tooltip:a,sticky:!1,prepend:!0,callback:function(){s._promptForView(function(t,i){var s=n.getRequestBuilder("StateHandler.SaveStateRequest");n.request(e,s(t,i))})}}))}n.getUser().isLoggedIn()||(i=n.getRequestBuilder("Toolbar.ToolButtonStateRequest"),n.request(e,i("save_view","viewtools",!1)))},{getName:function(){return"PersonalData.MyViews"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,i=t.template.clone();t.container=e,e.append(i),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,i=t.container.find(".viewsList");i.empty(),this.viewData=e;var n=this._getGridModel(e),s=this._getGrid(n);s.renderTo(i)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("USER",function(t,i){t?e._renderViewsList(i.views):e._showErrorMessage(e.loc.error.loadfailed)})},_editView:function(e){var t=this;this.instance.getSandbox();var i=t.instance.getViewService(),n=function(n,s){i.updateView(e.id,n,s,function(e){if(e){var i=Oskari.clazz.create("Oskari.userinterface.component.Popup");i.show(t.loc.popup.title,t.loc.save.success),i.fadeout(),t._refreshViewsList()}else t._showErrorMessage(t.loc.error.notsaved)})};this._promptForView(n,e.name,e.description)},_promptForView:function(e,t,i){var n=this,s=Oskari.clazz.create("Oskari.userinterface.component.Form"),r=Oskari.clazz.create("Oskari.userinterface.component.FormInput","name");r.setPlaceholder(this.loc.popup.name_placeholder);var a=this.loc.popup.title;t&&(a=this.loc.popup.edit,r.setValue(t)),r.setRequired(!0,n.loc.save.error_noname),r.setContentCheck(!0,n.loc.save.error_illegalchars),s.addField(r);var o=s.getForm();o.append(n.templateDesc.clone()),i&&o.find("textarea").val(i);var l=Oskari.clazz.create("Oskari.userinterface.component.Popup"),u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(this.loc.button.save),u.addClass("primary"),this.instance.sandbox,u.setHandler(function(){var t=s.validate();0===t.length?(e(r.getValue(),o.find("textarea").val()),l.close()):s.showErrors()});var h=l.createCloseButton(this.loc.button.cancel);l.show(a,o,[h,u]),l.dialog.on("keyup",function(e){e.stopPropagation()}),l.dialog.on("keydown",function(e){e.stopPropagation()})},_getGridModel:function(e){var t,i,n,s,r=Oskari.clazz.create("Oskari.userinterface.component.GridModel");for(r.setIdField("id"),t=0;t<e.length;++t)i=e[t],n=i.isPublic===!0,s={id:i.id,state:i.state,name:i.name,description:i.description,isPublic:n,edit:this.loc.edit,publish:n?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]},r.addData(s);return r},_getGrid:function(e){var t=this,i=this.instance,n=i.getSandbox(),s=["name","description","edit","delete"],r=Oskari.clazz.create("Oskari.userinterface.component.Grid");r.setDataModel(e),r.setVisibleFields(s);var a=function(e,s){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=n.getRequestBuilder("StateHandler.SetStateRequest");if(e){var t=e(s.state);t.setCurrentViewId(s.id),n.request(i,t)}return!1}),r};r.setColumnValueRenderer("name",a);var o=function(e,i){var n=t.templateLink.clone();return n.append(e),n.bind("click",function(){var e=t._getViewById(i.id);return e&&t._editView(e),!1}),n};r.setColumnValueRenderer("edit",o);var l=function(e,i){var n=t.templateLink.clone();return n.append(e),n.bind("click",function(){var e=t._getViewById(i.id);return e&&t._confirmDelete(e),!1}),n};r.setColumnValueRenderer("delete",l);var u,h,c;for(u=0;u<s.length;++u)h=s[u],c="grid."+h,this.loc&&this.loc.grid&&this.loc.grid[h]&&(c=this.loc.grid[h]),r.setColumnUIName(h,c);return r},_getViewById:function(e){var t;for(t=0;t<this.viewData.length;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(this.loc.error.generic)},_confirmDelete:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button");
n.setTitle(this.loc["delete"]),n.addClass("primary"),this.instance.sandbox,n.setHandler(function(){t._deleteView(e),i.close()});var s=i.createCloseButton(this.loc.button.cancel);i.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[s,n]),i.makeModal()},_deleteView:function(e){var t=this,i=t.instance.getViewService();i.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.loc.button.ok);i.addClass("primary"),t.show(this.loc.error.title,e,[i])},bindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(this,e)},unbindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.unregisterFromEventByName(this,e)},eventHandlers:{StateSavedEvent:function(e){if(e.isError())return this._showErrorMessage(this.loc.error.notsaved),void 0;var t=Oskari.clazz.create("Oskari.userinterface.component.Popup");t.show(this.loc.popup.title,this.loc.save.success),t.fadeout(),this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.service.ViewService",function(e){this._viewUrl=e},{__qname:"Oskari.mapframework.bundle.personaldata.service.ViewService",getQName:function(){return this.__qname},__name:"ViewService",getName:function(){return this.__name},loadViews:function(e,t){var i=this;e||(e="USER"),jQuery.ajax({url:i._viewUrl+"action_route=GetViews",data:{viewType:e},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){t(!0,e)},error:function(){t(!1)}})},deleteView:function(e,t){var i=this;jQuery.ajax({url:i._viewUrl+"action_route=DeleteView",data:{id:e.id},type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){t(!0)},error:function(){t(!1)}})},makeViewPublic:function(e,t,i){var n=this;jQuery.ajax({url:n._viewUrl+"action_route=AdjustViewAccess",data:{id:e,isPublic:t},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){i(!0)},error:function(){i(!1)}})},updateView:function(e,t,i,n){var s=this;jQuery.ajax({url:s._viewUrl+"action_route=UpdateView",type:"POST",data:{id:e,newName:t,newDescription:i},dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){n(!0)},error:function(){n(!1)}})},isViewLayersLoaded:function(e,t){var i={status:!1,msg:"error"};if(e&&e.state&&e.state.mapfull&&e.state.mapfull.state&&e.state.mapfull.state.selectedLayers){var n,s,r=e.state.mapfull.state.selectedLayers,a=t.getService("Oskari.mapframework.service.MapLayerService"),o=a.getAllLayers(),l=a.isAllLayersLoaded(),u=!1;for(n=0;n<r.length;++n)if(s=a.findMapLayer(r[n].id,o),!s){u=!0;break}l?u?i.msg="missing":(i.status=!0,i.msg="ok"):u?i.msg="notloaded":(i.status=!0,i.msg="ok")}return i}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",function(e,t){this.instance=e,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.loc=t,this.container=null},{getName:function(){return"PersonalData.PublishedMapsTab"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,i=t.template.clone();t.container=e,e.append(i),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,i=t.container.find(".viewsList");i.empty(),this.viewData=e;var n=this._getGridModel(e),s=this._getGrid(n);s.renderTo(i)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("PUBLISHED",function(t,i){t?e._renderViewsList(i.views):e._showErrorMessage(e.loc.error.loadfailed)})},_getViewById:function(e){var t;for(t=0;t<this.viewData.length;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(this.loc.error.generic)},_confirmSetState:function(e,t){var i=this,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(this.loc.button.ok),s.addClass("primary"),s.setHandler(function(){n.close(),e&&t&&e()});var r=n.createCloseButton(this.loc.button.cancel);t?n.show(i.loc.popup.showErrorTitle,i.loc.popup.showConfirmMissing,[r,s]):n.show(i.loc.popup.showErrorTitle,i.loc.popup.showConfirmNotLoaded,[r]),n.makeModal()},_confirmDelete:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button");n.setTitle(this.loc["delete"]),n.addClass("primary"),this.instance.sandbox,n.setHandler(function(){t._deleteView(e),i.close()});var s=i.createCloseButton(this.loc.button.cancel);i.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[s,n]),i.makeModal()},_deleteView:function(e){var t=this,i=t.instance.getViewService();i.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.loc.button.ok);i.addClass("primary"),t.show(this.loc.error.title,e,[i])},_getGridModel:function(e){var t,i,n,s,r=Oskari.clazz.create("Oskari.userinterface.component.GridModel");for(r.setIdField("id"),t=0;t<e.length;++t)i=e[t],n=i.isPublic===!0,s={id:i.id,state:i.state,name:i.name,domain:i.pubDomain,lang:i.lang,isPublic:n,show:this.loc.show,html:this.loc.getHTML,edit:this.loc.edit,publish:n?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]},r.addData(s);return r},_getGrid:function(e){var t=this,i=this.instance,n=i.getSandbox(),s=["name","domain","publish","show","html","edit","delete"],r=Oskari.clazz.create("Oskari.userinterface.component.Grid");r.setDataModel(e),r.setVisibleFields(s);var a=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=n.getLocalizedProperty(t.instance.conf.publishedMapUrl);return window.open(e+i.id,"Published","location=1,status=1,scrollbars=yes,width=850,height=800"),!1}),s};r.setColumnValueRenderer("name",a);var o=i.getViewService(),l=function(e,s,r){var a=n.getRequestBuilder("StateHandler.SetStateRequest"),l=o.isViewLayersLoaded(e,n);if(l.status||s===!0){if(a){var u=a(e.state);return u.setCurrentViewId(e.id),n.request(i,u),!0}return!1}return t._confirmSetState(r,"missing"===l.msg),!1},u=function(e,i){var n=t.templateLink.clone();return n.append(e),n.bind("click",function(){return l(i,!1,function(){return l(i,!0),!1}),!1}),n};r.setColumnValueRenderer("show",u);var h=function(e){var s=n.getRequestBuilder("Publisher.PublishMapEditorRequest");if(s){var r=s(e);n.request(i,r)}var a=n.getRequestBuilder("userinterface.UpdateExtensionRequest");if(a){var o=a(t.instance,"close",t.instance.getName());n.request(t.instance.getName(),o)}},c=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=n.getLocalizedProperty(t.instance.conf.publishedMapUrl),s="http://"+window.location.host+e+i.id,r=t._getViewById(i.id),a=r?r.state.mapfull.config.size:{height:525,width:700};t._showIframeCodePopup(s,a,r.name)}),s};r.setColumnValueRenderer("html",c);var p=function(e,i){var n=t.templateLink.clone();return n.append(e),n.bind("click",function(){return l(i,!1,function(){l(i,!0),h(i)})&&h(i),!1}),n};r.setColumnValueRenderer("edit",p);var d=function(e,i){var n=t.templateLink.clone();return n.append(e),n.bind("click",function(){var e=t._getViewById(i.id);return e&&t._confirmDelete(e),!1}),n};r.setColumnValueRenderer("delete",d),o=i.getViewService();var m=function(e,i){var n=t.templateLink.clone();return n.html(e),n.bind("click",function(){var e=t._getViewById(i.id);if(e){var s=!e.isPublic;o.makeViewPublic(i.id,s,function(r){r?(e.isPublic=s,i.publish=e.isPublic?t.loc.unpublish:t.loc.publish,n.html(i.publish)):s?t._showErrorMessage(t.loc.error.makePublic):t._showErrorMessage(t.loc.error.makePrivate)})}return!1}),n};r.setColumnValueRenderer("publish",m);var f,y,g;for(f=0;f<s.length;++f)y=s[f],g="grid."+y,this.loc&&this.loc.grid&&this.loc.grid[y]&&(g=this.loc.grid[y]),r.setColumnUIName(y,g);return r},bindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(this,e)},unbindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.unregisterFromEventByName(this,e)},eventHandlers:{"Publisher.MapPublishedEvent":function(){this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},_showIframeCodePopup:function(e,t,i){var e,n,s,r,a=this.loc,o=Oskari.clazz.create("Oskari.userinterface.component.Popup"),l=o.createCloseButton(a.button.ok);l.addClass("primary"),n='<iframe src="'+e+'" width="'+t.width+'" height="'+t.height+'"></iframe>',s='<textarea rows="3" cols="80">'+n+"</textarea>",r=a.published.desc+"<br/>"+s,o.makeModal(),o.stopKeydownPropagation(),o.show(i,r,[l])}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.AccountTab",function(e,t){this.conf=e.conf,this.instance=e,this.template=jQuery('<div class="account"><div class="info"></div><div class="bottomlinks"></div></div>'),this.loc=t},{getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this.template.clone();e.append(t),this._createAccountTab(e)},_createAccountTab:function(e){var t,i,n,s,r,a,o=this,l=o.instance.getSandbox(),u=jQuery('<div class="dataField"><div class="label"></div><div class="value"></div><br clear="all" /></div>'),h=l.getUser(),c=this.loc,p=[{label:c.firstName,value:h.getFirstName()},{label:c.lastName,value:h.getLastName()},{label:c.nickName,value:h.getNickName()},{label:c.email,value:h.getLoginName()}],d=e.find("div.info"),m=null;for(t=0;t<p.length;t+=1)i=p[t],n=u.clone(),n.find(".label").html(i.label),n.find(".value").html(i.value),d.append(n);for(o.conf&&(m=l.getLocalizedProperty(o.conf.changeInfoUrl)),s=[{label:c.changeInfo,href:m}],r=e.find("div.bottomlinks"),t=0;t<s.length;t+=1)i=s[t],i.href&&i.label&&(a=jQuery('<a href="'+i.href+'">'+i.label+"</a>&nbsp; "),r.append(a))}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequest",function(e,t,i){this._title=e,this._content=t,this._first=!!i},{__name:"PersonalData.AddTabRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getContent:function(){return this._content},isFirst:function(){return this._first}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",function(e,t){this.sandbox=e,this.personaldata=t},{handleRequest:function(e,t){this.personaldata.addTab({title:t.getTitle(),content:t.getContent(),first:t.isFirst()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesTab",function(e,t){this.instance=e,this.loc=t,this.tabsContainer=void 0,this.tabPanels={},this.linkTemplate=jQuery('<a href="JavaScript:void(0);"></a>'),this.iconTemplate=jQuery('<div class="icon"></div>')},{getName:function(){return"MyPlaces2.MyPlaces"},getTitle:function(){return this.loc.title},getTabsContainer:function(){return this.tabsContainer},getContent:function(){return this.tabsContainer.ui},initContainer:function(){var e=this;e.addAddLayerButton(),e.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabDropdownContainer",e.loc.nocategories,e.addLayerButton)},addAddLayerButton:function(){var e=this;return e.addLayerButton=Oskari.clazz.create("Oskari.userinterface.component.Button"),e.addLayerButton.setTitle(e.loc.addCategory),e.addLayerButton.setHandler(function(){e.instance.openAddLayerDialog("div.personaldata ul li select","right")}),e.addLayerButton},addTabContent:function(e){var t=this;t.initTabContent(),t.tabsContainer.ui.addClass("peikko"),e.append(t.tabsContainer.ui)},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(){var e=this,t=e.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),i=t.getAllCategories();t.getAllMyPlaces();var n,s,r,a=function(t){return function(){var i=e.instance.sandbox.getRequestBuilder("MyPlaces.EditCategoryRequest")(t);return e.instance.sandbox.request(e.instance,i),!1}},o=function(t){return function(){var i=e.instance.sandbox.getRequestBuilder("MyPlaces.DeleteCategoryRequest")(t);return e.instance.sandbox.request(e.instance,i),!1}};for(n=0;n<i.length;++n){s=i[n].getId(),r=this.tabPanels[s],r?(r.setTitle(i[n].name),e.tabsContainer.updatePanel(r)):(r=this._createCategoryTab(i[n]),this.tabsContainer.addPanel(r),this.tabPanels[s]=r),this._populatePlaces(s),r.getContainer().empty(),r.grid.renderTo(r.getContainer());var l=this.linkTemplate.clone();l.addClass("categoryOp"),l.append(this.loc.editCategory),l.bind("click",a(s)),r.getContainer().append(l);var u=this.linkTemplate.clone();u.addClass("categoryOp"),u.append(this.loc.deleteCategory),u.bind("click",o(s)),r.getContainer().append(u)}this._removeObsoleteCategories()}},_showPlace:function(e,t){var i=e.getCentroid(),n=this.instance.sandbox.getRequestBuilder("MapMoveRequest")(i.x,i.y,e.getBounds(),!1);this.instance.sandbox.request(this.instance,n);var s="myplaces_"+t,r=this.instance.sandbox.findMapLayerFromSelectedMapLayers(s);if(!r){var a=this.instance.sandbox.getRequestBuilder("AddMapLayerRequest")(s,!0);this.instance.sandbox.request(this.instance,a)}},_editPlace:function(e){this._showPlace(e.geometry,e.categoryId);var t=this.instance.sandbox.getRequestBuilder("MyPlaces.EditPlaceRequest")(e.id);this.instance.sandbox.request(this.instance,t)},_deletePlace:function(e){var t=this,i=this.instance.sandbox,n=this.loc.notification["delete"],s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(n.btnDelete),r.addClass("primary"),r.setHandler(function(){s.close();var r=i.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),a=function(r){var a=e.categoryId,o="myplaces_"+a,l=i.findMapLayerFromSelectedMapLayers(o);if(l){var u=i.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),h=u(o,!0);i.request(t.instance,h)}r?s.show(n.title,n.success):s.show(n.title,n.error),s.fadeout()};r.deleteMyPlace(e.id,a)});var a=s.createCloseButton(n.btnCancel),o=n.confirm+'"'+e.name+'"'+"?";s.show(n.title,o,[a,r]),s.makeModal()},_getDrawModeFromGeometry:function(e){if(null===e)return null;var t=e.CLASS_NAME,i=null;return"OpenLayers.Geometry.MultiPoint"===t||"OpenLayers.Geometry.Point"===t?i="point":"OpenLayers.Geometry.MultiLineString"===t||"OpenLayers.Geometry.LineString"===t?i="line":("OpenLayers.Geometry.MultiPolygon"===t||"OpenLayers.Geometry.Polygon"===t)&&(i="area"),i},_createCategoryTab:function(e){var t=this,i=e.getId(),n=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");n.setId(i),n.setTitle(e.getName()),n.grid=Oskari.clazz.create("Oskari.userinterface.component.Grid");var s=["name","desc","createDate","updateDate","measurement","edit","delete"];n.grid.setVisibleFields(s);var r=function(e,i){var n=t.linkTemplate.clone(),s=t.iconTemplate.clone(),r=t._getDrawModeFromGeometry(i.geometry);return s.addClass("myplaces-"+r),n.append(s),n.append(e),n.bind("click",function(){return t._showPlace(i.geometry,i.categoryId),!1}),n};n.grid.setColumnValueRenderer("name",r);var a=function(e,i){var n=t.linkTemplate.clone();return n.append(e),n.bind("click",function(){return t._editPlace(i),!1}),n};n.grid.setColumnValueRenderer("edit",a);var o=function(e,i){var n=t.linkTemplate.clone();return n.append(e),n.bind("click",function(){return t._deletePlace(i),!1}),n};n.grid.setColumnValueRenderer("delete",o);var l,u;for(l=0;l<s.length;++l)u=s[l],n.grid.setColumnUIName(u,this.loc.grid[u]);return n},_populatePlaces:function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),i=t.getAllMyPlaces(),n=this.tabPanels[e],s=Oskari.clazz.create("Oskari.userinterface.component.GridModel");s.setIdField("id"),n.grid.setDataModel(s);var r;for(r=0;r<i.length;++r)if(i[r].getCategoryID()===e){var a=this._getDrawModeFromGeometry(i[r].geometry),o=this.instance.formatMeasurementResult(i[r].geometry,a);s.addData({id:i[r].getId(),name:i[r].getName(),desc:i[r].getDescription(),attention_text:i[r].getAttention_text(),geometry:i[r].getGeometry(),categoryId:i[r].getCategoryID(),edit:this.loc.edit,"delete":this.loc["delete"],createDate:this._formatDate(t,i[r].getCreateDate()),updateDate:this._formatDate(t,i[r].getUpdateDate()),measurement:o})}},_formatDate:function(e,t){var i=e.parseDate(t),n="";return i.length>0&&(n=i[0]),n},_removeObsoleteCategories:function(){var e,t,i=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService");for(e in this.tabPanels)this.tabPanels.hasOwnProperty(e)&&(t=i.findCategory(e),t||(this.tabsContainer.removePanel(this.tabPanels[e]),this.tabPanels[e].grid=void 0,delete this.tabPanels[e].grid,this.tabPanels[e]=void 0,delete this.tabPanels[e]))},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},bindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(this,e)},unbindEvents:function(){var e,t=this.instance,i=t.getSandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&i.unregisterFromEventByName(this,e)}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.PublisherBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.PublisherBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/MapPublishedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/ToolStyleChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/ColourSchemeChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/FontChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/LayerToolsEditModeEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/NotLoggedIn.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/StartView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/BasicPublisher.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherLocationForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherToolsForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherLayerForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherLayoutForm.js"},{type:"text/css",src:"../../../../resources/framework/bundle/publisher/css/style.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/request/PublishMapEditorRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/request/PublishMapEditorRequestHandler.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"publisher","Bundle-Name":"publisher","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("publisher","Oskari.mapframework.bundle.publisher.PublisherBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.PublisherBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.publisher=null,this.disabledLayers=null},{__name:"Publisher",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e,t,i=this,n=i.conf,s=(n?n.sandbox:null)||"sandbox",r=Oskari.getSandbox(s);if(!i.started){i.started=!0,i.sandbox=r,this.localization=Oskari.getLocalization(this.getName()),r.register(i);for(t in i.eventHandlers)i.eventHandlers.hasOwnProperty(t)&&r.registerForEventByName(i,t);e=r.getRequestBuilder("userinterface.AddExtensionRequest")(this),r.request(this,e),i._createUi(),i.publishMapEditorRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.request.PublishMapEditorRequestHandler",i),r.addRequestHandler("Publisher.PublishMapEditorRequest",i.publishMapEditorRequestHandler)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(),this.publisher&&this.publisher.maplayerPanel.handleLayerSelectionChanged()},AfterMapLayerAddEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(),this.publisher&&this.publisher.maplayerPanel.handleLayerSelectionChanged()},MapLayerEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(),this.publisher&&this.publisher.maplayerPanel.handleLayerSelectionChanged()},"Publisher.MapPublishedEvent":function(e){var t,i,n,s,r=this.getLocalization(),a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=a.createCloseButton(r.BasicView.buttons.ok);o.addClass("primary"),t=this.sandbox.getLocalizedProperty(this.conf.publishedMapUrl)+e.getId(),i='<iframe src="'+t+'" width="'+e.getWidth()+'" height="'+e.getHeight()+'"></iframe>',n='<textarea rows="3" cols="80">'+i+"</textarea>",s=r.published.desc+"<br/>"+n,a.show(r.published.title,s,[o]),this.setPublishMode(!1)},"Publisher.ToolStyleChangedEvent":function(e){this.publisher&&this.publisher.changeToolStyles(e.getStyle())},"Publisher.ColourSchemeChangedEvent":function(e){this.publisher&&this.publisher.changeColourScheme(e.getColourScheme())},"Publisher.FontChangedEvent":function(e){this.publisher&&this.publisher.changeFont(e.getFont())},MapLayerVisibilityChangedEvent:function(e){this.publisher&&this.publisher.maplayerPanel&&this.publisher.maplayerPanel.handleLayerVisibilityChanged(e.getMapLayer(),e.isInScale(),e.isGeometryMatch())}},stop:function(){var e,t,i=this.sandbox();for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&i.unregisterFromEventByName(this,t);e=i.getRequestBuilder("userinterface.RemoveExtensionRequest")(this),i.request(this,e),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},_createUi:function(){var e=this;e.plugins["Oskari.userinterface.Flyout"].createUi(),e.plugins["Oskari.userinterface.Tile"].refresh()},setPublishMode:function(e,t,i){var n,s,r,a,o,l,u=this,h=jQuery("#contentMap");for(n=u.sandbox.findAllSelectedMapLayers(),s=null,r=0;r<n.length;r+=1)if(a=n[r],"stats"===a.getLayerType()){o=u.sandbox.getRequestBuilder("StatsGrid.StatsGridRequest")(!1,a),u.sandbox.request(u.getName(),o),s=a;break}e?(u.disabledLayers=t,u.oskariLang=Oskari.getLang(),u._removeLayers(),h.addClass("mapPublishMode"),u.sandbox.mapMode="mapPublishMode",jQuery(u.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display","none"),u.publisher=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.BasicPublisher",u,u.getLocalization("BasicView"),i),u.publisher.render(h),u.publisher.setEnabled(!0),s&&u.publisher.initGrid(s)):(jQuery("#contentMap").width(""),jQuery(".oskariui-left").css({width:"",height:"","float":""}).removeClass("published-grid-left").empty(),jQuery(".oskariui-center").css({width:"100%","float":""}).removeClass("published-grid-center"),Oskari.setLang(u.oskariLang),u.publisher&&(jQuery(u.plugins["Oskari.userinterface.Flyout"].container).parent().parent().css("display",""),u.publisher.toolLayoutEditMode&&u.publisher._editToolLayoutOff(),u.publisher.setEnabled(!1),u.publisher.destroy()),h.removeClass("mapPublishMode"),"mapPublishMode"===u.sandbox._mapMode&&delete u.sandbox._mapMode,u._addLayers(),o=u.sandbox.getRequestBuilder("userinterface.UpdateExtensionRequest")(u,"close",u.getName()),u.sandbox.request(u.getName(),o)),l=u.sandbox.getRequestBuilder("MapFull.MapResizeEnabledRequest"),l&&(o=l(!e),u.sandbox.request(u,o))},_addLayers:function(){var e,t,i=this,n=this.sandbox,s=n.getRequestBuilder("AddMapLayerRequest");if(i.disabledLayers)for(e=0;e<i.disabledLayers.length;e+=1)t=i.disabledLayers[e],n.request(i,s(t.getId(),!0))},_removeLayers:function(){var e,t,i=this,n=i.sandbox,s=n.getRequestBuilder("RemoveMapLayerRequest");if(i.disabledLayers)for(e=0;e<i.disabledLayers.length;e+=1)t=i.disabledLayers[e],n.request(i,s(t.getId()))},hasPublishRight:function(e){return"publication_permission_ok"===e.getPermission("publish")},getLayersWithoutPublishRights:function(){var e,t,i=[],n=this.sandbox.findAllSelectedMapLayers();for(e=0;e<n.length;e+=1)t=n[e],!this.hasPublishRight(t)&&t.getId().toString().indexOf("myplaces_")<0&&i.push(t);return i}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.view=null},{getName:function(){return"Oskari.mapframework.bundle.publisher.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("publisher")||jQuery(this.container).addClass("publisher")},startPlugin:function(){this.template=jQuery("<div></div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=jQuery(this.container),i=e.instance.getSandbox();t.empty(),this.view=i.getUser().isLoggedIn()?Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.StartView",this.instance,this.instance.getLocalization("StartView")):Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.NotLoggedIn",this.instance,this.instance.getLocalization("NotLoggedView")),this.view.render(t)},handleLayerSelectionChanged:function(){this.view&&this.view.handleLayerSelectionChanged&&this.view.handleLayerSelectionChanged()}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.publisher.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.MapPublishedEvent",function(e,t,i,n){this._id=e,this._width=t,this._height=i,this._language=n},{__name:"Publisher.MapPublishedEvent",getName:function(){return this.__name},getId:function(){return this._id},getWidth:function(){return this._width},getHeight:function(){return this._height},getLanguage:function(){return this._language}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.ToolStyleChangedEvent",function(e){this._style=e},{__name:"Publisher.ToolStyleChangedEvent",getName:function(){return this.__name},getStyle:function(){return this._style}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.ColourSchemeChangedEvent",function(e){this._colourScheme=e},{__name:"Publisher.ColourSchemeChangedEvent",getName:function(){return this.__name},getColourScheme:function(){return this._colourScheme}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.FontChangedEvent",function(e){this._font=e},{__name:"Publisher.FontChangedEvent",getName:function(){return this.__name},getFont:function(){return this._font}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.LayerToolsEditModeEvent",function(e){this._isInMode=e},{__name:"LayerToolsEditModeEvent",getName:function(){return this.__name},isInMode:function(){return this._isInMode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.NotLoggedIn",function(e,t){this.instance=e,this.template=jQuery("<div class='notLoggedIn'></div>"),this.loginTemplate=jQuery("<div class='notLoggedIn'><a></a></div>"),this.registerTemplate=jQuery("<div class='notLoggedIn'><a></a></div>"),this.loc=t},{render:function(e){var t=this,i=t.instance.conf,n=t.instance.getSandbox(),s=t.template.clone(),r=t.loginTemplate.clone(),a=null,o=t.registerTemplate.clone(),l=null,u=r.find("a"),h=o.find("a");i&&(a=n.getLocalizedProperty(i.loginUrl),l=n.getLocalizedProperty(i.registerUrl)),s.append(t.loc.text),e.append(s),a&&(u.attr("href",a),u.append(t.loc.signup),e.append(r)),l&&(h.attr("href",l),h.append(t.loc.register),e.append(o))}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.StartView",function(e,t){var i=this;i.instance=e,i.template=jQuery("<div class='startview'><div class='content'></div><div class='tou'><a href='JavaScript:void(0;)'></a></div><div class='buttons'></div></div>"),i.templateLayerList=jQuery("<div class='layerlist'><h4></h4><ul></ul></div>"),i.templateListItem=jQuery("<li></li>"),i.templateError=jQuery('<div class="error"><ul></ul></div>'),i.templateInfo=jQuery("<div class='icon-info'></div>"),i.loc=t,i.content=void 0,i.buttons={},i.hasAcceptedTou=!1
},{render:function(e){var t=this,i=t.template.clone();t.content=i,i.find("div.content").before(t.loc.text),e.append(i);var n=i.find("div.tou a");n.append(t.loc.touLink),n.bind("click",function(){return t._showTermsOfUse(),!1});var s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.addClass("primary"),s.setHandler(function(){t.hasAcceptedTou||t._markTouAccepted();var e=t.instance.getLayersWithoutPublishRights();t.instance.setPublishMode(!0,e)}),t.buttons["continue"]=s,t._updateContinueButton(),s.insertTo(i.find("div.buttons"));var r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(t.loc.buttons.cancel),r.setHandler(function(){t.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[t.instance,"close"])}),t.buttons.cancel=r,r.insertTo(i.find("div.buttons")),t._renderLayerLists(),t._checkTouAccepted()},_renderLayerLists:function(){var e,t,i,n,s,r=this,a=r.content.find("div.content"),o=[],l=[],u=r.instance.sandbox.findAllSelectedMapLayers();for(a.find("div.error").remove(),a.find("div.layerlist").remove(),e=0;e<u.length;++e)t=u[e],!r.instance.hasPublishRight(t)&&t.getId().toString().indexOf("myplaces_")<0?l.push(t):o.push(t);if(o.length>0){if(i=r._getRenderedLayerList(o),n=i.find("h4"),s="loc.layerlist_title",r.loc&&r.loc.layerlist_title&&(s=r.loc.layerlist_title),n.append(s),a.append(i),r.buttons["continue"].setEnabled(!0),l.length>0){var h=r._getRenderedLayerList(l);n=h.find("h4"),n.append(this.loc.layerlist_denied);var c=r.templateInfo.clone();c.attr("title",r.loc.denied_tooltip),n.before(c),a.append(h)}}else{var p=r.templateError.clone(),d=r.templateListItem.clone();d.append(r.loc.layerlist_empty),p.find("ul").append(d),a.append(p),r.buttons["continue"].setEnabled(!1)}},_getRenderedLayerList:function(e){var t,i,n,s=this.templateLayerList.clone(),r=s.find("ul");for(t=0;t<e.length;++t)i=e[t],n=this.templateListItem.clone(),i.getId().toString().indexOf("myplaces_")>-1?n.append(i.getName()+" ("+this.loc.myPlacesDisclaimer+")"):n.append(i.getName()),r.append(n);return s},handleLayerSelectionChanged:function(){this._renderLayerLists()},_showTermsOfUse:function(){var e=this;if(!e.termsOfUse){var t=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",e.instance.sandbox);return t.getHelpArticle("termsofuse, mappublication, "+Oskari.getLang(),function(t,i){t&&(e.termsOfUse=i,e._showTermsOfUse())}),void 0}var i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=i.createCloseButton(e.loc.buttons.close);i.show(e.termsOfUse.title,e.termsOfUse.body,[n])},_checkTouAccepted:function(){var e=this;jQuery.ajax({url:e.instance.sandbox.getAjaxUrl(),type:"GET",data:{action_route:"HasAcceptedPublishedTermsOfUse"},dataType:"json",error:function(){this.success(!1)},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){e.hasAcceptedTou=t,e._updateContinueButton()}})},_updateContinueButton:function(){this.buttons["continue"].setTitle(this.hasAcceptedTou?this.loc.buttons["continue"]:this.loc.buttons.continueAndAccept)},_markTouAccepted:function(){var e=this;jQuery.ajax({url:e.instance.sandbox.getAjaxUrl(),type:"GET",data:{action_route:"AcceptPublishedTermsOfUse"},dataType:"json",error:function(){this.success(!1)},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){e.hasAcceptedTou=t,e._updateContinueButton()}})}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.BasicPublisher",function(e,t,i){var n=this;if(n.data=i,n.instance=e,n.template=jQuery('<div class="basic_publisher"><div class="header"><div class="icon-close"></div><h3></h3></div><div class="content"></div></div>'),n.templates={publishedGridTemplate:'<div class="publishedgrid"></div>'},n.templateButtonsDiv=jQuery('<div class="buttons"></div>'),n.templateHelp=jQuery('<div class="help icon-info"></div>'),n.templateLayout=jQuery('<div class="tool "><label><input type="radio" name="toolLayout" /><span></span></label></div>'),n.templateData=jQuery('<div class="data "><input class="show-grid" type="checkbox"/><label class="show-grid-label"></label><br /><input class="allow-classification" type="checkbox"/><label class="allow-classification-label"></label></div>'),n.templateSizeOptionTool=jQuery('<div class="tool "><input type="radio" name="size" /><span></span></div>'),n.templateCustomSize=jQuery('<div class="customsize"><input type="text" name="width" placeholder="'+t.sizes.width+'"/> x '+'<input type="text" name="height" placeholder="'+t.sizes.height+'"/></div>'),this.normalMapPlugins=[],n.toolDropRules={"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin":{allowedLocations:["bottom left","bottom right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin","Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"],groupedSiblings:!1},"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin":{allowedLocations:["bottom left","bottom right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin","Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin"],groupedSiblings:!1},"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin":{allowedLocations:["bottom left","bottom right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin","Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"],groupedSiblings:!1},"Oskari.mapframework.bundle.mapmodule.plugin.PanButtons":{allowedLocations:["top left","top right","bottom left","bottom right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar"],groupedSiblings:!0},"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar":{allowedLocations:["top left","top right","bottom left","bottom right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.PanButtons"],groupedSiblings:!0},"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin":{allowedLocations:["top left","top center","top right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin","Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"],groupedSiblings:!1},"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin":{allowedLocations:["top left","top center","top right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin","Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"],groupedSiblings:!1},"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin":{allowedLocations:["top left","top center","top right"],allowedSiblings:["Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin","Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin"],groupedSiblings:!1}},n.logoPluginClasses={lefthanded:"bottom left",righthanded:"bottom right",classes:"bottom left"},n.layerSelectionClasses={lefthanded:"top right",righthanded:"top left",classes:"top right"},n.toolLayouts=["lefthanded","righthanded","userlayout"],n.activeToolLayout="lefthanded",n.sizeOptions=[{id:"small",width:580,height:387},{id:"medium",width:700,height:525,selected:!0},{id:"large",width:1240,height:700},{id:"custom",minWidth:30,minHeight:20,maxWidth:4e3,maxHeight:2e3}],n.grid={},n.grid.selected=!0,i){i.lang&&Oskari.setLang(i.lang),n.data.state.mapfull.config.layout&&(n.activeToolLayout=n.data.state.mapfull.config.layout);var s,r,a=!1,o=n.data.state.mapfull.config.size.width,l=n.data.state.mapfull.config.size.height;for(r=0;r<n.sizeOptions.length;r+=1)s=n.sizeOptions[r],o===s.width&&l===s.height?(s.selected=!0,a=!0):s.selected=!1;if(!a){var u=n.sizeOptions[n.sizeOptions.length-1];u.selected=!0,u.width=o,u.height=l}}n.loc=t,n.accordion=null,n.maplayerPanel=null,n.mainPanel=null,n.logoPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",{location:{classes:n.logoPluginClasses.classes}}),n.latestGFI=null,n.urlBase=e.conf.urlPrefix+"/web/"},{render:function(e){var t=this,i=t.template.clone();t.mainPanel=i,e.append(i);var n=i.find("div.content"),s=Oskari.clazz.create("Oskari.userinterface.component.Accordion");t.accordion=s;var r=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherLocationForm",t.loc,t);t.locationForm=r,t.data?(i.find("div.header h3").append(t.loc.titleEdit),r.init({domain:t.data.domain,name:t.data.name,lang:t.data.lang})):(i.find("div.header h3").append(t.loc.title),r.init());var a=r.getPanel();a.open(),s.addPanel(a);var o,l,u=t.instance.getSandbox(),h=u.findAllSelectedMapLayers(),c=!1;for(o=0;o<h.length;o+=1)l=h[o],"stats"===l.getLayerType()&&(c=!0);if(c){t.showStats=!0;var p=u.findRegisteredModuleInstance("MainMapModule");t.mapModule=p,t.statsContainer=jQuery(t.templates.publishedGridTemplate);var d=t._createDataPanel();d.open(),s.addPanel(d)}s.addPanel(t._createSizePanel()),s.addPanel(t._createToolsPanel()),s.addPanel(t._createToolLayoutPanel()),t.data&&t.data.hasLayerSelectionPlugin&&t.data.hasLayerSelectionPlugin.location&&(t.layerSelectionClasses.classes=t.data.hasLayerSelectionPlugin.location.classes),t.maplayerPanel=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherLayerForm",t.loc,t.instance,{location:{classes:t.layerSelectionClasses.classes}},t),t.maplayerPanel.init(),t.layoutPanel=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherLayoutForm",t.loc,t);var m=t._getInitialLayoutData(t.data);t.layoutPanel.init(m),s.addPanel(t.layoutPanel.getPanel()),s.addPanel(t.maplayerPanel.getPanel()),s.insertTo(n),e.find("div.header div.icon-close").bind("click",function(){t.instance.setPublishMode(!1)}),n.append(t._getButtons());var f=t.mainPanel.find("input[type=text]");f.focus(function(){t.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}),f.blur(function(){t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var y=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",t.instance.sandbox);y.processHelpLinks(t.loc.help,i,t.loc.error.title,t.loc.error.nohelp)},_setSelectedSize:function(){var e,t,i,n=this,s=this.mainPanel.find("div.customsize input[name=width]"),r=this.mainPanel.find("div.customsize input[name=height]"),a=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");for(s.removeClass("error"),r.removeClass("error"),e=0;e<n.sizeOptions.length;e+=1)if(t=n.sizeOptions[e],t.selected){if(i=jQuery(a.getMap().div),"custom"===t.id){var o=s.val();this._validateNumberRange(o,t.minWidth,t.maxWidth)?(i.width(o),n.adjustDataContainer()):s.addClass("error");var l=r.val();this._validateNumberRange(l,t.minHeight,t.maxHeight)?i.height(l):r.addClass("error");break}i.width(t.width),i.height(t.height),n.adjustDataContainer();break}a.updateSize()},_createSizePanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.size.label);var i=t.getContainer(),n=this.templateHelp.clone();n.attr("title",this.loc.size.tooltip),i.append(n);var s,r,a,o,l=function(t){return function(){var n;for(i.find("input[name=size]:checked").val(),n=0;n<e.sizeOptions.length;n+=1)e.sizeOptions[n].selected=!1;t.selected=!0,e._setSelectedSize()}},u=!1;for(s=0;s<this.sizeOptions.length;s+=1)r=this.sizeOptions[s],a=this.templateSizeOptionTool.clone(),o=this.loc.sizes[r.id],r.width&&r.height&&"custom"!==r.id&&(o=e._getSizeLabel(o,r)),a.find("span").addClass("sizeoption_"+r.id).append(o),r.selected&&(a.find("input").attr("checked","checked"),"custom"===r.id&&(u=!0)),i.append(a),a.find("input").attr("value",r.id),a.find("input").change(l(r));var h=this.templateCustomSize.clone(),c=h.find("input");if(c.focus(function(){var e=i.find("input[name=size][value=custom]");e.attr("checked","checked"),e.trigger("change")}),c.bind("keyup",function(){e._setSelectedSize()}),u){var p=h.find("input[name=width]"),d=h.find("input[name=height]");p.val(r.width),d.val(r.height)}return i.append(h),t},_getSizeLabel:function(e,t){var i=this.isDataVisible?this._calculateGridWidth():0;return e+" ("+(t.width+i)+" x "+t.height+"px)"},_setSizeLabels:function(){var e,t,i,n;for(e=0;e<this.sizeOptions.length;e+=1)t=this.sizeOptions[e],i=jQuery("span.sizeoption_"+t.id),n=this.loc.sizes[t.id],t.width&&t.height&&"custom"!==t.id&&(n=this._getSizeLabel(n,t)),i.text(n)},_createToolsPanel:function(){var e=this,t=null;if(e.data&&e.data.state&&e.data.state.mapfull&&e.data.state.mapfull.config&&e.data.state.mapfull.config.plugins){var i,n=e.data.state.mapfull.config.plugins;for(t={},i=0;i<n.length;i+=1)t[n[i].id]=!0,"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"===n[i].id&&(e.data.hasLayerSelectionPlugin=n[i].config)}return e.toolsPanel=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherToolsForm",e,t),e.toolsPanel.init(),e.toolsPanel.getPanel(e.data)},_changeToolLayout:function(e,t){var i,n,s,r,a=this,o=a.toolsPanel.getTools();if(a.activeToolLayout=e,"userlayout"!==e){for(a.toolLayoutEditMode&&a._editToolLayoutOff(),i=o.length-1;i>-1;i-=1)n=o[i],n[e]&&(n.config||(n.config={}),n.config.location||(n.config.location={}),n.config.location.classes=n[e],n.plugin&&n.plugin.setLocation&&n.plugin.setLocation(n.config.location.classes));a.logoPluginClasses.classes=a.logoPluginClasses[e],a.logoPlugin&&a.logoPlugin.setLocation(a.logoPluginClasses.classes),a.layerSelectionClasses.classes=a.layerSelectionClasses[e],a.maplayerPanel.plugin.setLocation(a.layerSelectionClasses.classes),t&&(s=jQuery(t.currentTarget),r=s.parents(".content").find("input#editModeBtn"),r.prop("disabled",!0),r.addClass("disabled-button"),a._editToolLayoutOff())}else t&&(s=jQuery(t.currentTarget),r=s.parents(".tool").find("input#editModeBtn"),r.prop("disabled",!1),r.removeClass("disabled-button"),a._editToolLayoutOn())},_createToolLayoutPanel:function(){var e,t,i,n=this,s=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),r=s.getContainer(),a=n.templateHelp.clone(),o=function(e){this.checked&&n._changeToolLayout(this.value,e)};for(s.setTitle(this.loc.toollayout.label),a.attr("title",this.loc.toollayout.tooltip),r.append(a),e=0;e<n.toolLayouts.length;e+=1)if(i=n.templateLayout.clone(),t=i.find("input"),t.val(n.toolLayouts[e]).change(o),n.activeToolLayout?n.toolLayouts[e]===n.activeToolLayout&&t.attr("checked","checked"):0===e&&t.attr("checked","checked"),i.find("span").html(this.loc.toollayout[n.toolLayouts[e]]||n.toolLayouts[e]),r.append(i),"userlayout"===n.toolLayouts[e]){var l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.setTitle(n.loc.toollayout.usereditmode),l.setHandler(function(){jQuery(l.getButton()).val()===n.loc.toollayout.usereditmodeoff?n._editToolLayoutOff():n._editToolLayoutOn()}),l.setEnabled("userlayout"===n.activeToolLayout),l.getButton().attr("id","editModeBtn"),l.insertTo(i)}return s},_makeDraggable:function(e){var t=this;return e.draggable({appendTo:".mappluginsContent",drag:function(){},snap:!0,start:function(e,i){t._showDroppable(i.helper.attr("data-clazz"),i.helper.parents(".mapplugins"))},stop:t._hideDroppable,revert:"invalid"})},_togglePluginUIControls:function(e){var t,i,n;for(t=0;t<this.tools.length;t++)i=n[t],i.plugin&&i.plugin.toggleUIControls&&i.plugin.toggleUIControls(e)},_editToolLayoutOn:function(){var e=this,t=Oskari.getSandbox("sandbox");e.toolLayoutEditMode=!0,jQuery("#editModeBtn").val(e.loc.toollayout.usereditmodeoff),jQuery(".mapplugin").addClass("toollayoutedit"),e._makeDraggable(jQuery(".mapplugin")),jQuery(".mappluginsContent").droppable({drop:function(t,i){var n=i.draggable.attr("data-clazz"),s=e._getPluginByClazz(n),r=i.draggable.parents(".mapplugins"),a=jQuery(this);e._moveSiblings(n,r,a),s&&s.setLocation&&(s.setLocation(jQuery(this).parents(".mapplugins").attr("data-location")),s.element.css({top:"0px",left:"0px"})),e._hideDroppable()},hoverClass:"ui-state-highlight",tolerance:"pointer"});var i=t.getEventBuilder("LayerToolsEditModeEvent")(!0);t.notifyAll(i);var n=e.toolsPanel.getToolById("Oskari.mapframework.mapmodule.ControlsPlugin");n&&(e.isMapControlActive=n&&n.selected,e.toolsPanel.activatePreviewPlugin(n,!1))},_editToolLayoutOff:function(){var e=this,t=Oskari.getSandbox("sandbox");e.toolLayoutEditMode=!1,jQuery("#editModeBtn").val(e.loc.toollayout.usereditmode),jQuery(".mapplugin").removeClass("toollayoutedit");var i=jQuery(".mapplugin.ui-draggable");i.css("position",""),i.draggable("destroy"),jQuery(".mappluginsContent.ui-droppable").droppable("destroy");var n=t.getEventBuilder("LayerToolsEditModeEvent")(!1);t.notifyAll(n),e.logoPlugin&&(e.logoPluginClasses.classes=e.logoPlugin.element.parents(".mapplugins").attr("data-location"),e.logoPlugin.element.css("position","")),e.maplayerPanel.plugin&&e.maplayerPanel.plugin.element&&(e.layerSelectionClasses.classes=e.maplayerPanel.plugin.element.parents(".mapplugins").attr("data-location"),e.maplayerPanel.plugin.element.css("position",""));var s=e.toolsPanel.getToolById("Oskari.mapframework.mapmodule.ControlsPlugin");s&&(e.toolsPanel.activatePreviewPlugin(s,e.isMapControlActive),delete e.isMapControlActive)},_createDataPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(e.loc.data.label);var i=t.getContainer(),n=e.templateHelp.clone();n.attr("title",e.loc.data.tooltip),i.append(n);var s=e.templateData.clone();return s.find("input.show-grid").attr("id","show-grid-checkbox").change(function(t){var i=jQuery(t.target),n=i.is(":checked");e.isDataVisible=n,e.adjustDataContainer(),e._setSizeLabels()}),s.find("label.show-grid-label").attr("for","show-grid-checkbox").append(e.loc.data.grid),s.find("input.allow-classification").attr("id","allow-classification-checkbox").change(function(t){var i=jQuery(t.target),n=i.is(":checked");e.classifyPlugin.showClassificationOptions(n)}),s.find("label.allow-classification-label").attr("for","allow-classification-checkbox").append(e.loc.data.allowClassification),e.grid.selected&&(s.find("input#show-grid-checkbox").attr("checked","checked"),e.isDataVisible=e.grid.selected,e.adjustDataContainer()),i.append(s),t},adjustDataContainer:function(){if(this.statsContainer){var e=this,t=jQuery("#contentMap"),i=t.width(),n=t.css("margin-left").split("px")[0],s=(jQuery(window).width()-n-40,jQuery("#mapdiv").width()),r=jQuery("#mapdiv").height(),a=e._calculateGridWidth(),o=r,l=jQuery(".oskariui-left"),u=jQuery(".oskariui-center");e.isDataVisible?(a>400&&(a=400),l.removeClass("oskari-closed"),jQuery("#contentMap").width(a+s),a+="px",o+="px",s+="px"):(l.addClass("oskari-closed"),jQuery("#contentMap").width(""),a="0px",o="0px",i="100%"),l.css({width:a,height:o,"float":"left"}).addClass("published-grid-left"),u.css({width:s,"float":"left"}).addClass("published-grid-center"),e.statsContainer.height(r),e.gridPlugin&&e.gridPlugin.setGridHeight()}},_calculateGridWidth:function(){var e,t=Oskari.getSandbox("sandbox"),i=t.getStatefulComponents().statsgrid;if(i&&i.state&&null!==i.state.indicators&&void 0!==i.state.indicators){var n=i.state.indicators.length+2;e=80*n}else e=160;return e+20},getDataContainer:function(){return jQuery(".oskariui-left")},addDataGrid:function(e){this.getDataContainer.html(e)},handleMapMoved:function(){var e=this.instance.sandbox.getMap();e.getX(),e.getY(),e.getZoom()},_getButtons:function(){var e=this,t=e.templateButtonsDiv.clone(),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(e.loc.buttons.cancel),i.setHandler(function(){e._editToolLayoutOff(),e.instance.setPublishMode(!1)}),i.insertTo(t);var n=Oskari.clazz.create("Oskari.userinterface.component.Button");if(n.setTitle(e.loc.buttons.save),n.addClass("primary"),e.data){var s=function(){e._editToolLayoutOff();var t=e._gatherSelections();t&&e._publishMap(t)};n.setTitle(e.loc.buttons.saveNew),n.setHandler(function(){e.data.id=null,delete e.data.id,s()}),n.insertTo(t);var r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(e.loc.buttons.replace),r.addClass("primary"),r.setHandler(function(){e._showReplaceConfirm(s)}),r.insertTo(t)}else n.setTitle(e.loc.buttons.save),n.setHandler(function(){e._editToolLayoutOff();var t=e._gatherSelections();t&&e._publishMap(t)}),n.insertTo(t);return t},_showReplaceConfirm:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(this.loc.buttons.replace),i.addClass("primary"),i.setHandler(function(){t.close(),e()});var n=t.createCloseButton(this.loc.buttons.cancel);t.show(this.loc.confirm.replace.title,this.loc.confirm.replace.msg,[n,i])},_showValidationErrorMessage:function(e){var t,i,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=n.createCloseButton(this.loc.buttons.ok),r=jQuery("<ul></ul>");for(t=0;t<e.length;t+=1)i=jQuery("<li></li>"),i.append(e[t].error),r.append(i);n.show(this.loc.error.title,r,[s])},_gatherSelections:function(){var e,t,i=this,n=i.mainPanel,s=i.instance.getSandbox(),r=i.locationForm.validate(),a=i.locationForm.getValues(),o=n.find("input[name=size]:checked").val(),l=(i._calculateGridWidth(),{domain:a.domain,name:a.name,language:a.language,plugins:[]});if(i.data&&i.data.id&&(l.id=i.data.id),l.layout=i.activeToolLayout,i.toolsPanel.addValues(l),"custom"===o){var u=n.find("div.customsize input[name=width]").val(),h=n.find("div.customsize input[name=height]").val();i._validateSize(u,h)?l.size={width:u,height:h}:r.push({field:"size",error:this.loc.error.size})}else for(e=0;e<i.sizeOptions.length;e+=1)if(t=i.sizeOptions[e],t.id===o){l.size={width:t.width,height:t.height};break}var c=i.maplayerPanel.getValues();if(c.layerSelection&&(c.layerSelection.location={classes:i.layerSelectionClasses.classes},l.plugins.push(c.layerSelection),l.defaultBase=c.defaultBase,l.baseLayers=c.baseLayers),l.plugins.push({id:"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",config:{location:{classes:i.logoPluginClasses.classes}}}),i.showStats){var p=i.gridPlugin.getState();p=i._filterIndicators(_.clone(p,!0)),p.gridShown=i.isDataVisible,l.gridState=p}var d=s.getStatefulComponents().mapfull.getState();return l.mapstate=d,s.getStatefulComponents().infobox&&(l.infobox=s.getStatefulComponents().infobox.getState()),r.length>0?(i._showValidationErrorMessage(r),void 0):l},_publishMap:function(e){var t=this,i=t.instance.getSandbox(),n=i.getAjaxUrl(),s=t.isDataVisible?e.size.width+t._calculateGridWidth():e.size.width,r=function(){var e=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=e.createCloseButton(t.loc.buttons.ok);e.show(t.loc.error.title,t.loc.error.saveFailed,[i])};jQuery.ajax({url:n+"&action_route=Publish",type:"POST",dataType:"json",data:{pubdata:JSON.stringify(e)},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){if(t.id>0){var n=i.getEventBuilder("Publisher.MapPublishedEvent")(t.id,s,e.size.height,e.language);i.notifyAll(n)}else r()},error:r})},_validateNumberRange:function(e,t,i){var n=!0;return isNaN(parseInt(e,10))?n=!1:isFinite(e)?(t>e||e>i)&&(n=!1):n=!1,n},_validateSize:function(e,t){var i,n,s=null;for(i=0;i<this.sizeOptions.length;i+=1)if(n=this.sizeOptions[i],"custom"===n.id){s=n;break}var r=this._validateNumberRange(e,s.minWidth,s.maxWidth)&&this._validateNumberRange(t,s.minHeight,s.maxHeight);return r},setEnabled:function(e){e?this._enablePreview():this._disablePreview()},_enablePreview:function(){var e,t,i,n=this,s=n.instance.sandbox.findRegisteredModuleInstance("MainMapModule"),r=s.getPluginInstances(),a=n.toolsPanel.getTools();for(e in r)r.hasOwnProperty(e)&&(t=r[e],t.hasUI&&t.hasUI()&&(t.stopPlugin(n.instance.sandbox),s.unregisterPlugin(t),n.normalMapPlugins.push(t)));for(n.maplayerPanel.start(),n.data&&n.data.hasLayerSelectionPlugin&&n.maplayerPanel.useConfig(n.data.hasLayerSelectionPlugin),n._setSelectedSize(),i=0;i<a.length;i+=1)a[i].selected&&n.toolsPanel.activatePreviewPlugin(a[i],!0);s.registerPlugin(n.logoPlugin),this.logoPlugin.startPlugin(n.instance.sandbox)},_disablePreview:function(){var e,t,i=this,n=i.toolsPanel.getTools(),s=i.instance.sandbox.findRegisteredModuleInstance("MainMapModule");for(s.getPluginInstances(),t=0;t<n.length;t+=1)n[t].plugin&&(i.toolsPanel.activatePreviewPlugin(n[t],!1),s.unregisterPlugin(n[t].plugin),n[t].plugin=void 0,delete n[t].plugin);i.maplayerPanel.stop(),i.layoutPanel.stop();var r=jQuery(s.getMap().div);for(r.width(""),r.height(jQuery(window).height()),s.updateSize(),s.unregisterPlugin(i.logoPlugin),i.logoPlugin.stopPlugin(i.instance.sandbox),t=0;t<i.normalMapPlugins.length;t+=1)e=i.normalMapPlugins[t],s.registerPlugin(e),e.startPlugin(i.instance.sandbox);i.normalMapPlugins=[]},destroy:function(){this.mainPanel.remove()},setPluginLanguage:function(e){Oskari.setLang(e);var t,i;for(t=0;t<this.tools.length;t+=1)i=this.tools[t],i._isPluginStarted&&(this.toolsPanel.activatePreviewPlugin(i,!1),this.toolsPanel.activatePreviewPlugin(i,!0));this._resetLayerSelectionPlugin(),this.logoPlugin.stopPlugin(this.instance.sandbox),this.logoPlugin.startPlugin(this.instance.sandbox)},_resetLayerSelectionPlugin:function(){if(this.maplayerPanel.isEnabled()){var e=this.maplayerPanel.plugin.getBaseLayers();this.maplayerPanel.enablePlugin(!1),this.maplayerPanel.enablePlugin(!0);var t,i,n=e.baseLayers,s=e.defaultBaseLayer;for(t=0;t<n.length;t+=1)i=this.instance.sandbox.findMapLayerFromSelectedMapLayers(n[t]),this.maplayerPanel.plugin.addBaseLayer(i);this.maplayerPanel.plugin.selectBaseLayer(s)}},initGrid:function(e){var t,i=this,n=(i.conf,Oskari.getLocalization("StatsGrid")),s=!0,r="sandbox",a=Oskari.getSandbox(r);i.sandbox=a,a.register(i.instance);var o=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.StatisticsService",i);a.registerService(o),i.statsService=o;var l=i.sandbox.getStatefulComponents().statsgrid;if(l&&l.state&&s){t=i._filterIndicators(_.clone(l.state,!0));var u={published:!0,layer:e,state:t},h=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.plugin.ManageStatsPlugin",u,n);i.mapModule.registerPlugin(h),i.mapModule.startPlugin(h),i.gridPlugin=h,u.state.allowClassification=!1;var c=Oskari.clazz.create("Oskari.statistics.bundle.statsgrid.plugin.ManageClassificationPlugin",u,n);i.mapModule.registerPlugin(c),i.mapModule.startPlugin(c),i.classifyPlugin=c;var p=i.getDataContainer();p.html(i.statsContainer),i.gridPlugin.createStatsOut(i.statsContainer)}},_filterIndicators:function(e){return e.indicators=_.filter(e.indicators,function(e){return!e.ownIndicator||e.ownIndicator&&e.public}),e},changeToolStyles:function(e){if(e){var t,i,n,s=this,r=s.toolsPanel.getTools();for("default"===e.val&&(e.val=null),i=0;i<r.length;i+=1)n=r[i],n.id.indexOf("Portti2Zoombar")>=0?(t=e.zoombar||{},t.val=e.val):n.id.indexOf("SearchPlugin")>=0?(t=e.search||{},t.val=e.val):t=e.val,n.config&&(n.config.toolStyle=t),n._isPluginStarted&&n.plugin.changeToolStyle&&n.plugin.changeToolStyle(t),n.id.indexOf("PublisherToolbarPlugin")>=0&&s.toolsPanel.toolbarConfig&&s.toolsPanel.toolbarConfig.classes&&(s.toolsPanel.toolbarConfig.classes=n.plugin.getToolConfs());s._setLayerSelectionStyle(e.val),s.toolLayoutEditMode&&s._makeDraggable(jQuery(".mapplugin"))}},_setLayerSelectionStyle:function(e){var t=this.maplayerPanel;t.pluginConfig.toolStyle=e,t.isEnabled()&&t.plugin.changeToolStyle&&t.plugin.changeToolStyle(e)},changeColourScheme:function(e){var t=this._getGetInfoPlugin(),i=this.maplayerPanel;t&&(t.config=t.config||{},t.config.colourScheme=e),i.pluginConfig.colourScheme=e,i.isEnabled()&&i.plugin.changeColourScheme&&i.plugin.changeColourScheme(e)},changeFont:function(e){if(e){var t,i,n=this,s=n.toolsPanel.getTools();for(t=0;t<s.length;t+=1)i=s[t],i.config&&(i.config.font=e),i._isPluginStarted&&i.plugin.changeFont&&i.plugin.changeFont(e);n._setLayerSelectionFont(e),n.logoPlugin&&n.logoPlugin.changeFont&&n.logoPlugin.changeFont(e);var r=n._getGetInfoPlugin();r&&(r.config=r.config||{},r.config.font=e)}},_setLayerSelectionFont:function(e){var t=this.maplayerPanel;t.pluginConfig.font=e,t.isEnabled()&&t.plugin.changeFont&&t.plugin.changeFont(e)},_getGetInfoPlugin:function(){return this.toolsPanel.getToolById("Oskari.mapframework.mapmodule.GetInfoPlugin")},_getPreferredPluginLocation:function(e,t){var i=this,n=t,s="div.mapplugins."+n.split(" ").join(".");if(null===n||0===this._siblingsAllowed(e.getClazz(),null,jQuery(s))){var r=i.toolDropRules[e.getClazz()].allowedLocations;jQuery(jQuery("div.mapplugins").get().reverse()).each(function(){var t=jQuery(this),s=i._locationAllowed(r,t);return s&&2===i._siblingsAllowed(e.getClazz(),null,t)?(n=s,!1):void 0})}return n},_getInitialPluginLocation:function(e,t){var i,n,s=this.data.state.mapfull.config.plugins;for(n=0;n<s.length;n++)if(i=s[n],i.id===t&&i.config&&i.config.location)return i.config.location.classes;return null},_getInitialLayoutData:function(e){if(!e)return null;var t,i,n=e.state.mapfull.config.plugins,s=n.length,r={};for(t=0;s>t;t+=1)i=n[t],i.config&&(i.config.font&&(r.font=i.config.font),i.config.colourScheme&&(r.colourScheme=i.config.colourScheme),i.config.toolStyle&&(r.toolStyle="string"==typeof i.config.toolStyle?i.config.toolStyle:i.config.toolStyle.val));return r},_getPluginByClazz:function(e){var t,i=this,n=null;return t=i.toolsPanel.getToolById(e),t&&t.plugin?n=t.plugin:"Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"===e?n=i.logoPlugin:"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin"===e&&(n=i.maplayerPanel.plugin),n},_getActivePlugins:function(e){var t,i=[];return jQuery(".mapplugins .mapplugin").each(function(){t=jQuery(this).attr("data-clazz"),jQuery.inArray(t,e)>-1&&i.push(t)}),i},_getDraggedPlugins:function(e){var t=[];return this.toolDropRules[e].groupedSiblings&&(t=this._getActivePlugins(this.toolDropRules[e].allowedSiblings)),t.push(e),t},_getDropzonePlugins:function(e){var t,i=[];return e.find(".mapplugin").each(function(){t=jQuery(this).attr("data-clazz"),t&&i.push(t)}),i},_locationAllowed:function(e,t){var i,n;if(!e||!t)return!1;for(n=0;n<e.length;n++)if(i=t.is("."+e[n].split(" ").join(".")))return e[n];return null},_moveSiblings:function(e,t,i){var n,s=this,r=this._getDropzonePlugins(i);for(n=0;n<r.length;n++)jQuery.inArray(r[n],s.toolDropRules[e].allowedSiblings)<0&&s._getPluginByClazz(r[n]).setLocation(t.attr("data-location"))},_siblingsAllowed:function(e,t,i,n){var s,r=this,a=this._getDropzonePlugins(i),o=2;for(s=0;s<a.length;s++)if((!n||a[s]!==n)&&jQuery.inArray(a[s],r.toolDropRules[e].allowedSiblings)<0&&e!==a[s]){if(!t||!r._locationAllowed(this.toolDropRules[a[s]].allowedLocations,t)||2!=r._siblingsAllowed(a[s],null,t,e)){o=0;break}o=1}return o},_showDroppable:function(e,t){var i,n,s=this;e&&jQuery("div.mapplugins").each(function(){n=jQuery(this),i=s._locationAllowed(s.toolDropRules[e].allowedLocations,n),i?(i=s._siblingsAllowed(e,t,n),i?n.find(".mappluginsContent").addClass("allowed").droppable("enable"):n.find(".mappluginsContent").addClass("disallowed").droppable("disable")):n.find(".mappluginsContent").addClass("disallowed").droppable("disable")})},_hideDroppable:function(){jQuery("div.mapplugins .mappluginsContent").removeClass("allowed").removeClass("disallowed")}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherLocationForm",function(e,t){this.loc=e,this._publisher=t,this.fields={domain:{label:e.domain.label,placeholder:e.domain.placeholder,helptags:"portti,help,publisher,domain",tooltip:e.domain.tooltip},name:{label:e.name.label,placeholder:e.name.placeholder,helptags:"portti,help,publisher,name",tooltip:e.name.tooltip}},this.langField={template:jQuery('<div class="field"><div class="help icon-info" title="'+e.language.tooltip+'" helptags="portti,help,publisher,language"></div>'+'<label for="language">'+e.language.label+'</label><br clear="all" />'+'<select name="language"></select>'+"</div>"),optionTemplate:jQuery("<option></option>")}},{init:function(e){var t,i,n,s=this;for(t in this.fields)this.fields.hasOwnProperty(t)&&(i=this.fields[t],n=Oskari.clazz.create("Oskari.userinterface.component.FormInput",t),n.getField().find("input").before("<br />"),n.setLabel(i.label),n.setTooltip(i.tooltip,i.helptags),n.setPlaceholder(i.placeholder),i.field=n);
this.fields.domain.field.setRequired(!0,this.loc.error.domain),this.fields.domain.field.setContentCheck(!0,this.loc.error.domainIllegalCharacters),this.fields.domain.field.setValidator(function(e){var t=e.getValue(),i=e.getName(),n=[];return 0===t.indexOf("http")||0===t.indexOf("www")?(n.push({field:i,error:s.loc.error.domainStart}),n):n}),this.fields.name.field.setRequired(!0,this.loc.error.name),this.fields.name.field.setContentCheck(!0,this.loc.error.nameIllegalCharacters),e&&(this.fields.domain.field.setValue(e.domain),this.fields.name.field.setValue(e.name));var r,a,o=this.langField.template.clone(),l=o.find("select[name=language]"),u=this.loc.language.options,h=Oskari.getLang();e&&e.lang&&(h=e.lang);for(r in u)u.hasOwnProperty(r)&&(a=this.langField.optionTemplate.clone(),a.attr("value",r),h===r&&a.attr("selected","selected"),a.append(u[r]),l.append(a));l.change(function(){s._publisher.setPluginLanguage(jQuery(this).attr("value"))}),this.langField.field=o},getPanel:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");e.setTitle(this.loc.domain.title);var t,i,n=e.getContainer();for(t in this.fields)this.fields.hasOwnProperty(t)&&(i=this.fields[t],n.append(i.field.getField()));return n.append(this.langField.field),e},getValues:function(){var e,t,i={};for(e in this.fields)this.fields.hasOwnProperty(e)&&(t=this.fields[e],i[e]=t.field.getValue());return i.language=this.langField.field.find("select[name=language]").val(),i},validate:function(){var e,t,i=[];for(e in this.fields)this.fields.hasOwnProperty(e)&&(t=this.fields[e],i=i.concat(t.field.validate()));return i}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherToolsForm",function(e,t){if(this.instance=e.instance,this.loc=e.loc,this._publisher=e,this._sandbox=null,this.myplaces=[],this.selectedDrawingLayer={layer:null},this.toolbarConfig={myplaces:{point:!1,line:!1,area:!1}},this.tools=[{id:"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",selected:!1,lefthanded:"bottom left",righthanded:"bottom right",config:{location:{top:"",right:"",bottom:"",left:"",classes:"bottom left"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",selected:!1,lefthanded:"bottom right",righthanded:"bottom left",config:{location:{top:"",right:"",bottom:"",left:"",classes:"bottom right"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",selected:!1,lefthanded:"top left",righthanded:"top right",config:{location:{top:"",right:"",bottom:"",left:"",classes:"top left"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",selected:!0,lefthanded:"top left",righthanded:"top right",config:{location:{top:"",right:"",bottom:"",left:"",classes:"top left"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",selected:!1,lefthanded:"top right",righthanded:"top left",config:{location:{top:"",right:"",bottom:"",left:"",classes:"top right"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.PublisherToolbarPlugin",selected:!1,lefthanded:"top right",righthanded:"top left",config:{location:{top:"",right:"",bottom:"",left:"",classes:"top right"},toolbarId:"PublisherToolbar"}},{id:"Oskari.mapframework.mapmodule.ControlsPlugin",selected:!0},{id:"Oskari.mapframework.mapmodule.GetInfoPlugin",selected:!0,config:{ignoredLayerTypes:["WFS"],infoBox:!1}}],t){var i,n;for(i=0;i<this.tools.length;i++)n=this.tools[i],n.selected=!!t[n.id]}this.buttonGroups=[{name:"history",buttons:{history_back:{iconCls:"tool-history-back-dark",prepend:!0,disabled:!0,callback:function(){}},history_forward:{iconCls:"tool-history-forward-dark",disabled:!0,callback:function(){}}}},{name:"basictools",buttons:{measureline:{iconCls:"tool-measure-line-dark",disabled:!0,sticky:!0,callback:function(){}},measurearea:{iconCls:"tool-measure-area-dark",disabled:!0,sticky:!0,callback:function(){}}}},{name:"myplaces",buttons:{point:{iconCls:"myplaces-draw-point",disabled:!0,sticky:!0,callback:function(){}},line:{iconCls:"myplaces-draw-line",disabled:!0,sticky:!0,callback:function(){}},area:{iconCls:"myplaces-draw-area",disabled:!0,sticky:!0,callback:function(){}}}}],this.templates={help:'<div class="help icon-info"></div>',tool:'<div class="tool "><label><input type="checkbox"/></label></div>',toolOptions:'<div class="tool-options"></div>',toolOption:'<div class="tool-option"><label><input type="checkbox" /></label></div>',toolOptionSettings:'<div class="tool-option-settings"></div>',toolOptionSetting:'<div class="tool-option-setting"></div>',toolOptionSettingInput:'<label><input type="checkbox" /></label>',layerSelect:'<select class="publisher-select-layer"></select>',layerSelectOption:"<option></option>"}},{init:function(){var e=this,t=e._publisher.instance.getSandbox(),i=t.getService("Oskari.mapframework.service.MapLayerService"),n=i.getLayersOfType("myplaces");e.myplaces=n,e._sandbox=t},getTools:function(){return this.tools},getPanel:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");i.setTitle(this.loc.tools.label);var n,s,r,a,o=i.getContainer(),l=jQuery(t.templates.help).clone();l.attr("title",this.loc.tools.tooltip),o.append(l);var u=function(e){return function(){var i=jQuery(this),n=i.is(":checked");e.selected=n,t.activatePreviewPlugin(e,n)}};for(t._toolIndices={},n=0;n<this.tools.length;n+=1){s=jQuery(this.templates.tool).clone();var h=this.tools[n];if(r=h.id,t._toolIndices[r]=n,r=r.substring(r.lastIndexOf(".")+1),a=this.loc.tools[r],s.find("label").attr("for","tool-"+r).append(a),h.selected&&s.find("input").attr("checked","checked"),h.publisherPluginContainer=s,o.append(s),e){var c=this._publisher._getInitialPluginLocation(e,this.tools[n].id);c&&(this.tools[n].config.location.classes=c)}s.find("input").attr("id","tool-"+r).change(u(h))}return i},getToolById:function(e){var t=this._toolIndices[e],i=null;return null!==t&&void 0!==t&&(i=this.tools[t]),i},addValues:function(e){var t,i,n,s=this,r=s.toolbarConfig,a=s._sandbox.findAllSelectedMapLayers();if(r){var o=!1;for(t in r)if(r.hasOwnProperty(t)){for(i in r[t])if(r[t].hasOwnProperty(i)&&r[t][i]){o=!0;break}if(o)break}o&&(e.toolbar=r)}for(t=0;t<s.tools.length;t+=1)if(s.tools[t].selected){if(n={id:s.tools[t].id},s.tools[t].config&&(n.config=s.tools[t].config,n.config.location))if(n.config.location.classes){var l=n.config.location.classes;n.config.location={classes:l}}else n.config.location={};e.plugins.push(n)}if(s.toolbarConfig.myplaces.point===!0||s.toolbarConfig.myplaces.line===!0||s.toolbarConfig.myplaces.area===!0){var u=!1;for(t=0;t<a.length;t++)a[t].getId()===s.selectedDrawingLayer.layer.getId()&&(u=!0);u||s._sandbox.postRequestByName("AddMapLayerRequest",[s.selectedDrawingLayer.layer.getId(),!1,s.selectedDrawingLayer.layer.isBaseLayer()]),e.publishedmyplaces2=s.selectedDrawingLayer}return e},validate:function(){var e=[];return e},activatePreviewPlugin:function(e,t){var i=this,n=i._sandbox;if(!e.plugin&&t){var s=n.findRegisteredModuleInstance("MainMapModule");e.plugin=Oskari.clazz.create(e.id,e.config),s.registerPlugin(e.plugin)}if(e.plugin){e.config&&e.config.location&&e.plugin.setLocation(this._publisher._getPreferredPluginLocation(e.plugin,e.config.location.classes));var r,a,o,l,u,h,c=function(t,s,r){return function(){var a,o=jQuery(this),l=o.is(":checked");e.selected=l;var u=e.plugin;l?(a=n.getRequestBuilder("Toolbar.AddToolButtonRequest"),n.request(u,a(t,s,r)),i.toolbarConfig[s]||(i.toolbarConfig[s]={}),i.toolbarConfig[s][t]=!0):(a=n.getRequestBuilder("Toolbar.RemoveToolButtonRequest"),n.request(u,a(t,s,r.toolbarid)),i.toolbarConfig[s]&&delete i.toolbarConfig[s][t])}};if(t){if(e.plugin.startPlugin(n),i._publisher.toolLayoutEditMode&&e.plugin.element&&i._publisher._makeDraggable(e.plugin.element),e._isPluginStarted=!0,e.id.indexOf("PublisherToolbarPlugin")>=0){i.toolbarConfig={toolbarId:"PublisherToolbar",defaultToolbarContainer:".publishedToolbarContent",hasContentContainer:!0,classes:{}},e.plugin.setToolbarContainer(),i.toolbarConfig.classes=e.plugin.getToolConfs();var p=function(e,t,n){var s,r,a,o,l;for(s=0,r=i.buttonGroups.length;r>s;s++)if(e===i.buttonGroups[s].name){a=i.buttonGroups[s];break}for(o in a.buttons)a.buttons.hasOwnProperty(o)&&(l=a.buttons[o],l.toolbarid=n.toolbarId,l.selectTool=jQuery(i.templates.toolOption).clone(),l.selectTool.find("label").attr("for","tool-opt-"+o).append(i.loc.toolbarToolNames[o]),l.selected&&l.selectTool.find("input").attr("checked","checked"),l.selectTool.find("input").attr("id","tool-opt-"+o).change(c(o,a.name,l)),t.append(l.selectTool));return t};if(r=jQuery(i.templates.toolOptions).clone(),r=p("history",r,i.toolbarConfig,c),r=p("basictools",r,i.toolbarConfig,c),e.publisherPluginContainer.append(r),i._sandbox.getUser().hasRole(i.instance.conf.drawRoleIds)){r=jQuery(i.templates.toolOptions).clone(),e.publisherPluginContainer.append(r);var d=jQuery(i.templates.toolOption).clone();d.find("label").attr("for","tool-opt-drawing").append(this.loc.toolbarToolNames.drawTools),d.find("input").attr("id","tool-opt-drawing").change(function(e){i._toggleDrawTools(e,"drawTools","myplaces",i.toolbarConfig,c)}),r.append(d)}}}else if(e.id.indexOf("PublisherToolbarPlugin")>=0&&(i.toolbarConfig={}),e._isPluginStarted){if(toolOptions=e.plugin.getToolOptions?e.plugin.getToolOptions():null){for(a in toolOptions)if(toolOptions.hasOwnProperty(a)){o=toolOptions[a];for(l in o.buttons)o.buttons.hasOwnProperty(l)&&(u=o.buttons[l],h=n.getRequestBuilder("Toolbar.RemoveToolButtonRequest"),n.request(e.plugin,h(l,o.name,u.toolbarid)))}var m=e.publisherPluginContainer.find(".tool-options"),f=m.find("input").off("change",i._toggleToolOption);f.remove(),m.remove()}e._isPluginStarted=!1,e.plugin.stopPlugin(n)}}},_toggleDrawTools:function(e,t,i,n,s){var r,a,o,l=this,u=jQuery(e.target),h=u.is(":checked"),c=l.myplaces;if(h){var p,d,m=jQuery(l.templates.layerSelect).clone();for(a=0;a<c.length;a++)p=jQuery(l.templates.layerSelectOption).clone(),p.attr("value",c[a].getId()).append(c[a].getName()),null!==l.selectedDrawingLayer.layer&&void 0!==l.selectedDrawingLayer.layer&&c[a].getId()===l.selectedDrawingLayer.layer.getId()&&p.prop("selected",!0),m.append(p);(null===l.selectedDrawingLayer.layer||void 0===l.selectedDrawingLayer.layer)&&(l.selectedDrawingLayer.layer=c[0]),m.change(function(e){var t,i=jQuery(e.target),n=i.val();for(t=0;t<c.length;t++)c[t].getId()===n&&(l.selectedDrawingLayer.layer=c[t])});var f=jQuery(l.templates.toolOptionSettings).clone(),y=jQuery(l.templates.toolOptionSetting).clone();for(d=l._getAddLayerButton(),y.append("<span>"+l.loc.tools.selectDrawLayer+"</span><br/>"),y.append(m),d.insertTo(y),f.append(y),a=0,o=this.buttonGroups.length;o>a;a++)if(i===this.buttonGroups[a].name){r=this.buttonGroups[a];break}for(t in r.buttons)r.buttons.hasOwnProperty(t)&&(toolButton=r.buttons[t],toolButton.toolbarid=n.toolbarId,toolButton.toolOption=jQuery(l.templates.toolOptionSetting).clone(),toolButton.toolOption.append(jQuery(l.templates.toolOptionSettingInput).clone()),toolButton.toolOption.find("label").attr("for","option-"+t).append(this.loc.toolbarToolNames[t]),toolButton.toolOption.find("input").attr("id","option-"+t).change(s(t,r.name,toolButton)),f.append(toolButton.toolOption));u.parent().parent().append(f)}else u.parent().parent().find(".tool-option-settings").remove()},_getAddLayerButton:function(){var e,t=this;return e=Oskari.clazz.create("Oskari.userinterface.component.Button"),e.setTitle(this.loc.layers.add),e.setHandler(function(){console.log("Send OpenAddLayerDialogEvent");var e=t._sandbox.getRequestBuilder("MyPlaces.OpenAddLayerDialogRequest")(".publisher-select-layer","right");t._sandbox.request(t.instance,e)}),e}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherLayerForm",function(e,t,i,n){var s=this;s.loc=e,s.instance=t,s._publisher=n,s.panel=null,s.plugin=null,s.isDataVisible=!1,s.templateHelp=jQuery('<div class="help icon-info"></div>'),s.templateTool=jQuery('<div class="tool"><input type="checkbox"/><label></label></div>'),s.templateList=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'></ul>'),s.templateLayer=jQuery('<li class="layer selected"><div class="layer-info"><div class="layer-tool-remove icon-close"></div><div class="layer-title"><h4></h4></div></div><div class="layer-tools volatile"></div></li>');var r=s.instance.getLocalization("layer");s.templateLayerFooterTools=jQuery('<div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+r.hide+"</a>"+"&nbsp;"+'<span class="temphidden" '+'style="display: none;">'+r.hidden+"</span>"+"</div>"+'<div class="oskariui layer-opacity">'+'<div class="layout-slider" id="layout-slider">'+"</div> "+'<div class="opacity-slider" style="display:inline-block">'+'<input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%</div>'+'</div> <br/><input class="baselayer" type="checkbox"/><label>'+r.selectAsBaselayer+"</label>"+"</div>"+'<div class="right-tools">'+'<div class="layer-rights"></div>'+'<div class="object-data"></div>'+'<div class="layer-description">'+"</div></div>"),s.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+r.show+"</a> "+r.hidden+"</p>"),s.templateButtonsDiv=jQuery('<div class="buttons"></div>'),s.config={layers:{promote:[{text:s.loc.layerselection.promote,id:[24]}],preselect:["base_35"]}},s.pluginConfig=i,s.pluginConfig||(s.pluginConfig={}),s.showLayerSelection=!1,s._sliders={}},{init:function(){this.panel||(this.panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),this.panel.setTitle(this.loc.layers.label)),this.plugin=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",this.pluginConfig)},useConfig:function(e){e&&(this.config.layers.preselect="[object Array]"===Object.prototype.toString.call(e.baseLayers)&&e.baseLayers.length>0?e.baseLayers:[],this.showLayerSelection=!0,this.enablePlugin(!0),this._populateMapLayerPanel())},getPanel:function(){return this._populateMapLayerPanel(),this.panel},enablePlugin:function(e){e?(this.plugin.setLocation(this._publisher._getPreferredPluginLocation(this.plugin,this.plugin.conf.location.classes)),this.plugin.startPlugin(this.instance.sandbox),this._publisher.toolLayoutEditMode&&this.plugin.element&&this._publisher._makeDraggable(this.plugin.element)):this.isEnabled()&&this.plugin.stopPlugin(this.instance.sandbox)},isEnabled:function(){return this.showLayerSelection},start:function(){this.plugin=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",this.pluginConfig);var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");e.registerPlugin(this.plugin),this.showLayerSelection&&this.enablePlugin(!0)},stop:function(){this.enablePlugin(!1);var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");e.unregisterPlugin(this.plugin)},getValues:function(){var e={};if(this.showLayerSelection){e.layerSelection={id:"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",config:this.pluginConfig};var t=this.plugin.getBaseLayers();t.defaultBaseLayer&&(e.layerSelection.config.baseLayers=t.baseLayers,e.layerSelection.config.defaultBaseLayer=t.defaultBaseLayer)}return e},validate:function(){var e=[];return e},_getLayersList:function(){var e=this.instance.sandbox.findAllSelectedMapLayers();return e},_populateMapLayerPanel:function(){var e=this,t=this.instance.getSandbox(),i=this.panel.getContainer();i.empty(),e.container=i;var n=this.templateHelp.clone();n.attr("title",this.loc.layerselection.tooltip),i.append(n);var s=this.templateTool.clone();if(s.find("label").attr("for","show-map-layers-checkbox").append(this.loc.layerselection.label),this.showLayerSelection&&s.find("input").attr("checked","checked"),i.append(s),i.append(this.loc.layerselection.info),s.find("input").attr("id","show-map-layers-checkbox").change(function(){var t=jQuery(this),n=t.is(":checked");e.enablePlugin(n),e.showLayerSelection=n,i.empty(),e._populateMapLayerPanel()}),this.showLayerSelection){var r,a,o,l=this._getLayersList(),u=this.templateList.clone(),h=function(t){var i=jQuery.inArray(""+t,e.config.layers.preselect);return-1!==i};for(r=0;r<l.length;r++){a=l[r];var c=this.templateLayer.clone();c.attr("data-id",a.getId()),c.find("div.layer-title h4").append(a.getName()),c.find("div.layer-title").append(a.getDescription()),a.isSticky()||(c.find("div.layer-tool-remove").addClass("icon-close"),c.find("div.layer-tool-remove").bind("click",function(i){var n="RemoveMapLayerRequest",s=t.getRequestBuilder(n),r=s(jQuery(i.currentTarget).parents(".layer").attr("data-id")),o=jQuery(i.currentTarget).parents(".layer").find(".baselayer"),l=o.is(":checked");a.selected=l,l&&e.plugin.removeBaseLayer(a),t.request(e.instance.getName(),r)})),e._appendLayerFooter(c,a,a.selected),o=c.find("input.baselayer"),o.attr("id","checkbox"+a.getId()),h(a.getId())&&(o.attr("checked","checked"),a.selected=!0,this.plugin.addBaseLayer(a)),u.prepend(c)}i.append(u),u.sortable({stop:function(t,i){var n=i.item;e._layerOrderChanged(n)}});var p=e.templateButtonsDiv.clone(),d=Oskari.clazz.create("Oskari.userinterface.component.Button");d.setTitle(e.loc.buttons.add),d.addClass("block"),d.insertTo(p);var m=function(){e._openExtension("LayerSelector")};d.setHandler(function(){m()}),i.append(p)}},_populateLayerPromotion:function(e){var t,i,n,s,r,a,o,l=this,u=this.instance.getSandbox(),h=u.getRequestBuilder("AddMapLayerRequest"),c=u.getRequestBuilder("RemoveMapLayerRequest"),p=function(e){return function(){var t=jQuery(this),i=t.is(":checked");i?(u.request(l.instance,h(e.getId(),!0)),l.plugin.addBaseLayer(e)):u.request(l.instance,c(e.getId()))}};for(t=0;t<this.config.layers.promote.length;t+=1)if(i=this.config.layers.promote[t],n=this._getActualPromotionLayers(i.id),n.length>0)for(e.append(i.text),s=0;s<n.length;s+=1)r=n[s],a=this.templateTool.clone(),a.attr("data-id",r.getId()),a.find("label").attr("for","checkbox"+r.getId()).append(r.getName()),o=a.find("input"),o.attr("id","checkbox"+r.getId()),o.change(p(r)),e.append(a)},_getActualPromotionLayers:function(e){var t,i,n=this.instance.getSandbox(),s=[];for(t=0;t<e.length;t+=1)n.isLayerAlreadySelected(e[t])||(i=n.findMapLayerFromAllAvailable(e[t]),i&&s.push(i));return s},handleLayerSelectionChanged:function(){this._populateMapLayerPanel()},_layerOrderChanged:function(e){var t=jQuery(this.container).find(".selectedLayersList li"),i=e.attr("data-id"),n=-1;if(t.each(function(e){return $(this).attr("data-id")===i?(n=e,!1):!0}),n>-1){n=t.length-1-n;var s=this.instance.getSandbox(),r="RearrangeSelectedMapLayerRequest",a=s.getRequestBuilder(r),o=a(i,n);s.request(this.instance.getName(),o)}},_layerOpacityChanged:function(e,t){var i=this.instance.getSandbox(),n="ChangeMapLayerOpacityRequest",s=i.getRequestBuilder(n),r=s(e.getId(),t);i.request(this.instance.getName(),r);var a="li.layer.selected[data-id="+e.getId()+"]",o=jQuery(this.container).find(a),l=o.find("div.layer-opacity input.opacity");l.attr("value",e.getOpacity())},handleLayerVisibilityChanged:function(e){var t=this,i=(t.instance.getSandbox(),"li.layer.selected[data-id="+e.getId()+"]"),n=jQuery(this.container).find(i),s=(this.instance.getLocalization("layer"),n.find("div.layer-tools")),r=s.find(".baselayer").is(":checked");s.empty(),n.removeClass("hidden-layer"),this._sliders[e.getId()]=null,this._appendLayerFooter(n,e,r)},_createLayerFooter:function(e,t,i){var n=this,s=n.instance.getSandbox(),r=this.templateLayerFooterTools.clone(),a=(this.instance.getLocalization("layer"),"MapModulePlugin.MapLayerVisibilityRequest"),o=s.getRequestBuilder(a);r.find("div.layer-visibility a").bind("click",function(){var t=o(e.getId(),!1);return s.request(n.instance.getName(),t),!1});var l=function(e){return function(){var t=jQuery(this),i=t.is(":checked");e.selected=i,i?n.plugin.addBaseLayer(e):n.plugin.removeBaseLayer(e)}},u=r.find("input.baselayer");return u.attr("id","checkbox"+e.getId()),i&&u.attr("checked","checked"),u.change(l(e)),r},_createLayerFooterHidden:function(e){var t=this,i=t.instance.getSandbox(),n=this.templateLayerFooterHidden.clone(),s="MapModulePlugin.MapLayerVisibilityRequest",r=i.getRequestBuilder(s);return n.addClass("layer-msg-for-hidden"),n.find("a").bind("click",function(){var n=r(e.getId(),!0);return i.request(t.instance.getName(),n),!1}),n},_appendLayerFooter:function(e,t,i){var n=e.find("div.layer-tools"),s=this._createLayerFooter(t,e,i);t.isVisible()?s.css("display",""):(n.addClass("hidden-layer"),s.find(".layer-visibility").css("display","none"),jQuery(jQuery(s).get(0)).prepend(this._createLayerFooterHidden(t))),n.append(s);var r=(this._addSlider(t,e),e.find("div.layer-opacity input.opacity"));r.attr("value",t.getOpacity())},_addSlider:function(e,t){var i=this,n=e.getId(),s=e.getOpacity(),r=t.find(".layout-slider"),a=r.slider({min:0,max:100,value:s,slide:function(t,n){i._layerOpacityChanged(e,n.value)},stop:function(t,n){i._layerOpacityChanged(e,n.value)}});return i._sliders[n]=a,a},_getFakeExtension:function(e){return{getName:function(){return e}}},_openExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.instance.getSandbox().postRequestByName(i,[t,"attach",i,"10","405"])}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherLayoutForm",function(e,t){this.loc=e,this._publisher=t,this._sandbox=t.instance.sandbox,this._colourSchemePopup=null,this._customColoursPopup=null,this.template={};var i;for(i in this.__templates)this.__templates.hasOwnProperty(i)&&(this.template[i]=jQuery(this.__templates[i]));this.values=null,this.initialValues={colours:[{val:"light_grey",bgColour:"#EFF2F2",titleColour:"#333438",headerColour:"#333438",iconCls:"icon-close"},{val:"dark_grey",bgColour:"#424343",titleColour:"#FFFFFF",headerColour:"#424343",iconCls:"icon-close-white"},{val:"blue",bgColour:"#0091FF",titleColour:"#FFFFFF",headerColour:"#0091FF",iconCls:"icon-close-white"},{val:"red",bgColour:"#FF3333",titleColour:"#FFFFFF",headerColour:"#FF3333",iconCls:"icon-close-white"},{val:"green",bgColour:"#26BF4C",titleColour:"#FFFFFF",headerColour:"#48732E",iconCls:"icon-close-white"},{val:"yellow",bgColour:"#FFDE00",titleColour:"#333438",headerColour:"#333438",iconCls:"icon-close"},{val:"custom",bgColour:null,titleColour:null,headerColour:null,iconCls:"icon-close-white"}],fonts:[{name:"Arial (sans-serif)",val:"arial"},{name:"Georgia (serif)",val:"georgia"}],toolStyles:[{val:"default",zoombar:{},search:{}},{val:"rounded-dark",zoombar:{widthPlus:"22px",widthMinus:"22px",widthCenter:"22px",heightPlus:"38px",heightMinus:"39px",heightCenter:12,heightCursor:"18px",widthCursor:"17px"},search:{widthLeft:17,widthRight:32}},{val:"rounded-light",zoombar:{widthPlus:"22px",widthMinus:"22px",widthCenter:"22px",heightPlus:"38px",heightMinus:"39px",heightCenter:12,heightCursor:"18px",widthCursor:"17px"},search:{widthLeft:17,widthRight:32}},{val:"sharp-dark",zoombar:{widthPlus:"23px",widthMinus:"23px",widthCenter:"23px",heightPlus:"17px",heightMinus:"18px",heightCenter:16,heightCursor:"16px",widthCursor:"23px"},search:{widthLeft:5,widthRight:30}},{val:"sharp-light",zoombar:{widthPlus:"23px",widthMinus:"23px",widthCenter:"23px",heightPlus:"17px",heightMinus:"18px",heightCenter:16,heightCursor:"16px",widthCursor:"23px"},search:{widthLeft:5,widthRight:30}},{val:"3d-dark",zoombar:{widthPlus:"23px",widthMinus:"23px",widthCenter:"23px",heightPlus:"35px",heightMinus:"36px",heightCenter:13,heightCursor:"13px",widthCursor:"23px"},search:{widthLeft:5,widthRight:44}},{val:"3d-light",zoombar:{widthPlus:"23px",widthMinus:"23px",widthCenter:"23px",heightPlus:"35px",heightMinus:"36px",heightCenter:13,heightCursor:"13px",widthCursor:"23px"},search:{widthLeft:5,widthRight:44}}]},this.fields={colours:{label:this.loc.layout.fields.colours.label,getContent:this._getColoursTemplate},fonts:{label:this.loc.layout.fields.fonts.label,getContent:this._getFontsTemplate},toolStyles:{label:this.loc.layout.fields.toolStyles.label,getContent:this._getToolStylesTemplate}},this.customColourValues={bg:null,title:null,header:null,iconCsl:null},this.maxColourValue=255,this.minColourValue=0},{__templates:{colours:'<div id="publisher-layout-colours"><label for="publisher-colours"></label><div id="publisher-layout-coloursSelector"><input type="text" name="publisher-colour" disabled /><button id="publisher-colours"></button></div></div>',fonts:'<div id="publisher-layout-fonts"><label for="publisher-fonts"></label><select name="publisher-fonts"></select></div>',toolStyles:'<div id="publisher-layout-toolStyles"><label for="publisher-toolStyles"></label><select name="publisher-toolStyles"></select></div>',option:"<option></option>",inputRadio:'<div><input type="radio" /><label></label></div>',coloursPopup:'<div id="publisher-colour-popup"><div id="publisher-colour-inputs"></div><div id="publisher-colour-preview"></div></div>',customClrs:'<div id="publisher-custom-colours"><div id="publisher-custom-colours-bg"></div><div id="publisher-custom-colours-title"></div><div id="publisher-custom-colours-header"></div><div id="publisher-custom-colours-iconcls"></div></div>',rgbInput:'<div class="rgbInput"><label for="red">R</label><input type="text" name="red" maxlength="3" /><label for="green">G</label><input type="text" name="green" maxlength="3" /><label for="blue">B</label><input type="text" name="blue" maxlength="3" /></div>',iconClsInput:'<div class="iconClsInput"><input type="radio" name="custom-icon-class" value="icon-close" /><label for="icon-close"></label><input type="radio" name="custom-icon-class" value="icon-close-white" /><label for="icon-close-white"></label></div>'},init:function(e){var t,i,n,s=this,r=e||{};this.values={colourScheme:r.colourScheme,font:r.font,toolStyle:r.toolStyle};for(t in this.fields)this.fields.hasOwnProperty(t)&&(i=this.fields[t],n=i.getContent.apply(s,arguments),i.content=n);null!==e&&void 0!==e&&(this._sendFontChangedEvent(this.values.font),this._sendColourSchemeChangedEvent(this.values.colourScheme),this._sendToolStyleChangedEvent(this._getItemByCode(this.values.toolStyle,this.initialValues.toolStyles)))},stop:function(){this._closePopups()},getPanel:function(){var e,t,i=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),n=i.getContainer();i.setTitle(this.loc.layout.label);for(e in this.fields)this.fields.hasOwnProperty(e)&&(t=this.fields[e],n.append(t.content));return i},getValues:function(){var e=jQuery("input[name=publisher-colour]").attr("data-colour-code");this.values.colourScheme=this._getItemByCode(e,this.initialValues.colours),this.values.font=jQuery("select[name=publisher-fonts]").val();var t=jQuery("select[name=publisher-toolStyles]").val();return this.values.toolStyle=this._getItemByCode(t,this.initialValues.toolStyles),this.values},_closePopups:function(){this._colourSchemePopup&&this._colourSchemePopup.close(!0),this._customColoursPopup&&this._customColoursPopup.close(!0),this._colourSchemePopup=null,this._customColoursPopup=null},_getColoursTemplate:function(){var e=this,t=this.template.colours.clone(),i=this.values.colourScheme||{},n=this.loc.layout.fields.colours[i.val],s=this.loc.layout.fields.colours.label,r=this.loc.layout.fields.colours.placeholder,a=this.loc.layout.fields.colours.buttonLabel;return t.find("label").html(s),t.find("button").html(a).on("click",function(){e._openColourDialog(jQuery(this))}),t.find("input[name=publisher-colour]").attr("placeholder",r).val(n),t},_getFontsTemplate:function(){var e,t,i,n=this,s=this.template.fonts.clone(),r=this.loc.layout.fields.fonts.label,a=this.initialValues.fonts,o=a.length;for(s.find("label").html(r).after("<br />"),t=0;o>t;++t)e=this.template.option.clone(),e.attr({value:a[t].val}).html(a[t].name),s.find("select").append(e);return s.find("select").on("change",function(){i=jQuery(this).val(),n._sendFontChangedEvent(i)}),jQuery(s.find("select option")).filter(function(){return jQuery(this).val()===n.values.font}).prop("selected","selected"),s},_getToolStylesTemplate:function(){var e,t,i,n,s,r=this,a=this.template.toolStyles.clone(),o=this.loc.layout.fields.toolStyles.label,l=this.initialValues.toolStyles,u=l.length;for(a.find("label").html(o).after("<br />"),i=0;u>i;++i)e=this.template.option.clone(),t=this.loc.layout.fields.toolStyles[l[i].val],e.attr({value:l[i].val}).html(t),a.find("select").append(e);return a.find("select").on("change",function(){n=jQuery(this).val(),s=r._getItemByCode(n,r.initialValues.toolStyles),r._sendToolStyleChangedEvent(s)}),jQuery(a.find("select option")).filter(function(){return r.values.toolStyle&&jQuery(this).val()===r.values.toolStyle}).prop("selected","selected"),a},_openColourDialog:function(){var e,t,i,n,s,r,a=this,o=Oskari.clazz.create("Oskari.userinterface.component.Popup"),l=Oskari.clazz.create("Oskari.userinterface.component.Button"),u=this.loc.layout.popup.title,h=this.template.coloursPopup.clone(),c=this.initialValues.colours,p=c.length;for(l.setTitle(this.loc.layout.popup.close),l.setHandler(function(){o.close(!0),a._colourSchemePopup=null}),h.find("div#publisher-colour-preview").append(a._createGfiPreview()),i=0;p>i;++i)e=this.template.inputRadio.clone(),t=this.loc.layout.fields.colours[c[i].val],e.find("input[type=radio]").attr({id:c[i].val,name:"colour",value:c[i].val}),e.find("label").html(t).attr({"for":c[i].val}),n=a.values.colourScheme,(n&&n.val===c[i].val||!n&&"dark_grey"===c[i].val)&&(e.find("input[type=radio]").attr("checked","checked"),a._changeGfiColours(c[i],h)),h.find("div#publisher-colour-inputs").append(e),"custom"===c[i].val&&(r=jQuery("<button>"+this.loc.layout.fields.colours.buttonLabel+"</button>"),r.click(function(){e.find("input[type=radio]").attr("checked","checked"),a._createCustomColoursPopup()}),h.find("div#publisher-colour-inputs").append(r));h.find("input[name=colour]").change(function(){s=a._getItemByCode(jQuery(this).val(),a.initialValues.colours),a._changeGfiColours(s,h),t=a.loc.layout.fields.colours[s.val],jQuery("div.basic_publisher").find("input[name=publisher-colour]").val(t).attr("data-colour-code",s.val),a._sendColourSchemeChangedEvent(s)}),o.show(u,h,[l]),this._colourSchemePopup=o},_createCustomColoursPopup:function(){var e,t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button"),s=this.loc.layout.fields.colours.custom,r=this._createCustomColoursInputs(),a=jQuery("div#publisher-colour-inputs input#custom").attr("checked");n.setTitle(this.loc.layout.popup.close),n.setHandler(function(){t._collectCustomColourValues(r),a&&(e=t._getItemByCode("custom",t.initialValues.colours),t._changeGfiColours(e),t._sendColourSchemeChangedEvent(e)),i.close(!0),t._customColoursPopup=null}),i.show(s,r,[n]),this._customColoursPopup=i},_createCustomColoursInputs:function(){var e,t=this,i=this.template.customClrs.clone(),n=this.template.rgbInput.clone(),s=this.loc.layout.fields.colours.customLabels.bgLabel,r=this.template.rgbInput.clone(),a=this.loc.layout.fields.colours.customLabels.titleLabel,o=this.template.rgbInput.clone(),l=this.loc.layout.fields.colours.customLabels.headerLabel,u=this.template.iconClsInput.clone(),h=this.loc.layout.fields.colours.customLabels.iconLabel,c=this.loc.layout.fields.colours.customLabels.iconCloseLabel,p=this.loc.layout.fields.colours.customLabels.iconCloseWhiteLabel;return u.find("label[for=icon-close]").html(c),u.find("label[for=icon-close-white]").html(p),i.find("div#publisher-custom-colours-bg").append(s).append(n),i.find("div#publisher-custom-colours-title").append(a).append(r),i.find("div#publisher-custom-colours-header").append(l).append(o),i.find("div#publisher-custom-colours-iconcls").append(h).append(u),this._prepopulateCustomColoursTemplate(i),i.find("input[type=text]").change(function(){e=jQuery(this).val(),isNaN(e)||e<t.minColourValue?jQuery(this).val(t.minColourValue):e>t.maxColourValue&&jQuery(this).val(t.maxColourValue)}),i},_prepopulateCustomColoursTemplate:function(e){var t=e.find("div#publisher-custom-colours-bg"),i=e.find("div#publisher-custom-colours-title"),n=e.find("div#publisher-custom-colours-header"),s=e.find("div#publisher-custom-colours-iconcls"),r=this.customColourValues;
this._prepopulateRgbDiv(t,r.bg),this._prepopulateRgbDiv(i,r.title),this._prepopulateRgbDiv(n,r.header),s.find("input[type=radio]").removeAttr("checked"),s.find("input[value="+r.iconCls+"]").attr("checked","checked")},_collectCustomColourValues:function(e){var t=this._getColourFromRgbDiv(e.find("div#publisher-custom-colours-bg")),i=this._getColourFromRgbDiv(e.find("div#publisher-custom-colours-title")),n=this._getColourFromRgbDiv(e.find("div#publisher-custom-colours-header")),s=e.find("div#publisher-custom-colours-iconcls input[name=custom-icon-class]:checked").val(),r=this._getItemByCode("custom",this.initialValues.colours);this.customColourValues.bg=t,this.customColourValues.title=i,this.customColourValues.header=n,this.customColourValues.iconCls=s,r.bgColour=this._getCssRgb(t),r.titleColour=this._getCssRgb(i),r.headerColour=this._getCssRgb(n),r.iconCls=s},_prepopulateRgbDiv:function(e,t){t&&(e.find("input[name=red]").val(t.red),e.find("input[name=green]").val(t.green),e.find("input[name=blue]").val(t.blue))},_getColourFromRgbDiv:function(e){var t=e.find("input[name=red]").val(),i=e.find("input[name=green]").val(),n=e.find("input[name=blue]").val();return{red:t,green:i,blue:n}},_getCssRgb:function(e){return"rgb("+e.red+", "+e.green+", "+e.blue+")"},_createGfiPreview:function(){var e=this.loc.layout.popup.gfiDialog.title,t=this.loc.layout.popup.gfiDialog.featureName,i=this.loc.layout.popup.gfiDialog.featureDesc,n=this._publisher.urlBase+Oskari.getLang(),s=jQuery("<div></div>"),r=jQuery('<div class="popupTitle"></div>'),a=jQuery('<div class="popupHeader"></div>'),o=jQuery('<div class="olPopupCloseBox icon-close-white" style="position: absolute; top: 12px;"></div>'),l=jQuery('<div class="popupContent"></div>'),u=jQuery('<div class="contentWrapper"></div>'),h=(jQuery('<span class="infoboxActionLinks"><a href="#"></a></span>'),jQuery('<span class="infoboxActionLinks"><input type="button" /></span>'),jQuery('<div class="infoboxLine">separator</div>'),jQuery('<div class="myplaces_wrapper"><div class="myplaces_place"><h3 class="myplaces_header"></h3><p class="myplaces_desc"></p><img class="myplaces_img"></img><a class="myplaces_link"></a></div></div>'));return r.append(e),a.append(r),a.append(o),a.css({width:"320px"}),h.find("h3.myplaces_header").html(t),h.find("p.myplaces_desc").html(i),h.find("a.myplaces_link").html(n).attr("href",n),l.append(h),l.css({"margin-left":"0px",height:"120px"}),u.append(l),u.css({width:"320px"}),s.append(a).append(u),s},_changeGfiColours:function(e,t){t=t||jQuery("div#publisher-colour-popup");var i=t.find("div.popupHeader"),n=t.find("div.popupTitle"),s=t.find("h3.myplaces_header"),r=t.find("div.olPopupCloseBox");i.css({"background-color":e.bgColour}),n.css({color:e.titleColour}),s.css({color:e.headerColour}),r.removeClass("icon-close-white"),r.removeClass("icon-close"),r.addClass(e.iconCls)},_sendColourSchemeChangedEvent:function(e){this._sendEvent("Publisher.ColourSchemeChangedEvent",e)},_sendFontChangedEvent:function(e){this._sendEvent("Publisher.FontChangedEvent",e)},_sendToolStyleChangedEvent:function(e){this._sendEvent("Publisher.ToolStyleChangedEvent",e||{val:"default",zoombar:{},search:{}})},_sendEvent:function(e,t){var i,n=this._sandbox.getEventBuilder(e);n&&(i=n(t),this._sandbox.notifyAll(i))},_getItemByCode:function(e,t){var i,n=t.length;for(i=0;n>i;++i)if(t[i].val===e)return t[i];return null}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.request.PublishMapEditorRequest",function(e){this._viewData=e},{__name:"Publisher.PublishMapEditorRequest",getName:function(){return this.__name},getEditMap:function(){return this._viewData}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.request.PublishMapEditorRequestHandler",function(e){this.instance=e},{handleRequest:function(e,t){this.instance.publishId=t.getEditMap().id,this.instance.setPublishMode(!0,this.instance.getLayersWithoutPublishRights(),t.getEditMap()),this._showEditNotification()},_showEditNotification:function(){var e=this.instance.getLocalization("edit"),t=Oskari.clazz.create("Oskari.userinterface.component.Popup");t.show(e.popup.title,e.popup.msg),t.fadeout()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/plugin/CoordinatesPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/coordinatedisplay/css/coordinatedisplay.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"coordinatedisplay","Bundle-Name":"coordinatedisplay","Bundle-Author":[{Name:"ah",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("coordinatedisplay","Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance",function(){this.sandbox=null,this.started=!1,this._localization=null},{__name:"coordinatedisplay",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.setSandbox(n);var s=n.findRegisteredModuleInstance("MainMapModule");t={};var r=this.getLocalization("display"),a=Oskari.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",t,r);s.registerPlugin(a),s.startPlugin(a),this.plugin=a}},stop:function(){this.sandbox=null,this.started=!1}},{protocol:["Oskari.bundle.BundleInstance"]}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",function(e,t){this._conf=e,this._locale=t,this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._elements={},this.__templates={}},{__name:"CoordinatesPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.__templates.latlondiv=jQuery('<div class="mapplugin coordinates"> <div class="cbSpansWrapper"> <div class="cbRow">  <div class="cbCrsLabel"></div> </div> <div class="cbRow">  <div class="cbLabel cbLabelN" axis="lat"></div>  <div class="cbValue" axis="lat"></div> </div>  <br clear="both"> <div class="cbRow">  <div class="cbLabel cbLabelE" axis="lon"></div>  <div class="cbValue" axis="lon"></div> </div> </div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){var t;this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._createUI();for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);this._elements.display&&(this._elements.display.remove(),delete this._elements.display),e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},_createUI:function(){var e=this,t=(e._sandbox,jQuery(e._map.div),e._elements.display),i="top right",n=4;e._elements.display||(t=e._elements.display=e.__templates.latlondiv.clone());var s=e._map.getProjection(),r=e._locale.crs[s];t.find(".cbCrsLabel").html(r),t.find(".cbLabelN").html(e._locale.compass.N),t.find(".cbLabelE").html(e._locale.compass.E),t.mousedown(function(e){e.stopPropagation()}),e.conf&&e.conf.location&&(i=e.conf.location.classes||i,n=e.conf.location.position||n),e.getMapModule().setMapControlPlugin(t,i,n),e.update(),t.show()},update:function(e){if(!e||!e.latlon){var t=this._sandbox.getMap();e={latlon:{lat:Math.floor(t.getY()),lon:Math.floor(t.getX())}}}var i=this,n=e.latlon,s=i._elements.display,r=s.find('.cbValue[axis="lat"]'),a=s.find('.cbValue[axis="lon"]');r&&a&&(r.text(Math.floor(n.lat)),a.text(Math.floor(n.lon)))},eventHandlers:{MouseHoverEvent:function(e){this.update({latlon:{lat:Math.floor(e.getLat()),lon:Math.floor(e.getLon())}})},AfterMapMoveEvent:function(){this.update()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];return t?t.apply(this,[e]):void 0}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/service/UserGuideService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Flyout.js"},{type:"text/css",src:"../../../../resources/framework/bundle/userguide/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"userguide","Bundle-Name":"userguide","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"userguide",Title:"userguide"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("userguide","Oskari.mapframework.bundle.userguide.UserGuideBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.ui=null,this._requestHandlers={},this.attachedToDefault=!1,this.helper=null,this.isContentLoaded=!1},{templates:{userguide:'<div class="oskari-userguide"><span class="oskari-prompt"></span><br /></div>'},__name:"userinterface.UserGuide",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,this._localization=Oskari.getLocalization(this.getName());var s,r=this.getLocalization("title"),a=Oskari.clazz.create("Oskari.userinterface.component.Popover",r,"");this.ui=a,a.setContent($(this.templates.userguide)),n.register(e);for(s in e.eventHandlers)e.eventHandlers.hasOwnProperty(s)&&n.registerForEventByName(e,s);this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",n,this),n.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var o=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,o),e.createUi();var l=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",n);this.helper=l}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()===t.getName()){var i="close"!==e.getViewState();t.displayContent(i)}}},displayContent:function(e){var t=this;if(e&&!t.isContentLoaded){var i="help.contentPart";t.getLocalization("help")&&t.getLocalization("help").contentPart&&(i=t.getLocalization("help").contentPart);var n="help.tags";this.getLocalization("help")&&this.getLocalization("help").tags&&(n=this.getLocalization("help").tags),this.helper.getHelpArticle(n,function(e,n){var s=n,r="error.generic";t.getLocalization("error")&&t.getLocalization("error").generic&&(r=t.getLocalization("error").generic),e?s[i]&&(s=s[i]):s=r,t.plugins["Oskari.userinterface.Flyout"].setContent(s),t.isContentLoaded=!0})}},toggleUserInterface:function(e){var t=this,i=this.ui;if(e){if(!t.attachedToDefault){var n=t.plugins["Oskari.userinterface.Tile"].getEl();i.setPlacement("right"),i.attachTo(n),t.attachedToDefault=!0}i.show()}else i.hide()},scheduleShowUserGuide:function(e){var t=this,i=t.ui,n=e.isToggle();if(n&&i.shown)return t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"close"]),void 0;t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"attach"]);var s=jQuery(this.templates.userguide),r=jQuery("<div />"),a=Oskari.getLang(),o=r.clone(),l=e.getContent();l?s.append(l):(o.append("Lang: "+a),s.append(o),o=r.clone(),o.append("Extension: "+e.getExtension()),s.append(o),o=r.clone(),o.append("Context: "+e.getContext()),s.append(o),o=r.clone(),o.append("Element: "+(e.getEl()?"YES":"NO")),s.append(o));var u=e.getEl(),h=e.getPlacement();h&&i.setPlacement(h),u?(i.hide(),t.attachedToDefault=!1,i.attachTo(u)):t.attachedToDefault||(u=t.plugins["Oskari.userinterface.Tile"].getEl(),i.attachTo(u),t.attachedToDefault=!0),i.setContent(s)},stop:function(){var e,t=this.sandbox();for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);t.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Tile",this,this.getLocalization("tile"))},stopExtension:function(){this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].setContent("")}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(e){var t=e||{};this._creator=null,this._el=t.el,this._context=t.context,this._extension=t.extension,this._toggle=t.toggle,this._placement=t.placement,this._content=t.content},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+t.getUuid()),this.instance.scheduleShowUserGuide(t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Tile"},setEl:function(e){this.container=jQuery(e),this.container.children(".oskari-tile-status")},getEl:function(){return this.container},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.desciption},getOptions:function(){},refresh:function(){var e=this,t=e.instance;this.container,this.template,t.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("userguide")||jQuery(this.container).addClass("userguide")},startPlugin:function(){this.template=jQuery('<div class="userguide"></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},setContent:function(e){var t=this;t.instance.getSandbox();var i=jQuery(this.container);i.empty();var n=this.template.clone();n.append(e),i.append(n)}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance")},start:function(){},stop:function(){},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/instance.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/service/MetadataLoader.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/view/MetadataPage.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/Tile.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequest.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/plugin/MetadataLayerPlugin.js"},{type:"text/css",src:"../../../../resources/catalogue/bundle/metadataflyout/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/fi.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/en.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/sv.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"metadataflyout","Bundle-Name":"catalogue.bundle.metadataflyout","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012",End:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("metadataflyout","Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundle"),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance",function(){this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.started=!1,this.plugins={},this._locale=null,this._requestHandlers={},this.loader=null,this.layerPlugin=null,this.layer=null},{__name:"catalogue.bundle.metadataflyout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocale:function(){return this._locale},getLoader:function(){return this.loader},layerSpec:{text:"",name:"Metadata",wmsName:"1",type:"vectorlayer",styles:{title:"Trains",legend:"",name:"1"},descriptionLink:"",orgName:"Metadata",inspire:"Metadata",legendImage:"",info:"",isQueryable:!0,formats:{value:"text/html"},id:"catalogue_metadataflyout_layer",minScale:36e6,maxScale:1,style:"",dataUrl:"",wmsUrl:"x",opacity:60,checked:"false",styledLayerDescriptor:'<StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"     xmlns="http://www.opengis.net/sld"     xmlns:ogc="http://www.opengis.net/ogc"     xmlns:xlink="http://www.w3.org/1999/xlink"     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">   <NamedLayer>     <Name>Simple point with stroke</Name>    <UserStyle><Title>GeoServer SLD Cook Book: Simple point with stroke</Title>     <FeatureTypeStyle><Rule><PolygonSymbolizer> <Graphic><Mark><WellKnownName>circle</WellKnownName><Fill>        <CssParameter name="fill">#000040</CssParameter>       </Fill><Stroke>          <CssParameter name="stroke">#000040</CssParameter>           <CssParameter name="stroke-width">2</CssParameter>          </Stroke></Mark><Size>12</Size></Graphic>     </PolygonSymbolizer><TextSymbolizer><Label><ogc:PropertyName>title</ogc:PropertyName></Label><Fill><CssParameter name="fill">#000000</CssParameter></Fill></TextSymbolizer></Rule></FeatureTypeStyle></UserStyle></NamedLayer></StyledLayerDescriptor>'},start:function(){if(!this.started){this.started=!0,this._locale=Oskari.getLocalization(this.getName());var e,t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);this.sandbox=n,this.loader=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",this.getLocale().loader,n),n.register(this);for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&n.registerForEventByName(this,e);this._requestHandlers["catalogue.ShowMetadataRequest"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",n,this),n.addRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);var s={};for(e in this.layerSpec)this.layerSpec.hasOwnProperty(e)&&(s[e]=this.layerSpec[e]);var r=this.getLocale().layer;for(e in r)r.hasOwnProperty(e)&&(s[e]=r[e]);var a=n.getService("Oskari.mapframework.service.MapLayerService"),o=a.createMapLayer(s);a.addLayer(o,!0),this.layer=o;var l=n.findRegisteredModuleInstance("MainMapModule"),u=Oskari.clazz.create("Oskari.mapframework.mapmodule.MetadataLayerPlugin");u.setMapLayer(o),l.registerPlugin(u),l.startPlugin(u),this.layerPlugin=u;var h=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,h),n.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerAddEvent:function(){},AfterMapLayerRemoveEvent:function(){},AfterMapMoveEvent:function(){}},stop:function(){var e,t=this.sandbox;t.removeRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);var i=t.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);t.request(this,i),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},setSandbox:function(){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.Flyout",this,this.getLocale().flyout,this.getLoader())},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getTitle:function(){return this.getLocale().title},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},scheduleShowMetadata:function(e){this.plugins["Oskari.userinterface.Flyout"].scheduleShowMetadata(e),this.getSandbox().requestByName(this,"userinterface.UpdateExtensionRequest",[this,"detach"])},showExtentOnMap:function(e,t,i){var n=this;if(t){var s,r,a,o,l,u=[];for(s=0;s<t.length;s++)r=t[s],a=new OpenLayers.Bounds(r.westBoundLongitude,r.southBoundLatitude,r.eastBoundLongitude,r.northBoundLatitude),o=a.toGeometry(),l=new OpenLayers.Feature.Vector(o),l.attributes=i||l.attributes,u.push(l);var h=n.getSandbox().getEventBuilder("FeaturesAvailableEvent")(this.layer,u,"application/nlsfi-x-openlayers-feature","EPSG:3067","replace");n.sandbox.notifyAll(h)}},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",function(e,t){this.urls=e,this.sandbox=t,this.dev=!1},{getURLForView:function(e,t){var i=this.urls[e],n=i+"uuid="+t;if(this.dev){var s={"abstract":"abstract",jhs:"jhs158",inspire:"inspire",json:"json"}[e];null!==s&&void 0!==s&&(n=s)}return n},loadMetadata:function(e,t,i,n,s,r){var a=this.getURLForView(e,t,i,n);this.sandbox.printDebug("loadMetadata "+a),null!==a&&void 0!==a&&jQuery.ajax({url:a,dataType:r||"xml",beforeSend:function(e){e&&e.overrideMimeType&&(r&&"json"===r?e.overrideMimeType("application/json"):e.overrideMimeType("text/html"))},success:function(e){s(e,!0)},error:function(){s(null,!1)}})},loadGeonetworkAjaxHTML:function(e,t,i,n,s){var r=this.getURLForView(t,i,n,s);OpenLayers.Request.GET({url:r,callback:e})},openMetadata:function(e,t,i,n,s,r,a){var o=this.getURLForView(e,t,i,n);this.sandbox.printDebug("openMetadata "+o),window.open(o,a,"resizable=yes,scrollbars=yes,status=yes")}}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.view.MetadataPage",function(e,t){this.instance=e,this.locale=t,this.container=null,this.views={},this.titles={},this.tabs={},this.browseGraphic=null,this.compileTemplates(),this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert"),this.state=null,this.contentState={title:"...",metadata:{uuid:null,RS_Identifier_Code:null,RS_Identifier_CodeSpace:null},view:"abstract",metadataJson:null},this.panel=null},{getPanel:function(){return this.panel},compileTemplates:function(){},templates:{content:"<div class='metadataflyout_content'></div>",browseGraphic:"<div class='metadataflyout_content_browseGraphic'></div>",viewTabs:"<div class='metadataflyout_content_tabs'></div>",viewTab:"<div class='metadataflyout_content_tab'></div>",titles:{"abstract":"<div class='metadataflyout_content_abstract_title'></div>",jhs:"<div class='metadataflyout_content_jhs_title'></div>",inspire:"<div class='metadataflyout_content_inspire_title'></div>"},views:{"abstract":"<div class='metadataflyout_content_abstract'></div>",jhs:"<div class='metadataflyout_content_jhs'></div>",inspire:"<div class='metadataflyout_content_inspire'></div>"}},init:function(){this.container=jQuery("<div />");var e,t,i,n,s,r,a,o=this.locale,l=jQuery(this.templates.content),u=this,h=jQuery(this.templates.viewTabs),c=jQuery(this.templates.viewTab);for(e in this.templates.views){t=h.clone(),i=o.tabs[e];for(n in i)s=c.clone(),"string"==typeof i[n]?(s.append(i[n]),t.append(s),n!==e&&s.click({viewId:n},function(e){var t=e.data;u.showMetadataView(t.viewId)})):(r=i[n].text,a=i[n].target,s.append(r),t.append(s),s.click({viewId:n,target:a},function(e){var t=e.data;u.openMetadataView(t.viewId,t.target)}));t.hide(),this.tabs[e]=t,l.append(t)}var p=jQuery(this.templates.browseGraphic);this.browseGraphic=p,l.append(p);for(e in this.templates.views)this.titles[e]=jQuery(this.templates.titles[e]),this.titles[e].append(this.locale[e]),this.views[e]=jQuery(this.templates.views[e]),l.append(this.titles[e]),l.append(this.views[e]);l.append(h),this.alert.insertTo(this.container),this.container.append(l);var d=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");d.setTitle(this.contentState.title);var m=d.getContainer();m.append(this.container),this.panel=d},destroy:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},openMetadataView:function(e,t){if(this.contentState){var i=this.contentState.metadata;this.instance.getLoader().openMetadata(e,i.uuid,i.RS_Identifier_Code,i.RS_Identifier_CodeSpace,function(){},null,t)}},showMetadataView:function(e){this.instance.getSandbox().printDebug("ShowMetadataView "+e);var t,i=this.tabs,n=this.views,s=this.titles;for(t in n)t!==e?(i[t].hide(),s[t].hide(),n[t].hide()):(i[t].show(),s[t].show(),n[t].hide());this.contentState.view=e,this.loadMetadataForState()},resetBrowseGraphic:function(e){var t=jQuery(this.browseGraphic);t.empty(),e&&t.append(e)},loadMetadataForState:function(){function e(e){var s=jQuery("<div />");s.html(e.responseText),jQuery.each(s.find("td.metadataContent"),function(e,i){var n=jQuery(i),s=n.parent(),r=jQuery('<td class="metadataContent"/>');n.hasClass("MD_DigitalTransferOptions")&&r.addClass("MD_DigitalTransferOptions");var a=n.text().split(".\n");jQuery.each(a,function(e,t){var i=jQuery.trim(t);if(0!==i.length){var n=jQuery('<div class="metadataflyout_content_section"/>');a.length>1?n.text(i+"."):n.text(i),r.append(n)}}),n.remove(),s.append(r),t._linkify(r)});var r=s.find("a[href]"),a=new RegExp("^\\?.*");jQuery.each(r,function(e,i){var s=jQuery(i),r=s.attr("href");if(r&&a.test(r)){var o=r.split("&"),l={};jQuery.each(o,function(e,t){var i=t.split("=");l[i[0]]=i[1]}),s.attr("href",null),s.click({viewId:n,uuid:l.uuid},function(e){var i=e.data,n=i.uuid;t.showMetadata(n)})}}),i[n].append(s),i[n].css("display",""),t._updatePanel()}var t=this,i=this.views;if(!this.contentState||!this.contentState.metadata||!this.contentState.metadata.uuid)return!1;var n=this.contentState.view,s=this.contentState.metadata;
i[n].empty(),t.instance.getLoader().loadGeonetworkAjaxHTML(e,n,s.uuid,s.RS_Identifier_Code,s.RS_Identifier_CodeSpace)},_updatePanel:function(){var e=this,t=e.contentState.metadataJson;if(t){var i=t.title;i&&this.panel.setTitle(i)}},loadMetadataJSONForState:function(){var e=this;if(!this.contentState||!this.contentState.metadata||!this.contentState.metadata.uuid)return!1;var t=this.contentState.metadata;return this.instance.getLoader().loadMetadata("json",t.uuid,t.RS_Identifier_Code,t.RS_Identifier_CodeSpace,function(t){if(t&&t.mdcs&&t.mdcs.length&&0!==t.mdcs.length){var i=t.mdcs[0];e.processJSON(i)}},"json"),!0},processJSON:function(e){var t=this,i=e.browseGraphic,n=e.env;if(this.resetBrowseGraphic(),i){var s=jQuery("<img />"),r=null;r=this.instance.getLoader().dev?"espoo_johtokartta_s.png":i;var a=new Image;a.onload=function(){s.attr("src",r),a.onload=null},a.src=r,this.resetBrowseGraphic(s)}n&&this.instance.showExtentOnMap(this.contentState.metadata.uuid,n,e),t.contentState.metadataJson=e,t._updatePanel()},resetContentState:function(){},showMetadata:function(e,t,i){this.resetContentState(),this.contentState.metadata.uuid=e,this.contentState.metadata.RS_Identifier_Code=t,this.contentState.metadata.RS_Identifier_CodeSpace=i,this.instance.getSandbox().printDebug("showMetadata { uuid="+e+", view="+this.contentState.view+"}"),this.loadMetadataJSONForState(),this.showMetadataView(this.contentState.view)},scheduleShowMetadata:function(e,t,i){this.showMetadata(e,t,i)},_linkify:function(e){var t=e.html(),i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,n=t.replace(i,'<a href="$1" target="_blank">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim;n=n.replace(s,'$1<a href="http://$2" target="_blank">$2</a>'),e.html(n)}},{}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Flyout",function(e,t){this.instance=e,this.locale=t,this.container=null,this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert"),this.accordion=null,this.pages={}},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Flyout"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){var e=this;e.locale;var t=Oskari.clazz.create("Oskari.userinterface.component.Accordion");e.accordion=t,t.insertTo(e.container)},stopPlugin:function(){var e;for(e in this.pages)this.pages.hasOwnProperty(e)&&(this.pages[e].destroy(),delete this.pages[e]);this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},scheduleShowMetadata:function(e){var t,i,n,s,r,a,o=this.accordion;for(t in this.pages)this.pages.hasOwnProperty(t)&&(i=this.pages[t],i&&(this.pages[t]=null,i.page.destroy(),o.removePanel(i.panel)));for(n=0;n<e.length;n++)s=e[n],r=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.view.MetadataPage",this.instance,this.locale),r.init(),a=r.getPanel(),o.addPanel(a),0===n&&a.open(),this.pages[s.uuid||s.RS_Identifier_CodeSpace+":"+s.RS_Identifier_Code]={page:r,panel:a,data:s};for(t in this.pages)this.pages.hasOwnProperty(t)&&(i=this.pages[t],i&&(s=i.data,r=i.page,r.scheduleShowMetadata(s.uuid,s.RS_Identifier_Code,s.RS_Identifier_CodeSpace)))},setContentState:function(e){this.contentState=e},getContentState:function(){return this.contentState},resetContentState:function(){this.contentState={}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Tile"},setEl:function(e){this.container=$(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},refresh:function(){var e=this,t=e.instance;this.container,this.template,t.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequest",function(e,t){if(this._creator=null,this._uuid=e.uuid,this._RS_Identifier_Code=e.RS_Identifier_Code,this._RS_Identifier_CodeSpace=e.RS_Identifier_CodeSpace,this._additionalMetadata=t,this._allMetadata=[],(null!=e.uuid||null!=e.RS_Identifier_Code||null!=console.RS_Identifier_CodeSpace)&&this._allMetadata.push(e),t){this._additionalMetadata=t;var i;for(i=0;i<t.length;i++)this._allMetadata.push(t[i])}},{__name:"catalogue.ShowMetadataRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getRS_Identifier_Code:function(){return this._RS_Identifier_Code},getRS_Identifier_CodeSpace:function(){return this._RS_Identifier_CodeSpace},getAdditionalMetadata:function(){return this._additionalMetadata},getAllMetadata:function(){return this._allMetadata}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.instance.scheduleShowMetadata(t.getAllMetadata())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.MetadataLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._layer=null,this._supportedFormats={},this._features=null,this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"MetadataLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("metadatalayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("metadatalayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.registerForEventByName(this,t)},stopPlugin:function(e){var t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){var t,i,n,s=this.getMapLayer(),r=this._sandbox;for(t=0;t<e.length;t++)i=e[t],n=i.getId()+"",i.isLayerOfType("VECTOR")&&s.getId()+""===n&&(r.printDebug("preselecting "+n),this.addMapLayerToMap(i,!0,i.isBaseLayer()))},setMapLayer:function(e){this._layer=e},getMapLayer:function(){return this._layer},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",{read:function(e){return e}})},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer(),i=this.getMapLayer();if(t.isLayerOfType("VECTOR")&&t.getId()+""==i.getId()+""){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var n=this._map.getLayersByName("layer_"+t.getId());(null!==n[0]||void 0!==n[0])&&n[0].setOpacity(t.getOpacity()/100)}},addMapLayerToMap:function(e,t){var i=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()+""==i.getId()+""){var n=new OpenLayers.StyleMap,s={styleMap:n},r=e.getStyledLayerDescriptor();if(r){this._sandbox.printDebug(r);var a=this._sldFormat.read(r),o=a.namedLayers[0].userStyles,l=o[0];n.styles["default"]=l}else this._sandbox.printDebug("NO SLD FOUND");var u=new OpenLayers.Layer.Vector("layer_"+e.getId(),s);u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._features&&u.addFeatures(this._features),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(u,this._map.layers.length):this._map.setLayerIndex(u,0)}},removeMapLayerFromMap:function(e){var t=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()+""==t.getId()+""){var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}},getOLMapLayers:function(e){if(e.isLayerOfType("VECTOR")){var t=this.getMapLayer();if(e.getId()+""==t.getId()+"")return this._map.getLayersByName("layer_"+e.getId())}},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer();if(null!==t&&void 0!==t){var i=this.getMapLayer();if(t.getId()+""==i.getId()+""){var n=e.getMimeType(),s=e.getFeatures(),r=e.getOp(),a=this._supportedFormats[n];if(a){var o=a.read(s);this._features=o;var l=this._map.getLayersByName("layer_"+t.getId())[0];l&&(r&&"replace"===r&&l.removeFeatures(l.features),l.addFeatures(o))}}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.FeatureDataBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.FeatureDataBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/PopupHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/plugin/MapSelectionPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/event/AddedFeatureEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/plugin/FeaturedataPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/service/GridJsonService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/service/GridModelManager.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/domain/WfsGridUpdateParams.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/request/ShowFeatureDataRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/request/ShowFeatureDataRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/featuredata/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"featuredata","Bundle-Name":"featuredata","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("featuredata","Oskari.mapframework.bundle.featuredata.FeatureDataBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.FeatureDataBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.popupHandler=null,this.selectionPlugin=null,this.geometry=null},{__name:"FeatureData",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=this.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,n.register(e);for(var s in e.eventHandlers)n.registerForEventByName(e,s);var r=n.getRequestBuilder("userinterface.AddExtensionRequest")(this);n.request(this,r),e.createUi();var a=this.getLocalization("popup");if(this.conf&&this.conf.selectionTools===!0){this.popupHandler=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.PopupHandler",this);var o=n.getRequestBuilder("Toolbar.AddToolButtonRequest"),l={iconCls:"tool-feature-selection",tooltip:a.tools.select.tooltip,sticky:!1,callback:function(){e.popupHandler.showSelectionTools()}};n.request(this,o("dialog","selectiontools",l))}for(var u=n.findAllSelectedMapLayers(),h=0;h<u.length;++h)u[h].isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(u[h]));n.addRequestHandler("ShowFeatureDataRequest",this.requestHandlers.showFeatureHandler)}},init:function(){var e=this;return this.requestHandlers={showFeatureHandler:Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.request.ShowFeatureDataRequestHandler",e)},this.service=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.service.GridJsonService",this.sandbox.getAjaxUrl()),null},getService:function(){return this.service},getSelectionPlugin:function(){return this.selectionPlugin},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){e.getMapLayer().isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerRemoved(e.getMapLayer()))},AfterMapLayerAddEvent:function(e){e.getMapLayer().isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(e.getMapLayer()))},AfterMapMoveEvent:function(){this.setGeometry(null);var e=this.getSelectionPlugin().getFullScreenSelection();this.plugins["Oskari.userinterface.Flyout"].updateGrid(e)},WFSFeaturesSelectedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].featureSelected(e)},"userinterface.ExtensionUpdatedEvent":function(e){var t=this.plugins["Oskari.userinterface.Flyout"];if(e.getExtension().getName()===this.getName())if("close"===e.getViewState())this.setGeometry(null),t.setEnabled(!1);else if(!t.isEnabled()){var i=this.geometry;i?this.setGeometry(null):i=this.getSelectionPlugin().getFullScreenSelection(),t.setEnabled(!0,i)}}},setGeometry:function(e){this.geometry=e},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi();var e=this.sandbox.findRegisteredModuleInstance("MainMapModule"),t=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.plugin.FeaturedataPlugin",{instance:this});e.registerPlugin(t),e.startPlugin(t),this.plugin=t;var i={id:"FeatureData"};this.selectionPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.plugin.MapSelectionPlugin",i),e.registerPlugin(this.selectionPlugin),e.startPlugin(this.selectionPlugin)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.PopupHandler",function(e){this.instance=e,this.localization=e.getLocalization("popup"),this.templateContent=jQuery("<div></div>"),this.templateEditDialogContent=jQuery("<div></div>"),this.templateEditButtons=jQuery("<div></div>"),this.templateToolsButton=jQuery('<div style= "display: inline-block; border: 1px solid;"></div>'),this.templateInstructions=jQuery("<div class='instructions' style= 'padding: 20px 0px 0px 0px;'></div>"),this.templateLink=jQuery("<div class='link'><a href='JavaScript:void(0);'></a></div></div>");var t=this,i=t.instance.getSelectionPlugin();this.buttons={point:{iconCls:"selection-point",tooltip:t.localization.tools.point.tooltip,sticky:!1,callback:function(){i.startDrawing({drawMode:"point"})}},line:{iconCls:"selection-line",tooltip:t.localization.tools.line.tooltip,sticky:!1,callback:function(){i.startDrawing({drawMode:"line"})}},polygon:{iconCls:"selection-area",tooltip:t.localization.tools.polygon.tooltip,sticky:!1,callback:function(){i.startDrawing({drawMode:"polygon"})}},square:{iconCls:"selection-square",tooltip:t.localization.tools.square.tooltip,sticky:!1,callback:function(){i.startDrawing({drawMode:"square"})}},circle:{iconCls:"selection-circle",tooltip:t.localization.tools.circle.tooltip,sticky:!1,callback:function(){i.startDrawing({drawMode:"circle"})}}}},{showSelectionTools:function(){var e=this;e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"close"]);var t=function(t){return function(){e.buttons[t].callback(),i.close(),e._selectionStarted()}},i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=this.localization.title,s=this.templateContent.clone();for(var r in this.buttons){var a=this.templateToolsButton.clone(),o=this.buttons[r];a.attr("title",o.tooltip),a.addClass(o.iconCls),a.bind("click",t(r)),s.append(a)}var l=this.templateInstructions.clone();l.append(this.localization.instructions),s.append(l);var u=i.createCloseButton(this.localization.button.cancel);u.addClass("primary"),i.addClass("tools_selection"),i.show(n,s,[u]),i.moveTo("#toolbar div.toolrow[tbgroup=default-selectiontools]","top")},_selectionStarted:function(){var e=this;e._sandbox;var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=e.localization.title,n=e.templateEditDialogContent.clone(),s=e.templateEditButtons.clone(),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(e.localization.button.edit),r.setHandler(function(){t.close(),e.showSelectionTools(),e.instance.getSelectionPlugin().startDrawing({drawMode:"modify"})}),s.append(r.getButton());var a=t.createCloseButton(e.localization.button.close);s.append(a.getButton()),a.setHandler(function(){t.close(),e.instance.getSelectionPlugin().stopDrawing(),e.showSelectionTools()}),n.append(s);var o=e.templateLink.clone();o.append(e.localization.link.title),o.bind("click",function(){t.close(),e.showSelectionTools()}),n.append(o),e.instance.setGeometry(null);var l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.setTitle(e.localization.button.show),l.addClass("primary showSelection"),l.setHandler(function(){var i=e.instance.getSelectionPlugin().getFeaturesAsGeoJSON();e.instance.setGeometry(i),e.instance.getSelectionPlugin().stopDrawing(),e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"detach"]),t.close()});var u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(e.localization.button.cancel),u.setHandler(function(){t.close(),e.instance.getSelectionPlugin().stopDrawing()}),t.show(i,n,[u,l]),t.moveTo("#toolbar div.toolrow[tbgroup=default-selectiontools]","top")}}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.plugin.MapSelectionPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.listeners=[],this.currentDrawMode=null,this.prefix="Default.",e&&e.id&&(this.prefix=e.id+"."),e&&e.graphicFill&&(this.graphicFill=e.graphicFill),this.multipart=e&&e.multipart===!0},{__name:"MapSelectionPlugin",getName:function(){return this.prefix+this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},addListener:function(e){this.listeners.push(e)},startDrawing:function(e){if(e.isModify)this.modifyControls.select.select(this.drawLayer.features[0]);else if(e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.drawControls.select.select(this.drawLayer.features[0])}else this.editMode=!1,this._toggleControl(e.drawMode)},stopDrawing:function(){this._toggleControl(),this.drawLayer.removeAllFeatures()},setDrawing:function(e){var t=[new OpenLayers.Feature.Vector(e)];this.drawLayer.addFeatures(t)},forceFinishDraw:function(){this._finishedDrawing(!0)},_finishedDrawing:function(e){if((!this.multipart||e)&&this._toggleControl(),!this.editMode){var t=this.drawLayer.features.length-1;this.drawControls.select.select(this.drawLayer.features[t])}var i;!this.multipart||e?(i=this._sandbox.getEventBuilder(this.prefix+"FinishedDrawingEvent")(this.getDrawing(),this.editMode),this._sandbox.notifyAll(i)):(i=this._sandbox.getEventBuilder(this.prefix+"AddedFeatureEvent")(this.getDrawing(),this.currentDrawMode),this._sandbox.notifyAll(i))},_toggleControl:function(e){var t,i;this.currentDrawMode=e;for(t in this.drawControls)this.drawControls.hasOwnProperty(t)&&(i=this.drawControls[t],e===t?i.activate():i.deactivate())},init:function(){var e=this;if(this.drawLayer=new OpenLayers.Layer.Vector(this.prefix+"FeatureData Draw Layer",{eventListeners:{featuresadded:function(){e._finishedDrawing()}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Path),polygon:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.Polygon),square:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4}}),circle:new OpenLayers.Control.DrawFeature(e.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:40}}),modify:new OpenLayers.Control.ModifyFeature(e.drawLayer,{standalone:!0}),select:new OpenLayers.Control.SelectFeature(e.drawLayer)},void 0!==this.drawControls.select.handlers?this.drawControls.select.handlers.feature.stopDown=!1:void 0!==this.drawControls.select.handler&&(this.drawControls.select.handler.stopDown=!1,this.drawControls.select.handler.stopUp=!1),null!==this.graphicFill&&void 0!==this.graphicFill){var t,i=this.graphicFill,n=new OpenLayers.Format.SLD,s=n.read(i);if(s&&s.namedLayers)for(t in s.namedLayers)if(s.namedLayers.hasOwnProperty(t)){this.drawLayer.styleMap.styles["default"]=s.namedLayers[t].userStyles[0],this.drawLayer.redraw();break}}this._map.addLayers([e.drawLayer]);var r;for(r in this.drawControls)this.drawControls.hasOwnProperty(r)&&this._map.addControl(this.drawControls[r]);this.geojson_format=new OpenLayers.Format.GeoJSON},getDrawing:function(){if(0===this.drawLayer.features.length)return null;var e=this.drawLayer.features[0].geometry.CLASS_NAME;if("OpenLayers.Geometry.MultiPoint"===e||"OpenLayers.Geometry.MultiLineString"===e||"OpenLayers.Geometry.MultiPolygon"===e)return this.drawLayer.features[0].geometry;var t,i=null,n=[];for(t=0;t<this.drawLayer.features.length;t++)n.push(this.drawLayer.features[t].geometry);switch(e){case"OpenLayers.Geometry.Point":i=new OpenLayers.Geometry.MultiPoint(n);break;case"OpenLayers.Geometry.LineString":i=new OpenLayers.Geometry.MultiLineString(n);break;case"OpenLayers.Geometry.Polygon":i=new OpenLayers.Geometry.MultiPolygon(n)}return i},getFeatures:function(){return this.drawLayer.features},getFeaturesAsGeoJSON:function(){var e=this.geojson_format.write(this.getFeatures()),t=JSON.parse(e);return t.crs=this._getSRS(),t},getFullScreenSelection:function(){var e=this._sandbox.getMap().getBbox(),t=e.toGeometry(),i=this.geojson_format.write(t),n=JSON.parse(i),s={type:"FeatureCollection",crs:this._getSRS(),features:[]},r={type:"Feature",geometry:n,properties:{geom_type:"polygon",buffer_radius:"0"}};return s.features.push(r),s},_getSRS:function(){return{type:"EPSG",properties:{code:3067}}},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.event.FinishedDrawingEvent",function(e,t){this._drawing=e,this._modification=1==t},{__name:"FeatureData.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.event.AddedFeatureEvent",function(e,t){this._drawing=e,this._drawingMode=t},{__name:"FeatureData.AddedFeatureEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},getDrawingMode:function(){return this._drawingMode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.layers={},this.tabsContainer=null,this.modelMngr=null,this.selectedTab=null,this.active=!1,this.mapDivId="#mapdiv",this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.resizable=!0,this.resizing=!1,this.resized=!1},{getName:function(){return"Oskari.mapframework.bundle.featuredata.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("featuredata")||jQuery(this.container).addClass("featuredata")},startPlugin:function(){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("nodata")),this.modelMngr=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.service.GridModelManager");var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule"),t=e.getMap().div;t&&(this.mapDivId=t)},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setResizable:function(e){this.resizable=e},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.instance.sandbox,n=i.getRequestBuilder("DimMapLayerRequest"),s=i.getRequestBuilder("HighlightMapLayerRequest");this.tabsContainer.addTabChangeListener(function(t,r){if(t){e.instance.getService().cancelWFSGridUpdateForLayer(t.layer.getId());var a=n(t.layer.getId());i.request(e.instance.getName(),a)}if(e.selectedTab=r,r&&(e._updateData(r.layer),e.active)){var a=s(r.layer.getId());i.request(e.instance.getName(),a)}}),this.tabsContainer.insertTo(t)},layerAdded:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");t.setTitle(e.getName()),t.getContainer().append(this.instance.getLocalization("loading")),t.layer=e,this.layers[""+e.getId()]=t,this.tabsContainer.addPanel(t)},layerRemoved:function(e){var t=""+e.getId();this.instance.getService().cancelWFSGridUpdateForLayer(t);var i=this.layers[t];this.tabsContainer.removePanel(i),i.grid=null,delete i.grid,i.layer=null,delete i.layer,this.layers[t]=null,delete this.layers[t]},_updateData:function(e,t){if(this.active){this.instance.getService().cancelWFSGridUpdateForLayer(e.getId());var i=this.instance.sandbox.getMap(),n=this.layers[""+e.getId()],s=null;if(n.grid&&(s=n.grid.getSelection()),n.getContainer().empty(),!e.isInScale(i.getScale()))return n.getContainer().append(this.instance.getLocalization("errorscale")),void 0;n.getContainer().append(this.instance.getLocalization("loading"));var r=this,a=i.getWidth(),o=i.getHeight(),l=function(t){if(r._prepareData(e,t),s)for(var i=0;i<s.length;++i)n.grid.select(s[i].featureId,!0)};this.instance.getService().scheduleWFSGridUpdate(e,t,a,o,l)}},updateGrid:function(e){this.selectedTab&&(e=JSON.stringify(e),this._updateData(this.selectedTab.layer,e))},_enableResize:function(){var e=this,t=jQuery("div.oskari-flyoutcontent.featuredata"),i=t.parent().parent(),n=t.parent();t.find("div.tabsContent");var s=0,r=0;i.find("div.tab-content").css({"padding-top":"1px","padding-right":"1px"});var a=jQuery("<div/>");a.addClass("flyout-resizer");var o=16;a.removeClass("allowHover"),a.addClass("icon-drag"),a.bind("dragstart",function(e){e.preventDefault()}),a.mousedown(function(t){e.resizing||(e.resizing=!0,s=t.pageX-i[0].offsetWidth-i[0].offsetLeft,r=t.pageY-i[0].offsetHeight-i[0].offsetTop,jQuery(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1))}),jQuery(document).mouseup(function(){e.resizing=!1,e.resized=!0}),jQuery(document).mousemove(function(t){if(e.resizing){var a=100,l=60,u=i.offset(),h=n.offset();if(t.pageX>u.left){var c=t.pageX-u.left-s;i.css("max-width",c.toString()+"px"),i.css("width",c.toString()+"px")}if(t.pageY-u.top>a){var p=t.pageY-u.top-r;i.css("max-height",p.toString()+"px"),i.css("height",p.toString()+"px");var d=t.pageY-h.top-r;n.css("max-height",(d-o).toString()+"px"),n.css("height",(d-o).toString()+"px");var m=jQuery("div.oskari-flyoutcontent.featuredata").find("div.tabsContent"),f=t.pageY-m[0].offsetTop-o-l;i.find("div.tab-content").css("max-height",f.toString()+"px")}}}),i.find("div.oskari-flyoutcontent").css("padding-bottom","5px"),0===jQuery("div.flyout-resizer").length&&i.append(a)},_prepareData:function(e,t){var i=this,n=this.layers[""+e.getId()],s=this.tabsContainer.isSelected(n);if(s){var r=this.modelMngr.getData(t);if(n.getContainer().empty(),!r)return n.getContainer().append(this.instance.getLocalization("errordata")),void 0;var a=r.all;a.setIdField("featureId");var o=a.getFields();if(!n.grid){var l=Oskari.clazz.create("Oskari.userinterface.component.Grid",this.instance.getLocalization("columnSelectorTooltip"));l.setColumnUIName("__featureName",this.instance.getLocalization("featureNameAll")),l.addSelectionListener(function(t,n){i._handleGridSelect(e,n)});var u=this.instance.getLocalization("showmore");l.setAdditionalDataHandler(u,function(e,t){var i=Oskari.clazz.create("Oskari.userinterface.component.Popup");i.show(u,t),i.moveTo(e,"bottom")});for(var h=[],c=0;c<o.length;++c)"featureId"!=o[c]&&"qName"!=o[c]&&h.push(o[c]);l.setVisibleFields(h),l.setColumnSelector(!0),l.setResizableColumns(!0),n.grid=l}n.grid.setDataModel(a),n.grid.renderTo(n.getContainer());var p=jQuery(i.mapDivId),d=jQuery("div.oskari-flyoutcontent.featuredata"),m=d.parent().parent();i.resized||(m.find("div.tab-content").css("max-height",(p.height()/4).toString()+"px"),m.css("max-width",p.width().toString()+"px")),i.resizable&&this._enableResize()}},_handleGridSelect:function(e,t,i){var n=this.instance.sandbox,s=[t],r=n.getEventBuilder("WFSFeaturesSelectedEvent");void 0===i&&(i=n.isCtrlKeyDown());var a=r(s,e,i);n.notifyAll(a)},featureSelected:function(e){if(this.active){var t=e.getMapLayer(),i=this.layers[""+t.getId()],n=e.getWfsFeatureIds()[0];i.grid&&i.grid.select(n,e.isKeepSelection())}},isEnabled:function(){return this.active===!0},setEnabled:function(e,t){if(this.active==e)return t&&this.updateGrid(t),void 0;
this.active=e===!0;var i=this.instance.sandbox,n=i.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");if(n&&i.request(this.instance.getName(),n(!this.active)),this.active){if(this.selectedTab){var s=i.getRequestBuilder("HighlightMapLayerRequest"),r=s(this.selectedTab.layer.getId());i.request(this.instance.getName(),r),this.updateGrid(t)}}else{if(this.selectedTab){this.instance.getService().cancelWFSGridUpdateForLayer(this.selectedTab.layer.getId());var a=i.getRequestBuilder("DimMapLayerRequest"),r=a(this.selectedTab.layer.getId());i.request(this.instance.getName(),r)}for(var o in this.layers)o.getContainer&&o.getContainer().empty()}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.plugin.FeaturedataPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this.__elements={},this.__templates={},this.instance=e.instance},{__name:"FeaturedataPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.__templates.main=jQuery('<div class="mapplugin featuredataplugin"><a href="JavaScript: void(0);"></a></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._createUI();for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.__elements.main&&(this.__elements.main.remove(),delete this.__elements.main),e.unregister(this)},start:function(){},stop:function(){},_createUI:function(){this._sandbox;var e=this,t=jQuery(this._map.div);e.__elements.main||(e.__elements.main=e.__templates.main.clone());var i=e.__elements.main.find("a");i.html(this.instance.getLocalization("title")),i.bind("click",function(){return e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"detach"]),!1}),e.__elements.main.mousedown(function(e){e.stopPropagation()}),t.append(e.__elements.main),this.update()},update:function(){for(var e=this.mapModule.getSandbox(),t=e.findAllSelectedMapLayers(),i=0,n=0;n<t.length;n++){var s=t[n];s.isLayerOfType("WFS")&&i++}var r=this;i>0?r.__elements.main.show():r.__elements.main.hide()},eventHandlers:{AfterMapMoveEvent:function(){this.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.service.GridJsonService",function(e){this._gridPollingInterval=200,this.endpointUrl=e,this.pendingOperations={},this._wfsTableQueryId=0},{__qname:"Oskari.mapframework.bundle.featuredata.service.GridJsonService",getQName:function(){return this.__qname},__name:"GridJsonService",getName:function(){return this.__name},cancelWFSGridUpdateForLayer:function(e){var t=this.pendingOperations[e];t&&(t.timer&&clearTimeout(t.timer),t.query&&t.query.abort(),this.pendingOperations[e]=null,delete this.pendingOperations[e])},scheduleWFSGridUpdate:function(e,t,i,n,s){this.cancelWFSGridUpdateForLayer(e.getId());var r=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.domain.WfsGridUpdateParams",e,t,i,n,s),a=this,o=setTimeout(function(){a._processGridUpdate(r)},this._gridPollingInterval);this.pendingOperations[e.getId()]={timer:o}},_processGridUpdate:function(e){var t=this,i=e.getMapLayer();this.pendingOperations[i.getId()].timer=null,delete this.pendingOperations[i.getId()].timer;var n=function(n){t.cancelWFSGridUpdateForLayer(i.getId()),n.error||t._getLatestWfsTableQueryId()==parseInt(n.wfsQueryId)&&e.getCallback()(n)},s=jQuery.ajax({dataType:"json",type:"POST",data:{layerIds:i.getId(),flow_pm_map_width:e.getMapWidth(),flow_pm_map_height:e.getMapHeight(),mode:"data_to_table",geojson:e.getGeometry(),flow_pm_map_wfs_query_id:t._generateWfsTableQueryId()},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this.endpointUrl+"action_route=GetWfsFeatureData",success:n});this.pendingOperations[i.getId()].query=s},_getLatestWfsTableQueryId:function(){return this._wfsTableQueryId},_generateWfsTableQueryId:function(){return this._wfsTableQueryId++,this._wfsTableQueryId}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.service.GridModelManager",function(){},{getData:function(e){if(!this._isValidData(e))return!1;var t=this._getModels(e);if(e.featureDatas.length<2)for(var i in t)t.all=t[i];else{var n="__featureName",s=Oskari.clazz.create("Oskari.userinterface.component.GridModel");s._addField(n);for(var i in t){for(var r=t[i],a=r.getFields(),o=0;o<a.length;o++){var l=a[o],u=this._findInList(s.getFields(),l);-1===u&&s._addField(l)}for(var e=r.getData(),o=0;o<e.length;o++){var h=e[o];h[n]=i,s.addData(h)}}t.all=s}return t},_isValidData:function(e){if(!e||!e.headers||!e.featureDatas)return!1;for(var t=0;t<e.featureDatas.length;t++)if(null==e.featureDatas[t].children)return!1;return!0},_findInList:function(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1},_getModels:function(e){for(var t=Oskari.getLang(),i={},n=0;n<e.featureDatas.length;n++){var s=e.featureDatas[n],r=this._getIndividualModel(s),a=s["feature_"+t];i[a]=r}return i},_getIndividualModel:function(e){for(var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),i=0;i<e.children.length;i++)t.addData(e.children[i]);return t}}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.domain.WfsGridUpdateParams",function(e,t,i,n,s){this._geometry=t,this._mapWidth=i,this._mapHeight=n,this._mapLayer=e,this._onReady=s},{getMapLayer:function(){return this._mapLayer},getGeometry:function(){return this._geometry},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getCallback:function(){return this._onReady}}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.request.ShowFeatureDataRequest",function(e){this._id=e},{__name:"ShowFeatureDataRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.request.ShowFeatureDataRequestHandler",function(e){this.featureData=e},{handleRequest:function(e,t){for(var i=t.getId(),n=this.featureData.plugins["Oskari.userinterface.Flyout"],s=n.tabsContainer.panels,r=0;r<s.length;r++)if(s[r].layer.getId()===i){n.tabsContainer.select(s[r]);break}this.featureData.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[this.featureData,"detach"])}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance")},update:function(e,t,i,n){e.alert("RECEIVED update notification "+n)}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/AddedFeatureEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/MyPlaceHoverEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/MyPlacesChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/event/SelectedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/model/MyPlace.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/model/MyPlacesCategory.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/DrawPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/plugin/HoverPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/MyPlacesTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/GetGeometryRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StartDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/drawplugin/request/StopDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditPlaceRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/DeleteCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/PublishCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/OpenAddLayerDialogRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/OpenAddLayerDialogHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/service/MyPlacesService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/service/MyPlacesWFSTStore.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/MainView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/PlaceForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/CategoryForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/ButtonHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/CategoryHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/instance.js"},{type:"text/javascript",src:"../../../../libraries/jscolor/jscolor.js"},{type:"text/css",src:"../../../../resources/framework/bundle/myplaces2/css/myplaces.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"myplaces2","Bundle-Name":"myplaces2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("myplaces2","Oskari.mapframework.bundle.myplaces2.MyPlacesBundle"),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlaceHoverEvent",function(e,t,i){this._creator=null,this._lonlat=e,this._hoverEvent=t,this._zoom=i},{__name:"MyPlaces.MyPlaceHoverEvent",getName:function(){return this.__name},getHoverEvent:function(){return this._hoverEvent},getLonLat:function(){return this._lonlat},getZoomLevel:function(){return this._zoom}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlacesChangedEvent",function(){},{__name:"MyPlaces.MyPlacesChangedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlace",function(){this.id=void 0,this.name=void 0,this.description=void 0,this.categoryID=void 0,this.geometry=void 0,this.link=void 0,this.attention_text=void 0,this.createDate=void 0,this.updateDate=void 0},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDescription:function(e){this.description=e},getDescription:function(){return this.description},getAttention_text:function(){return this.attention_text},setAttention_text:function(e){this.attention_text=e},setLink:function(e){this.link=e},getLink:function(){return this.link},setImageLink:function(e){this.imageLink=e},getImageLink:function(){return this.imageLink},setCategoryID:function(e){this.categoryID=e},getCategoryID:function(){return this.categoryID},setGeometry:function(e){this.geometry=e},getGeometry:function(){return this.geometry},setCreateDate:function(e){this.createDate=e},getCreateDate:function(){return this.createDate},setUpdateDate:function(e){this.updateDate=e},getUpdateDate:function(){return this.updateDate},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory",function(){this.id=void 0,this.name=void 0,this._isDefault=!1,this._isPublic=!1,this.lineStyle="",this.lineCap=0,this.lineCorner=0,this.lineWidth=1,this.lineColor="3233ff",this.areaLineWidth=1,this.areaLineCorner=0,this.areaLineStyle="",this.areaLineColor="000000",this.areaFillColor="ffde00",this.areaFillStyle=-1,this.dotShape=1,this.dotSize=3,this.dotColor="000000",this.uuid=void 0},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDefault:function(e){this._isDefault=1==e},isDefault:function(){return 1==this._isDefault},setPublic:function(e){this._isPublic=1==e},isPublic:function(){return 1==this._isPublic},setLineStyle:function(e){this.lineStyle=e},getLineStyle:function(){return this.lineStyle},setLineCap:function(e){this.lineCap=e},getLineCap:function(){return this.lineCap},setLineCorner:function(e){this.lineCorner=e},getLineCorner:function(){return this.lineCorner},setLineWidth:function(e){this.lineWidth=e},getLineWidth:function(){return this.lineWidth},setLineColor:function(e){this.lineColor=e},getLineColor:function(){return this.lineColor},setAreaLineWidth:function(e){this.areaLineWidth=e},getAreaLineWidth:function(){return this.areaLineWidth},setAreaLineCorner:function(e){this.areaLineCorner=e},getAreaLineCorner:function(){return this.areaLineCorner},setAreaLineStyle:function(e){this.areaLineStyle=e},getAreaLineStyle:function(){return this.areaLineStyle},setAreaLineColor:function(e){this.areaLineColor=e},getAreaLineColor:function(){return this.areaLineColor},setAreaFillColor:function(e){this.areaFillColor=e},getAreaFillColor:function(){return this.areaFillColor},setAreaFillStyle:function(e){this.areaFillStyle=e},getAreaFillStyle:function(){return this.areaFillStyle},setDotShape:function(e){this.dotShape=e},getDotShape:function(){return this.dotShape},setDotSize:function(e){this.dotSize=e},getDotSize:function(){return this.dotSize},setDotColor:function(e){this.dotColor=e},getDotColor:function(){return this.dotColor},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.plugin.HoverPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MyPlaces.HoverPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(e){var t=this;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(){},onMove:function(){}}),this.hoverControl=new OpenLayers.Control.Hover({handlerOptions:{delay:500,pixelTolerance:6},onPause:function(i){var n=t._map.getLonLatFromPixel(i.xy),s=e.getEventBuilder("MyPlaces.MyPlaceHoverEvent")(n,i,t._map.getZoom());e.notifyAll(s)}}),this._map.addControl(this.hoverControl)},activate:function(){this.hoverControl.activate()},deactivate:function(){this.hoverControl.deactivate()},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditPlaceRequest",function(e){this._placeId=e},{__name:"MyPlaces.EditPlaceRequest",getName:function(){return this.__name},getId:function(){return this._placeId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.EditCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.DeleteCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.DeleteCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.PublishCategoryRequest",function(e,t){this._categoryId=e,this._isPublic=1==t},{__name:"MyPlaces.PublishCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId},isPublic:function(){return this._isPublic}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){var i=e.getSandbox();"MyPlaces.EditPlaceRequest"==t.getName()?this._handleEditPlace(i,t):"MyPlaces.EditCategoryRequest"==t.getName()?this._handleEditCategory(i,t):"MyPlaces.DeleteCategoryRequest"==t.getName()?this._handleDeleteCategory(i,t):"MyPlaces.PublishCategoryRequest"==t.getName()&&this._handlePublishCategory(i,t)},_handleEditPlace:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for place "+t.getId());var i=this.instance.getService(),n=i.findMyPlace(t.getId());if(n){var s=n.getGeometry().getCentroid(),r={lon:s.x,lat:s.y};this.instance.getDrawPlugin().startDrawing({geometry:n.getGeometry()}),this.instance.getMainView().showPlaceForm(r,n)}},_handleEditCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for category "+t.getId());var i=this.instance.getService(),n=i.findCategory(t.getId());n&&this.instance.getCategoryHandler().editCategory(n)},_handleDeleteCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] delete requested for category "+t.getId());var i=this.instance.getService(),n=i.findCategory(t.getId());n&&this.instance.getCategoryHandler().confirmDeleteCategory(n)},_handlePublishCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] (un/)publish requested for category "+t.getId());var i=this.instance.getService(),n=i.findCategory(t.getId());n&&this.instance.getCategoryHandler().confirmPublishCategory(n,t.isPublic())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.OpenAddLayerDialogRequest",function(e,t){this._originator=e,this._side=t},{__name:"MyPlaces.OpenAddLayerDialogRequest",getName:function(){return this.__name},getOriginator:function(){return this._originator},getSide:function(){return this._side}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.OpenAddLayerDialogHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){console.log("Caught request"),this.instance?(console.log("Opening dialog..."),this.instance.openAddLayerDialog(t.getOriginator(),t.getSide())):console.log("No MyPlacesTab in instance: ",this.instance)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",function(e,t,i,n,s){this._categoryList=[],this._placesList=[],this.wfstStore=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",e,t,s.featureNS),this._sandbox=i,this.defaultCategory=null,this.defaults=n,this._instance=s},{__qname:"Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",getQName:function(){return this.__qname},__name:"MyPlacesService",getName:function(){return this.__name},init:function(){var e=this;this.wfstStore.connect();var t=!1,i=!1,n=function(){i&&t&&e._notifyDataChanged()},s=function(i){if(i){var s;for(s=0;s<i.length;++s)e._addCategory(i[s])}var r=function(){t=!0,n()};e.getDefaultCategory()?r():e._createDefaultCategory(r)},r=function(t){t&&(e._placesList=t),i=!0,n()};this.wfstStore.getCategories(s),this.wfstStore.getMyPlaces(r)},_createDefaultCategory:function(e){var t=this,i=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");i.setName(t.defaultCategoryName),t.defaultCategoryName||i.setName("My map layer"),i.setName(this.defaults.name),i.setDotShape(this.defaults.point.shape),i.setDotColor(this.defaults.point.color),i.setDotSize(this.defaults.point.size),i.setLineStyle(this.defaults.line.style),i.setLineCap(this.defaults.line.cap),i.setLineCorner(this.defaults.line.corner),i.setLineWidth(this.defaults.line.width),i.setLineColor(this.defaults.line.color),i.setAreaLineWidth(this.defaults.area.linewidth),i.setAreaLineCorner(this.defaults.area.linecorner),i.setAreaLineStyle(this.defaults.area.linestyle),i.setAreaLineColor(this.defaults.area.linecolor),i.setAreaFillColor(this.defaults.area.color),i.setAreaFillStyle(this.defaults.area.fill),i.setDefault(!0);var n=function(){0===t.getAllCategories().length?t._instance.forceDisable():e()};this.saveCategory(i,n)},_addCategory:function(e){e.isDefault()&&(this.defaultCategory=e),this._categoryList.push(e)},_movePlacesToCategory:function(e,t,i){var n,s=this,r=s.getPlacesInCategory(e);if(0===r.length)return i(!0),void 0;for(n=0;n<r.length;n++)r[n].setCategoryID(t);var a=function(e){s._notifyDataChanged(),i(e)};this.wfstStore.commitMyPlaces(r,a)},_deletePlacesInCategory:function(e,t){var i,n=this.getPlacesInCategory(e),s=[];for(i=0;i<n.length;i++)s.push(n[i].getId());if(0===s.length)return t(!0),void 0;var r=this,a=function(e,i){if(e){var s;for(s=0;s<n.length;s++)r._removeMyPlace(i[s]);r._notifyDataChanged()}t(e)};this.wfstStore.deleteMyPlaces(s,a)},parseDate:function(e){if(!e&&e.length<10)return[];var t=e.substring(0,4),i=e.substring(5,7),n=e.substring(8,10),s=[n+"."+i+"."+t],r="";if(29===e.length){r=e.substring(11);var a=r.split("+");r=a[0],r=r.split(".")[0];var o=r.split(":"),l=o[0],u=o[1],h=o[2];r=l+":"+u+":"+h,s.push(r)}return s},getPlacesInCategory:function(e){var t,i=[];for(t=0;t<this._placesList.length;t++)this._placesList[t].getCategoryID()===e&&i.push(this._placesList[t]);return i},deleteCategory:function(e,t,i){var n=this,s=function(t){t?n._deleteEmptyCategory(e,i):i(t)};if(t===!0){var r=n.getDefaultCategory();n._movePlacesToCategory(e,r.getId(),s)}else n._deletePlacesInCategory(e,s)},_deleteEmptyCategory:function(e,t){var i=this,n=function(e,n){e&&i._removeCategory(n[0]),t(e),i._notifyDataChanged()};this.wfstStore.deleteCategories([e],n)},_removeCategory:function(e){var t;for(t=0;t<this._categoryList.length;t++)if(this._categoryList[t].getId()===e){this._categoryList.splice(t,1);break}},saveCategory:function(e,t){var i=this,n=!e.getId(),s=function(s,r){if(n&&s)i._addCategory(r[0]);else{var a=i.findCategory(r[0].getId());a?(a.setName(e.getName()),a.setDotSize(e.getDotSize()),a.setDotColor(e.getDotColor()),a.setDotShape(e.getDotShape()),a.setLineWidth(e.getLineWidth()),a.setLineColor(e.getLineColor()),a.setLineCap(e.getLineCap()),a.setLineCorner(e.getLineCorner()),a.setLineStyle(e.getLineStyle()),a.setAreaLineWidth(e.getAreaLineWidth()),a.setAreaLineCorner(e.getAreaLineCorner()),a.setAreaLineStyle(e.getAreaLineStyle()),a.setAreaLineColor(e.getAreaLineColor()),a.setAreaFillColor(e.getAreaFillColor()),a.setAreaFillStyle(e.getAreaFillStyle()),a.setDefault(e.isDefault())):s=!1}i._notifyDataChanged(),t(s,r[0],n)};this.wfstStore.commitCategories([e],s)},getAllCategories:function(){return this._categoryList},getDefaultCategory:function(){return this.defaultCategory},_addMyPlace:function(e){this._placesList.push(e)},_removeMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);-1!==t&&this._placesList.splice(t,1)},_notifyDataChanged:function(){var e=this._sandbox.getEventBuilder("MyPlaces.MyPlacesChangedEvent")();this._sandbox.notifyAll(e)},deleteMyPlace:function(e,t){var i=this,n=function(e,n){e&&(i._removeMyPlace(n[0]),i._notifyDataChanged()),t(e,n[0])};this.wfstStore.deleteMyPlaces([e],n)},findMyPlaceByLonLat:function(e,t){var i,n,s,r,a=[],o=this.getAllMyPlaces();for(i=0;i<o.length;++i)n=o[i].getGeometry(),s=!1,"OpenLayers.Geometry.Point"===n.CLASS_NAME?(r=720-5*t*t,t>10?r=5:t>8?r=20:t>5&&(r=50),s=n.atPoint(e,r,r)):s=n.atPoint(e),s&&a.push(o[i]);return a},findMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);return-1!==t?this._placesList[t]:null},findCategory:function(e){var t=this.findBy(this._categoryList,"id",e);return-1!==t?this._categoryList[t]:null},findBy:function(e,t,i){var n;for(n=0;n<e.length;n++)if(e[n][t]===i)return n;return-1},saveMyPlace:function(e,t){var i=this,n=!e.getId(),s=function(s,r){if(n&&s)i._addMyPlace(r[0]);else if(r.length<1)s=!1;else{var a=i.findMyPlace(r[0].getId());a?(a.setName(e.getName()),a.setDescription(e.getDescription()),a.setAttention_text(e.getAttention_text()),a.setLink(e.getLink()),a.setCategoryID(e.getCategoryID()),a.setGeometry(e.getGeometry()),a.setUpdateDate(r[0].getUpdateDate())):s=!1}i._notifyDataChanged(),t(s,r[0],n)};this.wfstStore.commitMyPlaces([e],s)},getAllMyPlaces:function(){return this._placesList},publishCategory:function(e,t,i){var n=this.findCategory(e);n||i(!1);var s=this,r=this._sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{id:n.getId(),makePublic:t},url:r+"action_route=PublishMyPlaceLayer",success:function(e){e?(n.setPublic(t),i(!0),s._notifyDataChanged()):i(!1)},error:function(e){0!==e.status&&i(!1)}})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",function(e,t,i){this.uuid=t,this.protocols={},this.url=e,this.featureNS=i},{connect:function(){var e=this.url;this.protocols.categories=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",featureType:"categories",featureNS:this.featureNS,url:e}),this.protocols.my_places=new OpenLayers.Protocol.WFS({version:"1.0.0",srsName:"EPSG:3067",geometryName:"geometry",featureType:"my_places",featureNS:this.featureNS,url:e})},getCategories:function(e){var t=this.uuid,i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),n=this.protocols.categories,s=this;n.read({filter:i,callback:function(t){s._handleCategoriesResponse(t,e)}})},_handleCategoriesResponse:function(e,t){var i=this.uuid,n=e.features;if(null===n||void 0===n||0===n.length)return t&&t(),void 0;var s,r,a,o,l,u=[];for(s=0;s<n.length;s++)r=n[s],a=r.attributes,o=this._parseNumericId(r.fid),l=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory"),l.setId(o),l.setName(a.category_name),l.setDefault("true"===a["default"]),l.setLineWidth(a.stroke_width),l.setLineStyle(a.stroke_dasharray),l.setLineCap(a.stroke_linecap),l.setLineCorner(a.stroke_linejoin),l.setLineColor(this._formatColorFromServer(a.stroke_color)),l.setAreaLineWidth(a.border_width),l.setAreaLineStyle(a.border_dasharray),l.setAreaLineCorner(a.border_linejoin),l.setAreaLineColor(this._formatColorFromServer(a.border_color)),l.setAreaFillColor(this._formatColorFromServer(a.fill_color)),l.setAreaFillStyle(a.fill_pattern),l.setDotShape(a.dot_shape),l.setDotColor(this._formatColorFromServer(a.dot_color)),l.setDotSize(a.dot_size),l.setUUID(i),a.publisher_name&&l.setPublic(!0),u.push(l);t&&t(u)},_formatColorFromServer:function(e){return"#"===e.charAt(0)?e.substring(1):e},_prefixColorForServer:function(e){return"#"!==e.charAt(0)?"#"+e:e},commitCategories:function(e,t){var i,n,s,r,a,o=this.uuid,l=this.protocols.categories,u=this,h=[];for(i=0;i<e.length;i++)n=e[i],s=n.getId(),r={category_name:n.getName(),"default":n.isDefault(),stroke_width:n.getLineWidth(),stroke_dasharray:n.getLineStyle(),stroke_linecap:n.getLineCap(),stroke_linejoin:n.getLineCorner(),stroke_color:this._prefixColorForServer(n.getLineColor()),border_width:n.getAreaLineWidth(),border_dasharray:n.getAreaLineStyle(),border_linejoin:n.getAreaLineCorner(),border_color:this._prefixColorForServer(n.getAreaLineColor()),fill_color:this._prefixColorForServer(n.getAreaFillColor()),fill_pattern:n.getAreaFillStyle(),dot_color:this._prefixColorForServer(n.getDotColor()),dot_size:n.getDotSize(),dot_shape:n.getDotShape(),uuid:o},a=new OpenLayers.Feature.Vector(null,r),s?(a.fid=l.featureType+"."+s,a.state=OpenLayers.State.UPDATE):a.toState(OpenLayers.State.INSERT),h.push(a);l.commit(h,{callback:function(i){u._handleCommitCategoriesResponse(i,e,t)}})},_handleCommitCategoriesResponse:function(e,t,i){if(e.success()){var n,s,r,a,o,l=e.reqFeatures,u=e.insertIds||[];for(r=0,o=l.length;o>r;++r)s=l[r],n=s.state,n&&(n===OpenLayers.State.INSERT&&(s.fid=u[r],s.attributes.id=s.fid,a=this._parseNumericId(s.fid),t[r].setId(a)),s.state=null);i(!0,t)}else i(!1,t)},deleteCategories:function(e,t){var i,n,s,r,a=this.protocols.categories,o=this.uuid,l=[];for(i=0;i<e.length;i++)n=e[i],n&&(s={uuid:o},r=new OpenLayers.Feature.Vector(null,s),r.fid=a.featureType+"."+n,r.state=OpenLayers.State.DELETE,l.push(r));var u=this;a.commit(l,{callback:function(i){u._handleDeleteCategoriesResponse(i,e,t)}})},_handleDeleteCategoriesResponse:function(e,t,i){e.success()?i(!0,t):i(!1,t)},_parseNumericId:function(e){var t=e.split(".")[1];return t},getMyPlaces:function(e){var t=this.uuid,i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),n=this.protocols.my_places,s=this;n.read({filter:i,callback:function(t){s._handleMyPlacesResponse(t,e)}})},_handleMyPlacesResponse:function(e,t){var i=this.uuid,n=[],s=e.features;if(null===s||void 0===s||0===s.length||jQuery.isEmptyObject(s))return t&&t(n),void 0;
var r,a,o,l,u;for(r=0;r<s.length;r++)a=s[r],o=a.attributes,l=this._parseNumericId(a.fid),u=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace"),u.setId(l),u.setName(o.name),u.setDescription(o.place_desc),u.setAttention_text(o.attention_text),u.setLink(o.link),u.setImageLink(o.image_url),u.setCategoryID(o.category_id),u.setCreateDate(o.created),u.setUpdateDate(o.updated),u.setGeometry(a.geometry),u.setUUID(i),n.push(u);t&&t(n)},getMyPlacesByIdList:function(e,t){var i=this.uuid,n=this.protocols.my_places,s=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:i}),new OpenLayers.Filter.FeatureId({fids:e})]}),r=this;n.read({filter:s,callback:function(e){r._handleMyPlacesResponse(e,t)}})},commitMyPlaces:function(e,t){var i,n,s,r,a,o,l=this.protocols.my_places,u=this.uuid,h=[];for(i=0;i<e.length;i++)n=e[i],s=n.getId(),r=n.getGeometry(),a={name:n.getName(),place_desc:n.getDescription(),attention_text:n.getAttention_text(),link:n.getLink(),image_url:n.getImageLink(),category_id:n.getCategoryID(),uuid:u},o=new OpenLayers.Feature.Vector(r,a),s?(o.fid=l.featureType+"."+s,o.state=OpenLayers.State.UPDATE):o.toState(OpenLayers.State.INSERT),h.push(o);var c=this;l.commit(h,{callback:function(i){c._handleCommitMyPlacesResponse(i,e,t)}})},_handleCommitMyPlacesResponse:function(e,t,i){if(e.success()){var n,s,r,a,o,l=e.reqFeatures,u=e.insertIds||[],h=[];for(r=0,o=l.length;o>r;++r)s=l[r],n=s.state,n&&(n===OpenLayers.State.INSERT?(s.fid=u[r],s.attributes.id=s.fid,a=this._parseNumericId(s.fid),t[r].setId(a),h.push(a)):h.push(t[r].getId()),s.state=null);var c=function(e){e.length<1?i(!1,e):i(!0,e)};this.getMyPlacesByIdList(h,c)}else i(!1,t)},deleteMyPlaces:function(e,t){var i,n,s,r,a=this.protocols.my_places,o=this.uuid,l=[];for(i=0;i<e.length;i++)n=e[i],n&&(s={uuid:o},r=new OpenLayers.Feature.Vector(null,s),r.fid=a.featureType+"."+n,r.state=OpenLayers.State.DELETE,l.push(r));var u=this;a.commit(l,{callback:function(i){u._handleDeleteMyPlacesResponse(i,e,t)}})},_handleDeleteMyPlacesResponse:function(e,t,i){e.success()?i(!0,t):i(!1,t)},disconnect:function(){}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.MainView",function(e){this.instance=e,this.popupId="myplacesForm",this.form=void 0},{__name:"MyPlacesMainView",getName:function(){return this.__name},getSandbox:function(){return this.instance.sandbox},init:function(){},start:function(){var e,t=this,i=this.instance.sandbox;i.register(t);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(t,e);var n=i.findRegisteredModuleInstance("MainMapModule"),s={id:"MyPlaces",multipart:!0},r=Oskari.clazz.create("Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin",s);n.registerPlugin(r),n.startPlugin(r),this.drawPlugin=r},stop:function(){var e,t=this.instance.sandbox;for(e in this.eventHandlers)this.eventHandlers.hasOwnProperty(e)&&t.unregisterFromEventByName(this,e);t.unregister(this)},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this._cleanupPopup()},"DrawPlugin.FinishedDrawingEvent":function(e){this._handleFinishedDrawingEvent(e)},"DrawPlugin.ActiveDrawingEvent":function(e){this.form&&this.form.setMeasurementResult(e.getDrawing(),e.getDrawMode())}},_handleFinishedDrawingEvent:function(e){var t=e.getDrawing().getCentroid(),i={lon:t.x,lat:t.y};this.showPlaceForm(i)},showPlaceForm:function(e,t){var i=this,n=this.instance.sandbox;n.postRequestByName("DisableMapKeyboardMovementRequest");var s=this.instance.getLocalization();this.form=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",this.instance);var r=this.instance.getService().getAllCategories();if(t){var a={place:{id:t.getId(),name:t.getName(),link:t.getLink(),imageLink:t.getImageLink(),desc:t.getDescription(),attention_text:t.getAttention_text(),category:t.getCategoryID()}};this.form.setValues(a)}var o=this.drawPlugin.getDrawing();o&&("OpenLayers.Geometry.MultiLineString"===o.CLASS_NAME?this.form.setMeasurementResult(o,"line"):"OpenLayers.Geometry.MultiPolygon"===o.CLASS_NAME&&this.form.setMeasurementResult(o,"area"));var l=[{html:i.form.getForm(r),useButtons:!0,primaryButton:s.buttons.save,actions:{}}];l[0].actions[s.buttons.cancel]=function(){i._cleanupPopup();var e=i.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();i.instance.sandbox.request(i,e)},l[0].actions[s.buttons.save]=function(){i._saveForm()};var u=n.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(this.popupId,s.placeform.title,l,e,!0);n.request(i.getName(),u)},_validateForm:function(e){var t=[],i=this.instance.getCategoryHandler();t=i.validateCategoryFormValues(e.category);var n=this.instance.getLocalization("validation");return e.place.name?i.hasIllegalChars(e.place.name)&&t.push({name:"name",error:n.placeNameIllegal}):t.push({name:"name",error:n.placeName}),i.hasIllegalChars(e.place.desc)&&t.push({name:"desc",error:n.descIllegal}),t},_showValidationErrorMessage:function(e){var t,i,n=this.instance.getLocalization(),s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=s.createCloseButton(n.buttons.ok),a=jQuery("<ul></ul>");for(t=0;t<e.length;++t)i=jQuery("<li></li>"),i.append(e[t].error),a.append(i);s.show(n.validation.title,a,[r])},_saveForm:function(){if(this.form){var e=this,t=this.form.getValues(),i=this._validateForm(t);if(0!==i.length)return this._showValidationErrorMessage(i),void 0;if(t.category){var n=this.instance.getCategoryHandler().getCategoryFromFormValues(t.category),s=function(i,n,s){if(i)t.place.category=n.getId(),e.__savePlace(t.place);else{var r=e.instance.getLocalization("notification").error;s?e.instance.showMessage(r.title,r.addCategory):e.instance.showMessage(r.title,r.editCategory)}};this.instance.getService().saveCategory(n,s)}else this.__savePlace(t.place)}},__savePlace:function(e){var t,i=this;if(!e)return t=i.instance.getLocalization("notification").error,i.instance.showMessage(t.title,t.savePlace),void 0;var n=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace"),s=-1;e.id&&(n=this.instance.getService().findMyPlace(e.id),s=n.getCategoryID()),n.setId(e.id),n.setName(e.name),n.setLink(e.link),n.setImageLink(e.imageLink),n.setDescription(e.desc),n.setAttention_text(e.attention_text),n.setCategoryID(e.category),n.setGeometry(this.drawPlugin.getDrawing());var r=this.instance.sandbox,a=function(e,a,o){if(e){var l,u=i.instance.getCategoryHandler()._getMapLayerId(n.getCategoryID()),h=r.getRequestBuilder("AddMapLayerRequest"),c=r.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),p=h(u,!0);r.request(i,p),o?(l=c(u,!0),r.request(i,l)):(l=c(u,!0),r.request(i,l),s!==n.getCategoryID()&&(u=i.instance.getCategoryHandler()._getMapLayerId(s),p=h(u,!0),r.request(i,p))),i._cleanupPopup();var d=Oskari.clazz.create("Oskari.userinterface.component.Popup");t=i.instance.getLocalization("notification").placeAdded,d.show(t.title,t.message),d.fadeout(),i.drawPlugin.stopDrawing()}else t=i.instance.getLocalization("notification").error,i.instance.showMessage(t.title,t.savePlace)};this.instance.getService().saveMyPlace(n,a)},_cleanupPopup:function(){if(this.form){var e=this.instance.sandbox,t=e.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.popupId);e.request(this,t),this.form.destroy(),this.form=void 0,e.postRequestByName("EnableMapKeyboardMovementRequest"),this.instance.enableGfi(!0)}}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",function(e){this.instance=e,this.newCategoryId="-new-",this.placeId=void 0,this.initialValues=void 0;var t=e.getLocalization("placeform");this.template=jQuery('<div class="myplacesform"><div class="field"><div class="help icon-info" title="'+t.tooltip+'"></div>'+'<input type="text" name="placename" placeholder="'+t.placename.placeholder+'"/>'+"</div>"+'<div class="field">'+'<textarea name="placedesc" placeholder="'+t.placedesc.placeholder+'">'+"</textarea>"+"</div>"+'<div class="field">'+'<input type="text" name="placeAttention" placeholder="'+t.placeAttention.placeholder+'"/>'+"</div>"+'<div class="field measurementResult">'+"</div>"+'<div class="field">'+'<input type="text" name="placelink" placeholder="'+t.placelink.placeholder+'"/>'+"</div>"+'<div class="field">'+'<input type="text" name="imagelink" placeholder="'+t.imagelink.placeholder+'"/>'+"</div>"+'<div class="field imagePreview">'+"<label>"+t.imagelink.previewLabel+'</label><br clear="all" />'+'<a class="myplaces_imglink" target="_blank"><img src=""></img></a>'+"</div>"+'<div class="field" id="newLayerForm">'+'<label for="category">'+'<a href="#" class="newLayerLink">'+t.category.newLayer+"</a>"+t.category.choose+'</label><br clear="all" />'+'<select name="category" autofocus>'+"</select>"+"</div>"+"</div>"),this.templateOption=jQuery("<option></option>"),this.categoryForm=void 0},{getForm:function(e){var t=this.template.clone();if(this.instance.getLocalization("placeform"),e){var i,n,s,r=t.find("select[name=category]");for(n=0;n<e.length;++n)s=e[n],i=this.templateOption.clone(),i.append(s.getName()),i.attr("value",s.getId()),this.initialValues?this.initialValues.place.category===s.getId()&&i.attr("selected","selected"):s.isDefault()&&i.attr("selected","selected"),r.append(i);this._bindCategoryChange()}this._bindImageUrlChange(),this._bindCreateNewLayer(),this.initialValues&&(t.find("input[name=placename]").attr("value",this.initialValues.place.name),t.find("textarea[name=placedesc]").append(this.initialValues.place.desc),t.find("input[name=placeAttention]").attr("value",this.initialValues.place.attention_text),t.find("input[name=placelink]").attr("value",this.initialValues.place.link),t.find("input[name=imagelink]").attr("value",this.initialValues.place.imageLink));var a=t.find("div.measurementResult");return this.measurementResult?a.html(this.measurementResult):a.remove(),t},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){var i=t.find("input[name=placename]").val(),n=t.find("textarea[name=placedesc]").val(),s=t.find("input[name=placeAttention]").val(),r=t.find("input[name=placelink]").val();r&&((-1===r.indexOf("://")||r.indexOf("://")>6)&&(r="http://"+r),r=r.replace("<",""),r=r.replace(">",""));var a=t.find("input[name=imagelink]").val(),o=t.find("select[name=category]").val();e.place={name:i,desc:n,attention_text:s,link:r,imageLink:a,category:o},this.placeId&&(e.place.id=this.placeId)}return this.categoryForm&&(e.category=this.categoryForm.getValues()),e},setValues:function(e){this.placeId=e.place.id;var t=this._getOnScreenForm();t.length>0&&(t.find("input[name=placename]").val(e.place.name),t.find("textarea[name=placedesc]").val(e.place.desc),t.find("input[name=placeAttention]").val(e.place.attention_text),t.find("input[name=placelink]").val(e.place.link),t.find("input[name=imagelink]").val(e.place.imageLink),t.find("select[name=category]").val(e.place.category)),this.initialValues=e},setMeasurementResult:function(e,t){var i=this.instance.getLocalization("placeform"),n=this.instance.formatMeasurementResult(e,t);this.measurementResult=i.measurement[t]+n,this._getOnScreenForm().find("div.measurementResult").html(this.measurementResult)},_bindCategoryChange:function(){var e=this,t=this._getOnScreenForm();t.find("select[name=category]").live("change",function(){e.categoryForm&&(e.categoryForm.destroy(),e.categoryForm=void 0)})},_bindImageUrlChange:function(){var e=this,t=e._getOnScreenForm();t.find("input[name=imagelink]").live("change",function(){var t=e._getOnScreenForm(),i=jQuery(this).val();t.find("div.imagePreview").find("img").attr("src",i),t.find("a.myplaces_imglink").attr({href:i})})},_bindCreateNewLayer:function(){var e=this,t=e._getOnScreenForm();t.find("a.newLayerLink").live("click",function(t){var i=e._getOnScreenForm();t.preventDefault(),e.categoryForm=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",e.instance),i.find("div#newLayerForm").html(e.categoryForm.getForm()),e.categoryForm.start()})},destroy:function(){var e=this._getOnScreenForm();e.find("select[name=category]").die(),e.find("input[name=imagelink]").die(),e.find("a.newLayerLink").die(),this.categoryForm&&(this.categoryForm.destroy(),this.categoryForm=void 0)},_getOnScreenForm:function(){return jQuery("div.myplacesform")}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",function(e){this.instance=e;var t=null,i=null;e.conf&&e.conf.defaults&&(t=e.conf.defaults.dotMinSize,i=e.conf.defaults.dotMaxSize);var n={forms:["dot","line","area"],formValues:{dot:{size:e.myPlacesService.defaults.point.size,color:e.myPlacesService.defaults.point.color,shape:e.myPlacesService.defaults.point.shape,dotMinSize:t,dotMaxSize:i},line:{style:e.myPlacesService.defaults.line.style,cap:e.myPlacesService.defaults.line.cap,corner:e.myPlacesService.defaults.line.corner,width:e.myPlacesService.defaults.line.width,color:e.myPlacesService.defaults.line.color},area:{line:{style:e.myPlacesService.defaults.area.linestyle,corner:e.myPlacesService.defaults.area.linecorner,width:e.myPlacesService.defaults.area.linewidth,color:e.myPlacesService.defaults.area.linecolor},fill:{style:e.myPlacesService.defaults.area.fill,color:e.myPlacesService.defaults.area.color}}}};this.visualizationForm=Oskari.clazz.create("Oskari.userinterface.component.VisualizationForm",n);var s=e.getLocalization("categoryform");this.template=jQuery('<div class="myplacescategoryform"><div class="field"><label for="categoryname">'+s.name.label+'</label><br clear="all" />'+'<input type="text" name="categoryname" placeholder="'+s.name.placeholder+'"/>'+"</div>"+'<div class="field drawing">'+"<label>"+s.drawing.label+'</label><br clear="all" />'+'<div class="rendering"></div>'+"</div>"+'<div class="field visibleFields">'+"<label>"+s.visibleFields.label+'</label><br clear="all" />'+'<input type="checkbox" name="placename" checked="checked" />'+s.visibleFields.placename+"<br/>"+'<input type="checkbox" name="placedesc" checked="checked" />'+s.visibleFields.placedesc+"<br/>"+'<input type="checkbox" name="image" checked="checked" />'+s.visibleFields.image+"<br/>"+"</div>"+"</div>"),this.templateTableRow=jQuery("<tr></tr>"),this.templateTableCell=jQuery("<td></td>"),this.templateTextInput=jQuery('<input type="text"/>'),this.categoryId=void 0,this._isDefault=void 0},{start:function(){},getForm:function(){var e=this.template.clone();e.find("div.drawing table");var t=e.find("div.rendering");return t.append(this.visualizationForm.getForm()),e},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){e.name=t.find("input[name=categoryname]").val(),this.categoryId&&(e.id=this.categoryId),e._isDefault=this._isDefault||!1;var i=this.visualizationForm.getValues();e.dot=i.dot,e.line=i.line,e.area=i.area,e.visibleFields=[],t.find("div.visibleFields").find("input[type=checkbox]:checked").each(function(){e.visibleFields.push(this.name)})}return e},setValues:function(e){this.categoryId=e.id,this._isDefault=e._isDefault;var t=this._getOnScreenForm();t.length>0&&this._checkVisibleFields(t,e.visibleFields),this.visualizationForm.setValues(e)},_getOnScreenForm:function(){return jQuery("div.myplacescategoryform")},_checkVisibleFields:function(e,t){e.find("div.visibleFields input[type=checkbox]").each(function(e,i){i.removeAttr("checked");var n;for(t?t.length:0,n=0;fLen>n;++n)t[n]===i.attr("name")&&i.attr("checked","checked")})},destroy:function(){this.dialog&&this.dialog.close();var e=this._getOnScreenForm();e.remove()}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.ButtonHandler",function(e){this.instance=e,this.buttonGroup="myplaces",this.measureButtonGroup="basictools",this.ignoreEvents=!1,this.dialog=null;var t=this;this.buttons={point:{iconCls:"myplaces-draw-point",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"point"})}},line:{iconCls:"myplaces-draw-line",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"line"})}},area:{iconCls:"myplaces-draw-area",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"area"})}}},this.templateGuide=jQuery('<div><div class="guide"></div><div class="buttons"><div class="cancel button"></div><div class="finish button"></div></div></div>'),this.templateHelper=jQuery('<div class="drawHelper"><div class="infoText"></div><div class="measurementResult"></div></div>')},{__name:"MyPlacesButtonHandler",getName:function(){return this.__name},init:function(){var e,t,i=this.instance.getLocalization("tools"),n=this.instance.sandbox.getUser(),s=" - "+this.instance.getLocalization("guest").loginShort;for(e in this.buttons)this.buttons.hasOwnProperty(e)&&(t=i[e].tooltip,n.isLoggedIn()||(t+=s),this.buttons[e].tooltip=t)},start:function(){var e,t,i,n=this,s=n.instance.sandbox;s.register(n);for(e in n.eventHandlers)n.eventHandlers.hasOwnProperty(e)&&s.registerForEventByName(n,e);var r=s.getRequestBuilder("Toolbar.AddToolButtonRequest");for(t in this.buttons)if(this.buttons.hasOwnProperty(t)&&(s.request(this,r(t,this.buttonGroup,this.buttons[t])),s.getUser().isLoggedIn())){var a=n.instance.getLocalization();"line"===t&&(console.log("LINE"),i=jQuery.extend(!0,{},this.buttons[t]),i.callback=function(){n.startNewDrawing({drawMode:"measureline"})},i.iconCls="tool-measure-line",i.tooltip=a.tools.measureline.tooltip,s.request(this,r(t,this.measureButtonGroup,i))),"area"===t&&(console.log("AREA"),i=jQuery.extend(!0,{},this.buttons[t]),i.callback=function(){n.startNewDrawing({drawMode:"measurearea"})},i.iconCls="tool-measure-area",i.tooltip=a.tools.measurearea.tooltip,s.request(this,r(t,this.measureButtonGroup,i)))}var o=this.instance.sandbox.getUser();o.isLoggedIn()||this.disableButtons()},disableButtons:function(){var e=this.instance.sandbox,t=e.getRequestBuilder("Toolbar.ToolButtonStateRequest");e.request(this,t(void 0,this.buttonGroup,!1))},startNewDrawing:function(e){var t=this.instance.sandbox.getEventBuilder("DrawPlugin.SelectedDrawingEvent")();this.instance.sandbox.notifyAll(t),this.sendDrawRequest(e),this.instance.enableGfi(!1)},sendDrawRequest:function(e){var t=jQuery.extend(!0,{},e);"measureline"===t.drawMode?t.drawMode="line":"measurearea"===t.drawMode&&(t.drawMode="area");var i=this.instance.sandbox.getRequestBuilder("DrawPlugin.StartDrawingRequest")(t);this.instance.sandbox.request(this,i),e.geometry||(console.log(e),this._showDrawHelper(e.drawMode))},_showDrawHelper:function(e){console.log("_showDrawHelper ",e);var t=this,i=this.instance.getLocalization("tools")[e],n=this.instance.getLocalization("buttons"),s=i.title,r=i.add,a=Oskari.clazz.create("Oskari.userinterface.component.Popup");this.dialog=a;var o=[],l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.setTitle(n.cancel),l.setHandler(function(){var e=t.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();t.instance.sandbox.request(t,e),t.sendStopDrawRequest(!0)}),o.push(l);var u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(n.finish),u.addClass("primary"),u.setHandler(function(){t.sendStopDrawRequest()}),o.push(u),t.instance.sandbox.getUser().isLoggedIn()&&("line"===e||"area"===e)&&(l.setTitle(n.close),u.setTitle(n.saveAsMyPlace));var h=this.templateHelper.clone();h.find("div.infoText").html(r);var c=h.find("div.measurementResult");"point"===e?c.remove():c.html(i.noResult),a.show(s,h,o),a.addClass("myplaces2"),a.moveTo("#toolbar div.toolrow[tbgroup=default-myplaces]","top")},sendStopDrawRequest:function(e){var t=this.instance.sandbox.getRequestBuilder("DrawPlugin.StopDrawingRequest")(e);this.instance.sandbox.request(this,t),this.dialog&&this.dialog.close()},stop:function(){jQuery("div.myplaces2 div.button").die()},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.ignoreEvents||(this.sendStopDrawRequest(!0),this.instance.enableGfi(!0))},"DrawPlugin.SelectedDrawingEvent":function(e){if(!e.getPlace()){var t=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,t)}},"DrawPlugin.FinishedDrawingEvent":function(){this.ignoreEvents=!0;var e=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,e),this.ignoreEvents=!1,this.instance.enableGfi(!1),this.dialog&&this.dialog.close()},"DrawPlugin.AddedFeatureEvent":function(e){var t=e.getDrawingMode();if(void 0!==t&&null!==t){var i=this.instance.getLocalization("tools"),n=i[t].next,s=this.dialog.getJqueryContent();s.find("div.infoText")!==n&&(s.find("div.infoText").html(n),this.dialog.moveTo("#toolbar div.toolrow[tbgroup=default-myplaces]","top"))}},"DrawPlugin.ActiveDrawingEvent":function(e){var t=e.getDrawing(),i=e.getDrawMode(),n=this.instance.formatMeasurementResult(t,i);if(this.dialog){var s=this.dialog.getJqueryContent();s.find("div.measurementResult").html(n)}}}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.CategoryHandler",function(e){this.instance=e,this.initialLoad=!0,this.validateTool=Oskari.clazz.create("Oskari.userinterface.component.FormInput")},{__name:"MyPlacesCategoryHandler",getName:function(){return this.__name},init:function(){},start:function(){var e,t=this,i=this.instance.sandbox,n=i.getUser();if(n.isLoggedIn()){i.register(t);for(e in t.eventHandlers)t.eventHandlers.hasOwnProperty(e)&&i.registerForEventByName(t,e)}},stop:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(){this._handlePlacesChanged()}},_handlePlacesChanged:function(){var e,t,i,n,s,r=this.instance.sandbox,a=r.getService("Oskari.mapframework.service.MapLayerService"),o=this.instance.getService().getAllCategories(),l=a.getAllLayersByMetaType(this.instance.idPrefix);for(e=0;e<l.length;++e){for(t=l[e],i=!1,n=0;n<o.length;++n)s=o[n],this._getMapLayerId(s.getId())===t.getId()&&(i=!0);i||(r.requestByName(this.getName(),"RemoveMapLayerRequest",[t.getId()]),a.removeLayer(t.getId()))}for(n=0;n<o.length;++n){for(s=o[n],i=!1,e=0;e<l.length;++e)if(this._getMapLayerId(s.getId())===l[e].getId()&&(i=!0,s.getName()!==l[e].getName())){var u={name:s.getName()};a.updateLayer(l[e].getId(),u)}if(!i){var h=this._getMapLayerJson(s),c=a.createMapLayer(h);a.addLayer(c,this.initialLoad)}}if(this.initialLoad){var p=r.getEventBuilder("MapLayerEvent")(null,"add");r.notifyAll(p),this._processStartupLinkLayers(r),this.initialLoad=!1}},addLayerToMap:function(e){var t=this._getMapLayerId(e),i=this.sandbox.findMapLayerFromSelectedMapLayers(t);if(!i){var n=this.sandbox.getRequestBuilder("AddMapLayerRequest")(t,!0);this.sandbox.request(this.getName(),n)}},addLayerToService:function(e){var t=this._sandbox.getService("Oskari.mapframework.service.MapLayerService"),i=this._getMapLayerJson(e),n=t.createMapLayer(i);t.addLayer(n)},_getMapLayerId:function(e){if(!e){var t=this.myPlacesService.getDefaultCategory();e=t?t.getId():"-99"}return this.instance.idPrefix+"_"+e},_getMapLayerJson:function(e){var t=this._getMapLayerJsonBase();return t.wmsUrl=this.instance.conf.wmsUrl+e.getId()+"&",t.name=e.getName(),t.id=this._getMapLayerId(e.getId()),t.permissions=e.isPublic()?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"},t},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("category"),t={wmsName:"oskari:my_places_categories",type:"myplaceslayer",isQueryable:!0,opacity:50,metaType:this.instance.idPrefix,orgName:e.organization,inspire:e.inspire};if(this.instance.conf&&this.instance.conf.layerDefaults&&"object"==typeof this.instance.conf.layerDefaults){var i,n=this.instance.conf.layerDefaults;for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t},_processStartupLinkLayers:function(e){var t=e.getRequestParameter("mapLayers");if(null!==t&&""!==t){var i,n,s,r,a,o,l=t.split(","),u=!0;for(i=0;i<l.length;i++)n=l[i].split("+"),s=n[0],r=n[1],null!==s&&-1!==s.indexOf(this.instance.idPrefix)&&(a=null,o=null,a=e.getRequestBuilder("AddMapLayerRequest"),o=a(s,u),e.request(this.getName(),o),a=e.getRequestBuilder("ChangeMapLayerOpacityRequest"),o=a(s,r),e.request(this.getName(),o))}},editCategory:function(e){var t=this;this.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest");var i=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",t.instance),n={name:e.getName(),id:e.getId(),_isDefault:e.isDefault(),dot:{size:e.getDotSize(),color:e.getDotColor(),shape:null!==e.getDotShape()&&void 0!==e.getDotShape()?e.getDotShape():1},line:{cap:e.getLineCap(),corner:e.getLineCorner(),style:e.getLineStyle(),width:e.getLineWidth(),color:e.getLineColor()},area:{lineWidth:e.getAreaLineWidth(),lineCorner:e.getAreaLineCorner(),lineStyle:e.getAreaLineStyle(),lineColor:e.getAreaLineColor(),fillColor:e.getAreaFillColor(),fillStyle:e.getAreaFillStyle()}};i.setValues(n);var s=i.getForm();s.find("input[name=categoryname]").val(e.name);var r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=[],o=Oskari.clazz.create("Oskari.userinterface.component.Button"),l=this.instance.getLocalization("buttons"),u=this.instance.getLocalization("categoryform").edit;o.setTitle(l.save),o.addClass("primary"),o.setHandler(function(){var e=i.getValues(),n=t.validateCategoryFormValues(e);if(0!==n.length)return t.showValidationErrorMessage(n),void 0;var s=t.getCategoryFromFormValues(e);t.saveCategory(s),r.close(),t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var h=Oskari.clazz.create("Oskari.userinterface.component.Button");h.setTitle(l.cancel),h.setHandler(function(){r.close()}),a.push(h),a.push(o),r.show(u.title,s,a),r.moveTo("div.personaldata ul li select","right"),r.makeModal(),i.start()},showValidationErrorMessage:function(e){var t=this.instance.getLocalization(),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=Oskari.clazz.create("Oskari.userinterface.component.Button");n.setTitle(t.buttons.ok),n.addClass("primary"),n.setHandler(function(){i.close(!0)});var s,r,a=jQuery("<ul></ul>");for(s=0;s<e.length;++s)r=jQuery("<li></li>"),r.append(e[s].error),a.append(r);i.show(t.validation.title,a,[n])},_showMessage:function(e,t){var i=this.instance.getLocalization(),n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(i.buttons.ok),s.addClass("primary"),s.setHandler(function(){n.close(!0)}),n.show(e,t,[s])},hasIllegalChars:function(e){return this.validateTool.setValue(e),!this.validateTool.checkValue()},_validateNumber:function(e,t,i){return this.validateTool.validateNumberRange(e,t,i)},_isColor:function(e){return this.validateTool.validateHexColor(e)},validateCategoryFormValues:function(e){var t=[];if(!e)return t;var i=this.instance.getLocalization("validation");return e.name?this.hasIllegalChars(e.name)&&t.push({field:"name",error:i.categoryNameIllegal}):t.push({field:"name",error:i.categoryName}),this._validateNumber(e.dot.shape,0,6)||t.push({field:"dotShape",error:i.dotShape}),this._validateNumber(e.dot.size,1,5)||t.push({field:"dotSize",error:i.dotSize}),this._isColor(e.dot.color)||t.push({field:"dotColor",error:i.dotColor}),this._validateNumber(e.line.width,1,50)||t.push({field:"lineWidth",error:i.lineSize}),this._isColor(e.line.color)||t.push({field:"lineColor",error:i.lineColor}),this._validateNumber(e.area.lineWidth,0,50)||t.push({field:"areaLineWidth",error:i.areaLineSize}),this._isColor(e.area.lineColor)||t.push({field:"areaLineColor",error:i.areaLineColor}),this._isColor(e.area.fillColor)||t.push({field:"areaFillColor",error:i.areaFillColor}),t},getCategoryFromFormValues:function(e){var t=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");return t.setName(e.name),t.setId(e.id),t.setDotSize(e.dot.size),t.setDotColor(e.dot.color),t.setDotShape(e.dot.shape),t.setLineWidth(e.line.width),t.setLineColor(e.line.color),t.setLineCap(e.line.cap),t.setLineCorner(e.line.corner),t.setLineStyle(e.line.style),t.setAreaLineWidth(e.area.lineWidth),t.setAreaLineColor(e.area.lineColor),t.setAreaLineCorner(e.area.lineCorner),t.setAreaLineStyle(e.area.lineStyle),t.setAreaFillColor(e.area.fillColor),t.setAreaFillStyle(e.area.fillStyle),t.setDefault(e._isDefault),t},saveCategory:function(e){var t=this,i=t.instance.getLocalization("notification"),n=function(n,s,r){if(n){var a=Oskari.clazz.create("Oskari.userinterface.component.Popup");a.show(i.categorySaved.title,i.categorySaved.message),a.fadeout();var o=t._getMapLayerId(e.getId()),l=t.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(o,!0);t.instance.sandbox.request(t,l)}else r?t.instance.showMessage(i.error.title,i.error.addCategory):t.instance.showMessage(i.error.title,i.error.editCategory)};this.instance.getService().saveCategory(e,n)},confirmDeleteCategory:function(e){var t,i,n=this,s=n.instance.getLocalization("buttons"),r=this.instance.getService(),a=r.getDefaultCategory(),o=Oskari.clazz.create("Oskari.userinterface.component.Popup");if(a.getId()===e.getId()){t=n.instance.getLocalization();var l=o.createCloseButton(t.buttons.ok);return o.show(t.notification.error.title,t.notification.error.deleteDefault,[l]),void 0}var u=r.getPlacesInCategory(e.getId()),h=[],c=o.createCloseButton(s.cancel);h.push(c),t=n.instance.getLocalization("notification");var p="";if(u.length>0){i=Oskari.clazz.create("Oskari.userinterface.component.Button"),i.setTitle(s.deleteCategoryAndPlaces),i.setHandler(function(){o.close(),n._deleteCategory(e,!1)}),h.push(i);var d=Oskari.clazz.create("Oskari.userinterface.component.Button");d.setTitle(s.movePlaces),d.addClass("primary"),d.setHandler(function(){o.close(),n._deleteCategory(e,!0)}),h.push(d);var m=[e.getName(),u.length,a.getName()];p=this._formatMessage(t.categoryDelete.deleteConfirmMove,m)}else i=Oskari.clazz.create("Oskari.userinterface.component.Button"),i.setTitle(s.deleteCategory),i.addClass("primary"),h.push(i),i.setHandler(function(){o.close(),n._deleteCategory(e,!1)}),p=this._formatMessage(t.categoryDelete.deleteConfirm,[e.getName()]);o.show(t.categoryDelete.title,p,h),o.makeModal()},_formatMessage:function(e,t){var i,n=e;for(i=0;i<t.length;++i)n=n.replace("{"+i+"}",t[i]);return n},_deleteCategory:function(e,t){var i=this,n=e.getId(),s=function(e){i._deleteCategoryCallback(e,t,n)},r=this.instance.getService();r.deleteCategory(n,t,s)},_deleteCategoryCallback:function(e,t){var i,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=this.instance.getService(),r=this;if(e){if(t){var a=s.getDefaultCategory(),o=this._getMapLayerId(a.getId()),l=this.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(o,!0);this.instance.sandbox.request(this,l)}i=r.instance.getLocalization(),n.show(i.notification.categoryDelete.title,i.notification.categoryDelete.deleted),n.fadeout()}else{i=r.instance.getLocalization();var u=n.createCloseButton(i.buttons.ok);n.show(i.notification.error.title,i.notification.error.deleteCategory,[u])}},confirmPublishCategory:function(e,t){var i,n=this,s=n.instance.getLocalization(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=this.instance.getService(),o=[],l=r.createCloseButton(s.buttons.cancel);o.push(l);var u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.addClass("primary"),u.setHandler(function(){a.publishCategory(e.getId(),t,function(i){n._handlePublishCategory(e,t,i)}),r.close()}),o.push(u);var h=[e.getName()];t?(u.setTitle(s.buttons.changeToPublic),i=this._formatMessage(s.notification.categoryToPublic.message,h),r.show(s.notification.categoryToPublic.title,i,o)):(u.setTitle(s.buttons.changeToPrivate),i=this._formatMessage(s.notification.categoryToPrivate.message,h),r.show(s.notification.categoryToPrivate.title,i,o))
},_handlePublishCategory:function(e,t,i){var n;if(!i)return n=this.instance.getLocalization("notification"),this._showMessage(n.error.title,n.error.generic),void 0;var s=this.instance.sandbox,r=s.getService("Oskari.mapframework.service.MapLayerService"),a=this._getMapLayerId(e.getId()),o=r.findMapLayer(a);if(!o)return n=this.instance.getLocalization("notification"),this._showMessage(n.error.title,n.error.generic),void 0;t?o.addPermission("publish","publication_permission_ok"):o.addPermission("publish","no_publication_permission");var l=s.getEventBuilder("MapLayerEvent")(a,"update");s.notifyAll(l)}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance",function(){this._localization=null,this.sandbox=null,this.buttons=void 0,this.categoryHandler=void 0,this.myPlacesService=void 0,this.featureNS=void 0,this.idPrefix="myplaces"},{__name:"MyPlaces2",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization&&this._localization[e]?this._localization[e]:e:this._localization},showMessage:function(e,t){var i=this.getLocalization(),n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(i.buttons.ok),s.addClass("primary"),s.setHandler(function(){n.close(!0)}),n.show(e,t,[s])},forceDisable:function(){this.buttons.disableButtons();var e=this.getLocalization();this.showMessage(e.category.organization+" - "+e.notification.error.title,e.notification.error.generic)},enableGfi:function(e){var t=this.sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");t&&this.sandbox.request(this.buttons,t(e))},getService:function(){return this.myPlacesService},getDrawPlugin:function(){return this.view.drawPlugin},getCategoryHandler:function(){return this.categoryHandler},getMainView:function(){return this.view},update:function(){},init:function(){},start:function(){var e=this,t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);if(this.sandbox=n,this.featureNS=t?t.featureNS:null,this.featureNS){n.printDebug("Initializing my places module..."),this.buttons=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.ButtonHandler",this),this.buttons.start();var s=n.getUser();if(s.isLoggedIn()){n.register(e),this.categoryHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.CategoryHandler",this),this.categoryHandler.start();var r=this._getCategoryDefaults(),a=this.conf.queryUrl;this.myPlacesService=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",a,s.getUuid(),n,r,this),this.sandbox.registerService(this.myPlacesService),this.myPlacesService.init(),this.view=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.MainView",this),this.view.start(),this.editRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",n,e),this.openAddLayerDialogHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.OpenAddLayerDialogHandler",n,e),n.addRequestHandler("MyPlaces.EditPlaceRequest",this.editRequestHandler),n.addRequestHandler("MyPlaces.EditCategoryRequest",this.editRequestHandler),n.addRequestHandler("MyPlaces.DeleteCategoryRequest",this.editRequestHandler),n.addRequestHandler("MyPlaces.PublishCategoryRequest",this.editRequestHandler),n.addRequestHandler("MyPlaces.OpenAddLayerDialogRequest",this.openAddLayerDialogHandler);var o=this.getLocalization("tab");this.tab=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.MyPlacesTab",this,o),this.tab.initContainer(),this.tab.bindEvents&&this.tab.bindEvents();var l=this.tab.getTitle(),u=this.tab.getContent(),h=!0,c="PersonalData.AddTabRequest",p=n.getRequestBuilder(c),d=p(l,u,h);n.request(this,d)}}},stop:function(){this.sandbox=null},openAddLayerDialog:function(e,t){var i=this,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",i),r=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.CategoryHandler",i),a=i.getLocalization("buttons"),o=[],l=Oskari.clazz.create("Oskari.userinterface.component.Button"),u=n.createCloseButton(a.cancel);l.setTitle(a.save),l.addClass("primary"),l.setHandler(function(){var e=s.getValues(),t=r.validateCategoryFormValues(e);if(0!==t.length)return r.showValidationErrorMessage(t),void 0;var a=r.getCategoryFromFormValues(e);r.saveCategory(a),n.close(),i.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")}),o.push(u),o.push(l),n.show(i.getLocalization("tab").addCategory,s.getForm(),o),e&&n.moveTo(e,t),n.makeModal(),s.start()},_getCategoryDefaults:function(){var e={name:this.getLocalization("category").defaultName,point:{shape:1,color:"000000",size:3},line:{style:"",cap:0,corner:0,width:1,color:"3233ff"},area:{linestyle:"",linecorner:0,linewidth:1,linecolor:"000000",color:"ffde00",fill:-1}};if(!this.conf)return e;if(!this.conf.defaults)return e;for(var t in e)this.conf.defaults[t]&&(e[t]=this.conf.defaults[t]);return e},formatMeasurementResult:function(e,t){var i,n;if("area"===t)i=Math.round(100*e.getArea())/100,n=" m²",i>=1e6&&(i=Math.round(i)/1e6,n=" km²");else{if("line"!==t)return"";i=Math.round(100*e.getLength())/100,n=" m",i>=1e3&&(i=Math.round(i)/1e3,n=" km")}return(i+n).replace(".",",")},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},rgbToHex:function(e){if("#"===e.charAt(0))return e.substring(1);var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete t[0];for(var i=1;3>=i;++i)t[i]=parseInt(t[i]).toString(16),1==t[i].length&&(t[i]="0"+t[i]);return t.join("")}},{protocol:["Oskari.bundle.BundleInstance"]});var jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){jscolor.binding&&jscolor.bind(),jscolor.preloading&&jscolor.preload()},getDir:function(){if(!jscolor.dir){var e=jscolor.detectDir();jscolor.dir=e!==!1?e:"jscolor/"}return jscolor.dir},detectDir:function(){for(var e=location.href,t=document.getElementsByTagName("base"),i=0;i<t.length;i+=1)t[i].href&&(e=t[i].href);for(var t=document.getElementsByTagName("script"),i=0;i<t.length;i+=1)if(t[i].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(t[i].src)){var n=new jscolor.URI(t[i].src),s=n.toAbsolute(e);return s.path=s.path.replace(/[^\/]+$/,""),s.query=null,s.fragment=null,s.toString()}return!1},bind:function(){for(var matchClass=new RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i"),e=document.getElementsByTagName("input"),i=0;i<e.length;i+=1){var m;if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3])try{eval("prop="+m[3])}catch(eInvalidProp){}e[i].color=new jscolor.color(e[i],prop)}}},preload:function(){for(var e in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(e)&&jscolor.loadImage(e)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=!0},loadImage:function(e){jscolor.imgLoaded[e]||(jscolor.imgLoaded[e]=new Image,jscolor.imgLoaded[e].src=jscolor.getDir()+e)},fetchElement:function(e){return"string"==typeof e?document.getElementById(e):e},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},fireEvent:function(e,t){if(e)if(document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(document.createEventObject){var i=document.createEventObject();e.fireEvent("on"+t,i)}else e["on"+t]&&e["on"+t]()},getElementPos:function(e){var t=e,i=e,n=0,s=0;if(t.offsetParent)do n+=t.offsetLeft,s+=t.offsetTop;while(t=t.offsetParent);for(;(i=i.parentNode)&&"BODY"!==i.nodeName.toUpperCase();)n-=i.scrollLeft,s-=i.scrollTop;return[n,s]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,i=0;return e||(e=window.event),"number"==typeof e.offsetX?(t=e.offsetX,i=e.offsetY):"number"==typeof e.layerX&&(t=e.layerX,i=e.layerY),{x:t,y:i}},getViewPos:function(){return"number"==typeof window.pageYOffset?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return"number"==typeof window.innerWidth?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(e){function t(e){for(var t="";e;)if("../"===e.substr(0,3)||"./"===e.substr(0,2))e=e.replace(/^\.+/,"").substr(1);else if("/./"===e.substr(0,3)||"/."===e)e="/"+e.substr(3);else if("/../"===e.substr(0,4)||"/.."===e)e="/"+e.substr(4),t=t.replace(/\/?[^\/]*$/,"");else if("."===e||".."===e)e="";else{var i=e.match(/^\/?[^\/]*/)[0];e=e.substr(i.length),t+=i}return t}this.scheme=null,this.authority=null,this.path="",this.query=null,this.fragment=null,this.parse=function(e){var t=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=t[3]?t[2]:null,this.authority=t[5]?t[6]:null,this.path=t[7],this.query=t[9]?t[10]:null,this.fragment=t[12]?t[13]:null,this},this.toString=function(){var e="";return null!==this.scheme&&(e=e+this.scheme+":"),null!==this.authority&&(e=e+"//"+this.authority),null!==this.path&&(e+=this.path),null!==this.query&&(e=e+"?"+this.query),null!==this.fragment&&(e=e+"#"+this.fragment),e},this.toAbsolute=function(e){var e=new jscolor.URI(e),i=this,n=new jscolor.URI;return null===e.scheme?!1:(null!==i.scheme&&i.scheme.toLowerCase()===e.scheme.toLowerCase()&&(i.scheme=null),null!==i.scheme?(n.scheme=i.scheme,n.authority=i.authority,n.path=t(i.path),n.query=i.query):(null!==i.authority?(n.authority=i.authority,n.path=t(i.path),n.query=i.query):(""===i.path?(n.path=e.path,n.query=null!==i.query?i.query:e.query):("/"===i.path.substr(0,1)?n.path=t(i.path):(n.path=null!==e.authority&&""===e.path?"/"+i.path:e.path.replace(/[^\/]+$/,"")+i.path,n.path=t(n.path)),n.query=i.query),n.authority=e.authority),n.scheme=e.scheme),n.fragment=i.fragment,n)},e&&this.parse(e)},color:function(target,prop){function RGB_HSV(e,t,i){var n=Math.min(Math.min(e,t),i),s=Math.max(Math.max(e,t),i),r=s-n;if(0===r)return[null,0,s];var a=e===n?3+(i-t)/r:t===n?5+(e-i)/r:1+(t-e)/r;return[6===a?0:a,r/s,s]}function HSV_RGB(e,t,i){if(null===e)return[i,i,i];var n=Math.floor(e),s=n%2?e-n:1-(e-n),r=i*(1-t),a=i*(1-t*s);switch(n){case 6:case 0:return[i,a,r];case 1:return[a,i,r];case 2:return[r,i,a];case 3:return[r,a,i];case 4:return[a,r,i];case 5:return[i,r,a]}}function removePicker(){delete jscolor.picker.owner,document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(e,t){function i(){var e=THIS.pickerInsetColor.split(/\s+/),t=e.length<2?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];a.btn.style.borderColor=t}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)};for(var n=0,s=4;n<jscolor.images.sld[1];n+=s){var r=document.createElement("div");r.style.height=s+"px",r.style.fontSize="1px",r.style.lineHeight="0",jscolor.picker.sld.appendChild(r)}jscolor.picker.sldB.appendChild(jscolor.picker.sld),jscolor.picker.box.appendChild(jscolor.picker.sldB),jscolor.picker.box.appendChild(jscolor.picker.sldM),jscolor.picker.padB.appendChild(jscolor.picker.pad),jscolor.picker.box.appendChild(jscolor.picker.padB),jscolor.picker.box.appendChild(jscolor.picker.padM),jscolor.picker.btnS.appendChild(jscolor.picker.btnT),jscolor.picker.btn.appendChild(jscolor.picker.btnS),jscolor.picker.box.appendChild(jscolor.picker.btn),jscolor.picker.boxB.appendChild(jscolor.picker.box)}var a=jscolor.picker;a.box.onmouseup=a.box.onmouseout=function(){target.focus()},a.box.onmousedown=function(){abortBlur=!0},a.box.onmousemove=function(e){(holdPad||holdSld)&&(holdPad&&setPad(e),holdSld&&setSld(e),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),dispatchImmediateChange())},a.padM.onmouseup=a.padM.onmouseout=function(){holdPad&&(holdPad=!1,jscolor.fireEvent(valueElement,"change"))},a.padM.onmousedown=function(e){switch(modeID){case 0:0===THIS.hsv[2]&&THIS.fromHSV(null,null,1);break;case 1:0===THIS.hsv[1]&&THIS.fromHSV(null,1,null)}holdPad=!0,setPad(e),dispatchImmediateChange()},a.sldM.onmouseup=a.sldM.onmouseout=function(){holdSld&&(holdSld=!1,jscolor.fireEvent(valueElement,"change"))},a.sldM.onmousedown=function(e){holdSld=!0,setSld(e),dispatchImmediateChange()};var o=getPickerDims(THIS);a.box.style.width=o[0]+"px",a.box.style.height=o[1]+"px",a.boxB.style.position="absolute",a.boxB.style.clear="both",a.boxB.style.left=e+"px",a.boxB.style.top=t+"px",a.boxB.style.zIndex=THIS.pickerZIndex,a.boxB.style.border=THIS.pickerBorder+"px solid",a.boxB.style.borderColor=THIS.pickerBorderColor,a.boxB.style.background=THIS.pickerFaceColor,a.pad.style.width=jscolor.images.pad[0]+"px",a.pad.style.height=jscolor.images.pad[1]+"px",a.padB.style.position="absolute",a.padB.style.left=THIS.pickerFace+"px",a.padB.style.top=THIS.pickerFace+"px",a.padB.style.border=THIS.pickerInset+"px solid",a.padB.style.borderColor=THIS.pickerInsetColor,a.padM.style.position="absolute",a.padM.style.left="0",a.padM.style.top="0",a.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px",a.padM.style.height=a.box.style.height,a.padM.style.cursor="crosshair",a.sld.style.overflow="hidden",a.sld.style.width=jscolor.images.sld[0]+"px",a.sld.style.height=jscolor.images.sld[1]+"px",a.sldB.style.display=THIS.slider?"block":"none",a.sldB.style.position="absolute",a.sldB.style.right=THIS.pickerFace+"px",a.sldB.style.top=THIS.pickerFace+"px",a.sldB.style.border=THIS.pickerInset+"px solid",a.sldB.style.borderColor=THIS.pickerInsetColor,a.sldM.style.display=THIS.slider?"block":"none",a.sldM.style.position="absolute",a.sldM.style.right="0",a.sldM.style.top="0",a.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px",a.sldM.style.height=a.box.style.height;try{a.sldM.style.cursor="pointer"}catch(l){a.sldM.style.cursor="hand"}a.btn.style.display=THIS.pickerClosable?"block":"none",a.btn.style.position="absolute",a.btn.style.left=THIS.pickerFace+"px",a.btn.style.bottom=THIS.pickerFace+"px",a.btn.style.padding="0 15px",a.btn.style.height="18px",a.btn.style.border=THIS.pickerInset+"px solid",i(),a.btn.style.color=THIS.pickerButtonColor,a.btn.style.font="12px sans-serif",a.btn.style.textAlign="center";try{a.btn.style.cursor="pointer"}catch(l){a.btn.style.cursor="hand"}switch(a.btn.onmousedown=function(){THIS.hidePicker()},a.btnS.style.lineHeight=a.btn.style.height,modeID){case 0:var u="hs.png";break;case 1:var u="hv.png"}a.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')",a.padM.style.backgroundRepeat="no-repeat",a.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')",a.sldM.style.backgroundRepeat="no-repeat",a.pad.style.backgroundImage="url('"+jscolor.getDir()+u+"')",a.pad.style.backgroundRepeat="no-repeat",a.pad.style.backgroundPosition="0 0",redrawPad(),redrawSld(),jscolor.picker.owner=THIS,document.getElementsByTagName("body")[0].appendChild(a.boxB)}function getPickerDims(e){var t=[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]];return t}function redrawPad(){switch(modeID){case 0:var e=1;break;case 1:var e=2}var t=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1)),i=Math.round((1-THIS.hsv[e])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+i-Math.floor(jscolor.images.cross[1]/2))+"px";var n=jscolor.picker.sld.childNodes;switch(modeID){case 0:for(var s=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1),r=0;r<n.length;r+=1)n[r].style.backgroundColor="rgb("+100*s[0]*(1-r/n.length)+"%,"+100*s[1]*(1-r/n.length)+"%,"+100*s[2]*(1-r/n.length)+"%)";break;case 1:var s,a,o=[THIS.hsv[2],0,0],r=Math.floor(THIS.hsv[0]),l=r%2?THIS.hsv[0]-r:1-(THIS.hsv[0]-r);switch(r){case 6:case 0:s=[0,1,2];break;case 1:s=[1,0,2];break;case 2:s=[2,0,1];break;case 3:s=[2,1,0];break;case 4:s=[1,2,0];break;case 5:s=[0,2,1]}for(var r=0;r<n.length;r+=1)a=1-1/(n.length-1)*r,o[1]=o[0]*(1-a*l),o[2]=o[0]*(1-a),n[r].style.backgroundColor="rgb("+100*o[s[0]]+"%,"+100*o[s[1]]+"%,"+100*o[s[2]]+"%)"}}function redrawSld(){switch(modeID){case 0:var e=2;break;case 1:var e=1}var t=Math.round((1-THIS.hsv[e])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){valueElement===target&&THIS.importColor(),THIS.pickerOnfocus&&THIS.hidePicker()}function blurValue(){valueElement!==target&&THIS.importColor()}function setPad(e){var t=jscolor.getRelMousePos(e),i=t.x-THIS.pickerFace-THIS.pickerInset,n=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(i*(6/(jscolor.images.pad[0]-1)),1-n/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(i*(6/(jscolor.images.pad[0]-1)),null,1-n/(jscolor.images.pad[1]-1),leaveSld)}}function setSld(e){var t=jscolor.getRelMousePos(e),i=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-i/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-i/(jscolor.images.sld[1]-1),null,leavePad)}}function dispatchImmediateChange(){THIS.onImmediateChange&&("string"==typeof THIS.onImmediateChange?eval(THIS.onImmediateChange):THIS.onImmediateChange(THIS))}this.required=!0,this.adjust=!0,this.hash=!1,this.caps=!0,this.slider=!0,this.valueElement=target,this.styleElement=target,this.onImmediateChange=null,this.hsv=[0,0,1],this.rgb=[1,1,1],this.pickerOnfocus=!0,this.pickerMode="HSV",this.pickerPosition="bottom",this.pickerSmartPosition=!0,this.pickerButtonHeight=20,this.pickerClosable=!1,this.pickerCloseText="Close",this.pickerButtonColor="ButtonText",this.pickerFace=10,this.pickerFaceColor="ThreeDFace",this.pickerBorder=1,this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight",this.pickerInset=1,this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",this.pickerZIndex=1e4;for(var p in prop)prop.hasOwnProperty(p)&&(this[p]=prop[p]);this.hidePicker=function(){isPickerOwner()&&removePicker()},this.showPicker=function(){if(!isPickerOwner()){var e,t,i,n=jscolor.getElementPos(target),s=jscolor.getElementSize(target),r=jscolor.getViewPos(),a=jscolor.getViewSize(),o=getPickerDims(this);switch(this.pickerPosition.toLowerCase()){case"left":e=1,t=0,i=-1;break;case"right":e=1,t=0,i=1;break;case"top":e=0,t=1,i=-1;break;default:e=0,t=1,i=1}var l=(s[t]+o[t])/2;if(this.pickerSmartPosition)var u=[-r[e]+n[e]+o[e]>a[e]?-r[e]+n[e]+s[e]/2>a[e]/2&&n[e]+s[e]-o[e]>=0?n[e]+s[e]-o[e]:n[e]:n[e],-r[t]+n[t]+s[t]+o[t]-l+l*i>a[t]?-r[t]+n[t]+s[t]/2>a[t]/2&&n[t]+s[t]-l-l*i>=0?n[t]+s[t]-l-l*i:n[t]+s[t]-l+l*i:n[t]+s[t]-l+l*i>=0?n[t]+s[t]-l+l*i:n[t]+s[t]-l-l*i];else var u=[n[e],n[t]+s[t]-l+l*i];drawPicker(u[e],u[t])}},this.importColor=function(){valueElement?this.adjust?!this.required&&/^\s*$/.test(valueElement.value)?(valueElement.value="",styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.fromString(valueElement.value)||this.exportColor():this.fromString(valueElement.value,leaveValue)||(styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.exportColor()},this.exportColor=function(e){if(!(e&leaveValue)&&valueElement){var t=this.toString();this.caps&&(t=t.toUpperCase()),this.hash&&(t="#"+t),valueElement.value=t}e&leaveStyle||!styleElement||(styleElement.style.backgroundImage="none",styleElement.style.backgroundColor="#"+this.toString(),styleElement.style.color=.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]<.5?"#FFF":"#000"),e&leavePad||!isPickerOwner()||redrawPad(),e&leaveSld||!isPickerOwner()||redrawSld()},this.fromHSV=function(e,t,i,n){0>e&&(e=0)||e>6&&(e=6),0>t&&(t=0)||t>1&&(t=1),0>i&&(i=0)||i>1&&(i=1),this.rgb=HSV_RGB(null===e?this.hsv[0]:this.hsv[0]=e,null===t?this.hsv[1]:this.hsv[1]=t,null===i?this.hsv[2]:this.hsv[2]=i),this.exportColor(n)},this.fromRGB=function(e,t,i,n){0>e&&(e=0)||e>1&&(e=1),0>t&&(t=0)||t>1&&(t=1),0>i&&(i=0)||i>1&&(i=1);var s=RGB_HSV(null===e?this.rgb[0]:this.rgb[0]=e,null===t?this.rgb[1]:this.rgb[1]=t,null===i?this.rgb[2]:this.rgb[2]=i);null!==s[0]&&(this.hsv[0]=s[0]),0!==s[2]&&(this.hsv[1]=s[1]),this.hsv[2]=s[2],this.exportColor(n)},this.fromString=function(e,t){var i=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return i?(6===i[1].length?this.fromRGB(parseInt(i[1].substr(0,2),16)/255,parseInt(i[1].substr(2,2),16)/255,parseInt(i[1].substr(4,2),16)/255,t):this.fromRGB(parseInt(i[1].charAt(0)+i[1].charAt(0),16)/255,parseInt(i[1].charAt(1)+i[1].charAt(1),16)/255,parseInt(i[1].charAt(2)+i[1].charAt(2),16)/255,t),!0):!1},this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var THIS=this,modeID="hvs"===this.pickerMode.toLowerCase()?1:0,abortBlur=!1,valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement),holdPad=!1,holdSld=!1,leaveValue=1,leaveStyle=2,leavePad=4,leaveSld=8;if(jscolor.addEvent(target,"focus",function(){THIS.pickerOnfocus&&THIS.showPicker()}),jscolor.addEvent(target,"blur",function(){abortBlur?abortBlur=!1:window.setTimeout(function(){abortBlur||blurTarget(),abortBlur=!1},0)}),valueElement){var updateField=function(){THIS.fromString(valueElement.value,leaveValue),dispatchImmediateChange()};jscolor.addEvent(valueElement,"keyup",updateField),jscolor.addEvent(valueElement,"input",updateField),jscolor.addEvent(valueElement,"blur",blurValue),valueElement.setAttribute("autocomplete","off")}switch(styleElement&&(styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color}),modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif"),jscolor.requireImage("arrow.gif"),this.importColor()}};jscolor.install(),Oskari.clazz.define("Oskari.framework.bundle.guidedtour.GuidedTourBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/instance.js"},{type:"text/javascript",src:"../../../../libraries/jquery/plugins/jquery.cookie.js"},{type:"text/css",src:"../../../../resources/framework/bundle/guidedtour/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/en.js"},{lang:"cs",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/cs.js"},{lang:"de",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/de.js"},{lang:"es",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/es.js"}]},bundle:{manifest:{"Bundle-Identifier":"guidedtour","Bundle-Name":"guidedtour","Bundle-Author":[{Name:"ev",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("guidedtour","Oskari.framework.bundle.guidedtour.GuidedTourBundle"),Oskari.clazz.define("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance",function(e){this.sandbox=null,this._localization=e,this.mediator=null,this.guideStep=0},{__name:"GuidedTour",getName:function(){return this.__name},getTitle:function(){return this._localization.title},getDescription:function(){return this._localization.desc},getSandbox:function(){return this.sandbox},update:function(){},start:function(){if(this._localization||(this._localization=Oskari.getLocalization(this.getName())),"1"!=jQuery.cookie("pti_tour_seen")){var e=this,t=e.conf,i=(t?t.sandbox:null)||"sandbox",n=Oskari.getSandbox(i);e.sandbox=n,n.register(e),e._startGuide()}},_startGuide:function(){var e=this,t="Oskari.userinterface.component.Popup",i=Oskari.clazz.create(t);e.guideStep=0,i.makeDraggable(),i.addClass("guidedtour"),e._showGuideContentForStep(e.guideStep,i)},_guideSteps:[{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){return this.ref._localization.page1.title},getContent:function(){var e=jQuery("<div></div>");return e.append(this.ref._localization.page1.message),e}},{setScope:function(e){this.ref=e},getTitle:function(){return""+this.ref._localization.page2.title+"<span>1/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Search");var t=e._localization.page2,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),s=n.clone();s.append(t.openLink),s.bind("click",function(){e._openExtension("Search"),s.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Search"),s.show(),r.hide()}),i.append("<br /><br />"),i.append(s),i.append(r),r.show(),s.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page3.title;return e+"<span>2/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelector");var t=e._localization.page3,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),s=n.clone();s.append(t.openLink),s.bind("click",function(){e._openExtension("LayerSelector"),s.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelector"),s.show(),r.hide()}),i.append("<br><br>"),i.append(s),i.append(r),r.show(),s.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page4.title;return e+"<span>3/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelection");var t=e._localization.page4,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),s=n.clone();s.append(t.openLink),s.bind("click",function(){e._openExtension("LayerSelection"),s.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelection"),s.show(),r.hide()}),i.append("<br><br>"),i.append(s),i.append(r),r.show(),s.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page5.title;return e+"<span>4/8</span>"},getContent:function(){var e=this.ref;e._openExtension("PersonalData");var t=e._localization.page5,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),s=n.clone();s.append(t.openLink),s.bind("click",function(){e._openExtension("PersonalData"),s.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("PersonalData"),s.show(),r.hide()}),i.append("<br><br>"),i.append(s),i.append(r),r.show(),s.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page6.title;return e+"<span>5/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Publisher");var t=e._localization.page6,i=jQuery("<div></div>");i.append(t.message);var n=jQuery('<a href="#"></a>'),s=n.clone();s.append(t.openLink),s.bind("click",function(){e._openExtension("Publisher"),s.hide(),r.show()});var r=n.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Publisher"),s.show(),r.hide()}),i.append("<br><br>"),i.append(s),i.append(r),r.show(),s.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page7.title;return e+"<span>6/8</span>"},getContent:function(){var e=this.ref;e._closeExtension("Publisher");var t=e._localization.page7,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery("#toolbar")},positionAlign:"right"},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page8.title;return e+"<span>7/8</span>"},getContent:function(){var e=this.ref,t=e._localization.page8,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".panbuttonDiv")},positionAlign:"left"},{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref._localization.page9.title;return e+"<span>8/8</span>"},getContent:function(){var e=this.ref,t=e._localization.page9,i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".pzbDiv")},positionAlign:"left"}],_showGuideContentForStep:function(e,t){var i=this._guideSteps[e];i.setScope(this);var n=this._getDialogButton(t),s=i.getTitle(),r=i.getContent();if(i.appendTourSeenCheckbox){r.append("<br><br>");var a=jQuery('<input type="checkbox" name="pti_tour_seen" id="pti_tour_seen" value="1">'),o=a.clone(),l=jQuery('<label for="pti_tour_seen"></label>'),u=l.clone();u.append(this._localization.tourseen.label),o.bind("change",function(){jQuery(this).attr("checked")?jQuery.cookie("pti_tour_seen","1",{expires:365}):jQuery.cookie("pti_tour_seen","0",{expires:1})}),r.append(o),r.append("&nbsp;"),r.append(u)}t.show(s,r,n),i.getPositionRef?t.moveTo(i.getPositionRef(),i.positionAlign):t.resetPosition()},_getFakeExtension:function(e){return{getName:function(){return e}}},_openExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"attach"])},_closeExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"close"])},_getDialogButton:function(e){var t,i=this,n=[],s=i._localization.button.close,r=e.createCloseButton(s);
if(n.push(r),this.guideStep>1){t="Oskari.userinterface.component.Button";var a=Oskari.clazz.create(t),o=i._localization.button.previous;a.setTitle(o),a.setHandler(function(){i.guideStep--,i._showGuideContentForStep(i.guideStep,e)}),n.push(a)}if(0===this.guideStep){t="Oskari.userinterface.component.Button";var l=Oskari.clazz.create(t),u=i._localization.button.start;l.setTitle(u),l.setHandler(function(){i.guideStep++,i._showGuideContentForStep(i.guideStep,e)}),n.push(l)}else if(this.guideStep<this._guideSteps.length-1){t="Oskari.userinterface.component.Button";var h=Oskari.clazz.create(t),c=i._localization.button.next;h.setTitle(c),h.setHandler(function(){i.guideStep++,i._showGuideContentForStep(i.guideStep,e)}),n.push(h),e.addClass("bluetitle")}else if(this.guideStep===this._guideSteps.length-1){var p=i._localization.button.finish,d=e.createCloseButton(p);n.push(d)}return n},init:function(){return null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];if(!i){var n=i.apply(this,[e]);if(n)return n}return null},eventHandlers:{},stop:function(){var e=this;e.sandbox(),e.sandbox.unregister(e)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});